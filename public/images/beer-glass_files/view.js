define(["plugin-dependencies","jquery","underscore","backbone","common/plugin-loader/media","plugin-components/layers/layers","text!./view.html","css!./view.css"],function(e,n,i,t,s,a,o){var l=new a,r=t.View.extend({className:"media-loader",initialize:function(){i.bindAll(this,"render","setModel","sizeChange","handleLayers")},render:function(){return this.$el.html(o),s.init(this.model,this.$el.find(".media-container"),!0).show(),s.on("rendition.layers.toggle",this.handleLayers),this.model.on("change",function(e){s.updateMetadata(e)}),e.events.on("page_view",this.remove),this.sizeChange(),this},remove:function(){s.hide(),s.off("rendition.layers.toggle",this.handleLayers),e.events.off("page_view",this.remove)},setModel:function(e){this.model=e},sizeChange:function(){s.sizeChange()},handleLayers:function(){var i,t=e.utils.getCurrentBasePath(),a=/^#?link/.test(t);i=n(a?".cc-ActivityPlugin-aside":".layers-container"),i.toggleClass("show-layers"),l.appendTo(i),l.setResource(this.model),l.show(),s.sizeChange()}});return new r});