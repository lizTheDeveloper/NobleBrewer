define(["jquery","plugin-dependencies","plugin-components/media-loader","./section/comment/el","./section/color/el","./section/app/el","./section/font/el","text!./main.html","css!./main.css"],function(i,e,t,n,c,a,s,l){return l=e.utils.createTemplate(l),function(o){function d(i){var e={height:o.get("height")||500,width:o.get("width")||500},t=e.width/e.height;return t>=1&&e.width>i?(e.width=i,e.height=Math.round(i/t)):1>t&&e.height>i&&(e.height=i,e.width=Math.round(i*t)),e}var h,r,g,u,f=1e3,m=d(f),v=o.get("colors"),p=o.get("app"),y=o.get("fonts"),w=/^#?video/.test(o.get("type")),A=function(){var i=m.width/m.height,e=r.outerWidth(!0),t=260,n=m.height,c=e/i,a=n>c?c:n;r.css("height",Math.max(t,Math.round(a))),w&&r.addClass("video"),g.css("visibility","visible"),P.sizeChange()},P={$el:i("<div>").addClass("cc-ActivityPlugin"),show:function(){h=this.$el,h.html(l({translate:e.translate})),u=h.find(".cc-ActivityPlugin-article"),r=h.find(".cc-ActivityPlugin-imgframe"),g=h.find(".cc-ActivityPlugin-metadata"),g.css("visibility","hidden"),t.setModel(o),h.find(".cc-ActivityPlugin-imgframe").append(t.render().$el);var d=o.get("permissions");d&&d.comment||!e.utils.hasFeature("collaboration_service_links")?h.find(".cc-ActivityPlugin-section-comment").replaceWith(new n(o)):h.find(".cc-ActivityPlugin-left-metadata").remove(),v||p||y?(h.find(".cc-ActivityPlugin-section-color").replaceWith(new c(o)),h.find(".cc-ActivityPlugin-section-app").replaceWith(new a(o)),h.find(".cc-ActivityPlugin-section-font").replaceWith(new s(o))):g.addClass("left-metadata-only"),i(window).on("resize",A),_.defer(A)},hide:function(){t.remove()},sizeChange:function(){t.sizeChange()}};return P=_.extend(i({}),P)}});