define(["require","jquery","underscore","plugin-dependencies","common/datastore/collabservice/api/comments/create"],function(e,t,a,o,n){var i={},r={};return i.getLink=function(e){var a=new t.Deferred;return t.ajax({type:"GET",url:o.config("sharedcloud_proxy_url")+"/links/"+e}).done(function(e){return"view_sharedcloud_resource"===e.type?void a.resolve(e):void a.reject()}).fail(a.reject),a.promise()},i.getResource=function(a,n){var i=t.Deferred(),s=-1!=n.indexOf("collections"),l=s?"/collections/":"/assets/",c=n.split(l).shift(),d=s?n+"?assetView=asset_overview&collectionView=collection_overview":n+"/metadata",u=s?"sharedcloud-proxy.route.getcollectionmetadata":"sharedcloud-proxy.route.getassetmetadata";if(d in r)return i.resolve(r[d]).promise();var p={"X-Location":d,Accept:"application/hal+json"};return s?e(["files/data/paginatedCollection"],function(e){var t=new e(n,{linkId:a,max:1e3,assetView:"asset_overview",sortAttribute:"mimetype"});t.at(0).done(function(e){e.parentLocation=e.parent_collection,r[d]=e,i.resolve(e)}).fail(i.reject)}):t.ajax({type:"GET",dataType:"json",url:o.config("sharedcloud_proxy_url")+"/api",data:{link:a},timeout:6e4,headers:p}).done(function(e){var t=e.asset.mimeType,a=e._links.self.name,s=o.utils.isAssetShareable(o.objectUtils.get(e,"asset.mimeType"),o.objectUtils.get(e,"ugc")),l={apiPath:c,location:n,name:a,type:t,_isShareable:s,_defaultIcon:t?o.utils.getValidDefaultIcon(t,a):void 0,parentLocation:e._links.parent.href,metadata:e};r[d]=l,i.resolve(l)}).fail(i.reject).always(o.logAjaxDuration(u)),i.promise()},i.addComment=function(e,t,a){var o="application/vnd.adobe.asset";return n(t,o,a.commenter_name,a.commenter_email,a.content,null)},i});