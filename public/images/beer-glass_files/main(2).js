define("ccweb.files.extract/models/PluginConfigModel",["underscore","backbone","plugin-dependencies"],function(e,t,i){"use strict";var s=t.Model.extend({defaults:{buildSHA:"538db857255817cdc3929336d9a50c9bc2cb1d29"},getBuildNumber:function(){return this.get("buildSHA")}});return s});define("ccweb.files.extract/models/PluginAuthModel",["underscore","backbone","plugin-dependencies"],function(e,t,i){"use strict";var s=t.Model.extend({defaults:{access_token:null,expires_in:null,user_data:null,adobeID:null},initialize:function(){},isValid:function(){return!0},isValidWithUserFeature:function(e){return!0},isAnalyticsOptIn:function(){return!0},isAdobeInternalUser:function(){var e=!1,t=i.user.get("email");if(t){var s=t.lastIndexOf("@");if(-1!==s){var n=t.substr(s+1);n=n.toLowerCase();("adobe.com"===n||"adobetest.com"===n||"601t.com"===n||"adobecc.com"===n)&&(e=!0)}}return e},setAnalyticsOptIn:function(e){},getAdobeId:function(){var e=i.user.profile().userId||"";return e},getRegisterDate:function(){return""}});return s});define("ccweb.files.extract/models/MetricsProxyModel",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({defaults:{authModel:null,configModel:null},setAuthModel:function(e){this.authModel=e},setConfigModel:function(e){this.configModel=e;this.setDefaultParam("parfaitBuild",this.configModel.getBuildNumber())},initialize:function(){window.graphite=window.graphite||{};window.graphite.events=window.graphite.events||e.extend({},t.Events);window.graphite.events.on("landing-page",this.onLandingPage,this);window.graphite.events.on("login-dialog-shown",this.handleLogInDialogShown,this);window.graphite.events.on("logged-in",this.handleLoggedIn,this);window.graphite.events.on("upload-init",this.uploadInit,this);window.graphite.events.on("uploaded",this.uploaded,this);window.graphite.events.on("upload-failed",this.uploadFailed,this);window.graphite.events.on("processed",this.processed,this);window.graphite.events.on("processing-failed",this.processingFailed,this);window.graphite.events.on("drawPreviewFinish",this.drawPreviewFinish,this);window.graphite.events.on("selectedTab",this.selectedTab,this);window.graphite.events.on("help-dialog",this.helpDialog,this);window.graphite.events.on("help-dialog-shortcut",this.helpDialogShortCut,this);window.graphite.events.on("first-user-overlay-shortcut",this.FUXShortCut,this);window.graphite.events.on("show-color-popup",this.showColorPopup,this);window.graphite.events.on("show-measurement-offsets",this.showMeasurementOffsets,this);window.graphite.events.on("copy-css",this.copyCSS,this);window.graphite.events.on("copy-text",this.copyText,this);window.graphite.events.on("copy-value",this.copyValue,this);window.graphite.events.on("color-format",this.colorFormat,this);window.graphite.events.on("report-fidelity-error",this.reportFidelityError,this);window.graphite.events.on("typekitSearch",this.typekitSearch,this);window.graphite.events.on("extract-asset-download-init",this.extractAssetDownload,this);window.graphite.events.on("extract-asset-direct-download",this.extractAssetDownloadDirect,this);window.graphite.events.on("add-asset-to-catalog",this.addAssetToCatalog,this);window.graphite.events.on("asset-extracted-scaled",this.scaledAssetExtracted,this);window.graphite.events.on("canvasClick",this.canvasClicked,this);window.graphite.events.on("canvasClickDrag",this.canvasClickDrag,this);window.graphite.events.on("cssDoublClick",this.cssDoubleClick,this);window.graphite.events.on("register-defaults",this.registerDefaults,this);window.graphite.events.on("load-alert",this.loadAlert,this);window.graphite.events.on("load-calltoaction",this.loadCallToAction,this);window.graphite.events.on("bad-file-type-dragdrop",this.badFileTypeDragDrop,this);window.graphite.events.on("show-extract-asset-popup",this.showExtractAssetPopup,this);window.graphite.events.on("downloading-extracted-asset",this.downloadingExtractedAsset,this);window.graphite.events.on("downloading-psd",this.downloadingPSD,this);window.graphite.events.on("featureFlagSet",this.featureFlagSet,this);window.graphite.events.on("layerCompShown",this.layerCompShown,this);window.graphite.events.on("layerCompChanged",this.layerCompChanged,this);window.graphite.events.on("commitDropperColor",this.handleDropperExtraction,this);window.graphite.events.on("preprocessorChanged",this.handlePreprocessorChanged,this);window.graphite.events.on("catchIntercept",this.handleIntercept,this);window.graphite.events.on("baseFontSizeChanged",this.handleBaseFontSizeChanged,this);window.graphite.events.on("preferredFontUnitsChanged",this.handlePreferredFontUnitsChanged,this);window.graphite.events.on("show-job-list-overlay",this.handleShowJobListOverlay,this);window.graphite.events.on("upload-psd-public-one-up",this.handleUploadOneUp,this);window.graphite.events.on("measurement-notification-shown",this.handleMeasurementNotificationShown,this);window.graphite.events.on("measurement-notification-closed",this.handleMeasurementNotificationClosed,this);window.graphite.events.on("artboardpsd-shown",this.handleArtboardShown,this);window.graphite.events.on("nonartboardpsd-shown",this.handleNonArtboardShown,this);window.graphite.events.on("artboard-zoomToFit",this.handleArtboardZoomToFit,this);this.defaultParams={}},registerDefaults:function(){graphite.serverAPI.registerPersistentParameters(this.defaultParams);window.graphite.events.off("register-defaults")},mergeParams:function(e){var t,i={},s=new Date;for(t in this.defaultParams)this.defaultParams.hasOwnProperty(t)&&(i[t]=this.defaultParams[t]);for(t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);i.timestamp=s.getTime();return i},setDefaultParam:function(e,t){this.defaultParams[e]=t},onLandingPage:function(){this.trackEvent("landing-page")},handleLogInDialogShown:function(){this.trackEvent("login-dialog-shown")},handleLoggedIn:function(){this.trackEvent("logged-in")},uploadInit:function(e){var t,i=e.files.length;for(t=0;i>t;t++){var s=e.files[t].name,n={filename:s};this.trackEvent("upload-init",n)}},uploaded:function(e){this.trackEvent("uploaded",e)},uploadFailed:function(e){this.trackEvent("upload-failed",e)},processed:function(e){this.trackEvent("processed",e)},processingFailed:function(e){this.trackEvent("processing-failed",e)},drawPreviewFinish:function(e){var t=Date.now(),i=t-e.get("previewStarted"),s={renditionDuration:i};this.setDefaultParam("assetID",e.get("id"));this.trackEvent("rendered",s)},selectedTab:function(e){this.trackEvent("selected-tab",{tabName:e.selectedTab})},helpDialog:function(){this.trackEvent("help-dialog")},helpDialogShortCut:function(){this.trackEvent("help-dialog-shortcut")},FUXShortCut:function(){this.trackEvent("first-user-overlay-shortcut")},showColorPopup:function(){this.trackEvent("show-color-popup")},showMeasurementOffsets:function(){this.trackEvent("show-measurement-offsets")},copyCSS:function(e){this.trackEvent("copy-css",e)},copyText:function(){this.trackEvent("copy-text")},copyValue:function(e){this.trackEvent("copy-value",e)},colorFormat:function(e){this.trackEvent("color-format",e)},reportFidelityError:function(){this.trackEvent("report-fidelity-error")},typekitSearch:function(){this.trackEvent("typekit-search")},extractAssetDownload:function(e){this.trackEvent("extract-asset-download-init",e)},extractAssetDownloadDirect:function(e){this.trackEvent("extract-asset-direct-download",e)},addAssetToCatalog:function(e){this.trackEvent("add-asset-to-catalog",e)},scaledAssetExtracted:function(e){this.trackEvent("asset-extracted-scaled",e)},canvasClicked:function(e){this.trackEvent("psd-preview-canvas-clicked",e)},canvasClickDrag:function(e){this.trackEvent("psd-preview-canvas-clickdrag",e)},cssDoubleClick:function(e){this.trackEvent("css-properties-doubleclick",e)},loadAlert:function(e){this.trackEvent("load-alert",{alertMessage:e})},loadCallToAction:function(e){this.trackEvent("load-calltoaction")},badFileTypeDragDrop:function(e){this.trackEvent("bad-file-type-dragdrop",e)},showExtractAssetPopup:function(e){this.trackEvent("show-extract-asset-popup",{origin:e.origin})},downloadingExtractedAsset:function(e){this.trackEvent("downloading-extracted-asset",e)},downloadingPSD:function(e){this.trackEvent("downloading-psd",e)},featureFlagSet:function(e){this.trackEvent("feature-flag-set",e)},layerCompShown:function(){this.trackEvent("layer-comp-shown")},layerCompChanged:function(){this.trackEvent("layer-comp-changed")},handleDropperExtraction:function(){this.trackEvent("dropper-color-extracted")},handlePreprocessorChanged:function(e){this.trackEvent("preprocessor-changed",e)},handleIntercept:function(e){this.trackEvent("catch-intercept",e)},handleBaseFontSizeChanged:function(e){this.trackEvent("base-font-size-changed",e)},handlePreferredFontUnitsChanged:function(e){this.trackEvent("preferred-font-units-changed",e)},handleShowJobListOverlay:function(e){this.trackEvent("show-job-list-overlay",e)},handleUploadOneUp:function(e){this.trackEvent("upload-psd-public-one-up",e)},handleMeasurementNotificationShown:function(e){this.trackEvent("measurement-notification-shown",e)},handleMeasurementNotificationClosed:function(e){this.trackEvent("measurement-notification-closed",e)},handleArtboardShown:function(e){this.trackEvent("artboardpsd-shown",e)},handleNonArtboardShown:function(e){this.trackEvent("nonartboardpsd-shown",e)},handleArtboardZoomToFit:function(e){this.trackEvent("artboard-zoomToFit",e)},trackEvent:function(e,t){function i(e){}function s(e){}var n,r,a="EDGE_EXTRACT_LANDING",o=t||{};if(this.authModel){if(!this.authModel.isAnalyticsOptIn())return;if(this.authModel.isValid()){o.adobeID=this.authModel.getAdobeId();o.internalUser=this.authModel.isAdobeInternalUser();o.registerDate=this.authModel.getRegisterDate();graphite.serverAPI.registerPersistentParameters({internalUser:o.internalUser,registerDate:this.authModel.getRegisterDate()});a="EDGE_EXTRACT_ACTIVITY"}}o.isPublic1UpView=graphite.inPublicOneUp();n={"selected-tab":{event:a,subevent:"SELECTED_TAB"},"show-color-popup":{event:a,subevent:"SHOW_COLOR_POPUP"},"show-measurement-offsets":{event:a,subevent:"SHOW_MEASUREMENT_OFFSETS"},"copy-css":{event:a,subevent:"COPY_CSS"},"copy-text":{event:a,subevent:"COPY_TEXT"},"copy-value":{event:a,subevent:"COPY_VALUE"},"color-format":{event:a,subevent:"COLOR_FORMAT"},"dropper-color-extracted":{event:a,subevent:"DROPPER_COLOR_EXTRACTED"},"report-fidelity-error":{event:a,subevent:"FIDELITY_ERROR"},"typekit-search":{event:a,subevent:"TYPEKIT_SEARCH"},"extract-asset-download-init":{event:a,subevent:"ASSET_DOWNLOAD_INIT"},"extract-asset-direct-download":{event:a,subevent:"ASSET_DIRECT_DOWNLOAD"},"add-asset-to-catalog":{event:a,subevent:"ADD_ASSET_TO_CATALOG"},"asset-extracted-scaled":{event:a,subevent:"ASSET_EXTRACTED_SCALED"},"show-extract-asset-popup":{event:a,subevent:"SHOW_EXTRACT_ASSET_POPUP"},"downloading-extracted-asset":{event:a,subevent:"DOWNLOADING_EXTRACTED_ASSET"},"downloading-psd":{event:a,subevent:"DOWNLOADING_PSD"},"psd-preview-canvas-clicked":{event:a,subevent:"PSD_CANVAS_CLICKED"},"psd-preview-canvas-clickdrag":{event:a,subevent:"PSD_CANVAS_CLICKDRAG"},"css-properties-doubleclick":{event:a,subevent:"CSS_PROPERTIES_DOUBLECLICKED"},rendered:{event:a,subevent:"RENDERED"},"layer-comp-shown":{event:a,subevent:"LAYER_COMP_SHOWN"},"layer-comp-changed":{event:a,subevent:"LAYER_COMP_CHANGED"},"show-vendor-prefixes":{event:a,subevent:"SHOW_VENDOR_PREFIXES"},"preprocessor-changed":{event:a,subevent:"CSS_PREPROCESSOR_CHANGED"},"catch-intercept":{event:a,subevent:"CATCH_INTERCEPT"},"base-font-size-changed":{event:a,subevent:"BASE_FONT_SIZE_CHANGED"},"preferred-font-units-changed":{event:a,subevent:"PREFERRED_FONT_UNITS_CHANGED"},"upload-psd-public-one-up":{event:a,subevent:"UPLOAD_PSD_PUBLIC_ONE_UP"},"measurement-notification-shown":{event:a,subevent:"MEASUREMENT-NOTIFICATION-SHOWN"},"measurement-notification-closed":{event:a,subevent:"MEASUREMENT-NOTIFICATION-CLOSED"},"artboardpsd-shown":{event:a,subevent:"ARTBOARDPSD-SHOWN"},"nonartboardpsd-shown":{event:a,subevent:"NONARTBOARDPSD-SHOWN"},"artboard-zoomToFit":{event:a,subevent:"ARTBOARD-ZOOMTOFIT"},"load-calltoaction":{event:"EDGE_EXTRACT_LANDING",subevent:"CALLTOACTION_DIALOG"},"landing-page":{event:"EDGE_EXTRACT_LANDING",subevent:"LANDING_PAGE"},"login-dialog-shown":{event:"EDGE_EXTRACT_LANDING",subevent:"LOGIN_DIALOG"},"feature-flag-set":{event:"EDGE_EXTRACT_NAVIGATION",subevent:"FEATURE_FLAG_SET"},"load-alert":{event:"EDGE_EXTRACT_NAVIGATION",subevent:"ALERT_DIALOG"},"logged-in":{event:"EDGE_EXTRACT_NAVIGATION",subevent:"SIGNON_SSO"},"upload-init":{event:"EDGE_EXTRACT_UPLOAD",subevent:"INIT"},uploaded:{event:"EDGE_EXTRACT_UPLOAD",subevent:"COMPLETE"},"upload-failed":{event:"EDGE_EXTRACT_UPLOAD",subevent:"FAILED"},processed:{event:"EDGE_EXTRACT_UPLOAD",subevent:"PROCESSED"},"processing-failed":{event:"EDGE_EXTRACT_UPLOAD",subevent:"PROCESSING_FAILED"},"bad-file-type-dragdrop":{event:"EDGE_EXTRACT_UPLOAD",subevent:"BAD_FILE_TYPE_DRAGDROP"},"help-dialog":{event:"EDGE_EXTRACT_HELP",subevent:"HELP_DIALOG"},"help-dialog-shortcut":{event:"EDGE_EXTRACT_HELP",subevent:"HELP_DIALOG_SHORTCUT"},"first-user-overlay-shortcut":{event:"EDGE_EXTRACT_HELP",subevent:"FIRST_USER_OVERLAY_SHORTCUT"},"show-job-list-overlay":{event:"EDGE_EXTRACT_HELP",subevent:"JOB_LIST_OVERLAY_SHORTCUT"}};r=n[e];if(r){var l=this.mergeParams(o);if(!l.timestamp){var c=new Date;l.timestamp=c.getTime()}l.firstUse=l.registerDate&&l.timestamp-l.registerDate<36e5;l.subevent=r.subevent;l.eventname=r.event;l.ownerId=graphite.ownerId;graphite.serverAPI.trackEvent(l,i,s,this)}}});return i});define("ccweb.files.extract/Constants",[],function(){"use strict";var e={DefaultPPI:72,BaseFontDefaultSize:16,FontUnitType:{EMS:"em",REMS:"rem",PX:"px",PT:"pt"},ColorFormat:{RGB:"RGB",HEX:"Hex",HSL:"HSL"},DesignedAtMultiplier:{OneX:1,TwoX:2,ThreeX:3,FourX:4},MenuPosition:{BELOW:"0",TOP:"1"},MeasurementUnitType:{PX:"px",PCT:"%"},PREVIEW_SPACING:12,PREVIEW_SCROLLBAR_SPACING:17,Type:{LAYER_ARTBOARD:"artboardLayer",LAYER_GROUP:"layerSection",LAYER:"layer",LAYER_TEXT:"textLayer",LAYER_CONTENT:"contentLayer",LAYER_ADJUSTMENT:"adjustmentLayer",LAYER_BACKGROUND:"backgroundLayer",LAYER_SMARTOBJ:"smartObject"},Shape:{ELLIPSE:"ellipse",RECTANGLE:"rectangle",PATH:"path"},ContentType:{SOLID_COLOR:"solidColorLayer"},InterceptNames:{SHIFT_CLICK_MEASUREMENT:"shiftClickMeasurement"},LayerWarnings:{MULTI_LAYER_STYLES_WARNING:"Layer contains multiple layer styles that cannot be represented in CSS. Use the color picker or extract the layer as an image."},NotificationTooltip:{MIN_DURATION:3e3},Tool:{SELECT_DIRECT:0,DROPPER:1},Tab:{TAB_INSPECT:0,TAB_LAYERS:1},Shortcut:{LEFT_ARROW:37,UP_ARROW:38,RIGHT_ARROW:39,DOWN_ARROW:40,HELP:191,CLEAR:27,FUX:73,COLOR_PICKER:69,ALT:18,SHIFT:16,CTRL:17,CMD:91,SECONDARY_CMD:93,CMD_FF:224,TOGGLE_MEASUREMENT:88},Platform:{MAC:0,WINDOWS:1},topOffsetWithMessageBar:70,toolTipTimeout:2e3,flashTimeout:2300,CCWEB_FILES_URL:"https://assets.adobe.com/files",CCWEB_FILES_URL_STAGE:"https://stage.adobecc.com/files",RE_SHORT_URL:/^http:\/\/adobe\.ly\/\w+$/,WorkerErrorCodes:{UNSUPPORTED_INPUTFMT:"unsupported_input_format_exception",NOINPUTFILE:"no_input_file_exception",GRAPHITE_PROCESSING:"graphite_processing_exception",GRAPHITE_REJECTED:"graphite_file_rejected"},WorkerErrorMsgs:{UNSUPPORTED_INPUTFMT:"Unsupported Image Format",NOINPUTFILE:"No files specified",GR_JSONGENERATION:"Graphite JSON generation failed.",GR_THUMBNAIL:"Graphite Thumbnail generation failed.",GR_SPRITESHEET:"Graphite Spritesheet generation failed.",GR_UNKNOWNENCODING:"Unspecified Encoding Format",GR_MISSINGLAYERSPEC:"Missing Layer Specification",GR_CREATINGASSET:"Error generating asset"}};return e});define("ccweb.files.extract/models/UserSettingsModel",["underscore","ccweb.files.extract/Constants","backbone"],function(e,t,i){"use strict";var s=i.Model.extend({defaults:{preferredFontUnits:t.FontUnitType.PX,preferredMeasurementUnits:t.MeasurementUnitType.PX,preprocessor:"css",scaleExtractedAssets:!1,assetScaleFactor:2,shownIntercepts:{shiftClickMeasurement:!0}},initialize:function(){this.off("change",this.save,this);var e,t,i=localStorage.getItem("extractUserSettings");if(i){t=JSON.parse(i);for(e in t)t.hasOwnProperty(e)&&this.set(e,t[e])}else this.reset();this.on("change",this.save,this)},reset:function(){this.off("change",this.save,this);this.clear().set(this.defaults);this.save();this.on("change",this.save,this)},save:function(){localStorage.setItem("extractUserSettings",JSON.stringify(this.attributes))},setInterceptShown:function(e,t){var i=this.get("shownIntercepts");i[e]=t;this.set("shownIntercepts",i);this.save()},shouldInterceptBeShown:function(e){var t=this.get("shownIntercepts");return t[e]}});return new s});define("ccweb.files.extract/models/PSDSettingsModel",["underscore","ccweb.files.extract/Constants","backbone"],function(e,t,i){"use strict";var s=i.Model.extend({initialize:function(e){i.Model.prototype.initialize.apply(this,arguments);this.on("change",this.save,this)},defaults:{baseFontSizeValue:t.BaseFontDefaultSize,baseFontSizeUnits:t.FontUnitType.PX,designedAtMultiplier:t.DesignedAtMultiplier.OneX},setup:function(e){this.psdGuid=e;this.reset();var t=this;window.graphite.serverAPI.updateGenericData&&window.graphite.serverAPI.loadGenericData(e,"extract_psd_settings",function(e){if(e.data){t.set(e.data,{silent:!0});window.graphite.events.trigger("psdSettingsChanged",this)}},function(){})},save:function(){var e,t=this;graphite.serverAPI.updateGenericData&&graphite.serverAPI.updateGenericData(this.psdGuid,"extract_psd_settings",function(i){var s,n=t.changedAttributes();e=i||t.toJSON();for(s in n)n.hasOwnProperty(s)&&(e[s]=t.get(s));return e},function(i){if(i.needsRefresh){t.set(e,{silent:!0});window.graphite.events.trigger("psdSettingsChanged",this)}},function(){},null)},reset:function(){this.clear({silent:!0}).set(this.defaults,{silent:!0});window.graphite&&window.graphite.events.trigger("psdSettingsChanged",this)}});return new s});define("ccweb.files.extract/controllers/DetailsController",["underscore","backbone","ccweb.files.extract/Constants"],function(e,t,i){"use strict";var s=t.Model.extend({spriteSheets:{},spritesLoaded:{},psdModel:null,defaults:{selectedTab:i.Tab.TAB_INSPECT,activeTool:i.Tool.SELECT_DIRECT,selectedInspectItem:null,inspectedAsset:null,toggleMeasurementOnHover:!1},getPSDModel:function(){return this.psdModel},setPSDModel:function(e){this.psdModel=e;this.spriteSheets={};this.spritesLoaded={};this.spriteSheetLoadedEvent=null},changeActiveTool:function(e){this.set("activeTool",e)},setSelectedTab:function(e){this.set("selectedTab",e)},getSelectedTab:function(){return this.get("selectedTab")},setSelectedInspectItem:function(e){this.set("selectedInspectItem",e)},setInspectedAsset:function(e){this.set("inspectedAsset",e)},setToggleMeasurementOnHover:function(){this.set("toggleMeasurementOnHover",!this.toggleMeasurementOnHover);this.toggleMeasurementOnHover=!this.toggleMeasurementOnHover},disableMeasurementOnHover:function(){if(this.get("toggleMeasurementOnHover")){this.setToggleMeasurementOnHover();graphite.events.trigger("toggle-hover-measurement")}},drawSpriteSheet:function(e,t,i){var s=this.spriteSheets[e],n=this;if(void 0!==s&&null!==s)this.spritesLoaded[e]?t(s):s.drawWhenFinished.push(t);else{s=new Image;s.drawWhenFinished=[t];this.spriteSheets[e]=s;var r=this.getSpriteSheetURL(e);s.addEventListener("load",function(){var t=this;n.spritesLoaded[e]=!0;this.drawWhenFinished.forEach(function(e){e(t)});n.spriteSheetsLoaded()&&n.triggerSpriteSheetLoadedEvent()},!1);this.spritesLoaded[e]=!1;graphite.serverAPI.loadCrossDomainImage(s,r)}},getSpriteSheetURL:function(e){var t,i=this.psdModel.get("localContent");t=i?i.directory+"/spritesheet/"+e+".png":graphite.serverAPI.getSpriteSheetURL(this.psdModel.id,this.psdModel.get("layerCompId"),e);return t},triggerWhenSpriteSheetsLoaded:function(e){this.spriteSheetLoadedEvent=e;this.spriteSheetsLoaded()&&this.triggerSpriteSheetLoadedEvent()},triggerSpriteSheetLoadedEvent:function(e){graphite.events.trigger("hideWorkerProgress",-1);var t=e||this.spriteSheetLoadedEvent;this.spriteSheetLoadedEvent=null;t&&graphite.events.trigger(t,this.psdModel)},spriteSheetsLoaded:function(){var e;for(e in this.spriteSheets)if(this.spriteSheets.hasOwnProperty(e)&&!this.spriteSheets[e].complete)return!1;return!0}});return new s});define("ccweb.files.extract/collections/SubLayerCollection",["backbone"],function(e){"use strict";var t=e.Collection.extend({model:null,initialize:function(e){this.model=e}});return t});define("ccweb.files.extract/utils/Matrix",[],function(){"use strict";function e(e,i,s,n,r,a){if(null!==i&&void 0!==i||"[object SVGMatrix]"!==t.call(e))if(null!==e&&void 0!==e){this.a=+e;this.b=+i;this.c=+s;this.d=+n;this.e=+r;this.f=+a}else{this.a=1;this.b=0;this.c=0;this.d=1;this.e=0;this.f=0}else{this.a=e.a;this.b=e.b;this.c=e.c;this.d=e.d;this.e=e.e;this.f=e.f}}var t=Object.prototype.toString,i=String,s=Math,n=function(e){return e%360*s.PI/180},r=function(e){return 180*e/s.PI%360};!function(t){function a(e){return e[0]*e[0]+e[1]*e[1]}function o(e){var t=s.sqrt(a(e));e[0]&&(e[0]/=t);e[1]&&(e[1]/=t)}t.add=function(t,i,s,n,r,a){var o,l,c,d,h=[[],[],[]],p=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],u=[[t,s,r],[i,n,a],[0,0,1]];t&&t instanceof e&&(u=[[t.a,t.c,t.e],[t.b,t.d,t.f],[0,0,1]]);for(o=0;3>o;o++)for(l=0;3>l;l++){d=0;for(c=0;3>c;c++)d+=p[o][c]*u[c][l];h[o][l]=d}this.a=h[0][0];this.b=h[1][0];this.c=h[0][1];this.d=h[1][1];this.e=h[0][2];this.f=h[1][2];return this};t.invert=function(){var t=this,i=t.a*t.d-t.b*t.c;return new e(t.d/i,-t.b/i,-t.c/i,t.a/i,(t.c*t.f-t.d*t.e)/i,(t.b*t.e-t.a*t.f)/i)};t.clone=function(){return new e(this.a,this.b,this.c,this.d,this.e,this.f)};t.translate=function(e,t){return this.add(1,0,0,1,e,t)};t.scale=function(e,t,i,s){(null===t||void 0===t)&&(t=e);(i||s)&&this.add(1,0,0,1,i,s);this.add(e,0,0,t,0,0);(i||s)&&this.add(1,0,0,1,-i,-s);return this};t.rotate=function(e,t,i){e=n(e);t=t||0;i=i||0;var r=+s.cos(e).toFixed(9),a=+s.sin(e).toFixed(9);this.add(r,a,-a,r,t,i);return this.add(1,0,0,1,-t,-i)};t.x=function(e,t){return e*this.a+t*this.c+this.e};t.y=function(e,t){return e*this.b+t*this.d+this.f};t.get=function(e){return+this[i.fromCharCode(97+e)].toFixed(4)};t.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]};t.determinant=function(){return this.a*this.d-this.b*this.c};t.split=function(){var e={};e.dx=this.e;e.dy=this.f;var t=[[this.a,this.c],[this.b,this.d]];e.scalex=s.sqrt(a(t[0]));o(t[0]);e.shear=t[0][0]*t[1][0]+t[0][1]*t[1][1];t[1]=[t[1][0]-t[0][0]*e.shear,t[1][1]-t[0][1]*e.shear];e.scaley=s.sqrt(a(t[1]));o(t[1]);e.shear/=e.scaley;this.determinant()<0&&(e.scalex=-e.scalex);var i=-t[0][1],n=t[1][1];if(0>n){e.rotate=r(s.acos(n));0>i&&(e.rotate=360-e.rotate)}else e.rotate=r(s.asin(i));e.isSimple=!(Number(e.shear.toFixed(9))||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate);e.isSuperSimple=!Number(e.shear.toFixed(9))&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate;e.noRotation=!Number(e.shear.toFixed(9))&&!e.rotate;return e};t.toString=function(){var e=this.split(),t="";if(Number(e.shear.toFixed(9)))return"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]+")";e.scalex=+e.scalex.toFixed(4);e.scaley=+e.scaley.toFixed(4);e.rotate=+e.rotate.toFixed(4);(e.dx||e.dy)&&(t+="translate("+[+e.dx.toFixed(4),+e.dy.toFixed(4)]+")");1===e.scalex?1!==e.scaley&&(t+=(t?" ":"")+"scaleY("+e.scaley+")"):t+=1===e.scaley?(t?" ":"")+"scaleX("+e.scalex+")":e.scalex===e.scaley?(t?" ":"")+"scale("+e.scalex+")":(t?" ":"")+"scale("+[e.scalex,e.scaley]+")";e.rotate&&(t+=(t?" ":"")+"rotate("+ +e.rotate.toFixed(3)+"deg)");return t}}(e.prototype);return e});define("ccweb.files.extract/utils/CSSUtil",["jquery","underscore","plugin-dependencies","ccweb.files.extract/models/PSDSettingsModel","ccweb.files.extract/models/UserSettingsModel","ccweb.files.extract/Constants","ccweb.files.extract/utils/Matrix"],function(e,t,i,s,n,r,a){"use strict";var o={cssPreprocessors:{css:{displayName:"CSS",formatString:function(e,t,i){return e?e+": "+o.formatCSSValue(e,t)+";"+(i?" /* "+i+" */":""):i?"/* "+i+" */":void 0},listItem:function(e){if(e.spacer)return o.getSpacer(e);switch(e.property){case"background-color":case"color":case"border-color":return'<span class="property">'+e.property+': </span><span class="color-chip" style="background-color: '+e.value+';"></span> <span class="value">'+e.value+";</span>";case void 0:case null:if(e.comment)return'<span class="comment">/* '+e.comment+" */</span>";break;default:return'<span class="property">'+e.property+': </span> <span class="value">'+t.escape(e.value)+";</span>"+(e.comment?'<span class="comment">/* '+e.comment+" */</span>":"")}}},scssBourbon:{displayName:"SCSS+Bourbon",formatString:function(e,t,i){switch(e){case"background":return"@include "+e+"("+t+");";default:return o.cssPreprocessors.css.formatString(e,t,i)}},listItem:function(e){switch(e.property){case"background":return'<span class="value">@include</span> <span class="property">'+e.property+'</span> <span class="value">('+e.value+");</span>";default:return o.cssPreprocessors.css.listItem(e)}}},sassCompass:{enabled:!i.parfait,displayName:"SCSS+Compass",formatString:function(e,t,i){switch(e){case"background":return"@include "+e+"("+t+");";default:return o.cssPreprocessors.css.formatString(e,t,i)}},listItem:function(e){if(e.spacer)return o.getSpacer(e);switch(e.property){case"background":return'<span class="value">@include</span> <span class="property">'+e.property+'</span> <span class="value">('+e.value+");</span>";case"background-color":case"color":case"border-color":return'<span class="property">'+e.property+': </span><span class="color-chip" style="background-color: '+e.value+'"></span> <span class="value">'+e.value+";</span>";default:return'<span class="property">'+e.property+': </span> <span class="value">'+t.escape(e.value)+";</span>"}}},stylusNib:{enabled:!i.parfait,displayName:"Stylus+Nib",formatString:function(e,t,i){return e+" "+o.formatCSSValue(e,t,i)},listItem:function(e){if(e.spacer)return o.getSpacer(e);switch(e.property){case"background":return'<span class="property">'+e.property+'</span> <span class="value">'+e.value+"</span>";case"background-color":case"color":case"border-color":return'<span class="property">'+e.property+' </span><span class="color-chip" style="background-color: '+e.value+'"></span> <span class="value">'+e.value+"</span>";default:return'<span class="property">'+e.property+' </span> <span class="value">'+t.escape(e.value)+"</span>"}}},lessHat:{enabled:!0,displayName:"LESS+Hat",formatString:function(e,t,i){switch(e){case"background":return".background-image("+t+");";default:return o.cssPreprocessors.css.formatString(e,t,i)}},listItem:function(e){switch(e.property){case"background":return'<span class="property">.background-image</span><span class="value">('+e.value+");</span>";default:return o.cssPreprocessors.css.listItem(e)}}}},getSpacer:function(e){var t="<br/>";e.label.length&&(t+='<span class="property">'+e.label+"</span>");return t},applyCSS:function(i,s,n){var r=s.getCSS(n);r&&t.each(r,function(t){e(i).css(t.property,t.value)})},formatCSSString:function(e,t){t=t||"css";return this.cssPreprocessors[t].formatString(e.property,e.value,e.comment)},formatCSSValue:function(e,t){var i=t?t.toString().trim():"";"font-family"===e&&-1!==i.indexOf(" ")&&0!==i.indexOf("'")&&i.lastIndexOf("'")!==i.length-1&&(i="'"+t+"'");return i},getDefaultColorString:function(e,t,i,s){var n;n=null!==s&&void 0!==s&&1!==s?"rgba("+Math.round(e)+", "+Math.round(t)+", "+Math.round(i)+", "+s+")":this.rgbToHEX(e,t,i);return n},rgbToHEX:function(e,t,i){return"#"+((1<<24)+(Math.round(e)<<16)+(Math.round(t)<<8)+Math.round(i)).toString(16).slice(1)},rgbaToHSL:function(e,t,i,s){(null===s||void 0===s)&&(s=1);var n,r,a,o="";n=e/255;r=t/255;a=i/255;var l,c,d=Math.max(n,r,a),h=Math.min(n,r,a),p=(d+h)/2;if(d===h)l=c=0;else{var u=d-h;c=p>.5?u/(2-d-h):u/(d+h);switch(d){case n:l=60*(r-a)/u;break;case r:l=60*(a-n)/u+120;break;case a:l=60*(n-r)/u+240}}l=Math.round(l+360)%360;c=Math.round(100*c);p=Math.round(100*p);o=1===s?"hsl("+l+", "+c+"%, "+p+"%)":"hsla("+l+", "+c+"%, "+p+"%, "+parseFloat(s)+")";return o},fontStyleNameToCSS:function(e){var t=[],i=e.toLowerCase();-1!==i.indexOf("regular")||-1!==i.indexOf("normal")?t.push({property:"font-weight",value:"400"}):-1!==i.indexOf("thin")?t.push({property:"font-weight",value:"100"}):-1!==i.indexOf("light")?-1!==i.indexOf("extra light")||-1!==i.indexOf("extralight")||-1!==i.indexOf("ultra light")||-1!==i.indexOf("ultralight")?t.push({property:"font-weight",value:"200"}):t.push({property:"font-weight",value:"300"}):-1!==i.indexOf("book")||-1!==i.indexOf("demi")?-1!==i.indexOf("demibold")?t.push({property:"font-weight",value:"600"}):t.push({property:"font-weight",value:"300"}):-1!==i.indexOf("medium")?t.push({property:"font-weight",value:"500"}):-1!==i.indexOf("semibold")?t.push({property:"font-weight",value:"600"}):-1!==i.indexOf("bold")?t.push({property:"font-weight",value:"700"}):-1!==i.indexOf("heavy")?t.push({property:"font-weight",value:"800"}):-1!==i.indexOf("black")&&t.push({property:"font-weight",value:"900"});-1!==e.indexOf("Italic")?t.push({property:"font-style",value:"italic"}):-1!==e.indexOf("Oblique")&&t.push({property:"font-style",value:"oblique"});return t},hasWhiteSpace:function(e){return e.indexOf(" ")>=0},_camelCapsToSpaces:function(e){return e.replace(/([A-Z]+)/g," $1").replace(/([A-Z][a-z])/g," $1").replace(/\s+/g," ").trim()},getFontInfo:function(e){var t,i,s={},n=e.fontName,r=n,a="Regular";s.coolTypeResolved=e.cooltypeFontResolved;e.hasOwnProperty("fontStyleName")&&(a=e.fontStyleName);if(s.coolTypeResolved)n&&(r=this._camelCapsToSpaces(n));else{t=e.postscriptFontName;i=t.indexOf("-");if(-1!==i){n=t.substring(0,i);a=t.substring(i+1,t.length)}else n=t;r=this._camelCapsToSpaces(n)}s.fontName=n;s.fontFace=a;s.friendlyName=r;var o=this.parseCSSMeasure(e.size);o.val=+parseFloat(o.val).toFixed(2);s.size=o.val+(o.units||"");return s},getTransformedFontScale:function(e){if(e.get("transform")){var t=o.getCSSTransform(e.get("transform"));if(t&&""!==t.toString()){var i=t.split();return Math.min(i.scalex,i.scaley)}}return 1},parseCSSMeasure:function(e){if("object"==typeof e&&(e.val||0===e.val)&&e.units)return e;if("number"==typeof e)return{val:e,units:r.FontUnitType.PX};if("string"!=typeof e)return{val:0,units:r.FontUnitType.PX};var t=e.match(/([+\-]?[\d\.]*)\s?([a-zA-Z%]+)/);return t?{val:t[1],units:t[2]||r.FontUnitType.PX}:void 0},layerEffectStrokesToCSS:function(e,i){var s=[];if(i&&i.length>0){e.type!==r.Shape.ELLIPSE&&e.type!==r.Shape.RECTANGLE&&(e.bottomLeftRadius||e.bottomRightRadius||e.topLeftRadius||e.topRightRadius)&&(s=this.getBorderRadiusCSS(e.bottomLeftRadius,e.bottomRightRadius,e.topLeftRadius,e.topRightRadius));t.each(i,function(e){if("normal"===e.mode.toLowerCase()&&"outsetframe"===e.style.toLowerCase()||"insetframe"===e.style.toLowerCase()){s.push({property:"border-style",value:"solid"});if(e.size>0){var t=this.parseCSSMeasure(e.size);s.push({property:"border-width",value:t.val+t.units})}var i=e.color;i&&"rgbcolor"===e.colorType.toLowerCase()&&s.push({property:"border-color",value:this.getDefaultColorString(i.red,i.green,i.blue,e.opacity<100?e.opacity:null)});"insetframe"===e.style.toLowerCase()&&s.push({property:"box-sizing",value:"border-box"})}},this)}return s},strokeToCSS:function(e,t){var i=[],s=e.stroke;(null===t||void 0===t)&&(t=1);e.type!==r.Shape.ELLIPSE&&e.type!==r.Shape.RECTANGLE&&(e.bottomLeftRadius||e.bottomRightRadius||e.topLeftRadius||e.topRightRadius)&&(i=this.getBorderRadiusCSS(e.bottomLeftRadius,e.bottomRightRadius,e.topLeftRadius,e.topRightRadius));if(s){if(s.strokeStyleLineWidth){var n=this.parseCSSMeasure(s.strokeStyleLineWidth,"px");if("pt"===n.units&&s.strokeStyleResolution){n.units="px";n.val=n.val*s.strokeStyleResolution/r.DefaultPPI}i.push({property:"border-width",value:n.val+n.units})}if(s.strokeStyleContent){var a=s.strokeStyleContent,o=a.color,l=+(t*s.strokeStyleOpacity/100).toFixed(2);
a["class"]===r.ContentType.SOLID_COLOR&&o&&i.push({property:"border-color",value:this.getDefaultColorString(o.red,o.green,o.blue,l)})}if(s.strokeStyleLineDashSet){var c=s.strokeStyleLineDashSet;0===c.length?i.push({property:"border-style",value:"solid"}):2===c.length&&(0===this.parseCSSMeasure(c[0]).val?i.push({property:"border-style",value:"dotted"}):i.push({property:"border-style",value:"dashed"}))}}return i},getShadowCSS:function(e,t){var i,s={property:"",value:""};e===r.Type.LAYER_TEXT?s.property="text-shadow":s.property="box-shadow";if(Array.isArray(t))for(var n=0;n<t.length;n++)t[n].enabled&&(s.value+=(""!==s.value?", ":"")+this.getShadowCSSText(e,i,t[n]));else s.value=this.getShadowCSSText(e,i,t);return s},getShadowCSSText:function(e,t,i){var s,n,a,o,l,c,d;o=void 0===i.blur||null===i.blur?5:i.blur;l=i.chokeMatte||0;c=parseFloat((o*l/100).toFixed(2));s=Math.round(-i.distance*Math.cos(this.degreesToRadians(i.localLightingAngle)));n=Math.round(i.distance*Math.sin(this.degreesToRadians(i.localLightingAngle)));a=i.color;d=s+"px "+n+"px";d+=" "+ +(o-c).toFixed(2)+"px";e!==r.Type.LAYER_TEXT&&(d+=" "+c+"px");a&&(d+=" "+this.getDefaultColorString(a.red,a.green,a.blue,i.opacity/100));return d},degreesToRadians:function(e){return Math.PI/180*e},getBorderRadiusCSS:function(e,t,i,s){var n=[];if(e&&e===t&&i===s&&e===i)n.push({property:"border-radius",value:e+"px"});else{e&&n.push({property:"border-bottom-left-radius",value:e+"px"});t&&n.push({property:"border-bottom-right-radius",value:t+"px"});i&&n.push({property:"border-top-left-radius",value:i+"px"});s&&n.push({property:"border-top-right-radius",value:s+"px"})}return n},addCSS:function(e,t){e.push(t)},applyPrefixedStyle:function(e,t,i){var s={};s[t]=i;s["-moz-"+t]=i;s["-webkit-"+t]=i;s["-o-"+t]=i;s["-ms-"+t]=i;e.css(s)},getCSSTransform:function(e){return new a(e.xx,e.xy,e.yx,e.yy,0,0)},findModelResolution:function(e){return e.get("imgdata")?e.get("imgdata").pixelsPerInch||r.DefaultPPI:e.get("parentModel")?this.findModelResolution(e.get("parentModel")):r.DefaultPPI},convertUnits:function(e,t,i){var n=s.get("baseFontSizeValue");i=i||n;e=this.parseCSSMeasure(e);var a;if(e.units===r.FontUnitType.PX)a=e.val;else if(e.units===r.FontUnitType.PT)a=e.val;else if(e.units===r.FontUnitType.EMS)a=e.val*i;else{if(e.units!==r.FontUnitType.REMS)throw new Error("Unrecognized input unit: "+e.units);a=e.val*n}var o;if(t===r.FontUnitType.PX)o=a;else if(t===r.FontUnitType.PT)o=a;else if(t===r.FontUnitType.EMS)o=a/i;else{if(t!==r.FontUnitType.REMS)throw new Error("Unrecognized preferred unit: "+t);o=a/n}return o},convertPSDUnitsToPreferredUnits:function(e,t,i){var s=n.get("preferredFontUnits"),r=this.convertUnits(e,s,i);r=+parseFloat(r).toFixed(3);return t?r+s:r}};return o});define("ccweb.files.extract/models/ColorModel",["underscore","backbone","ccweb.files.extract/utils/CSSUtil"],function(e,t,i){"use strict";var s=t.Model.extend({defaults:{red:"",green:"",blue:"",alpha:1},parse:function(e){var t={};t.red=Math.round(e.red);t.green=Math.round(e.green);t.blue=Math.round(e.blue);return t},isEqual:function(e,t){var i=e&&e instanceof s&&this.get("red")===e.get("red")&&this.get("green")===e.get("green")&&this.get("blue")===e.get("blue");t&&(i=i&&this.get("alpha")===e.get("alpha"));return i},toRGBString:function(e){var t="("+this.get("red")+", "+this.get("green")+", "+this.get("blue"),i="";i=1===e||null===e||void 0===e?"rgb"+t+")":"rgba"+t+", "+parseFloat(e)+")";return i},toHEXString:function(e){(null===e||void 0===e)&&(e=1);var t=i.rgbToHEX(this.get("red"),this.get("green"),this.get("blue")),s="";1!==e&&null!==e&&void 0!==e&&(s="; opacity: "+e+";");return t+s},toHSLString:function(e){var t=i.rgbaToHSL(this.get("red"),this.get("green"),this.get("blue"),e);return t}});return s});define("ccweb.files.extract/models/TextStyleModel",["underscore","backbone","ccweb.files.extract/utils/CSSUtil"],function(e,t,i){"use strict";var s=t.Model.extend({defaults:{fontName:"",fontFace:"",size:"",sizeUnits:""},parse:function(e){return i.getFontInfo(e)},isEqual:function(e){return e&&e instanceof s&&this.get("fontName")===e.get("fontName")&&this.get("fontFace")===e.get("fontFace")&&this.get("size")===e.get("size")},getCSS:function(e,t){var s=[{property:"font-family",value:this.get("fontName")},{property:"font-size",value:i.convertPSDUnitsToPreferredUnits(this.get("size"),!0)}],n=i.fontStyleNameToCSS(this.get("fontFace"));n.length>0&&(s=s.concat(n));return s}});return s});define("ccweb.files.extract/models/GradientModel",["underscore","backbone","ccweb.files.extract/utils/CSSUtil"],function(e,t,i){"use strict";var s=t.Model.extend({compiledColorStops:[],defaults:{enabled:!0,reverse:!1,align:!0,opacity:100,angle:0,mode:"normal",type:"linear",gradient:null},initialize:function(){this.set("layers",[]);var e=this.get("angle"),t=this.get("type"),i=this.get("layerModel").get("bounds"),s=i.bottom-i.top,n=i.right-i.left,r=this.getGradientLineLengthPhotoshop(i),a=Math.abs(n*Math.sin(e))+Math.abs(s*Math.cos(e)),o=e%45===0||"linear"!==t?1:Math.min(r/a,1);this.set("percentageOfOriginalDimension",o);this.generateColorStops()},isEqual:function(e){return e&&this.get("reverse")===e.get("reverse")&&this.get("angle")===e.get("angle")&&this.get("type")===e.get("type")&&this.get("percentageOfOriginalDimension")===e.get("percentageOfOriginalDimension")&&JSON.stringify(this.get("gradient"))===JSON.stringify(e.get("gradient"))},linearInterp:function(e,t,i){return Math.round(e*(i-t)+t)},getColorForLocation:function(t,i){if(t){var s,n,r,a,o,l=t.length,c=l-1;if(i<=t[0].location)return e.clone(t[0].color);if(i>=t[c].location)return e.clone(t[c].color);for(s=1;l>s;s++){n=t[s];if(n.location===i)return e.clone(n.color);if(n.location>i){r=t[s-1];a=(i-r.location)/(n.location-r.location);o={red:this.linearInterp(a,r.color.red,n.color.red),green:this.linearInterp(a,r.color.green,n.color.green),blue:this.linearInterp(a,r.color.blue,n.color.blue),alpha:this.linearInterp(a,r.color.alpha,n.color.alpha)};return o}}}return{}},getOpacityForLocation:function(e,t){if(e){var i,s,n,r,a,o=e.length,l=o-1;if(t<=e[0].location)return e[0].opacity;if(t>=e[l].location)return e[l].opacity;for(i=1;o>i;i++){s=e[i];if(s.location===t)return s.opacity;if(s.location>t){n=e[i-1];r=(t-n.location)/(s.location-n.location);a=this.linearInterp(r,n.opacity,s.opacity);return a}}}return 100},generateColorStopString:function(e,t,s){(null===s||void 0===s)&&(s=1);var n=i.getDefaultColorString(e.color.red,e.color.green,e.color.blue,e.color.alpha*s)+" ",r=Math.floor(e.location/4096*100),a=Math.round(r*t+100*(1-t)/2);n+=a+"%";return n},generateColorStops:function(){var t,i,s,n,r=this.get("gradient").transparency,a=r?r.length:0,o=this.get("gradient").colors,l={};if(!o)return[];this.compiledColorStops=[];for(n=0;n<o.length;n++){var c=e.clone(o[n]);if(50!==c.midpoint&&n>0){s=c.midpoint/100;i=o[n-1];var d={};d.location=this.linearInterp(s,i.location,c.location);d.color={red:this.linearInterp(d.location/4096,i.color.red,c.color.red),green:this.linearInterp(d.location/4096,i.color.green,c.color.green),blue:this.linearInterp(d.location/4096,i.color.blue,c.color.blue),alpha:this.getOpacityForLocation(r,d.location)/100};this.compiledColorStops.push(d);l[d.location]=!0}c.color.alpha=this.getOpacityForLocation(r,c.location)/100;this.compiledColorStops.push(c);l[c.location]=!0}for(n=0;a>n;n++)if(!l[r[n].location]){t=!1;a>1&&(0===n?r[0].opacity===r[1].opacity&&(t=!0):n===a-1?r[a-2].opacity===r[a-1].opacity&&(t=!0):a>2&&r[n].opacity===r[n-1].opacity&&r[n].opacity===r[n+1].opacity&&(t=!0));if(!t){var h={};h.location=r[n].location;h.color=this.getColorForLocation(this.compiledColorStops,h.location);h.color.alpha=r[n].opacity/100;this.compiledColorStops.push(h)}}this.compiledColorStops.sort(function(e,t){return e.location<t.location?-1:e.location>t.location?1:0});if(this.get("reverse")){var p,u,f,g=this.compiledColorStops.length,m=g-1;this.compiledColorStops.reverse();for(n=0;n<Math.floor(g/2);n++){u=this.compiledColorStops[n];f=this.compiledColorStops[m-n];p=u.location;u.location=f.location;f.location=p}}},getCSS:function(e,t){var i,s,n="";for(s=0;s<this.compiledColorStops.length;s++)n+=this.generateColorStopString(this.compiledColorStops[s],this.get("percentageOfOriginalDimension"),t)+", ";n=n.substring(0,n.length-2)+")";switch(this.get("type")){case"linear":i="linear-gradient("+this.get("angle")+"deg, "+n;n="linear-gradient("+(90-this.get("angle"))+"deg, "+n;break;case"radial":var r="circle ",a=Math.abs(this.get("angle")),o=(this.get("scale")||100)/100,l=this.get("layerModel").get("bounds"),c=l.bottom-l.top,d=l.right-l.left;r+=0===a||180===a?d>c?"farthest-side":"closest-side":90===a||270===a?c>d?"farthest-side":"closest-side":Math.round(o*this.getGradientLineLengthPhotoshop(l))+"px";n="radial-gradient("+r+" at 50%, "+n;i=n;break;default:console.warn("Unknown gradient type: ",this.get("type"));return[]}return e?[{property:"background",value:"-webkit-"+i},{property:"background",value:"-moz-"+i},{property:"background",value:"-o-"+i},{property:"background",value:"-ms-"+i},{property:"background",value:n}]:[{property:"background",value:n}]},getGradientLineLengthPhotoshop:function(e){var t=.5*(e.left+e.right),i=.5*(e.top+e.bottom),s=this.get("angle"),n=0>s;n&&(s=-s);var r,a,o,l,c,d={},h={},p=.5*(e.right-e.left),u=.5*(e.bottom-e.top);if(90===s){r=t;a=n?e.bottom:e.top}else{var f=p>=u?p:u;if(0===f){a=i;r=t}else{var g={top:i-f,left:t-f,bottom:i+f,right:t+f};if(45>=s){o=s/45;c=f*o;if(p>=u){a=i+c;if(a>e.bottom){r=t+f/c*u;a=e.bottom}else r=g.right}else{a=i+c/f*p;r=e.right}}else if(90>=s){s-=45;o=1-s/45;l=f*o;if(u>=p){r=t+l;if(r>e.right){a=0!==l?i+f/l*p:i;r=e.right}else a=g.bottom}else{r=t+l/f*u;a=e.bottom}}else if(135>=s){s-=90;o=s/45;l=f*o;if(u>=p){r=t-l;if(r<e.left){a=0!==l?i+f/l*p:i;r=e.left}else a=g.bottom}else{r=t-l/f*u;a=e.bottom}}else{s-=135;o=1-s/45;c=f*o;if(p>=u){a=i+c;if(a>e.bottom){r=0!==c?t-f/c*u:t;a=e.bottom}else r=g.left}else{a=i+c/f*p;r=e.left}}n||(a=i-(a-i))}}var m=0,v=0;if("linear"===this.get("type")){h.h=Math.round(r+m);h.v=Math.round(a+v);d.h=Math.round(t+(t-r)+m);d.v=Math.round(i+(i-a)+v)}else{d.h=Math.round(t+m);d.v=Math.round(i+v);h.h=Math.round(r+m);h.v=Math.round(a+v)}var y=Math.abs(d.h-h.h),b=Math.abs(d.v-h.v);return Math.sqrt(y*y+b*b)}});return s});define("ccweb.files.extract/models/LayerPropertiesModel",["underscore","backbone","ccweb.files.extract/Constants","./ColorModel","./TextStyleModel","./GradientModel"],function(e,t,i,s,n,r){"use strict";var a=t.Model.extend({defaults:{layerType:"",colors:null,gradients:null,textStyles:null},enabledGradientTypes:{linear:!0,radial:!0,angle:!1,reflected:!1,diamond:!1,shapeburst:!1},enabledGradientForms:{customStops:!0,colorNoise:!1},initialize:function(e){this.layerType=e.layerType},layerEffectsAreTransparent:function(){var e=this.get("layerEffects"),t=function(e){return e.enabled&&100===e.opacity};return e&&e.solidFill.some(t)?!1:!0},getColorsFromEffects:function(t){var i,n=this.get("layerEffects"),r=this;n&&n.solidFill&&e.each(n.solidFill,function(e){if(e.enabled){i=new s;r.setColorModelAlpha(e.opacity,i);t.push(i.set(i.parse(e.color,{parse:!0})))}});return this.layerEffectsAreTransparent()},getColors:function(){var e,t=this.get("colors");if(null===t){t=[];var n,r,a,o;switch(this.layerType){case i.Type.LAYER_CONTENT:n=this.get("color");r=this.get("shape");a=this.getColorsFromEffects(t);if(n){if(a){o=new s;t.push(o.set(o.parse(n,{parse:!0})));this.checkFillOpacity(o)}if(r&&r.stroke){var l=r.stroke;if(l.strokeStyleContent){var c=l.strokeStyleContent;n=c.color;if(n){o=new s;this.checkStrokeOpacity(o);t.push(o.set(o.parse(n,{parse:!0})))}}}}break;case i.Type.LAYER_TEXT:var d=this.get("textStyleRange");if(d&&this.getColorsFromEffects(t))for(e=0;e<d.length;e++){n=d[e].textStyle.color;if(n){o=new s;t.push(o.set(o.parse(n,{parse:!0})));this.checkFillOpacity(o)}}}}return t},checkFillOpacity:function(e){var t=this.get("blendOptions"),i=this.get("shape"),s=1;if(t){t.hasOwnProperty("opacity")&&(s*=t.opacity/100);i&&i.fillEnabled&&t.hasOwnProperty("fillOpacity")&&(s*=t.fillOpacity/100);this.setColorModelAlpha(100*s,e)}},checkStrokeOpacity:function(e){var t=this.get("blendOptions"),i=this.get("shape"),s=i.stroke,n=1;if(t){t.hasOwnProperty("opacity")&&(n*=t.opacity/100);s.hasOwnProperty("strokeStyleOpacity")&&(n*=s.strokeStyleOpacity/100);i&&!i.fillEnabled&&t.hasOwnProperty("fillOpacity")&&(n*=t.fillOpacity/100);this.setColorModelAlpha(100*n,e)}},setColorModelAlpha:function(e,t){t.set("alpha",+(e/100).toFixed(2))},getGradients:function(){var e=this.get("gradients");if(null===e){e=[];if(this.layerType===i.Type.LAYER_CONTENT){e=this.getGradientEffects();if(this.layerEffectsAreTransparent()&&"gradientLayer"===this.get("class")&&this.enabledGradientTypes[this.get("type")]&&this.enabledGradientForms[this.get("gradient").gradientForm]){var t=new r(this.toJSON(),{parse:!0});e.push(t)}}}return e},getTextStyles:function(){var e,t=this.get("textStyles");if(null===t){t=[];if(this.layerType===i.Type.LAYER_TEXT&&""!==this.get("rawText")){var s,r,a=this.get("textStyleRange");if(a)for(e=0;e<a.length;e++){s=a[e].textStyle;r=new n;t.push(r.set(r.parse(s,{parse:!0})))}}}return t},getGradientEffects:function(){var e,t,s=null,n=[];if(this.layerType===i.Type.LAYER_CONTENT){t=this.get("layerEffects");if(t){if(t.gradientFill)for(var r=0;r<t.gradientFill.length;r++)if(t.gradientFill[r].enabled){e=this.getGradientEffect(t.gradientFill[r]);e&&n.push(e)}if(t.innerGlow&&t.innerGlow.gradient&&t.innerGlow.enabled){s=t.innerGlow;e=this.getGradientEffect(s);e&&n.push(e)}else if(t.outerGlow&&t.outerGlow.gradient&&t.outerGlow.enabled){s=t.outerGlow;e=this.getGradientEffect(s);e&&n.push(e)}}}return n},getGradientEffect:function(e){if(this.enabledGradientTypes[e.type]){e.layerModel=this.get("layerModel");return new r(e,{parse:!0})}return null}});return a});define("ccweb.files.extract/models/BaseStyleUsageModel",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({defaults:{style:null,layers:null},initialize:function(){this.set("layers",[])},addUsage:function(e){var t=this.get("layers");-1===t.indexOf(e)&&t.push(e)}});return i});define("ccweb.files.extract/models/ColorUsageModel",["underscore","backbone","./BaseStyleUsageModel"],function(e,t,i){"use strict";var s=i.extend({defaults:{alphas:null},alphaMap:null,initialize:function(e){i.prototype.initialize.apply(this,arguments);this.set("alphas",[]);this.alphaMap={}},addUsage:function(e,t){i.prototype.addUsage.apply(this,arguments);var n,r,a,o,l,c,d,h=!1;if(t instanceof s){o=t.get("style");r=o.get("alpha");l=t.get("alphas");for(c=0,d=l.length;d>c;c++){a=void 0===l[c]?1:l[c];o.set("alpha",a);this.addUsage(e,o)}o.set("alpha",r)}else{n=t.get("alpha");for(a in this.alphaMap)if(this.alphaMap.hasOwnProperty(a)&&a===String(n)){h=!0;this.alphaMap[a].push(e)}if(!h){this.alphaMap[n]=[e];this.get("alphas").push(n)}}}});return s});define("ccweb.files.extract/models/GradientUsageModel",["underscore","backbone","./BaseStyleUsageModel"],function(e,t,i){"use strict";var s=i.extend({});return s});define("ccweb.files.extract/models/TextStyleUsageModel",["underscore","backbone","./BaseStyleUsageModel"],function(e,t,i){"use strict";var s=i.extend({});return s});define("ccweb.files.extract/models/LayerModelMap",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({defaults:{psdLayersMap:{},layerNameMap:{}},initialize:function(){this.reset()},addLayerToMap:function(e,t,i,s){this.get("psdLayersMap")[e]={item:t,flattenedItem:i,model:s};this.get("layerNameMap")[s.get("layerName")]=s},addModel:function(e,t){this.idToModelMap[e]=t},getLayerInfoForId:function(e){return this.get("psdLayersMap")[e]},getLayerModelFromId:function(e){var t=this.get("psdLayersMap")[e];return t?t.model:null},getLayerModelFromName:function(e){return this.get("layerNameMap")[e]},getModel:function(e){return this.idToModelMap[e]},reset:function(){this.idToModelMap={};this.flattenedLayers=[]},addFlattenedLayer:function(e){this.flattenedLayers.push(e)},getFlattenedLayers:function(){return this.flattenedLayers}});return new i});define("ccweb.files.extract/utils/MeasurementUtil",["underscore","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/models/PSDSettingsModel","ccweb.files.extract/models/UserSettingsModel","ccweb.files.extract/Constants"],function(e,t,i,s,n){"use strict";var r={calcLayerGroupBounds:function(e,t){var i,s,n;if(e&&!(e.length<1)){i=this.getVisibleBounds(e[0],t);s={top:i.top,left:i.left,bottom:i.bottom,right:i.right};for(n=1;n<e.length;n++){i=this.getVisibleBounds(e[n],t);s.top=Math.min(s.top,i.top);s.left=Math.min(s.left,i.left);s.bottom=Math.max(s.bottom,i.bottom);s.right=Math.max(s.right,i.right)}return s}},boundsIntersect:function(e,t){return e.left<t.right&&e.right>t.left&&e.top<t.bottom&&e.bottom>t.top},getVisibleBounds:function(e,t,s){var n,r,a=t.get("imgdata").bounds,o=e.getArtboardParent(),l=o?o.get("bounds"):{top:0,left:0,bottom:a.bottom,right:a.right},c=i.get("designedAtMultiplier");n=e.zeroRawBounds()||s?e.get("bounds"):e.get("rawBounds");r={top:Math.max(0,n.top,l.top),left:Math.max(0,n.left,l.left),bottom:Math.min(a.bottom,n.bottom,l.bottom),right:Math.min(a.right,n.right,l.right)};r.width=r.right-r.left;r.height=r.bottom-r.top;r.displayLeft=Math.round(r.left/c);r.displayRight=Math.round(r.right/c);r.displayTop=Math.round(r.top/c);r.displayBottom=Math.round(r.bottom/c);return r},layer1ContainsLayer2:function(e,i){var s=t.getPSDModel(),n=this.getVisibleBounds(e,s),r=this.getVisibleBounds(i,s);return this.rect1ContainsRect2(n,r)},getMeasurementsOfLayerAgainstPSDBounds:function(e){var i=this.getVisibleBounds(e,t.getPSDModel());return e.getArtboardParent()?this.getMeasurementsOfRectInsideRect(i,e.getArtboardParent().get("bounds"),!0):this.getMeasurementsOfRectAgainstPSDBounds(i)},getMeasurementsOfRectAgainstPSDBounds:function(e){var i=t.getPSDModel().get("imgdata").bounds;return this.getMeasurementsOfRectInsideRect(e,i,!1)},getMeasurementsOfRectInsideRect:function(t,r,a){var o=e.clone(t),l=s.get("preferredMeasurementUnits"),c=i.get("designedAtMultiplier");if(a){o.displayLeft=o.left-r.left;o.displayTop=o.top-r.top}o.width=o.right-o.left;o.height=o.bottom-o.top;r.width=r.right-r.left;r.height=r.bottom-r.top;o.percentWidth=+(o.width/r.width*100).toFixed(1);o.displayWidth=(l===n.MeasurementUnitType.PX?Math.round(o.width/c):o.percentWidth)+l;o.percentHeight=+(o.height/r.height*100).toFixed(1);o.displayHeight=(l===n.MeasurementUnitType.PX?Math.round(o.height/c):o.percentHeight)+l;return o},setLayerBounds:function(e,i,s,r,a){var o,l=s.get("bounds"),c=t.getPSDModel().get("imgdata").bounds,d=r?r.get("bounds"):null;d||(d={top:0,left:0});var h=l.top,p=l.left,u=l.right,f=l.bottom,g=d.left,m=d.top;if(i){o=s.get("flattenedSprite");p=o.psdOrigin.left;h=o.psdOrigin.top;u=p+(o.bounds.right-o.bounds.left);f=h+(o.bounds.bottom-o.bounds.top)}if(a.clipLayersToImage){h=Math.max(0,h);p=Math.max(0,p);u=Math.min(c.right,u);f=Math.min(c.bottom,f);g=Math.max(0,g);m=Math.max(0,m)}e.css("top",h-m);e.css("left",p-g);if(s.get("type")!==n.Type.LAYER_GROUP&&s.get("type")!==n.Type.LAYER_ARTBOARD||i)if(0>u-p||0>f-h){e[0].width=0;e[0].height=0}else{e[0].width=u-p;e[0].height=f-h}else{e.css("width",u-p+"px");e.css("height",f-h+"px")}return{top:h,left:p,bottom:f,right:u}},rect1ContainsRect2:function(e,t){return e.left<=t.left&&e.top<=t.top&&e.right>=t.right&&e.bottom>=t.bottom},getClippedBounds:function(e,t){return{left:Math.max(e.left,0),top:Math.max(e.top,0),right:Math.min(t.get("width"),e.right),bottom:Math.min(t.get("height"),e.bottom)}}};return r});define("ccweb.files.extract/utils/UTF8",[],function(){"use strict";var e={decodeCharacters:function(e){e=e||"";for(var t,i,s,n={text:e,index:0,nextChar:function(){var e=null;if(this.index<this.text.length){e=this.text.charCodeAt(this.index);if(65535===e){e=parseInt(this.text.substr(this.index+3,2),16);this.index=this.index+4}this.index=this.index+1}return e},atEnd:function(){return this.index>=this.text.length}},r="";!n.atEnd();){t=n.nextChar();if(128>t)r+=String.fromCharCode(t);else if(t>191&&224>t){i=n.nextChar();r+=String.fromCharCode((31&t)<<6|63&i)}else{i=n.nextChar();s=n.nextChar();r+=String.fromCharCode((15&t)<<12|(63&i)<<6|63&s)}}return r}};return e});define("ccweb.files.extract/utils/ExtractTextLayerCss",["require","exports","module","plugin-dependencies","ccweb.files.extract/Constants","ccweb.files.extract/models/UserSettingsModel","ccweb.files.extract/utils/CSSUtil","ccweb.files.extract/utils/UTF8","underscore"],function(e,t,i){"use strict";var s=e("plugin-dependencies"),n=e("ccweb.files.extract/Constants"),r=e("ccweb.files.extract/models/UserSettingsModel"),a=e("ccweb.files.extract/utils/CSSUtil"),o=e("ccweb.files.extract/utils/UTF8"),l=e("underscore"),c=s.translate("Approximation due to font substitution"),d={justifyLeft:"left",justifyCenter:"center",justifyRight:"right",justifyFull:"justify"};return function(e,t){var i=[],h=[],p=e.get("textStyleRange"),u=o.decodeCharacters(e.get("rawText")),f=e.get("transform")&&a.getCSSTransform(e.get("transform")),g=a.getTransformedFontScale(e);f&&1!==g&&f.scale(1/g);if(p&&p.length>0){for(var m=!1,v=function(e){return l.isEqual(b,e)},y=0;y<p.length;y++){var b=p[y].textStyle,w=p[y].paragraphStyle,x=u.substring(p[y].from,p[y].to),S=l.some(h,v);if(""!==x.trim()&&!S){if(y>=1){i.push({spacer:!0,label:"/* "+s.translate("Inline Style")+" */",property:null,value:null});m=!0}var C=a.getFontInfo(b);i.push({property:"font-family",value:a.formatCSSValue("font-family",C.fontName)});var T,I=e.get("blendOptions");if(1===t.colors.length){T=t.colors[0].get("style");T={red:T.get("red"),green:T.get("green"),blue:T.get("blue"),alpha:T.get("alpha")}}else T=b.color;I&&I.hasOwnProperty("fillOpacity")&&(T.alpha*=I.fillOpacity/100);i.push({property:"color",value:a.getDefaultColorString(T.red,T.green,T.blue,T.alpha)});var E=a.parseCSSMeasure(C.size);E.val=Math.round(E.val*g*100)/100;var P=a.convertUnits(E,n.FontUnitType.PX);i.push({property:"font-size",value:a.convertPSDUnitsToPreferredUnits(E,!0),comment:C.coolTypeResolved?void 0:c});C.fontFace&&(i=i.concat(a.fontStyleNameToCSS(C.fontFace)));var M;if(b.tracking&&0!==(M=parseInt(b.tracking,10))){var L=M/1e3;i.push({property:"letter-spacing",value:a.convertPSDUnitsToPreferredUnits({val:L,units:n.FontUnitType.EMS},!0,P),comment:C.coolTypeResolved?void 0:c})}if(b.leading){var A,k=a.parseCSSMeasure(b.leading),D=r.get("preferredFontUnits");A=D===n.FontUnitType.PX?+(+k.val).toFixed(3)+D:+(k.val/E.val).toFixed(3);i.push({property:"line-height",value:A,comment:C.coolTypeResolved?void 0:c})}"underlineOn"===b.underline&&i.push({property:"text-decoration",value:"underline"});d.hasOwnProperty(w.textJustification)&&i.push({property:"text-align",value:d[w.textJustification]});w.firstLineIndent&&0!==parseInt(w.firstLineIndent,10)&&i.push({property:"text-indent",value:a.convertPSDUnitsToPreferredUnits(w.firstLineIndent,!0,P)});e.get("dropShadow")&&i.push({property:"text-shadow",value:e.get("dropShadow")});h.push(b)}}f&&""!==f.toString()&&i.push({property:"transform",value:f.toString()});m&&i.push({spacer:!0,label:""})}return i}});define("ccweb.files.extract/models/LayerModel",["underscore","backbone","plugin-dependencies","ccweb.files.extract/collections/SubLayerCollection","./LayerPropertiesModel","./ColorUsageModel","./GradientUsageModel","./TextStyleUsageModel","./LayerModelMap","./UserSettingsModel","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/utils/MeasurementUtil","ccweb.files.extract/Constants","ccweb.files.extract/utils/CSSUtil","ccweb.files.extract/utils/UTF8","ccweb.files.extract/utils/ExtractTextLayerCss"],function(e,t,i,s,n,r,a,o,l,c,d,h,p,u,f,g){"use strict";var m=t.Model.extend({defaults:{type:"",layerName:"",layerId:"",bounds:"",properties:"",selected:!1,rendered:!1,parentModel:null,flattenedParent:null,flattenedSprite:null,zIndex:0,toplevel:!1,psdGuid:"",layerCollection:null,colors:null,usageModels:null,visible:!1,psdVisible:!1,renderedVisible:!1,smartObjectInfo:null},initialize:function(){this.set("colors",[])},toString:function(){return"[object LayerModel name: "+this.get("layerName")+", layerId: "+this.get("layerId")+", zIndex: "+this.get("zIndex")+"]"},parse:function(t){var r,a={},o=t.children,c=new s(m);a.type=t.type;a.layerName=t.layerName;a.layerId=t.layerId;a.visible=t.visible;void 0===a.visible&&(a.visible=!0);if(t.type===p.Type.LAYER_SMARTOBJ){if(t.hasOwnProperty("smartObjectType"))a.smartObjectType=t.smartObjectType;else if(t.hasOwnProperty("smartObjectInfo")){a.smartObjectType=t.smartObjectInfo.linked?"linked":"embedded ";a.smartObjectInfo=t.smartObjectInfo}}else t.type===p.Type.LAYER_ADJUSTMENT&&t.adjustmentLayer&&(a.adjustmentLayerType=t.adjustmentLayer.type);if(t.type===p.Type.LAYER_ARTBOARD&&t.artboardRect){a.bounds=t.artboardRect;a.rawBounds=t.artboardRect}else{a.bounds=t.bounds;a.rawBounds=t.rawBounds}a.flattenedParent=t.flattenedParent;a.flattenedSprite=t.flattenedSprite;a.isFlattened=void 0!==a.flattenedSprite||void 0!==a.flattenedParent;a.psdVisible=a.renderedVisible=a.visible;if(!t.smartObjectLayer){l.addModel(a.layerId,this);if(t.clipped&&t.hasOwnProperty("clipLayerBaseId")){var d,h=l.getModel(t.clipLayerBaseId);if(h){d=h.get("clippedLayers")||[];d.push(this);h.set("clippedLayers",d);a.clipbase=h}}}a.smartObjectInfo=t.smartObjectInfo;t.hasOwnProperty("spriteSheet")&&(a.spriteSheet=t.spriteSheet);t.flattenedSprite&&l.addFlattenedLayer(this);if(o){c.reset();c.add(o,{parse:!0});a.layerCollection=c}if(!i.parfait&&t.hasOwnProperty("smartObjectData")){a.smartObjectLayers=new s(m);a.smartObjectLayers.reset();e.each(t.smartObjectData.children,function(e){e.smartObjectLayer=!0});a.smartObjectLayers.add(t.smartObjectData.children,{parse:!0})}r=new n({layerType:a.type,layerModel:this});r.set(r.parse(t.properties,{parse:!0}));a.properties=r;return a},getArtboardParent:function(){"undefined"==typeof this.artboardParent&&(this.get("type")===p.Type.LAYER_ARTBOARD?this.artboardParent=this:this.get("parentModel")instanceof m?this.artboardParent=this.get("parentModel").getArtboardParent():this.artboardParent=null);return this.artboardParent},getCSSArray:function(t){var s,n,r,a=[],o=this.get("properties"),l=h.getMeasurementsOfLayerAgainstPSDBounds(this),c=this.get("usageModels"),f=o.get("layerEffects");if(o.layerType===p.Type.LAYER_TEXT)a=a.concat(g(o,c));else if(o.layerType===p.Type.LAYER_CONTENT){n=o.get("shape");r=o.get("blendOptions");var m,v,y,b=r&&r.hasOwnProperty("opacity"),w=r&&r.hasOwnProperty("fillOpacity"),x=b?r.opacity/100:1,S=w?r.fillOpacity/100:1,C=c.gradients[0],T=c.colors[0],I=T||C,E=n&&n.stroke,P=f&&1===f.solidFill.length?f.solidFill[0]:null,M=f&&1===f.gradientFill.length?f.gradientFill[0]:null;if(n){n.type===p.Shape.ELLIPSE&&a.push({property:"border-radius",value:"50%"});if(n.type===p.Shape.RECTANGLE){v=u.getBorderRadiusCSS(n.bottomLeftRadius,n.bottomRightRadius,n.topLeftRadius,n.topRightRadius);v&&(a=a.concat(v))}}E&&(a=a.concat(u.strokeToCSS(n,I?null:+(x*S).toFixed(2))));f&&f.frameFX&&(a=a.concat(u.layerEffectStrokesToCSS(n,f.frameFX)));if(P&&100===P.opacity&&P.color){s=P.color;a.push({property:"background-color",value:u.getDefaultColorString(s.red,s.green,s.blue)})}else if(!P&&M&&100===M.opacity&&M.gradient){if(C){m=C.get("style");v=m.getCSS(t,y);v&&(a=a.concat(v))}}else{if(n&&n.fillEnabled&&T){y=(E?1:x)*S;y=+y.toFixed(2);s=o.get("color")||T.get("style").attributes;a.push({property:"background-color",value:u.getDefaultColorString(s.red,s.green,s.blue,y)})}if(C){m=C.get("style");v=m.getCSS(t,parseFloat(m.get("opacity"))/100);v&&(a=a.concat(v))}f&&f.solidFill&&e.each(f.solidFill,function(e){s=e.color;a.push({property:"background-color",value:u.getDefaultColorString(s.red,s.green,s.blue,parseFloat(e.opacity)/100)})})}b&&E&&I&&a.push({property:"opacity",value:+x.toFixed(2)});if(o.get("transform")){var L=u.getCSSTransform(o.get("transform"));L&&""!==L.toString()&&a.push({property:"transform",value:L})}}f&&f.masterFXSwitch!==!1&&f.dropShadow&&f.dropShadow.some(function(e){return e.enabled})&&u.addCSS(a,u.getShadowCSS(o.layerType,f.dropShadow));this.isMultipleLayerStylesCSSWarning()&&a.push({comment:i.translate(p.LayerWarnings.MULTI_LAYER_STYLES_WARNING)});if(n&&(n.type===p.Shape.RECTANGLE||n.type===p.Shape.ELLIPSE)&&n.stroke&&n.stroke.strokeStyleLineAlignment&&n.stroke.strokeStyleLineAlignment){l.right-=2*parseInt(n.stroke.strokeStyleLineWidth,10);l.bottom-=2*parseInt(n.stroke.strokeStyleLineWidth,10);l=h.getMeasurementsOfRectInsideRect(l,d.getPSDModel().get("imgdata").bounds,!1)}if(o.get("transform")){for(var A=0;A<a.length;A++)if("transform"===a[A].property){a[A].comment=i.translate("width and height properties ommitted due to transform");break}}else a.push({property:"width",value:l.displayWidth},{property:"height",value:l.displayHeight});return a},isFontSubstitution:function(){if(void 0!==this.fontSubstitution)return this.fontSubstitution;var e,t,i,s,n,r=this.get("properties");if(r.layerType===p.Type.LAYER_TEXT){i=r.get("textStyleRange");s=f.decodeCharacters(r.get("rawText"));if(i&&i.length>0)for(e=0;e<i.length;e++){t=i[e].textStyle;n=s.substring(i[e].from,i[e].to);if(!this.isWhitespace(n)&&!u.getFontInfo(t).coolTypeResolved){this.fontSubstitution=!0;break}}}this.fontSubstitution=this.fontSubstitution||!1;return this.fontSubstitution},isLinkedSmartObject:function(){var e=this.get("smartObjectInfo");return e?e.linked:!1},isMultipleLayerStylesCSSWarning:function(){var e=this.get("properties").get("layerEffects"),t=this.get("properties").get("shape"),i=this.get("usageModels")?this.get("usageModels").colors[0]:null;if(e){if(e&&e.masterFXSwitch!==!1&&(e.frameFX&&e.frameFX.length>1||e.gradientFill&&e.gradientFill.length>1||e.innerShadow&&e.innerShadow.length>1||e.solidFill&&e.solidFill.length>1))return!0;if(e.solidFill[0]&&100!==e.solidFill[0].opacity&&(e.gradientFill[0]||t&&t.fillEnabled&&i))return!0;if(e.gradientFill[0]&&100!==e.gradientFill[0].opacity&&t&&t.fillEnabled&&i)return!0}return!1},isWhitespace:function(e){e=e.replace(/\s/gm,"");return!e||0===e.length},getCSSAsString:function(e,t){var i,s,n="",r=this.getCSSArray("css"===t),a=r.length;for(i=0;a>i;i++){s=r[i];if(s.property||s.value||s.comment){n+=u.formatCSSString(s,t);i!==a-1&&(n+="\r\n")}}return n},combineUsageModels:function(e,t){function i(e,t){var i,s,n,r,a,o,l,c,d,h;for(o=0;o<t.length;o++){s=t[o];i=!1;h=s.get("style");for(l=0;l<e.length;l++){n=e[l];if(h.isEqual(n.get("style"))){for(c=0;c<s.get("layers").length;c++){r=s.get("layers")[c];i=!1;for(d=0;d<n.get("layers").length;d++){a=n.get("layers")[d];if(r.isEqual(a)){i=!0;break}}i||n.addUsage(r,s)}i=!0;break}}i||e.push(s)}}i(e.colors,t.colors);i(e.gradients,t.gradients);i(e.textStyles,t.textStyles)},fixupLayerEffects:function(){var e=this.get("properties").get("layerEffects"),t=function(e){return e.enabled};if(e){Array.isArray(e.frameFX)||(e.frameFX=[e.frameFX]);e.frameFX=e.frameFX.filter(t);Array.isArray(e.innerShadow)||(e.innerShadow=[e.innerShadow]);e.innerShadow=e.innerShadow.filter(t);Array.isArray(e.solidFill)||(e.solidFill=[e.solidFill]);e.solidFill=e.solidFill.filter(t);Array.isArray(e.gradientFill)||(e.gradientFill=[e.gradientFill]);e.gradientFill=e.gradientFill.filter(t);Array.isArray(e.dropShadow)||(e.dropShadow=[e.dropShadow]);e.dropShadow=e.dropShadow.filter(t)}},getUsageModels:function(){var t,i,s,n,r,a=this.get("usageModels"),o=this,l=function(e){e.get("layers").length=0;e.get("layers").push(o)};if(!a){a={colors:[],gradients:[],textStyles:[]};t=this.get("properties");i=this.get("layerCollection");if(t){this.fixupLayerEffects();this.addColorStyle(a.colors,t.getColors());this.addGStyle(a.gradients,t.getGradients());this.addStyle(a.textStyles,t.getTextStyles())}if(i)for(r=0;r<i.length;r++){s=i.at(r);n=s.getUsageModels();this.combineUsageModels(a,n)}i=this.get("smartObjectLayers");if(i)for(r=0;r<i.length;r++){s=i.at(r);n=s.getUsageModels();e.each(n.colors,l);e.each(n.gradients,l);e.each(n.textStyles,l);this.combineUsageModels(a,n);
}this.set("usageModels",a)}return{colors:a.colors,gradients:a.gradients,textStyles:a.textStyles}},addStyle:function(e,t){var i,s,n,r;if(t.length)for(n=0;n<t.length;n++){s=!1;for(r=0;r<e.length;r++)if(e[r].get("style").isEqual(t[n])){s=!0;e[r].addUsage(this);break}if(!s){i=new o({style:t[n]});i.addUsage(this);e.push(i)}}},addColorStyle:function(e,t){var i,s,n,a;this.set("colors",t);if(t.length)for(n=0;n<t.length;n++){s=!1;for(a=0;a<e.length;a++)if(e[a].get("style").isEqual(t[n])){s=!0;e[a].addUsage(this,t[n]);break}if(!s){i=new r({style:t[n]});i.addUsage(this,t[n]);e.push(i)}}},addGStyle:function(e,t){var i,s,n,r;if(t.length)for(n=0;n<t.length;n++){i=!1;for(r=0;r<e.length;r++)if(e[r].get("style").isEqual(t[n])){i=!0;e[r].addUsage(this);break}if(!i){s=new a({style:t[n]});s.addUsage(this);e.push(s)}}},isEqual:function(e){return this.get("layerId")===e.get("layerId")},zeroBounds:function(){var e=this.get("bounds");return 0===e.top&&0===e.bottom&&0===e.left&&0===e.right},zeroRawBounds:function(){var e=this.get("rawBounds");return!e||0===e.top&&0===e.bottom&&0===e.left&&0===e.right},isDescendantOf:function(e){for(var t=this.get("parentModel"),i=!1;t&&t instanceof m;){if(t.isEqual(e)){i=!0;break}t=t.get("parentModel")}return i},isEffectiveRenderedVisibility:function(){return this.get("renderedVisible")===this.getEffectiveVisibility()},getEffectiveVisibility:function(){var e,t,i=this.isVisibleOnStage(),s=this.get("parentModel"),n=this.get("layerCollection");i&&s&&s instanceof m&&(i=s.getEffectiveVisibility());if(i&&n){i=!1;for(t=0;t<n.length;t++){e=n.at(t);if(e.get("visible")){i=!0;break}}}return i},getEffectiveOpacity:function(){var e,t,i=this.isVisibleOnStage()?this.getCombinedOpacity():0,s=this.get("parentModel"),n=this.get("layerCollection");0!==i&&s&&s instanceof m&&(i*=s.getEffectiveOpacity());if(i>0&&n){var r=!1;for(t=0;t<n.length;t++){e=n.at(t);if(e.get("visible")){r=!0;break}}r||(i=0)}return i},findDescendantFlattenedSprites:function(){var t=l.getFlattenedLayers(),i=[],s=this;e.each(t,function(e){e.isDescendantOf(s)&&i.push(e)});return i},isVisibleOnStage:function(){var e=this.get("visible"),t=this.get("clipbase"),i=t?t.get("visible"):!0;return e&&i},isLayerShown:function(){for(var e=this,t=!0;t&&e instanceof m;){t=e.get("visible");e=e.get("parentModel")}return t},getCombinedOpacity:function(){var e=this.get("properties")&&this.get("properties").get("blendOptions");if(e){var t=(e.opacity||100)/100,i=(e.fillOpacity||100)/100;return t*i}return 1},canBeExtracted:function(){if(this.getEffectiveVisibility()){if(this.get("type")===p.Type.LAYER_GROUP||this.get("type")===p.Type.LAYER_ARTBOARD){var t=this.get("layerCollection")?this.get("layerCollection").models:[];return e.some(t,function(e,t){return e.canBeExtracted()})}return this.get("type")!==p.Type.LAYER_ADJUSTMENT}return!1}});return m});define("ccweb.files.extract/utils/StyleUtil",["ccweb.files.extract/models/BaseStyleUsageModel","ccweb.files.extract/models/ColorModel","ccweb.files.extract/models/GradientModel","ccweb.files.extract/models/TextStyleModel"],function(e,t,i,s){"use strict";var n={areUsageStylesEqual:function(n,r){var a=!1;if(n&&r&&n instanceof e&&r instanceof e){var o=n.get("style"),l=r.get("style");(o instanceof t&&l instanceof t||o instanceof i&&l instanceof i||o instanceof s&&l instanceof s)&&(a=o.isEqual(l))}return a}};return n});define("ccweb.files.extract/controllers/SelectionController",["underscore","backbone","ccweb.files.extract/Constants","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/models/LayerModel","ccweb.files.extract/models/LayerModelMap","ccweb.files.extract/models/ColorUsageModel","ccweb.files.extract/models/TextStyleUsageModel","ccweb.files.extract/models/GradientUsageModel","ccweb.files.extract/utils/StyleUtil","ccweb.files.extract/utils/MeasurementUtil"],function(e,t,i,s,n,r,a,o,l,c,d){"use strict";var h=t.Model.extend({selectionMap:{},focusMap:{},defaults:{psdModel:null,psdView:null,extractedStylesInSelection:null},getPSDModel:function(){return this.psdModel},setPSDModel:function(e){this.psdModel&&this.psdModel.off(null,null,this);this.psdModel=e;this.psdModel.on("change:info",this.handleModelInfoChanged,this);this.resetFocusMap();this.resetSelection();this.offscreenCanvas=null;this.offscreenContext=null;this.clipLayersToImage=!1;this.handleModelInfoChanged()},handleModelInfoChanged:function(){var e=this.psdModel.get("info");e&&e.hasOwnProperty("clipSpriteSheetLayers")&&(this.clipLayersToImage=e.clipSpriteSheetLayers)},isLayerVisible:function(e,t){var i=e.get("visible");t&&e.get("parentModel")&&i&&e.get("parentModel")instanceof n&&(i=this.isLayerVisible(e.get("parentModel"),t));return i},isSelected:function(e){return null!==this.selectionMap[e]},getSelectedLayers:function(){return e.values(this.selectionMap)},selectParent:function(){if(1===Object.keys(this.selectionMap).length){var e,t,i;for(e in this.selectionMap)if(this.selectionMap.hasOwnProperty(e)){t=r.getLayerModelFromId(e);i=t.get("parentModel");i instanceof n&&this.changeSelection([i],!1)}}},selectTopChild:function(){if(1===Object.keys(this.selectionMap).length){var e,t,i;for(e in this.selectionMap)if(this.selectionMap.hasOwnProperty(e)){t=r.getLayerModelFromId(e);i=t.get("layerCollection");i&&i.length>0&&this.changeSelection([i.at(i.length-1)],!1)}}},selectNextSibling:function(){if(1===Object.keys(this.selectionMap).length){var e,t,i,s,n;for(e in this.selectionMap)if(this.selectionMap.hasOwnProperty(e)){t=r.getLayerModelFromId(e);i=t.get("parentModel");s=i.get("layerCollection");n=s.indexOf(t);n>-1&&(n>0?this.changeSelection([s.at(n-1)],!1):this.changeSelection([s.at(s.length-1)],!1))}}},selectPrevSibling:function(){if(1===Object.keys(this.selectionMap).length){var e,t,i,s,n;for(e in this.selectionMap)if(this.selectionMap.hasOwnProperty(e)){t=r.getLayerModelFromId(e);i=t.get("parentModel");s=i.get("layerCollection");n=s.indexOf(t);n>-1&&(n<s.length-1?this.changeSelection([s.at(n+1)],!1):this.changeSelection([s.at(0)],!1))}}},changeSelection:function(e,t,i){var s,n,r;if(!t||!e){for(s in this.selectionMap)this.selectionMap.hasOwnProperty(s)&&this.selectionMap[s].set("selected",!1);this.selectionMap={}}if(e)for(n=0;n<e.length;n++){r=e[n];if(r&&!r.get("selected")){r.set("selected",!0);this.selectionMap[r.get("layerId")]=r}else if(r&&t){r.set("selected",!1);delete this.selectionMap[r.get("layerId")]}}graphite.events.trigger("selection-changed",i);this.updateStylesForSelection()},resetSelection:function(){this.selectionMap={}},selectItemAtPoint:function(e,t,i){var s=-1!==e&&-1!==t?this.itemAtPoint(e,t):null;this.changeSelection([s],i,!0);var n=null!==s?[s]:[];graphite.events.trigger("item-hovered-over",n,!0)},_expandGroup:function(e,t){var i,s=e.get("layerCollection"),n=!1;for(i=0;i<s.length;i++){var r=s.at(i),a=r.get("layerCollection");t.push(r);r.get("visible")===!1&&(n=!0);a&&(n=n||this._expandGroup(r,t))}return n},expandSelection:function(t){var i=[],s=[],n=[],r=t,a=this;e.each(t,function(e){for(var t=e.get("parentModel");t;){t.get("selected")&&i.push(t.get("layerId"));t=t.get("parentModel")}});i.length&&(r=e.filter(t,function(e){return-1===i.indexOf(e.get("layerId"))}));e.each(r,function(e){if(e.get("layerCollection")){var t=[],i=a._expandGroup(e,t);if(i){n.push(e.get("layerId"));s=s.concat(t)}}});r=r.concat(s);r=e.filter(r,function(e){return a.isLayerVisible(e,!0)&&-1===n.indexOf(e.get("layerId"))});return r},updateStylesForSelection:function(){var t,i=this.getSelectedLayers(),n=this.psdModel.get("extractedStyles")||{colors:[],textStyles:[],gradients:[],models:[]};if(i.length){var r={colors:[],textStyles:[],gradients:[]};e.each(i,function(e,i){t=e.getUsageModels();e.combineUsageModels(r,t)});n={colors:r.colors,textStyles:r.textStyles,gradients:r.gradients,models:i}}var d;s.get("selectedInspectItem")instanceof a?d=n.colors:s.get("selectedInspectItem")instanceof o?d=n.textStyles:s.get("selectedInspectItem")instanceof l&&(d=n.gradients);if(d){var h=!1;e.each(d,function(e,t){if(c.areUsageStylesEqual(e,s.get("selectedInspectItem"))){s.set("selectedInspectItem",e);h=!0;return!1}return!0});h||s.setSelectedInspectItem(null)}this.set("extractedStylesInSelection",n)},itemAtPoint:function(e,t){var i,s,n,r,a,o=null;for(i in this.focusMap)if(this.focusMap.hasOwnProperty(i)){s=this.focusMap[i];if(null!==s){n=s.get("layerCollection");if(n)for(r=n.length-1;r>=0;r--){a=n.at(r);o=this.hitTestItem(a,e,t,!0);if(o)break}if(o)break}}return o},findHitItem:function(e,t,i,s){var n,r,a=null,o=e.get("layerCollection");for(n=o.length-1;n>=0;n--){r=o.at(n);a=this.hitTestItem(r,t,i,s);if(null!==a)break}return a},hitTestItem:function(e,t,s,n){var a=null,o=e.get("bounds"),l=e.get("visible"),c=e.get("type")===i.Type.LAYER_ADJUSTMENT,h=e.get("type")===i.Type.LAYER_TEXT;void 0===l&&(l=!0);if(l&&!c&&this.pointInRect(t,s,o))if("complete"===this.psdModel.get("dataType")){var p=r.getLayerInfoForId(e.get("layerId")).item;if("CANVAS"===p[0].tagName)(h||this.pixelHit(p[0],t,s,o))&&(a=e);else{var u=e.get("layerCollection");null!==u&&n&&(a=this.findHitItem(e,t,s,n))}}else null!==e.get("layerCollection")&&n?a=this.findHitItem(e,t,s,n):this.pointInRect(t,s,d.getClippedBounds(o,this.psdModel))&&(a=e);return a},pointInRect:function(e,t,i){return e<=i.right&&e>=i.left&&t<=i.bottom&&t>=i.top},pixelHit:function(e,t,i,s){var n,r,a=!1,o=s.left,l=s.top;if(!this.offscreenContext){this.offscreenCanvas=document.createElement("canvas");this.offscreenCanvas.width=257;this.offscreenCanvas.height=256;this.offscreenContext=this.offscreenCanvas.getContext("2d");this.offscreenContext.webkitImageSmoothingEnabled=!1}if(this.clipLayersToImage){o=Math.max(o,0);l=Math.max(l,0)}this.offscreenContext.clearRect(0,0,1,1);this.offscreenContext.drawImage(e,t-o,i-l,1,1,0,0,1,1);n=this.offscreenContext.getImageData(0,0,1,1);for(r=0;r<n.data.length;r+=4)if(n.data[r+3]>0){a=!0;break}return a},resetFocusMap:function(){this.focusMap={root:this.psdModel}},groupExpanded:function(e){this.psdView.groupExpanded(e)},clearDOMSelection:function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()},enableDropperTool:function(){if(s.get("activeTool")!==i.Tool.DROPPER){s.changeActiveTool(i.Tool.DROPPER);this.selectItemAtPoint(-1,-1,!1);s.setSelectedInspectItem(null);graphite.events.trigger("dropperStart")}else this.disableDropperTool()},disableDropperTool:function(){s.changeActiveTool(i.Tool.SELECT_DIRECT);graphite.events.trigger("dropperStop")},rectIntersectsWith:function(e,t){return e.left<t.right&&t.left<e.right&&e.top<t.bottom?t.top<e.bottom:!1},rectIntersect:function(e,t){var i=Math.max(e.left,t.left),s=Math.max(e.top,t.top),n=Math.min(e.right,t.right),r=Math.min(e.bottom,t.bottom);return n>=i&&r>=s?{left:i-t.left,top:s-t.top,width:n-i,height:r-s,destLeft:i-e.left,destTop:s-e.top}:null},findIntersectsBackToFront:function(e,t,i){var s,n,a,o,l,c,h,p,u=t||this.psdModel.get("layerCollection"),f=i||[];if(u)for(p=u.length-1;p>=0;p--){s=n=u.at(p);a=d.getVisibleBounds(s,this.psdModel,!0);o=s.get("flattenedSprite");l=s.get("flattenedParent");if(s.get("visible")&&l){s=r.getLayerModelFromId(l);o=s.get("flattenedSprite")}if(o){var g=o.altPsdOrigin||o.psdOrigin;a.left=g.left;a.top=g.top;a.bottom=a.top+(o.bounds.bottom-o.bounds.top);a.right=a.left+(o.bounds.right-o.bounds.left)}if(n.getEffectiveVisibility()){c=s.get("layerCollection");if(c&&!o)this.rectIntersectsWith(e,a)&&this.findIntersectsBackToFront(e,c,f);else{h=this.rectIntersect(e,a);h&&f.push({item:s,intersect:h})}if(o)break}}return f},canExtractAsset:function(){var t=this.expandSelection(this.getSelectedLayers());return e.some(t,function(e,t){return e.canBeExtracted()})}});return new h});define("ccweb.files.extract/utils/KeyboardUtils",["jquery","underscore","ccweb.files.extract/Constants"],function(e,t,i){"use strict";var s={isMultiSelectKey:function(e){var t=e.shiftKey,s=this.getPlatform();e.metaKey&&s===i.Platform.MAC?t=!0:e.ctrlKey&&s===i.Platform.WINDOWS&&(t=!0);return t},getPlatform:function(){var e=navigator.appVersion.toLowerCase();e.indexOf("macintosh")>-1?e=i.Platform.MAC:e.indexOf("windows")>-1&&(e=i.Platform.WINDOWS);return e},getActiveFocusedElement:function(){var t=e(document.activeElement);return t},getMetaKeyName:function(e){var t=String(e).toLowerCase(),s=this.getPlatform();return"ctrl"===t||"cmd"===t?s===i.Platform.MAC?"⌘":"Ctrl":"shift"===t?s===i.Platform.MAC?"⇧":"Shift":"alt"===t||"option"===t?s===i.Platform.MAC?"⌥":"Alt":e},_doesFocusedElementHaveTag:function(e){var i=this.getActiveFocusedElement();if(i&&i.length){var s=function(e){return i.is(e)};if(t.some(e,s))return i.is("input")||i.is("textarea")||i[0].isContentEditable?i:null}return null},isInputInFocus:function(){return this._doesFocusedElementHaveTag(["input","p","div","textarea"])}};return s});define("ccweb.files.extract/controllers/KeyboardController",["jquery","underscore","./SelectionController","./DetailsController","ccweb.files.extract/Constants","ccweb.files.extract/utils/KeyboardUtils"],function(e,t,i,s,n,r){"use strict";var a={attachedElement:null,multiSelectPending:!1,attachKeyHandlers:function(i){this.attachedElement&&this.removeKeyHandlers();t.bindAll(this,"handleKeyUp","handleKeyDown");this.attachedElement=i||e(document);this.attachedElement.keyup(this.handleKeyUp);this.attachedElement.keydown(this.handleKeyDown)},removeKeyHandlers:function(){if(this.attachedElement){this.attachedElement.unbind("keyup",this.handleKeyUp);this.attachedElement.unbind("keydown",this.handleKeyDown);this.attachedElement=null}},isMultiSelectModifier:function(e){var i=r.isMultiSelectKey(e);i&&(i=t.contains([n.Shortcut.SHIFT,n.Shortcut.CTRL,n.Shortcut.CMD,n.Shortcut.SECONDARY_CMD,n.Shortcut.CMD_FF],e.keyCode));return i},setMultiSelectPending:function(e){if(this.multiSelectPending!==e){graphite.events.trigger("multiSelectPending",e);this.multiSelectPending=e}},handleKeyDown:function(e){if(this._hasFocus()){this.setMultiSelectPending(this.isMultiSelectModifier(e));switch(e.keyCode){case n.Shortcut.LEFT_ARROW:case n.Shortcut.RIGHT_ARROW:case n.Shortcut.UP_ARROW:case n.Shortcut.DOWN_ARROW:if(this.handleArrowKeys&&0!==i.getSelectedLayers().length){e.stopPropagation();e.preventDefault()}}}},_hasFocus:function(){return document.activeElement===this.attachedElement[0]||!r.isInputInFocus()},handleKeyUp:function(e){if(this._hasFocus()){this.setMultiSelectPending(!1);switch(e.keyCode){case n.Shortcut.CLEAR:graphite.events.trigger("dismiss-modal-views");graphite.events.trigger("hide-first-user-overlay");i.disableDropperTool();i.selectItemAtPoint(-1,-1,!1);s.setSelectedInspectItem(null);break;case n.Shortcut.LEFT_ARROW:i.selectParent();break;case n.Shortcut.RIGHT_ARROW:i.selectTopChild();break;case n.Shortcut.UP_ARROW:i.selectPrevSibling();break;case n.Shortcut.DOWN_ARROW:i.selectNextSibling();break;case n.Shortcut.TOGGLE_MEASUREMENT:s.get("activeTool")===n.Tool.DROPPER&&i.disableDropperTool();s.setToggleMeasurementOnHover();graphite.events.trigger("toggle-hover-measurement");break;case n.Shortcut.HELP:graphite.events.trigger("toggle-help-dialog",{from:"keyboard"});break;case n.Shortcut.COLOR_PICKER:s.disableMeasurementOnHover();e.ctrlKey||e.shiftKey||e.metaKey||e.altKey||i.enableDropperTool();break;case n.Shortcut.FUX:graphite.events.trigger("toggle-first-user-overlay",{from:"keyboard"})}}}};return a});define("ccweb.files.extract/controllers/ZoomController",["ccweb.files.extract/Constants","ccweb.files.extract/utils/CSSUtil"],function(e,t){"use strict";var i={level:1,prevLevel:null,isTransitioning:!1,setZoomLevel:function(e,t){e=e>32?32:e;this.prevLevel=this.level;this.level=e;graphite.events.trigger("zoomChanged",t)},getZoomLevel:function(){return this.level},getZoomPercent:function(){return parseFloat((100*this.level).toFixed(2))+"%"},isZooming:function(){return this.isTransitioning},zoomPoint:function(e,t){var i=t?1/this.level:this.level;return{x:e.x*i,y:e.y*i}},zoomSize:function(e,t){var i=t?1/this.level:this.level;return this._calcZoomSizeForFactor(e,i)},zoomRect:function(e,t){var i=t?1/this.level:this.level;return this.zoomRectToLevel(e,i)},zoomRectToLevel:function(e,t){return{top:Math.round(e.top*t),left:Math.round(e.left*t),bottom:Math.round(e.bottom*t),right:Math.round(e.right*t),width:Math.round((e.right-e.left)*t),height:Math.round((e.bottom-e.top)*t)}},getCenterZoomRect:function(e,t,i,s){var n,r,a,o,l;if(e.left>=0)n=e.left+(e.right-e.left)/2;else{var c=t.width/2;n=c+e.left}if(e.top>=0)r=e.top+(e.bottom-e.top)/2;else{var d=t.height/2;r=d+e.top}n/=s;r/=s;a=t.width/i;o=t.height/i;l={top:Math.round(r-o/2),left:Math.round(n-a/2),bottom:Math.round(r+o/2),right:Math.round(n+a/2)};return l},zoomAndScrollElements:function(i,s,n,r,a,o,l){var c,d,h,p,u=this,f=this.level-this.prevLevel,g=this._calcZoomSizeForFactor(o,this.prevLevel),m=this._calcZoomSizeForFactor(o,this.level),v=m.width-g.width,y=m.height-g.height,b=r.position().left,w=r.position().top,x=s.outerWidth()-e.PREVIEW_SCROLLBAR_SPACING,S=s.outerHeight()-e.PREVIEW_SCROLLBAR_SPACING;n=this.zoomRect(n);n.width=n.right-n.left;n.height=n.bottom-n.top;d=Math.round((n.width-x)/2);p=Math.round((n.height-S)/2);l||(p=0);if(0>b){s.scrollLeft(0);r.css({left:b})}if(0>w){w=-s.scrollTop();s.scrollTop(0)}s.css("overflow","hidden");this._setElementTopLeft(r,w,b);b=r.position().left;w=r.position().top;c=b+n.left+d;h=w+n.top+p;var C=function(e){var s=u.prevLevel+f*e,n={width:g.width+v*e,height:g.height+y*e},o=w-h*e,l=b-c*e;t.applyPrefixedStyle(i,"transform","scale3d("+s+", "+s+", 1)");t.applyPrefixedStyle(i,"transform-origin","0 0");u._setElementSize(r,n);u._setElementSize(a,n);u._setElementTopLeft(r,o,l)},T=function(){s.css("overflow","scroll");var e,t,i=r.position().top,n=r.position().left;if(0>i){r.css({top:0});e=s.prop("scrollHeight")-s.innerHeight();Math.abs(i)>e&&r.height(r.height()+(Math.abs(i)-e));s.scrollTop(Math.abs(i))}if(0>n){r.css({left:0});t=Math.max(0,r.outerWidth()-s.innerWidth());Math.abs(n)>t&&r.width(r.width()+(Math.abs(n)-t));s.scrollLeft(Math.abs(n))}u.isTransitioning=!1;graphite.events.trigger("zoomCompleted")};if(s&&n&&r&&o){this.isTransitioning=!0;this._animate(450,C,T)}else{i&&this.zoomElementScale(i);r&&o&&this.zoomElementSize(r,o);a&&o&&this.zoomElementSize(a,o)}},_animate:function(e,t,i){function s(r){"undefined"==typeof n&&(n=r);var a=r-n;if(e>a){t(a/e);window.requestAnimationFrame(s)}else{t(1);i()}}var n;window.requestAnimationFrame(s)},zoomElementScale:function(e){t.applyPrefixedStyle(e,"transform","scale3d("+this.level+")");t.applyPrefixedStyle(e,"transform-origin","0 0")},zoomElementSize:function(e,t){var i=this.zoomSize(t);this._setElementSize(e,i)},zoomToFitRect:function(t,i,s){var n=t.right-t.left,r=t.bottom-t.top,a=s?Math.min((i.width-2*e.PREVIEW_SCROLLBAR_SPACING)/n,(i.height-2*e.PREVIEW_SCROLLBAR_SPACING)/r):(i.width-2*e.PREVIEW_SCROLLBAR_SPACING)/n;if(!s){a=a>1||i.width<=0?1:a;t.bottom=t.bottom-t.top;t.top=0}this.setZoomLevel(a,t)},reset:function(){this.level=1},_calcZoomSizeForFactor:function(e,t){return{width:e.width*t,height:e.height*t}},_setElementSize:function(e,t){e.css({width:t.width+"px",height:t.height+"px"})},_setElementTopLeft:function(e,t,i){e.css({top:t,left:i})}};return i});define("ccweb.files.extract/utils/ScrollUtils",["underscore"],function(e){"use strict";var t={isScrollNeeded:!1,scrollRectIntoView:function(e,t){var i=e[0],s=i.getBoundingClientRect(),n={top:s.top,bottom:s.bottom,left:s.left,right:s.right,width:s.width,height:s.height},r=0,a=0;n.height<i.scrollHeight&&(n.right-=17);n.width<i.scrollWidth?n.bottom-=25:n.bottom-=10;if(t.top<n.top&&t.bottom<n.bottom)r=t.top-n.top;else if(t.bottom>n.bottom&&t.top>n.top){r=t.bottom-n.bottom;t.top-r<n.top&&(r=t.top-n.top)}if(t.left<n.left)a=t.left-n.left;else if(t.right>n.right){a=t.right-n.right;e.scrollLeft()>0&&t.left-a<n.left&&(a=t.left-n.left)}if(0!==r||0!==a){this.isScrollNeeded=!0;e.animate({scrollTop:i.scrollTop+r,scrollLeft:i.scrollLeft+a},400,null,this.onScrollComplete)}else this.isScrollNeeded=!1},onScrollComplete:function(){if(t.isScrollNeeded){graphite.events.trigger("preview-scroll-end");t.isScrollNeeded=!1}}};return t});define("ccweb.files.extract/mixins/ScrollableItem",["jquery","ccweb.files.extract/utils/ScrollUtils"],function(e,t){"use strict";var i={scrollIntoView:function(i){var s=this.$el[0],n=this.findScrollableParent(s),r=s.getBoundingClientRect(),a={top:r.top,bottom:r.bottom,left:r.left,right:r.right,width:r.width,height:r.height};i&&i.itemHeight&&(a.bottom=a.top+i.itemHeight);t.scrollRectIntoView(e(n),a)},findScrollableParent:function(e){var t,i=e;do{i=i.parentElement;t=getComputedStyle(i)}while(i!==document.body&&"auto"!==t.overflow&&"scroll"!==t.overflow);return i}};return i});define("ccweb.files.extract/utils/ImageUtil",["jquery"],function(e){"use strict";var t={ImageScaleType:{FIT:"fit",FILL:"fill"},calcImageSizeToFit:function(e,t,i){var s,n,r=e.naturalWidth/e.naturalHeight;if(r*i>t){s=t;n=t/r}else{n=i;s=i*r}var a=(t-s)/2,o=(i-n)/2;return{width:s,height:n,x:a,y:o}},calcImageSizeToFill:function(e,t,i){var s,n,r=e.naturalWidth/e.naturalHeight;if(t>r*i){s=t;n=t/r}else{n=i;s=i*r}return{width:s,height:n}},sizeAndCenterImage:function(t,i,s,n,r){var a,o,l;a=n===this.ImageScaleType.FIT?this.calcImageSizeToFit(t,i,s):this.calcImageSizeToFill(t,i,s);o=a.width;l=a.height;if(!r){var c=t.naturalWidth,d=t.naturalHeight;o=0!==c?Math.min(a.width,c):a.width;l=0!==d?Math.min(a.height,d):a.height}e(t).width(o+"px");e(t).height(l+"px");e(t).css("margin-left",(i-o)/2+"px");e(t).css("margin-top",(s-l)/2+"px")}};return t});define("ccweb.files.extract/utils/SpriteSheetUtils",["jquery","./ImageUtil","ccweb.files.extract/controllers/DetailsController"],function(e,t,i){"use strict";var s={drawSprite:function(i,s,n,r,a){var o=n.bounds;return function(n){var l,c,d,h,p,u,f,g,m=r[0],v=m.getContext("2d");d=o.right-o.left;h=o.bottom-o.top;if(a){l=parseInt(e(i.el).find(s).css("max-width"),10);c=parseInt(e(i.el).find(s).css("max-height"),10);c&&(c=Math.min(c,h))}else{l=parseInt(e(i.el).find(s).css("width"),10);c=parseInt(e(i.el).find(s).css("height"),10);if(0===l){l=40;c=30}}p={naturalWidth:d,naturalHeight:h};u=t.calcImageSizeToFit(p,l,c||h);f=u.width;g=u.height;m=r[0];a&&(c=g);m.width=l;m.height=c;v.drawImage(n,o.left,o.top,d,h,(l-f)/2,(c-g)/2,f,g)}},drawSpriteRect:function(i,s,n,r,a,o){var l,c,d,h,p,u,f,g,m=a[0],v=m.getContext("2d");d=s.right-s.left;h=s.bottom-s.top;if(o){l=parseInt(e(i.el).find(r).css("max-width"),10);c=parseInt(e(i.el).find(r).css("max-height"),10);c&&(c=Math.min(c,h))}else{l=parseInt(e(i.el).find(r).css("width"),10);c=parseInt(e(i.el).find(r).css("height"),10);if(0===l||0===c){l=40;c=30}}p={naturalWidth:d,naturalHeight:h};u=t.calcImageSizeToFit(p,l,c||h);f=u.width;g=u.height;m=a[0];o&&(c=g);m.width=l;m.height=c;v.globalAlpha=n.opacity/255;v.beginPath();v.rect((l-f)/2,(c-g)/2,f,g);v.fillStyle="rgb("+n.color.red+","+n.color.green+","+n.color.blue+")";v.fill()},renderSpriteModel:function(e,t,s,n,r){var a=t.get("spriteSheet");if(a)a.sheetID?i.drawSpriteSheet(a.sheetID,this.drawSprite(e,s,a,e.$el.find(n),r),this):a.color&&this.drawSpriteRect(e,t.get("bounds"),a,s,e.$el.find(n),r);else{var o={opacity:0,color:{red:0,green:0,blue:0}},l=e.$el.find(n);l.length&&this.drawSpriteRect(e,t.get("bounds"),o,s,e.$el.find(n))}}};return s});define("ccweb.files.extract/utils/TemplateUtil",["jquery","underscore","plugin-dependencies"],function(e,t,i){"use strict";var s={createTemplate:function(s,n){var r=graphite.isFeatureEnabled("ccweb")?s.replace(/\/images\//g,"/resource/extract/parfait/public/images/"):s,a=t.extend({translate:i.translate},n),o=t.template(r);return e(o(a).trim()).filter("*")}};return s});define("ccweb.files.extract/views/templates/layerListItemTemplate.html",[],function(){return'<div class="layer-item">\n    <div class="layer-bg"></div>\n    <div class="visible-button"></div>\n    <div class="image-wrapper">\n        <canvas id="sprite_preview" class="preview" width="40" height="30"></canvas>\n        <div class="preview-warning"></div>\n        <div class="layer-icon"></div>\n    </div>\n    <h5 class="layer-label" title="<%- layerName %>"> <%- layerName %> </h5>\n    <div class="export-buttons">\n        <span class="asset-button"></span>\n    </div>\n</div>\n'});define("ccweb.files.extract/views/layers/LayerItemView",["jquery","underscore","backbone","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/mixins/ScrollableItem","ccweb.files.extract/utils/SpriteSheetUtils","ccweb.files.extract/utils/KeyboardUtils","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/layerListItemTemplate.html","ccweb.files.extract/Constants"],function(e,t,i,s,n,r,a,o,l,c,d){"use strict";var h=i.View.extend({className:"layer-item-row",events:{click:"handleLayerSelect",mouseenter:"handleMouseEnter",mouseleave:"handleMouseLeave","click .asset-button":"handleExtractAssetClick"},adjLayerTypeToCSS:{brightnessContrast:"brightness-contrast",levels:"levels",curves:"curves",exposure:"exposure",vibrance:"vibrance",hueSaturation:"hue-saturation",colorBalance:"color-balance",blackAndWhite:"black-and-white",photoFilter:"photo-filter",channelMixer:"channel-mixer",colorLookup:"color-lookup",gradientMapClass:"gradient-map",selectiveColor:"selective-color",thresholdClassEvent:"threshold",posterization:"posterize",invert:"invert"},initialize:function(e){t.bindAll(this,"handleVisibilityToggleClick","handleThumbMouseEnter","handleThumbMouseLeave");this.model.set("psdGuid",e.psdGuid);this.model.set("toplevel",e.toplevel);this.parentView=e.parentView;this.render();this.$el.find(".image-wrapper").first().on("mouseenter",this.handleThumbMouseEnter);this.$el.find(".image-wrapper").first().on("mouseleave",this.handleThumbMouseLeave);this.$el.find(".visible-button").first().on("click",this.handleVisibilityToggleClick);this.addHandlers()},render:function(){var e=this.model.toJSON();this.$el.html(l.createTemplate(c,e));this.$previewWarning=this.$el.find("div.preview-warning");var t=this.$el.find("div.layer-icon");e.properties.attributes.shape?t.addClass("vector"):e.type===d.Type.LAYER_TEXT?t.addClass("text"):e.type===d.Type.LAYER_SMARTOBJ?t.addClass("smart-"+e.smartObjectType):t.addClass("none");e.type===d.Type.LAYER_ADJUSTMENT&&(e.adjustmentLayerType&&this.adjLayerTypeToCSS.hasOwnProperty(e.adjustmentLayerType)?this.$el.find(".image-wrapper").addClass(this.adjLayerTypeToCSS[e.adjustmentLayerType]):this.$el.find(".image-wrapper").addClass("adjustment-layer"));this.handleFlattenedChange();this.handleVisibilityChange();this.drawSpriteSheet();this.processLayerWarning();return this},addHandlers:function(){this.model.on("change:visible",this.handleVisibilityChange,this);this.model.on("change:selected",this.handleSelectionChange,this);this.model.on("change:isFlattened",this.handleFlattenedChange,this);graphite.events.on("selectedTab",this.handleSelectedTab,this);graphite.events.on("reset-layers-visibility",this.handleVisibilityReset,this)},removeEventListeners:function(){this.model.off(null,null,this);graphite.events.off(null,null,this)},drawSpriteSheet:function(){a.renderSpriteModel(this,this.model,".image-wrapper","#sprite_preview",!1)},handleExtractAssetClick:function(t){this.model.get("selected")||n.changeSelection([this.model],!1);graphite.events.trigger("show-extract-asset-popup",{type:"new",sourceElement:e(t.target),origin:"layerPanel"});t.stopPropagation()},handleMouseEnter:function(){this.$el.find(".layer-item").toggleClass("show-export",this.model.canBeExtracted());graphite.events.trigger("item-hovered-over",[this.model],!0)},handleMouseLeave:function(){this.model.get("selected")||this.$el.find(".layer-item").removeClass("show-export")},handleThumbMouseEnter:function(){var e=this;this.hoverTimer&&clearTimeout(this.hoverTimer);if("adjustmentLayer"!==this.model.toJSON().type){graphite.events.trigger("load-layer-thumb-popup",e.model);this.hoverTimer=setTimeout(function(){graphite.events.trigger("show-layer-thumb-popup",{sourceElement:e.$el.find("#sprite_preview").first(),model:e.model})},500)}},handleThumbMouseLeave:function(){var e=this;if(this.hoverTimer){clearTimeout(this.hoverTimer);this.hoverTimer=null}graphite.events.trigger("hide-layer-thumb-popup",{sourceElement:e.$el.find("#sprite_preview").first(),model:e.model})},handleLayerSelect:function(e){n.changeSelection([this.model],o.isMultiSelectKey(e))},handleSelectionChange:function(){if(this.$el.hasClass("selected")){this.$el.removeClass("selected");this.parentView&&this.parentView.childSelected(!1)}if(this.model.get("selected")===!0){this.$el.addClass("selected");this.model.canBeExtracted()&&this.$el.find(".layer-item").addClass("show-export");if(this.parentView){this.parentView.childSelected(!0);this.parentView.expand()}"psdLayersTab"===s.get("selectedTab")&&this.scrollIntoView()}else this.$el.find(".layer-item").removeClass("show-export")},handleFlattenedChange:function(){var e=this.model.get("properties"),t=this.model.get("isFlattened"),i=this.model.get("visible"),s=e?e.get("blendOptions"):null,n=!1;s&&!t&&i&&s.mode&&"passThrough"!==s.mode&&(n=!0);this.processLayerWarning(n)},processLayerWarning:function(e){e||this.model.isFontSubstitution()||this.model.isMultipleLayerStylesCSSWarning()?this.$previewWarning.show():this.$previewWarning.hide()},handleSelectedTab:function(e){if("Layers"===e.selectedTab&&this.model.get("selected")===!0&&this.parentView){this.parentView.expand();this.parentView.scrollIntoView()}},handleVisibilityChange:function(){var e=this.$el.find(".visible-button").first();e.toggleClass("off-state",!this.model.get("visible"));this.$el.find(".layer-item").toggleClass("show-export",this.model.get("selected")===!0&&this.model.canBeExtracted());this.handleFlattenedChange()},handleVisibilityToggleClick:function(e){var t=this.model.get("visible");this.model.set("visible",!t);graphite.events.trigger("layerVisiblityChanged",{layer:this.model});e.stopPropagation()},handleVisibilityReset:function(){this.model.set("visible",this.model.get("psdVisible"))},remove:function(){this.removeEventListeners();i.View.prototype.remove.call(this)}});t.extend(h.prototype,r);return h});define("ccweb.files.extract/views/layers/LayersListItemView",["underscore","backbone","ccweb.files.extract/Constants","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/mixins/ScrollableItem","ccweb.files.extract/utils/KeyboardUtils"],function(e,t,i,s,n,r,a){"use strict";var o=t.View.extend({className:"layer-item-row",initialize:function(e){this.parentView=e.parentView},addHandlers:function(){this.model.on("change:visible",this.handleVisibilityChange,this);this.model.on("change:selected",this.handleSelectionChange,this);graphite.events.on("reset-layers-visibility",this.handleVisibilityReset,this)},render:function(){return this},removeEventListeners:function(){this.model.off(null,null,this)},handleLayerSelect:function(e){if(this.model.get("type")===i.Type.LAYER_ARTBOARD&&e.altKey){graphite.events.trigger("zoomToFit",this.model.get("bounds"));graphite.events.trigger("artboard-zoomToFit")}else n.changeSelection([this.model],a.isMultiSelectKey(e))},handleSelectionChange:function(){if(this.$el.hasClass("selected")){this.$el.removeClass("selected");this.parentView&&this.parentView.childSelected(!1)}if(this.model.get("selected")===!0){this.$el.addClass("selected");this.model.canBeExtracted()&&this.$el.find(".layer-group-header").first().addClass("show-export");if(this.parentView){this.parentView.childSelected(!0);this.parentView.expand()}"psdLayersTab"===s.get("selectedTab")&&this.scrollIntoView({itemHeight:42})}else this.$el.find(".layer-group-header").first().removeClass("show-export")},handleVisibilityChange:function(){var e=this.$el.find(".visible-button").first();e.toggleClass("off-state",!this.model.get("visible"));this.$el.find(".layer-group-header").toggleClass("show-export",this.model.get("selected")===!0&&this.model.canBeExtracted());
},handleVisibilityToggleClick:function(e){this.model.set("visible",!this.model.get("visible"));graphite.events.trigger("layerVisiblityChanged",{layer:this.model});e.stopPropagation()},handleVisibilityReset:function(){this.model.set("visible",this.model.get("psdVisible"))},remove:function(){this.removeEventListeners();t.View.prototype.remove.call(this)}});e.extend(o.prototype,r);return o});define("ccweb.files.extract/views/templates/layerGroupListItemTemplate.html",[],function(){return'<div class="layer-group-item closed">\n    <div class="layer-group-header">\n        <div class="layer-bg"></div>\n        <div class="visible-button layer-group"></div>\n        <div class="folder"></div>\n        <h5 class="layer-group-label" title="<%- layerName %>"> <%- layerName %></h5>\n        <div class="export-buttons">\n            <span class="asset-button"></span>\n        </div>\n    </div>\n    <div class="children-list">\n        <div class="children-list-list">\n        </div>\n    </div>\n</div>\n'});define("ccweb.files.extract/views/templates/layerGroupListItemSpritesheetTemplate.html",[],function(){return'<div class="layer-group-item closed">\n    <div class="layer-group-header">\n        <div class="layer-bg"></div>\n        <div class="visible-button layer-group"></div>\n        <div class="folder"></div>\n        <div class="image-wrapper">\n            <canvas id="sprite_preview" class="preview" width="40" height="30"></canvas>\n            <div class="preview-warning"></div>\n            <div class="layer-icon"></div>\n        </div>\n        <h5 class="layer-group-label" title="<%- layerName %>"> <%- layerName %></h5>\n        <div class="export-buttons">\n            <span class="asset-button"></span>\n        </div>\n    </div>\n    <div class="children-list">\n        <div class="children-list-list">\n        </div>\n    </div>\n</div>\n'});define("ccweb.files.extract/views/templates/layerGroupListItemNoChildrenTemplate.html",[],function(){return'<div class="layer-group-item closed">\n    <div class="layer-group-header">\n        <div class="layer-bg"></div>\n        <div class="visible-button layer-group"></div>\n        <div class="folder"></div>\n        <div class="image-wrapper">\n        </div>\n        <h5 class="layer-group-label" title="<%- layerName %>"> <%- layerName %></h5>\n        <div class="export-buttons">\n            <span class="asset-button"></span>\n        </div>\n    </div>\n    <div class="children-list">\n        <div class="children-list-list">\n        </div>\n    </div>\n</div>'});define("ccweb.files.extract/views/layers/LayerGroupItemView",["jquery","underscore","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/views/layers/LayerItemView","ccweb.files.extract/views/layers/LayersListItemView","ccweb.files.extract/utils/ImageUtil","ccweb.files.extract/utils/SpriteSheetUtils","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/layerGroupListItemTemplate.html","ccweb.files.extract/views/templates/layerGroupListItemSpritesheetTemplate.html","ccweb.files.extract/views/templates/layerGroupListItemNoChildrenTemplate.html","ccweb.files.extract/Constants"],function(e,t,i,s,n,r,a,o,l,c,d,h,p){"use strict";var u=r.extend({hoverTimer:null,events:{change:"handleImageLoad"},initialize:function(e){t.bindAll(this,"handleImageLoad","handleLayerSelect","handleToggleOpen","handleVisibilityToggleClick","handleExtractAssetClick","handleExtractCodeClick","handleMouseEnter","handleMouseLeave","handleThumbMouseEnter","handleThumbMouseLeave");this.model.set("psdGuid",e.psdGuid);this.model.set("toplevel",e.toplevel);this.childrenRendered=!1;this.parentView=e.parentView;this.subItems=[];this.render();this.handleVisibilityChange()},render:function(){var e;e=void 0!==this.model.get("layerCollection")&&0===this.model.get("layerCollection").length?h:d;this.$previewWarning=this.$el.find("div.preview-warning");this.$el.html(l.createTemplate(e,this.model.toJSON()));this.handleFlattenedChange();this.drawSpriteSheet();this.renderChildren();this.processLayerWarning();this.addHandlers();if(this.model.get("type")===p.Type.LAYER_ARTBOARD){this.$el.find(".layer-group-item").first().addClass("artboard");this.$el.find(".folder").first().addClass("artboard")}return this},addHandlers:function(){r.prototype.addHandlers.apply(this,arguments);this.model.on("change:selected",this.handleSelectionChange,this);this.model.on("change:isFlattened",this.handleFlattenedChange,this);this.$el.find(".image-wrapper img").load(this.handleImageLoad);this.$el.find(".image-wrapper").first().click(this.handleLayerSelect);this.$el.find(".layer-group-label").first().click(this.handleLayerSelect);this.$el.find(".folder").first().click(this.handleToggleOpen);this.$el.find(".visible-button.layer-group").first().click(this.handleVisibilityToggleClick);this.$el.find(".asset-button").first().click(this.handleExtractAssetClick);this.$el.find(".code-button").first().click(this.handleExtractCodeClick);this.$el.find(".layer-group-header").first().mouseenter(this.handleMouseEnter);this.$el.find(".layer-group-header").first().mouseleave(this.handleMouseLeave);this.$el.find(".image-wrapper").first().mouseenter(this.handleThumbMouseEnter);this.$el.find(".image-wrapper").first().mouseleave(this.handleThumbMouseLeave);this.addHandlersToChildren(this.model)},addHandlersToChildren:function(e){var t,i,s=e.get("layerCollection")||[];for(t=0;t<s.length;t++){i=s.at(t);if(i.get("type")!==p.Type.LAYER_ADJUSTMENT){i.on("change:visible",this.handleVisibilityChange,this);(i.get("type")===p.Type.LAYER_GROUP||i.get("type")===p.Type.LAYER_ARTBOARD)&&this.addHandlersToChildren(i)}}},removeEventListeners:function(){this.model.off(null,null,this);graphite.events.off(null,null,this)},drawSpriteSheet:function(){o.renderSpriteModel(this,this.model,".image-wrapper","#sprite_preview",!1)},renderChildren:function(){if(this.childrenRendered!==!0){if(void 0!==this.model.attributes.layerCollection){var e,t,s,r=this.model.attributes.layerCollection;for(s=r.length-1;s>-1;s--){e=r.at(s);t=e.get("type")!==p.Type.LAYER_GROUP&&e.get("type")!==p.Type.LAYER_ARTBOARD?new n({model:e,parentView:this,psdGuid:i.getPSDModel().get("id")}):new u({model:e,parentView:this,psdGuid:i.getPSDModel().get("id")});this.subItems.push(t);this.$el.find(".children-list-list").first().append(t.el)}}this.childrenRendered=!0}},handleFlattenedChange:function(){var e=this.model.get("properties"),t=this.model.get("isFlattened"),i=this.model.get("visible"),s=e?e.get("blendOptions"):null;if(s&&!t&&i){if(s.mode&&"passThrough"!==s.mode){this.blendOptionsWarning=!0;return}this.blendOptionsWarning=!1}else this.blendOptionsWarning=!1;this.processLayerWarning()},processLayerWarning:function(){this.blendOptionsWarning||this.model.isFontSubstitution()||this.model.isMultipleLayerStylesCSSWarning()?this.$previewWarning.show():this.$previewWarning.hide()},handleImageLoad:function(){var e=parseInt(this.$el.find(".image-wrapper").width(),10);e&&a.sizeAndCenterImage(this.$el.find(".image-wrapper img")[0],e,parseInt(this.$el.find(".image-wrapper").height(),10),a.ImageScaleType.FIT,!1)},centerChildThumbs:function(){var t=this.$el.find(".children-list-list"),i=t?t.first()[0].children:null;e.each(i,function(t,i){var s=e(i).find(".image-wrapper img")[0];s&&a.sizeAndCenterImage(e(i).find(".image-wrapper img")[0],parseInt(e(i).find(".image-wrapper").width(),10),parseInt(e(i).find(".image-wrapper").height(),10),a.ImageScaleType.FIT,!1)});e.each(this.subItems,function(e,t){t.drawSpriteSheet()})},handleThumbMouseEnter:function(){var e=this;this.hoverTimer&&clearTimeout(this.hoverTimer);graphite.events.trigger("load-layer-thumb-popup",e.model);this.hoverTimer=setTimeout(function(){graphite.events.trigger("show-layer-thumb-popup",{sourceElement:e.$el.find("#sprite_preview").first(),model:e.model})},500)},handleThumbMouseLeave:function(){if(this.hoverTimer){clearTimeout(this.hoverTimer);this.hoverTimer=null}graphite.events.trigger("hide-layer-thumb-popup",{sourceElement:this.$el.find("#sprite_preview").first(),model:this.model})},handleMouseEnter:function(){this.$el.find(".layer-group-header").first().toggleClass("show-export",this.model.canBeExtracted());graphite.events.trigger("item-hovered-over",[this.model],!0)},handleMouseLeave:function(){this.model.get("selected")||this.$el.find(".layer-group-header").first().removeClass("show-export");graphite.events.trigger("item-hovered-over",[],!0)},handleExtractAssetClick:function(t){this.model.get("selected")||i.changeSelection([this.model],!1);graphite.events.trigger("show-extract-asset-popup",{type:"new",sourceElement:e(t.target),origin:"layerPanel"});t.stopPropagation()},handleExtractCodeClick:function(t){this.model.get("selected")||i.changeSelection([this.model],!1);graphite.events.trigger("show-extract-code-popup",{sourceElement:e(t.target),model:this.model})},handleToggleOpen:function(){this.renderChildren();var e=this.model.get("layerCollection").length>0,t=this.$el.find(".children-list").first();if(this.$el.find(".layer-group-item").first().hasClass("closed")){e&&t.slideDown(50);i.groupExpanded(this.model);this.centerChildThumbs();this.$el.find(".layer-group-item").first().removeClass("closed")}else{t.slideUp(50);this.$el.find(".layer-group-item").first().addClass("closed")}},childSelected:function(e){e?this.$el.addClass("parent-of-selected"):this.$el.removeClass("parent-of-selected")},expand:function(){var e=this.$el.find(".children-list").first();if(e.is(":hidden")){e.slideDown(50);i.groupExpanded(this.model);this.centerChildThumbs()}this.parentView instanceof u&&this.parentView.expand();this.$el.find(".layer-group-item").first().removeClass("closed")},remove:function(){this.removeEventListeners();t.each(this.subItems,function(e){e.remove()});this.subItems.length=0;r.prototype.remove.call(this)}});return u});define("ccweb.files.extract/views/layers/LayersListView",["underscore","backbone","ccweb.files.extract/views/layers/LayerItemView","ccweb.files.extract/views/layers/LayerGroupItemView","ccweb.files.extract/Constants","ccweb.files.extract/controllers/DetailsController","plugin-dependencies"],function(e,t,i,s,n,r,a){"use strict";function o(e){for(var t=0,i=e.length;i>t;t++){var s=e[t];if(s.model.get("visible")!==s.model.get("psdVisible"))return!1;if(s.subItems&&!o(s.subItems))return!1}return!0}var l=t.View.extend({template:'<div class="section-wrapper"><button disabled class="topcoat-button" id="resetLayers">'+a.translate("Reset Layers")+'</button></div><div class="layers-list" tabindex="0"></div>',$layersList:null,layerItems:[],events:{"click #resetLayers":"handleResetLayers"},initialize:function(){this.render();this.model.on("change:layerCollection",this.handleModelLayerCollectionChanged,this);this.handleModelLayerCollectionChanged()},render:function(){var t=e.template(this.template),i=this;this.$el.html(t);this.$layersList=this.$el.find(".layers-list");var s=this.$el.find("#resetLayers");graphite.events.on("layerVisiblityChanged",function(){s.attr({disabled:o(i.layerItems)})},this);graphite.events.on("reset-layers-visibility",function(){s.attr({disabled:!0})},this);this.$el.keydown(function(e){switch(e.keyCode){case n.Shortcut.LEFT_ARROW:case n.Shortcut.RIGHT_ARROW:case n.Shortcut.UP_ARROW:case n.Shortcut.DOWN_ARROW:e.stopPropagation();e.preventDefault()}});return this},handleModelLayerCollectionChanged:function(){var e,t,r,a,o,l;this.layerItems.length=0;this.$layersList.empty();if(null!==this.model.get("layerCollection")){e=this;t=this.model.get("layerCollection");for(r=t.length-1;r>-1;r--){a=t.at(r);o=a.get("type");if(o===n.Type.LAYER_GROUP||o===n.Type.LAYER_ARTBOARD){l=new s({model:a,psdGuid:e.model.get("id"),toplevel:!0});this.layerItems.push(l)}else{l=new i({model:a,psdGuid:e.model.get("id"),toplevel:!0});this.layerItems.push(l)}this.$layersList.append(l.el)}}},removeEventListeners:function(){this.model.off(null,null,this);graphite.events.off(null,null,this)},remove:function(){if(this.$layersList){this.$layersList.remove();this.$layersList=null}e.each(this.layerItems,function(e){e.remove()});this.layerItems.length=0;this.removeEventListeners();t.View.prototype.remove.call(this)},handleResetLayers:function(){graphite.events.trigger("reset-layers-visibility",{})}});return l});define("ccweb.files.extract/views/inspect/CSSListItemView",["underscore","backbone","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/utils/CSSUtil"],function(e,t,i,s){"use strict";var n={"background-color":1,"border-color":1,color:1},r=t.View.extend({defaults:{cssObj:null,clip:null},initialize:function(e){this.cssObj=e.cssObj;this.preProcessor=e.preProcessor;this.render()},render:function(){var e=s.cssPreprocessors[this.preProcessor].listItem(this.cssObj);this.setElement("<li>"+e+"</li>");return this},isColorProperty:function(){return this.cssObj&&n.hasOwnProperty(this.cssObj.property)},isSpacer:function(){return this.cssObj&&this.cssObj.spacer}});return r});define("ccweb.files.extract/views/templates/cssColorItemTemplate.html",[],function(){return'<li>\n    <span class="property">color:</span><span class="color-chip" style="background-color: <%- value %>;"></span> <span class="value"><%- value %>;</span>\n</li>\n'});define("ccweb.files.extract/views/templates/messageSelectSingleItemTemplate.html",[],function(){return'<li class="css-properties-message">\n    <%-translate("Select a single layer in the PSD to see its CSS properties")%>\n</li>'});define("ccweb.files.extract/views/inspect/InspectCSSView",["jquery","underscore","backbone","ccweb.files.extract/models/ColorModel","ccweb.files.extract/models/UserSettingsModel","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/views/inspect/CSSListItemView","ccweb.files.extract/utils/CSSUtil","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/cssColorItemTemplate.html","ccweb.files.extract/views/templates/messageSelectSingleItemTemplate.html"],function(e,t,i,s,n,r,a,o,l,c,d){"use strict";var h=i.View.extend({defaults:{cssListItemViews:[],$messageEl:null},initialize:function(e){this.cssListItemViews=[];this.$messageEl=l.createTemplate(d);this.render();this.addHandlers();graphite.events.on("designedAtMultiplierChanged",this.refreshCSS,this)},render:function(){this.handleSelectionChange()},addHandlers:function(){r.on("change:extractedStylesInSelection",this.handleSelectionChange,this);graphite.events.on("preprocessorChanged",this.refreshCSS,this);graphite.events.on("updateFontCSS",this.refreshCSS,this);graphite.events.on("commitDropperColor",this.handleNewDropperColor,this);graphite.events.on("preferredMeasurementUnitsChanged",this.refreshCSS,this)},removeEventListeners:function(){r.off(null,null,this);graphite.events.off(null,null,this)},refreshCSS:function(){var e,t,i,s,o=r.getSelectedLayers(),l=n.get("preprocessor");if(1===o.length){e=o[0];t=e.getCSSArray("css"===l);this.clearCSSList();for(i=0;i<t.length;i++){s=new a({cssObj:t[i],preProcessor:l});this.cssListItemViews.push(s);this.$el.append(s.el)}}else{this.clearCSSList();this.displayMessages()}},handleNewDropperColor:function(e){var t,i=new s(e),n=e.alpha<1?e.alpha.toFixed(2):null;this.$el.empty();t=l.createTemplate(c,{value:i.toHEXString()});this.$el.append(t);t=l.createTemplate(c,{value:i.toRGBString(n)});this.$el.append(t);t=l.createTemplate(c,{value:i.toHSLString(n)});this.$el.append(t)},handleSelectionChange:function(){this.refreshCSS()},clearCSSList:function(){var e,t;for(e=this.cssListItemViews.length-1;-1!==e;e--){t=this.cssListItemViews.pop();t.remove()}this.$messageEl.remove();this.$el.empty();r.clearDOMSelection()},displayMessages:function(){var e=r.getSelectedLayers();(0===e.length||e.length>1)&&this.$el.append(this.$messageEl)},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)}});return h});define("ccweb.files.extract/views/templates/fontFaceListItemTemplate.html",[],function(){return'<li class="font-face-list-item">\n    <p class="font-face-name"><%-fontFace%></p>\n    <ul>\n        <% _.each(sizes, function(size){ %>\n        <li class="text-style-size"><p><%-size[0]%></p></li>\n        <% }); %>\n    </ul>\n</li>\n'});define("ccweb.files.extract/views/inspect/InspectFontFaceView",["jquery","underscore","backbone","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/utils/StyleUtil","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/utils/CSSUtil","ccweb.files.extract/views/templates/fontFaceListItemTemplate.html"],function(e,t,i,s,n,r,a,o,l){"use strict";var c=i.View.extend({initialize:function(e){this.ppi=e.ppi;this.render();this.addHandlers()},render:function(){var i=this.model.styles.reduce(function(e,t){for(var i=t.get("layers"),s=o.parseCSSMeasure(t.get("style").get("size")),n=0;n<i.length;n++){var r=i[n],a=o.getTransformedFontScale(r.get("properties")),l=o.convertPSDUnitsToPreferredUnits({val:(s.val*a).toFixed(2),units:s.units},!0);if(!e[l]){e[l]=t.clone();e[l].set("layers",[])}e[l].get("layers").push(r)}return e},{});i=t.pairs(i).sort(this.sortTextSizeFunction);var s=t.extend({sizes:i},this.model);this.setElement(a.createTemplate(l,s));this.$el.find(".text-style-size").each(function(t){e(this).data("model",i[t][1])})},addHandlers:function(){var t=this;this.$el.find(".text-style-size").click(function(){if(e(this).data("model")===n.get("selectedInspectItem")){n.setSelectedInspectItem(null);graphite.events.trigger("hide-extract-code-popup")}else{n.setSelectedInspectItem(e(this).data("model"));graphite.events.trigger("show-extract-code-popup",{sourceElement:e(this),model:e(this).data("model"),ppi:t.ppi})}});n.on("change:selectedInspectItem",this.handleSelectedInspectItemChange,this);s.on("change:extractedStylesInSelection",this.handleSelectionChange,this)},removeEventListeners:function(){n.off(null,null,this);s.off(null,null,this)},sortTextSizeFunction:function(e,t){return parseFloat(e[0])-parseFloat(t[0])},handleSelectedInspectItemChange:function(){var t=n.get("selectedInspectItem");this.$el.find(".text-style-size").each(function(i,s){e(s).data("model")===t?e(s).addClass("selected"):e(s).removeClass("selected")})},handleSelectionChange:function(){var t=s.getSelectedLayers();this.$el.find(".text-style-size").each(function(i,s){var n=e(s).data("model");if(n){var r=n.get("layers");r.some(function(e){return-1!==t.indexOf(e)})?e(this).addClass("selected"):e(this).removeClass("selected")}})},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)}});return c});define("ccweb.files.extract/utils/FontUtil",["jquery","underscore"],function(e,t){"use strict";var i={TYPEKIT_LOOKUP:"https://typekit.com/api/v1/json/families/",TYPEKIT_SEARCH_URL:"http://typekit.com/search/fonts/?q=",cache:{},getTypeKitURL:function(t){var i=t.replace(/\s+/g,"-").toLowerCase(),s=this.cache[i],n=this;return e.Deferred(function(r){void 0===s?e.ajax({url:n.TYPEKIT_LOOKUP+i,dataType:"jsonp",error:function(){r.reject(new Error("TypeKit family lookup request failed"))}}).done(function(e){var s=e&&e.family&&e.family.web_link,a=s||null;n.cache[i]=a;a?r.resolve(!0,a):r.resolve(!1,n.TYPEKIT_SEARCH_URL+encodeURIComponent(t))}):s&&r.resolve(s)})}};return i});define("ccweb.files.extract/views/templates/fontFamilyListItemTemplate.html",[],function(){return'<li class="font-family-list-item">\n    <div class="arrow"></div>\n    <a class="typekit-anchor typekit-anchor-disabled" target="_blank" title=\'<%-translate("Find font on typekit.com")%>\'></a>\n    <p class="font-family-name"><%-get(\'name\')%></p>\n    <div class="font-face-count"><p></p></div>\n    <div style="clear:both;"></div>\n    <ul class="font-face-list"></ul>\n</li>'});define("ccweb.files.extract/views/inspect/InspectFontFamilyView",["underscore","backbone","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/views/inspect/InspectFontFaceView","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/utils/FontUtil","ccweb.files.extract/views/templates/fontFamilyListItemTemplate.html","plugin-dependencies"],function(e,t,i,s,n,r,a,o){"use strict";var l=t.View.extend({fontFaceViews:[],events:{"click .font-family-name":"handleClick","click .typekit-anchor":"handleTypeKitLink"},initialize:function(e){this.ppi=e.ppi;this.render();this.addHandlers()},render:function(){var t,i,o,l,c,d=this,h=this.model.get("faces"),p=0;this.setElement(n.createTemplate(a,this.model));this.$el[0].id="fontFamilyListItem_"+this.model.get("name").replace(/\s+/g,"");this.$el.addClass("closed");this.$el.find(".font-face-list").hide();l=this.$el.find(".typekit-anchor");c=this.$el.find(".font-family-name");r.getTypeKitURL(this.model.get("friendlyName")).done(function(e,t){e?l.removeClass("typekit-anchor-disabled"):l.addClass("typekit-anchor-disabled");l.attr("href",t)}).fail(function(e){l.addClass("typekit-anchor-disabled")});var u=e.keys(h);u&&u.sort(this.sortFaces);e.each(u,function(e){var n=h[e];n.sort(d.sortTextSizeFunction);o=e>>>0===parseFloat(e);e=o?"font-weight "+e:e;i={fontFace:e,styles:n};t=new s({model:i,ppi:d.ppi});d.fontFaceViews.push(t);d.$el.find(".font-face-list").append(t.el);d.$el.find(".font-face-list").append('<div style="clear:both;"></div>');p++});this.$el.find(".font-face-list").append('<div class="list-bottom-padding"></div>');this.$el.find(".font-face-count p").text(p)},sortFaces:function(e,t){var i=["regular","thin","extralight","ultralight","light","normal","medium","semibold","demibold","bold","extrabold","ultrabold","black","heavy","italic","bolditalic"];return i.indexOf(e.toLowerCase().replace(/ /g,""))-i.indexOf(t.toLowerCase().replace(/ /g,""))},updateClosedStatus:function(){if(this.$el.hasClass("closed")){this.$el.find(".font-face-list").slideUp(50);this.$el.find(".font-face-count").fadeIn(100)}else{this.$el.find(".font-face-list").slideDown(50);this.$el.find(".font-face-count").fadeOut(100)}},addHandlers:function(){i.on("change:extractedStylesInSelection",this.handleSelectionChange,this)},handleClick:function(){this.$el.toggleClass("closed");this.updateClosedStatus()},handleTypeKitLink:function(){graphite.events.trigger("typekitSearch")},removeEventListeners:function(){i.off(null,null,this)},handleSelectionChange:function(){var t=this,s=i.get("extractedStylesInSelection").textStyles,n=i.getSelectedLayers();e.each(s,function(e,i){if(e.get("style").get("fontName")===t.model.get("name")&&n.length>0){t.$el.removeClass("closed");t.updateClosedStatus()}})},remove:function(){e.each(this.fontFaceViews,function(e){e.remove()});this.fontFaceViews.length=0;this.removeEventListeners();return t.View.prototype.remove.call(this)}});return l});define("ccweb.files.extract/views/templates/colorListItemTemplate.html",[],function(){return'<li>\n    <div class="color-chip"></div>\n</li>'});define("ccweb.files.extract/views/inspect/BaseInspectColorView",["underscore","backbone","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/models/ColorUsageModel","ccweb.files.extract/utils/StyleUtil","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/colorListItemTemplate.html"],function(e,t,i,s,n,r,a,o){"use strict";var l=t.View.extend({events:{click:"handleClick"},initialize:function(){this.render();this.addHandlers()},render:function(){this.setElement(a.createTemplate(o))},addHandlers:function(){s.on("change:selectedInspectItem",this.handleSelectedInspectItemChange,this);i.on("change:extractedStylesInSelection",this.handleSelectionChange,this)},removeEventListeners:function(){s.off(null,null,this);i.off(null,null,this)},handleClick:function(){if(this.model===s.get("selectedInspectItem"))s.setSelectedInspectItem(null);else{s.setSelectedInspectItem(this.model);this.model instanceof n&&this.showInfo()}},handleSelectedInspectItemChange:function(){this.model===s.get("selectedInspectItem")?this.$el.addClass("selected"):this.$el.removeClass("selected");s.get("selectedInspectItem")||graphite.events.trigger("hide-color-popup",null)},handleSelectionChange:function(){var t=this.getStylesForSelection(),s=this.model,n=!1,a=i.getSelectedLayers();e.each(t,function(e,t){r.areUsageStylesEqual(s,e)&&(n=!0)});this.$el.removeClass("layer-over");n&&a.length>0?this.$el.addClass("selected"):this.$el.removeClass("selected")},getStylesForSelection:function(){},getStylesForLayer:function(e){},showInfo:function(){graphite.events.trigger("show-color-popup",{style:this.model,sourceElement:this.$el.find(".color-chip")})},remove:function(){this.removeEventListeners();return t.View.prototype.remove.call(this)}});return l});define("ccweb.files.extract/views/inspect/InspectSolidColorView",["underscore","ccweb.files.extract/views/inspect/BaseInspectColorView","ccweb.files.extract/controllers/SelectionController"],function(e,t,i){"use strict";var s=t.extend({render:function(){t.prototype.render.apply(this,arguments);this.$el.find(".color-chip").css("background-color",this.model.get("style").toRGBString())},getStylesForSelection:function(){return i.get("extractedStylesInSelection").colors},getStylesForLayer:function(e){return e.getUsageModels().colors}});return s});define("ccweb.files.extract/views/templates/dropperItemTemplate.html",[],function(){return'<li class="dropper-item" title=\'<%-translate("Color Picker")%>\'>\n    <div class="color-chip"><div class="dropper"></div></div>\n</li>'});define("ccweb.files.extract/views/inspect/DropperColorView",["underscore","backbone","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/dropperItemTemplate.html"],function(e,t,i,s,n){"use strict";var r=t.View.extend({events:{click:"handleClick"},initialize:function(){this.render()},render:function(){this.setElement(s.createTemplate(n))},handleClick:function(e){i.enableDropperTool();e.stopPropagation()},remove:function(){return t.View.prototype.remove.call(this)}});return r});define("ccweb.files.extract/views/inspect/InspectGradientView",["underscore","ccweb.files.extract/views/inspect/BaseInspectColorView","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/utils/CSSUtil"],function(e,t,i,s,n){"use strict";var r=t.extend({render:function(){t.prototype.render.apply(this,arguments);n.applyCSS(this.$el.find(".color-chip"),this.model.get("style"),!0)},handleClick:function(){this.model===s.get("selectedInspectItem")?graphite.events.trigger("hide-extract-code-popup"):graphite.events.trigger("show-extract-code-popup",{sourceElement:this.$el.find(".color-chip"),model:this.model});t.prototype.handleClick.apply(this,arguments)},getStylesForSelection:function(){return i.get("extractedStylesInSelection").gradients},getStylesForLayer:function(e){return e.getUsageModels().gradients}});return r});define("ccweb.files.extract/views/inspect/ContextMenuView",["jquery","underscore","backbone","ccweb.files.extract/Constants"],function(e,t,i,s){"use strict";var n=i.View.extend({className:"context-menu",enabled:!0,initialize:function(i){t.bindAll(this,"open","close","setItems","handleSelect");this.menuName=i.name;this.$el.addClass(i.name);i.enabled===!1&&(this.enabled=!1);this.items=i.items||[];this.$toggle=i.$toggle||e("<div>");this.$after=i.$after||this.$toggle;this.position=i.position;this.toggleEvent="click";this.itemEvent="click";this.blurEvent="mousedown";this.isOpen=!1;this.isRendered=!1;this.setItems(this.items);this.$toggle.bind(this.toggleEvent,this.open)},rebindToggle:function(){var e=this;this.close();t.delay(function(){e.$toggle.unbind(e.toggleEvent,e.open);e.$toggle.bind(e.toggleEvent,e.open)},300)},setItems:function(e){this.close();this.items=e;this.isRendered=!1;0===e.length?this.$toggle.addClass("context-menu-empty"):this.$toggle.removeClass("context-menu-empty");return this},checkItem:function(t){this.$el.find("a").removeClass("active");this.$el.find("a").each(function(){e(this).attr("data")===t&&e(this).addClass("active")})},placeMenu:function(){var e=this.$toggle.position(),t=this.$toggle.offsetParent(),i=t?t.scrollTop():0;this.position===s.MenuPosition.TOP?this.$el.css("top",e.top+i):this.position===s.MenuPosition.BELOW&&this.$el.css("top",e.top+this.$toggle.outerHeight()+i);this.$el.css("left",e.left)},open:function(){if(!this.enabled)return!1;this.placeMenu();this.$toggle.addClass("menu-open");this.$toggle.unbind(this.toggleEvent,this.open);this.$el.css("opacity",0);this.render();this.$after.after(this.$el);this.trigger("show",this.$el,this.$toggle);this.$el.find("a").bind(this.itemEvent,this.handleSelect);this.$el.bind(this.blurEvent,this.stopClickProp);e(document.body).bind(this.blurEvent,this.close);this.isOpen=!0;this.$el.animate({opacity:1},150);return!1},close:function(){if(this.isOpen!==!1){this.$toggle.removeClass("menu-open");this.$el.remove();this.trigger("hide");this.$el.find("a").unbind(this.itemEvent,this.handleSelect);this.$el.unbind(this.blurEvent,this.stopClickProp);e(document.body).unbind(this.blurEvent,this.close);this.isOpen=!1;var i=this;t.delay(function(){i.$toggle.bind(i.toggleEvent,i.open)},200);return!1}},handleSelect:function(i){var s=e(i.currentTarget).attr("data");this.trigger("selection",s);t.defer(this.close);return!1},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},render:function(){if(this.isRendered)return this;var e,t,i="";for(t=this.items.length-1;t>=0;t--){e=this.items[t];i+='<a data="'+e+'"><i class="icon-btn '+e+'"></i>'+this.labels[e]+"</a>"}this.$el.html(i);this.isRendered=!0;return this},stopClickProp:function(e){e&&e.stopImmediatePropagation&&e.stopImmediatePropagation()}});return n});define("ccweb.files.extract/models/FontFamilyModel",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({defaults:{name:"",faces:null},initialize:function(){this.set("faces",{})},addTextStyle:function(e){var t,i,s=e.get("style"),n=this.get("faces");for(i in n)if(n.hasOwnProperty(i)&&i===s.get("fontFace")){t=n[i];break}if(!t){t=[];n[s.get("fontFace")]=t}t.push(e)}});return i});define("ccweb.files.extract/controllers/ClipboardController",["underscore","backbone","ccweb.files.extract/external/ZeroClipboard/ZeroClipboard"],function(e,t,i){"use strict";var s=t.Model.extend({clipboard:null,loaded:!1,getClipboard:function(){this.clipboard||this.initController();return this.clipboard},initController:function(){try{this.clipboard=new i;this.clipboard.on("load",function(){graphite.events.trigger("clipboard-loaded")});this.clipboard.on("dataRequested",function(){graphite.events.trigger("clipboard-data-requested",this)});this.clipboard.on("complete",function(){graphite.events.trigger("clipboard-complete",this)});this.clipboard.on("mouseover",function(){graphite.events.trigger("clipboard-mouseover",this)})}catch(e){}}});return new s});define("ccweb.files.extract/views/templates/autoExtractedItemsTemplate.html",[],function(){return'<div>\n    <div id="aug21FilesHeader" class="aug21Header">\n        <span class="aug21HeaderTextLarge aug21HeaderTextBlackBold">Update:</span><span class="aug21HeaderTextLarge"> Project Parfait is now available as Extract in Creative Cloud, <span class="aug21HeaderTextLarge aug21HeaderTextBlackBold">for free</span>. Get all the same features you love and more, including sharing with others.</span><br/><br/>\n        <span class="aug21HeaderTextSmall">You can start using Extract by going to <a id="aug21CCFilesLink" href="https://assets.adobe.com/files">Creative Cloud Files</a>. You’ll be able to download your uploaded PSDs until <span class="aug21HeaderTextBlackBold aug21HeaderTextSmall">December 15, 2014.</span> <a id="aug21LearnMoreLink" href="http://www.adobe.com/go/extract_transition" target="_blank">Learn more here</a></span>\n    </div>\n    <h4 class="preprocessor-header">\n        <div class="preprocessor">\n            <b><%-preprocessors[currentPreprocessor].displayName%></b><em></em>\n        </div>\n        <button class="cssInspectorCopyAllButton topcoat-button"><%-translate("Copy All")%></button>\n    </h4>\n\n    <ul class="css-properties"></ul>\n    <ul class="panel-rows">\n        <li>\n            <label for="fontUnit"><%-translate("Preferred Font Unit")%></label>\n            <div class="dropdown">\n                <div class="dropdown-btn fontUnit" id="fontUnit">\n                    <%-currentUnitType%>\n                </div>\n            </div>\n        </li>\n        <li>\n            <label for="baseFontInput" id="baseFontInputLabel"><%-translate("Base Font Size")%></label>\n            <input id="baseFontInput" class="topcoat-text-input" type="text" class="prefix-input" value="16px" size="4">\n        </li>\n    </ul>\n\n    <h4><%-translate("Fonts")%></h4>\n    <ul class="font-list"></ul>\n    <h4><%-translate("Colors")%></h4>\n    <ul class="solid-color-list"></ul>\n    <h4><%-translate("Gradients")%></h4>\n    <ul class="gradient-list"></ul>\n</div>';
});define("ccweb.files.extract/views/inspect/PSDInspectView",["jquery","underscore","backbone","ccweb.files.extract/views/inspect/InspectCSSView","ccweb.files.extract/views/inspect/InspectFontFamilyView","ccweb.files.extract/views/inspect/InspectSolidColorView","ccweb.files.extract/views/inspect/DropperColorView","ccweb.files.extract/views/inspect/InspectGradientView","ccweb.files.extract/views/inspect/ContextMenuView","ccweb.files.extract/models/FontFamilyModel","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/controllers/ClipboardController","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/models/ColorModel","ccweb.files.extract/models/ColorUsageModel","ccweb.files.extract/models/PSDSettingsModel","ccweb.files.extract/models/UserSettingsModel","plugin-dependencies","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/Constants","ccweb.files.extract/utils/CSSUtil","ccweb.files.extract/views/templates/autoExtractedItemsTemplate.html"],function(e,t,i,s,n,r,a,o,l,c,d,h,p,u,f,g,m,v,y,b,w,x){"use strict";var S=i.View.extend({colorChips:[],gradientChips:[],fontFamilyViews:[],events:{"dblclick .css-properties":"handleDoubleClickEvent","change #baseFontInput":"handleBaseFontSizeChanged"},initialize:function(){this.render();this.model.on("change:extractedStyles",this.handleModelExtractedStylesChange,this);d.on("change:selectedInspectItem",this.handleSelectedInspectItemChange,this);this.model.get("extractedStyles")&&this.handleModelExtractedStylesChange();this.initCopyToClipboard();graphite.events.on("commitDropperColor",this.handleNewDropperColor,this);graphite.events.on("psdSettingsChanged",this.handlePSDSettingsChanged,this)},render:function(){this.setElement(y.createTemplate(x,{preprocessors:w.cssPreprocessors,currentPreprocessor:m.get("preprocessor"),currentUnitType:m.get("preferredFontUnits")}));this.createCSSView();this.createFontUnitMenu();this.createPreprocessorMenu();v.parfait&&window.graphite.isFeatureEnabled("aug21")&&this.$el.find("#aug21FilesHeader").addClass("aug21");return this},createPreprocessorMenu:function(){var e=[],i={};t.each(w.cssPreprocessors,function(t,s){if(t.enabled!==!1){i[s]=t.displayName;e.unshift(s)}});this.preprocessorMenu=new l({name:"preprocessor-selector",$toggle:this.$("div.preprocessor"),$after:this.$("div.preprocessor"),items:e,position:b.MenuPosition.BELOW});this.preprocessorMenu.labels=i;this.$(".preprocessor").addClass("menu-active");this.preprocessorMenu.on("show",this.handlePreprocessorMenuShow,this);this.preprocessorMenu.on("selection",this.handlePreprocessorSelectionChange,this)},createFontUnitMenu:function(){var e=["PX","REMS","EMS"];this.fontUnitMenu=new l({name:"fontUnit-selector",$toggle:this.$("div.fontUnit"),$after:this.$("div.fontUnit"),items:e,position:b.MenuPosition.TOP});this.fontUnitMenu.labels=b.FontUnitType;this.$(".fontUnit").addClass("menu-active");this.fontUnitMenu.on("show",this.handleFontUnitMenuShow,this);this.fontUnitMenu.on("selection",this.handleFontUnitSelectionChange,this)},handleFontUnitMenuShow:function(e){var i=m.get("preferredFontUnits"),s=t.invert(b.FontUnitType)[i];this.fontUnitMenu.checkItem(s)},handleFontUnitSelectionChange:function(e){var t=b.FontUnitType[e];if(t!==m.get("preferredFontUnits")){this.handlePreferredUnitTypeChanged(t);m.set("preferredFontUnits",t);this.$(".fontUnit").text(t)}},handlePreprocessorMenuShow:function(e){var t=m.get("preprocessor");this.preprocessorMenu.checkItem(t)},handlePreprocessorSelectionChange:function(e){if(e!==m.get("preprocessor")){m.set("preprocessor",e);this.$(".preprocessor b").text(w.cssPreprocessors[e].displayName);graphite.events.trigger("preprocessorChanged",{preprocessor:e})}},handleModelExtractedStylesChange:function(){this.createTextStyleExamples();this.createSolidColorChips();this.createGradientChips()},initCopyToClipboard:function(){var t=h.getClipboard(),i=this.$el.find("button.cssInspectorCopyAllButton");t.clip(i);var s=this;graphite.events.on("clipboard-data-requested",function(n){if(e(n).is(i)){i.html(v.translate("Copied"));setTimeout(function(){i.html(v.translate("Copy All"))},1500);var r,a=p.getSelectedLayers();if(0!==a.length){if(1===a.length){a=a[0];r=a.getCSSAsString(!0,m.get("preprocessor"));graphite.events.trigger("copy-css",{origin:"CSSInspectorCopyAll"})}else r="";t.setText(r)}else{var o=s.$el.find(".css-properties")[0],l=o.innerText||o.textContent;t.setText(l)}}})},removeEventListeners:function(){graphite.events.off(null,null,this);this.model.off(null,null,this);d.off(null,null,this)},createCSSView:function(){var e=this.$el.find(".css-properties"),t=m.get("preferredFontUnits");t||(t=b.FontUnitType.PX);this.$el.find(".fontUnit").text(t);this.handlePreferredUnitTypeChanged(t);this.cssView=new s({el:e[0]})},createTextStyleExamples:function(){var t,i=this.$el.find(".font-list"),s=this.processTextStyles(),r=this,a=w.findModelResolution(r.model);i.empty();e.each(s,function(e,s){t=new n({model:s,ppi:a});i.append(t.el);r.fontFamilyViews.push(t)});i.append(e('<div style="clear:both;"></div>'))},processTextStyles:function(){var t,i,s=this.model.get("extractedStyles"),n=s?s.textStyles:{},r=[];e.each(n,function(s,n){t=null;i=n.get("style");e.each(r,function(e,s){if(i.get("fontName")===s.get("name")){t=s;return!1}return!0});if(!t){t=new c({name:i.get("fontName"),friendlyName:i.get("friendlyName")});r.push(t)}t.addTextStyle(n)});return r},createSolidColorChips:function(){var t,s,n=this.$el.find(".solid-color-list"),o=this.model.get("extractedStyles").colors,l=this;o.sort(this.sortColorFunction);n.empty();e.each(o,function(e,i){t=new r({model:i});n.append(t.el);l.colorChips.push(t)});s=new a({model:new i.Model});n.prepend(s.el);n.append(e('<div style="clear:both;"></div>'))},handleNewDropperColor:function(e){var t=this.$el.find(".dropper-item .color-chip");if(e){var i=new f,s=new u(e),n=this.$el.find(".dropper-item");i.set("style",s);1!==e.alpha&&i.set("alphas",[e.alpha.toFixed(2)]);this.model.get("extractedStyles").colors.push(i);var a=new r({model:i});a.$el.insertAfter(n);this.colorChips.push(a)}t.css("background-color","")},createGradientChips:function(){var t,i=this.$el.find(".gradient-list"),s=this.model.get("extractedStyles").gradients,n=this;s.sort(this.sortColorFunction);i.empty();e.each(s,function(e,s){t=new o({model:s});i.append(t.el);n.gradientChips.push(t)});i.append(e('<div style="clear:both;"></div>'))},handleBaseFontSizeChanged:function(){var e,t=this.$el.find("#baseFontInput"),i=t.val(),s=/(\d+)\s*(.*)/,n=s.exec(i),r=g.get("baseFontSizeValue"),a=g.get("baseFontSizeUnits"),o=r+a;if(n&&n.length>=1){e=parseFloat(n[1]);e>0&&1e3>e&&(r=parseFloat(n[1]));if(n.length>=2)switch(n[2].trim().toLowerCase()){case"px":a=b.FontUnitType.PX;break;default:a=b.FontUnitType.PX}}else{r=b.BaseFontDefaultSize;a=b.FontUnitType.PX}if(r){g.set("baseFontSizeValue",r);if(a){t.val(r+a);g.set("baseFontSizeUnits",a)}else t.val(r.toString()+a)}else t.val(r+a);if(o!==r+a){graphite.events.trigger("updateFontCSS");graphite.events.trigger("baseFontSizeChanged",{newBaseUnits:r+a});this.createTextStyleExamples()}},handlePreferredUnitTypeChanged:function(e){var t=g.get("baseFontSizeValue"),i=g.get("baseFontSizeUnits");if(e&&e!==b.FontUnitType.PX){if(!t){t=16;g.set("baseFontSizeValue",t)}if(!i){i=b.FontUnitType.PX;g.set("baseFontSizeUnits",i)}this.$el.find("#baseFontInputLabel").removeClass("disabledLabel");this.$el.find("#baseFontInput").prop("disabled",!1);this.$el.find("#baseFontInput").val(t+i)}else{this.$el.find("#baseFontInputLabel").addClass("disabledLabel");this.$el.find("#baseFontInput").prop("disabled",!0);this.$el.find("#baseFontInput").val("")}if(e&&e!==m.get("preferredFontUnits")){m.set("preferredFontUnits",e);graphite.events.trigger("updateFontCSS");graphite.events.trigger("preferredFontUnitsChanged",{preferredUnits:e});this.createTextStyleExamples()}},handlePSDSettingsChanged:function(){this.handlePreferredUnitTypeChanged(m.get("preferredFontUnits"))},handleSelectedInspectItemChange:function(){d.get("selectedInspectItem")||graphite.events.trigger("hide-extract-code-popup")},handleDoubleClickEvent:function(){graphite.events.trigger("cssDoublClick")},sortColorFunction:function(e,t){return t.get("layers").length-e.get("layers").length},remove:function(){this.cssView.remove();this.cssView=null;this.removeEventListeners();t.each(this.colorChips,function(e){e.remove()});this.colorChips.length=0;t.each(this.gradientChips,function(e){e.remove()});this.gradientChips.length=0;t.each(this.fontFamilyViews,function(e){e.remove()});this.fontFamilyViews.length=0;i.View.prototype.remove.call(this)}});return S});define("ccweb.files.extract/models/DerivedAssetModel",["jquery","underscore","backbone","ccweb.files.extract/models/LayerModelMap"],function(e,t,i,s){"use strict";function n(e){if(!e)return"";var t=e.substring(e.lastIndexOf(".")+1);return r[t]||""}var r={png:"image/png",svg:"image/svg+xml",jpg:"image/jpeg",jpeg:"image/jpeg"},a=i.Model.extend({defaults:{guid:"",name:"",mimeType:""},hasLinkedSmartObject:function(){var e,t=this.get("originatingLayers"),i=!1;t&&(i=t.some(function(t,i){e=s.getLayerModelFromId(t);return e?e.isLinkedSmartObject():!1}));return i},parse:function(e){var t={id:e.id,guid:e.id,name:e.name,mimeType:n(e.name)};return t}});return a});define("ccweb.files.extract/collections/DerivedAssetCollection",["backbone","ccweb.files.extract/models/DerivedAssetModel"],function(e,t){"use strict";var i=e.Collection.extend({model:t,parse:function(e){return e}});return i});define("ccweb.files.extract/models/ExtractSettingsModel",["underscore","plugin-dependencies","ccweb.files.extract/Constants","backbone"],function(e,t,i,s){"use strict";var n=s.Model.extend({initialize:function(e){var t={};switch(e.type){case"LDPI":t={id:e.type,label:e.type,suffix:"",folder:"_ldpi"};break;case"MDPI":t={id:e.type,label:"MDPI/1x",suffix:"",folder:"_mdpi"};break;case"TVDPI":t={id:e.type,label:e.type,suffix:"",folder:"_tvdpi"};break;case"HDPI":t={id:e.type,label:e.type,suffix:"",folder:"_hdpi"};break;case"XHDPI":t={id:e.type,label:"XHDPI/Retina 2x",suffix:"@2x",folder:"_xhdpi-2x"};break;case"XXHDPI":t={id:e.type,label:"XXHDPI/Retina 3x",suffix:"@3x",folder:"_xhdpi-3x"};break;case"XXXHDPI":t={id:e.type,label:e.type,suffix:"",folder:"_xxxhdpi"}}t.checked=!1;this.defaults=t;this.set(this.defaults)},reset:function(){this.clear().set(this.defaults)}});return n});define("ccweb.files.extract/controllers/DerivedAssetController",["jquery","underscore","backbone","plugin-dependencies","ccweb.files.extract/collections/DerivedAssetCollection","ccweb.files.extract/models/DerivedAssetModel","ccweb.files.extract/models/ExtractSettingsModel","ccweb.files.extract/models/LayerModelMap","ccweb.files.extract/models/PSDSettingsModel"],function(e,t,i,s,n,r,a,o,l){"use strict";function c(e,t){var i={LDPI:.75,MDPI:1,TVDPI:1.33,HDPI:1.5,XHDPI:2,XXHDPI:3,XXXHDPI:4};return i.hasOwnProperty(e)?i[e]/t:1}function d(e,t){var i=e.lastIndexOf(".");t=t||"";return-1!==i?e.substr(0,i)+t:e+t}var h=i.Model.extend({downloadFrames:[],maxDownloads:3,fileExtMap:{svg:".svg",jpg:".jpg",jpeg:".jpg",png8:".png",png32:".png"},assetCatalog:new n,derivedAssetCollection:new n,_filterAssets:function(e){var t=this.assetCatalog.filter(function(t){var i=e.findWhere({name:t.get("name")});if(void 0===i)return!1;t.set("guid",i.get("guid"));t.set("mimeType",i.get("mimeType"));return!0});e.reset();this.derivedAssetCollection.reset(t)},_loadCataloguedAssets:function(e,t,i,s){var r=this;graphite.serverAPI.loadAssetData(this.psdGuid,"extract_asset_catalog",function(a){r.assetCatalog.reset(a.data);r.assetCatalogVersion=a.etag;var o=new n;graphite.serverAPI.loadDerivedAssetCollection(o,e,function(e){r._filterAssets(o);t.apply(s,[e])},function(e){i.apply(s,[e])})},function(e){i.apply(s,[e])})},_checkForRefresh:function(e){e.needRefresh&&graphite.events.trigger("refreshAssetsView")},_registerDerivedAsset:function(e,t,i,s,n){var a=this,o=t.get("name"),l=new r({name:o,guid:t.get("id"),scale:i.scale,layerCompId:i.layerCompId,originatingLayers:i.layerIds,encodingType:i.encodingType,encodingQualityFactor:i.encodingQualityFactor,psdModified:e.get("modified")});graphite.serverAPI.updateAssetData(this.psdGuid,"extract_asset_catalog",function(e){a.assetCatalog.reset(e);var t=a.assetCatalog.where({name:o});a.assetCatalog.remove(t);a.assetCatalog.push(l);return a.assetCatalog.toJSON()},function(e){a.assetCatalogVersion=e.etag;a.assetCatalog.reset(e.data);a._checkForRefresh(e);graphite.events.trigger("batch_extract_start");a.applyExportSettings(l);s&&s()},function(e){n&&n()},null)},_unregisterDerivedAsset:function(e,i,s){var n=this;graphite.serverAPI.updateAssetData(this.psdGuid,"extract_asset_catalog",function(i){n.assetCatalog.reset(i);var s=n.assetCatalog.where({name:e.get("name")});t.each(s,function(e){n.assetCatalog.remove(e)});return n.assetCatalog.toJSON()},function(e){n.assetCatalogVersion=e.etag;n.assetCatalog.reset(e.data);n._checkForRefresh(e);i&&i()},function(e){s&&s()},null)},containsALinkedSmartObjectAsset:function(){var e=!1;s.utils.hasFeature("extract_batch")&&this.derivedAssetCollection&&(e=this.derivedAssetCollection.models.some(function(e,t){return e.hasLinkedSmartObject()}));return e},getMetadataForAsset:function(e){return this.assetCatalog.findWhere({name:e.get("name")})},getDerivedAssets:function(e,t,i,r){this.derivedAssetCollection?this.psdGuid!==e.get("id")&&this.derivedAssetCollection.reset():this.derivedAssetCollection=new n;this.psdGuid=e.get("id");s.utils.hasFeature("extract_batch")?this._loadCataloguedAssets(e,t,i,r):graphite.serverAPI.loadDerivedAssetCollection(this.derivedAssetCollection,e,t,i,r);return this.derivedAssetCollection},exportAsset:function(t,i,n,a,o,l,c,d,h,p,u){function f(e){var n=JSON.parse(e.responseText);if(i)S.queueDownload(graphite.serverAPI.getDerivedDownloadURL(n.id,n.name));else{var a=new r;n.metadata&&n.metadata.asset&&(n.name=n.metadata.asset.fileName);a.attributes=a.parse(n);a.attributes.originatingLayers=t;var o=S.derivedAssetCollection.where({name:a.get("name")});o&&o.length&&S.derivedAssetCollection.remove(o);S.derivedAssetCollection.add(a);s.utils.hasFeature("extract_batch")&&S._registerDerivedAsset(c,a,x,function(){h&&h.apply(u,[e])},p&&p.bind(u))}}function g(e){graphite.events.trigger("assetExtractionFailure",{});p&&p.apply(u,[e])}var m,v=parseInt(o,10),y="",b="?",w=c.get("localContent");if(w){y="";m=c.get("id");y=y+b+"layerIds="+t.join(",");b="&";y=y+b+"encodingType="+a;y=y+b+"encodingQualityFactor="+v;y=y+b+"assetName="+encodeURIComponent(n);w?this.queueDownload("/api/v1/localcontent/"+m+"/derived"+y):this.queueDownload("/api/v1/psd/"+m+"/asset/derived"+y)}else{v=parseInt(o,10);s.utils.hasFeature("extract_batch")||(n=this.generateUniqueAssetName(n,a));var x={layerIds:t,encodingType:a,encodingQualityFactor:v,psdGuid:c.get("id"),scale:l,layerCompId:c.get("layerCompId"),noCache:e.now(),assetName:n,update:d},S=this;graphite.serverAPI.createDerivedAsset(x,i,f,g,this)}},updateAsset:function(e,t,i,s,n,r,a,o,l,c,d){var h=s+this.fileExtMap[n];if(!i&&e.get("name")!==h){var p=this,u=l,f=e.get("name");e.set("name",h);l=function(){e.set("name",f);p.deleteDerivedAsset(e,u,c,d)}}return this.exportAsset(t,i,s,n,r,a,o,!0,l,c,d)},deleteDerivedAsset:function(e,t,i,n){var r=this;s.utils.hasFeature("extract_batch")?r._unregisterDerivedAsset(e,t.bind(n,[e]),i.bind(n)):graphite.serverAPI.deleteDerivedAsset(e.get("guid"),function(e){t.apply(n,[e])},function(e){i.apply(n,[e])})},queueDownload:function(t){var i=e('<iframe style="display:none;" class="downloader">').appendTo(e("body"));i.attr("src",t);this.downloadFrames.unshift(i);if(this.downloadFrames.length>this.maxDownloads){this.downloadFrames[this.maxDownloads].remove();this.downloadFrames.length=this.maxDownloads}},generateUniqueAssetName:function(e,t){for(var i=this.fileExtMap[t],s=e+i,n=!0,r=0,a=e;n;){var o=this.derivedAssetCollection.where({name:s});if(o&&o.length){r++;a=e+" ("+r+")";s=a+i}else n=!1}return a},initDeviceExtractionSettings:function(){this.deviceExtractSettings=new i.Collection;var e,t=["LDPI","MDPI","TVDPI","HDPI","XHDPI","XXHDPI","XXXHDPI"];for(e=0;e<t.length;e++)this.deviceExtractSettings.push(new a({type:t[e]}))},loadDeviceExtractionSettings:function(e){var t=this;this.initDeviceExtractionSettings();graphite.serverAPI.loadAssetData&&!graphite.inPublicOneUp()&&graphite.serverAPI.loadAssetData(e.get("id"),"extract_batch_settings",function(e){e&&e.data&&t.deviceExtractSettings.reset(e.data)},function(e){});return this.deviceExtractSettings},saveDeviceExtractionSettings:function(){var e=this;graphite.events.trigger("batch_extract_start");graphite.serverAPI.updateAssetData(this.psdGuid,"extract_batch_settings",function(t){return e.deviceExtractSettings.toJSON()},function(t){e.applyExportSettings()},function(e){graphite.events.trigger("batch_extract_complete")},null)},applyExportSettings:function(e){var t=this,s=e?new i.Collection([e]):t.assetCatalog,n={psdGuid:this.psdGuid,jobs:[]};t.deviceExtractSettings.each(function(e){if(e.get("checked")){var t,i,r={};s.each(function(i){var s=i.get("layerCompId")||"default",n={layerIds:i.get("originatingLayers"),encodingType:i.get("encodingType"),encodingQualityFactor:i.get("encodingQualityFactor"),assetName:d(i.get("name"),e.get("suffix"))};t=r[s];if(!t){t={outputTarget:e.get("folder"),scale:c(e.get("type"),l.get("designedAtMultiplier")),assets:[]};"default"!==s&&(t.layerCompId=s);r[s]=t}t.assets.push(n)});for(i in r)r.hasOwnProperty(i)&&n.jobs.push(r[i])}});n.jobs.length?graphite.serverAPI.batchCreateDerivedAssets(n,function(e){graphite.events.trigger("batch_extract_complete")},function(e){graphite.events.trigger("batch_extract_complete_error")},this):graphite.events.trigger("batch_extract_cancelled")}});return new h});define("ccweb.files.extract/views/templates/derivedAssetListItemTemplate.html",[],function(){return'<li class="derived-asset-list-item">\n    <div class="image-wrapper">\n        <% if (mimeType === \'image/svg+xml\') { %>\n            <div style="background: url(\'<%- graphite.serverAPI.getDerivedDownloadURL(guid, name) %>\') center center no-repeat; background-size: contain;"></div>\n        <% } else { %>\n            <div style="background: url(\'<%- graphite.serverAPI.getDerivedRenditionURL(guid) %>\') center center no-repeat; background-size: contain;"></div>\n        <% } %>\n        <div class="warning-icon"></div>\n    </div>\n    <span class="asset-label" title="<%-name%>"> <%-name%> </span>\n    <div class="del-button" title=\'<%-translate("Delete asset")%>\'></div>\n    <div class="settings-button" title=\'<%-translate("Update extraction parameters")%>\'></div>\n    <div class="download-button" title=\'<%-translate("Download asset")%>\'></div>\n</li>\n'});define("ccweb.files.extract/views/assets/DerivedAssetView",["jquery","underscore","backbone","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/DerivedAssetController","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/models/LayerModelMap","ccweb.files.extract/utils/ImageUtil","ccweb.files.extract/utils/TemplateUtil","plugin-dependencies","ccweb.files.extract/views/templates/derivedAssetListItemTemplate.html"],function(e,t,i,s,n,r,a,o,l,c,d){"use strict";var h=i.View.extend({hoverTimer:null,events:{"load img":"handleImageLoad",mouseenter:"handleMouseEnter",mouseleave:"handleMouseLeave","click .del-button":"handleDeleteButton","click .download-button":"handleDownload","click .image-wrapper":"handleDownload","click .settings-button":"handleSettingsClick"},initialize:function(){t.bindAll(this,"handleThumbMouseEnter","handleThumbMouseLeave");this.render()},render:function(){this.setElement(l.createTemplate(d,this.model.attributes));this.$deleteButton=this.$el.find(".del-button");this.$settingsButton=this.$el.find(".settings-button");this.$downloadButton=this.$el.find(".download-button");this.$warningIcon=this.$el.find(".warning-icon");this.$deleteButton.css("visibility","hidden");c.utils.hasFeature("extract_batch")&&this.model.hasLinkedSmartObject()&&this.$warningIcon.css("visibility","visible");this.$el.find("div.image-wrapper").mouseenter(this.handleThumbMouseEnter);this.$el.find("div.image-wrapper").first().mouseleave(this.handleThumbMouseLeave)},removeEventListeners:function(){r.off(null,null,this)},handleImageLoad:function(t){var i=t.target,s=e(i).parent();o.sizeAndCenterImage(i,parseInt(s.width(),10),parseInt(s.height(),10),o.ImageScaleType.FIT,!1)},handleMouseEnter:function(){this.$deleteButton.css("visibility","visible");this.$downloadButton.css("visibility","visible");c.utils.hasFeature("extract_batch")&&this.$settingsButton.css("visibility","visible")},handleMouseLeave:function(){this.$deleteButton.css("visibility","hidden");this.$downloadButton.css("visibility","hidden");this.beingEdited||this.$settingsButton.css("visibility","hidden")},handleDeleteButton:function(e){this.$el.addClass("pending-delete");n.deleteDerivedAsset(this.model,this.handleDeleteSuccess,this.handleDeleteError,this);e.stopImmediatePropagation()},handleDownload:function(t){t.preventDefault();s.get("inspectedAsset")&&s.get("inspectedAsset").get("id")===this.model.get("id")?r.setInspectedAsset(null):r.setInspectedAsset(this.model);graphite.events.trigger("downloading-extracted-asset");if(!this.$downloadFrame){this.$downloadFrame=e('<iframe class="download-frame"/>');this.$el.append(this.$downloadFrame)}var i=graphite.serverAPI.getDerivedDownloadURL(this.model.get("guid"),this.model.get("name"));graphite.serverAPI.getAssetETag(this.model.get("guid"),function(e){this.$downloadFrame.attr("src",i)},function(e){401===e.status&&graphite.events.trigger("reauthenticate")},this)},handleDeleteSuccess:function(){var e=n.derivedAssetCollection;e.remove(this.model)},handleDeleteError:function(e){e&&401===e.status&&graphite.events.trigger("reauthenticate");this.$el.removeClass("pending-delete")},handleThumbMouseEnter:function(){var e=this;this.hoverTimer&&clearTimeout(this.hoverTimer);graphite.events.trigger("load-asset-thumb-popup",e.model);this.hoverTimer=setTimeout(function(){graphite.events.trigger("show-asset-thumb-popup",{sourceElement:e.$el.find(".image-wrapper div").first(),model:e.model})},500)},handleThumbMouseLeave:function(){if(this.hoverTimer){clearTimeout(this.hoverTimer);this.hoverTimer=null}graphite.events.trigger("hide-asset-thumb-popup",{sourceElement:this.$el.find(".sprite_preview").first(),model:this.model})},handleSettingsClick:function(t){if(c.utils.hasFeature("extract_batch")){graphite.events.trigger("show-extract-asset-popup",{type:"edit",sourceElement:e(t.target),origin:"assetPanel",model:this.model});t.stopPropagation();this.beingEdited=!0;graphite.events.once("hide-extract-asset-popup",this.handleAssetPopupHide,this)}},handleAssetPopupHide:function(){this.beingEdited=!1;var e=this.el;e.querySelector(":hover")||e.parentNode.querySelector(":hover")===e||this.handleMouseLeave()},remove:function(){if(this.$downloadFrame){this.$downloadFrame.remove();this.$downloadFrame=null}this.$deleteButton=null;this.$settingsButton=null;this.$downloadButton=null;this.removeEventListeners();return i.View.prototype.remove.call(this)}});return h});define("ccweb.files.extract/views/templates/derivedAssetsListTemplate.html",[],function(){return'<div class="assets-content">\n    <div class="no-derived-assets">\n        <%-translate("Select layer(s) in the PSD to extract assets.")%> <a href="<%-translate("http://adobe.com/go/extract_help")%>#extract_image_assets" target="_blank"><%-translate("Learn more")%></a>\n    </div>\n    <div class="derived-assets">\n        <span class=\'desc\'><%-translate("Click thumbnails to download")%></span>\n        <ul class="derived-assets-list"></ul>\n    </div>\n</div>\n'});define("ccweb.files.extract/views/templates/derivedAssetsListTemplateRedux.html",[],function(){return'<div class="assets-content">\n    <div class="no-derived-assets">\n        <%-translate("Select layer(s) in the PSD to extract assets.")%> <a href="<%-translate("http://adobe.com/go/extract_help")%>#extract_image_assets" target="_blank"><%-translate("Learn more")%></a>\n    </div>\n    <div class="derived-assets">\n\n        <button class="btn btn-primary" id="extract_for_device"><%-translate(\'Extract for Devices...\')%></button>\n        <button class="topcoat-button" id="show_files" disabled><%-translate(\'Show Files\')%></button>\n        <div class="extraction-in-progress">\n            <div class="extraction-spinner"></div>\n            <div class="msg"><%-translate(\'New assets are being extracted and optimized in the background.\')%></div>\n        </div>\n        <div class="extraction-complete">\n            <div class="close-button">×</div>\n            <div class="icon"></div>\n            <div class="msg"><%=translate(\'The HiDPI assets will be on your computer shortly if you have {2}http://adobe.com/go/cc_pd_download{3}Creative Cloud{4} installed or click on {0}Show Files{1} to view them.\', \'<span class="show-files">\', \'</span>\', \'<a href="\', \'" target="_blank">\', \'</a>\')%></div>\n        </div>\n        <ul class="derived-assets-list"></ul>\n    </div>\n</div>\n'});define("ccweb.files.extract/views/assets/PSDAssetsView",["jquery","underscore","backbone","ccweb.files.extract/controllers/DerivedAssetController","ccweb.files.extract/views/assets/DerivedAssetView","ccweb.files.extract/Constants","plugin-dependencies","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/derivedAssetsListTemplate.html","ccweb.files.extract/views/templates/derivedAssetsListTemplateRedux.html"],function(e,t,i,s,n,r,a,o,l,c){"use strict";var d=i.View.extend({derivedAssetCollection:null,events:{"click #extract_for_device":"handleExtractForDevicesClick","click #show_files":"handleShowFilesClick","click .extraction-complete .close-button":"handleCloseCompletePane"},initialize:function(){this.render();this.renderAssets();graphite.events.on("refreshAssetsView",this.renderAssets,this);graphite.events.on("batch_extract_start",this.handleBatchExtractStart,this);graphite.events.on("batch_extract_complete",this.handleBatchExtractComplete,this);graphite.events.on("batch_extract_cancelled",this.handleBatchExtractCancelled,this);graphite.events.on("batch_extract_complete_error",this.handleBatchExtractError,this)},render:function(){this.setElement(a.utils.hasFeature("extract_batch")?o.createTemplate(c):o.createTemplate(l));return this},renderAssets:function(){this.assetViews=[];this.$el.find(".derived-assets-list").empty();this.loadDerivedAssets()},loadDerivedAssets:function(){if(!this.model.get("localContent")){this.derivedAssetCollection&&this.derivedAssetCollection.off(null,null,this);this.derivedAssetCollection=s.getDerivedAssets(this.model,this.handleDerivedAssetSuccess,this.handleDerivedAssetError,this);this.derivedAssetCollection.on("add",this.handleDerivedAssetAdd,this);this.derivedAssetCollection.on("remove",this.handleDerivedAssetRemove,this)}},handleDerivedAssetSuccess:function(t){var i,s=this.$el.find(".derived-assets-list"),r=this;if(t&&t.collectionId){this.collectionId=t.collectionId;this.handleDerivedAssetsId()}e.each(this.derivedAssetCollection.models,function(e,t){if(!t.get("childAssets")&&"_extract.manifest"!==t.get("name")){i=new n({model:t});r.assetViews.push(i);s.append(i.el)}});var a={numExtractedAssets:this.assetViews.length,flash:!1};graphite.events.trigger("assetExtracted",a);this.update()},handleDerivedAssetAdd:function(e){var t,i=this.$el.find(".derived-assets-list");if(!e.get("childAssets")){t=new n({model:e});this.assetViews.push(t);i.prepend(t.el);var s={numExtractedAssets:this.assetViews.length,flash:!0};graphite.events.trigger("assetExtracted",s);this.$el.find("#show_files").prop("disabled")?this.handleDerivedAssetsId():this.update()}},handleDerivedAssetRemove:function(e){var t,i;for(i=0;i<this.assetViews.length;i++){t=this.assetViews[i];if(t.model.get("guid")===e.get("guid")){t.remove();this.assetViews.splice(i,1);break}}var s={};s.numExtractedAssets=this.assetViews.length;s.flash=!1;graphite.events.trigger("assetExtracted",s);this.update()},handleDerivedAssetError:function(e){404!==e.status&&401!==e.status&&0!==e.status&&a.notifyUser(a.translate("Error retrieving derived assets ({0})",e.status))},handleDerivedAssetsId:function(){var e=this;if(!this.model.get("localContent")&&!a.parfait&&!graphite.inPublicOneUp()){this.collectionId&&this.collectionId.length>0?this.filesURL="files?location="+encodeURIComponent(graphite.urlBase+"/api/v1/collections/"+this.collectionId):graphite.serverAPI.getAssetCollectionID(this.model.get("id"),!1,function(t){if(t&&t.length>0){e.collectionId=t;e.filesURL="files?location="+encodeURIComponent(graphite.urlBase+"/api/v1/collections/"+t);e.update()}},function(){});this.update()}},handleExtractForDevicesClick:function(){graphite.events.trigger("show-extractForDevice-dialog")},handleShowFilesClick:function(){window.open(this.filesURL,"_blank")},handleCloseCompletePane:function(){this.$el.find(".extraction-complete").hide()},update:function(){var e=!!this.assetViews.length;this.$el.find(".derived-assets").toggle(e);this.$el.find(".no-derived-assets").toggle(!e);var t=e&&this.filesURL&&this.filesURL.length>0;this.$el.find("#show_files").prop("disabled",!t)},handleBeforeUnload:function(){return a.translate("Assets are still being extracted.")},handleBatchExtractStart:function(){this.$el.find("#extract_for_device").prop("disabled",!0);this.$el.find(".extraction-complete").hide();this.$el.find(".extraction-in-progress").show();e(window).on("beforeunload",this.handleBeforeUnload)},handleBatchExtractComplete:function(){this.$el.find("#extract_for_device").prop("disabled",!1);this.$el.find(".extraction-complete").show();this.$el.find(".extraction-in-progress").hide();e(window).off("beforeunload",this.handleBeforeUnload)},handleBatchExtractCancelled:function(){this.$el.find("#extract_for_device").prop("disabled",!1);this.$el.find(".extraction-in-progress").hide();e(window).off("beforeunload",this.handleBeforeUnload)},handleBatchExtractError:function(){this.$el.find("#extract_for_device").prop("disabled",!1);this.$el.find(".extraction-complete").hide();this.$el.find(".extraction-in-progress").hide();e(window).off("beforeunload",this.handleBeforeUnload)},remove:function(){this.assetViews=[];this.collectionId=null;graphite.events.off("refreshAssetsView",this.renderAssets,this);i.View.prototype.remove.call(this);this.derivedAssetCollection&&this.derivedAssetCollection.off(null,null,this)}});return d});define("ccweb.files.extract/views/templates/detailPanelTemplate.html",[],function(){return'<div class="tabs dark media-container" id="detail-panel">\n    <button class="topcoat-button upload-button"><%-translate("Upload a PSD")%></button>\n    <nav role="tablist">\n        <a id="psdInspectTab" data-toggle="tab" class="active details-tab"><%-translate("Styles")%></a>\n        <a id="psdLayersTab" data-toggle="tab" class="disabled details-tab"><%-translate("Layers")%></a>\n        <% if (loggedIn && !graphite.inPublicOneUp()) { %>\n        <a id="psdAssetsTab" data-toggle="tab" class="disabled details-tab"><%-translate("Assets")%>&nbsp;<span id="assetCounter" style="display:none;"></span></a>\n        <% } %>\n    </nav>\n    <section id="psdInfoSection" role="tab" class="active"></section>\n    <section id="psdInspectSection" role="tab"></section>\n    <% if (loggedIn && !graphite.inPublicOneUp()) { %>\n    <section id="psdAssetsSection" role="tab"></section>\n    <% } %>\n</div>'});define("ccweb.files.extract/views/detail/DetailPanelView",["jquery","underscore","backbone","ccweb.files.extract/Constants","ccweb.files.extract/views/layers/LayersListView","ccweb.files.extract/views/inspect/PSDInspectView","ccweb.files.extract/views/assets/PSDAssetsView","ccweb.files.extract/controllers/DetailsController","plugin-dependencies","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/detailPanelTemplate.html"],function(e,t,i,s,n,r,a,o,l,c,d){
"use strict";var h=i.View.extend({layersListView:null,psdInspectView:null,events:{"click .details-tab":"handleTabClick","click .upload-button":"handleUploadPSD"},initialize:function(){this.render();o.on("change:selectedTab",this.handleSelectedTabChange,this);graphite.events.on("drawPreviewFinish",this.handleDrawPreviewFinish,this);graphite.events.on("assetExtracted",this.handleAssetExtracted,this);graphite.events.on("JSONPreviewReady",this.handleDrawPreviewFinish,this);this.model.on("change:extractedStyles",this.enableExtraTabs,this)},render:function(){this.setElement(c.createTemplate(d,{loggedIn:l.utils.getCurrentPage()}));if(null!==this.model){var e=this.$el.find("#psdInspectSection"),t=this.$el.find("#psdInfoSection"),i=this.$el.find("#psdAssetsSection"),s=this.model.get("localContent");this.psdInspectView=new r({model:this.model});this.layersListView=new n({model:this.model});e.empty();e.append(this.layersListView.el);t.empty();t.append(this.psdInspectView.el);if(!s&&!graphite.inPublicOneUp()){this.assetsListView=new a({model:this.model});i.empty();i.append(this.assetsListView.el)}this.$el.find("section").scroll(function(){graphite.events.trigger("hide-extract-asset-popup");graphite.events.trigger("hide-extract-code-popup");graphite.events.trigger("hide-color-popup")})}this.enableExtraTabs();return this},handleTabClick:function(t){o.setSelectedTab(e(t.target).attr("id"))},handleUploadPSD:function(e){graphite.events.trigger("upload-psd-public-one-up");window.location.href="/files"},handleSelectedTabChange:function(){var t=o.get("selectedTab"),i=this.$el.find("section");this.$el.find("a").each(function(s){if(e(this).attr("id")===t){e(this).addClass("active");e(i[s]).addClass("active");e(i[s]).children().first().trigger("activate")}else{e(this).removeClass("active");e(i[s]).removeClass("active")}});"psdAssetsTab"===t&&this.$el.find("#assetCounter").removeClass("new_asset");graphite.events.trigger("selectedTab",{selectedTab:t})},handleDrawPreviewFinish:function(){var e=o.getSelectedTab();o.setSelectedTab("",{silent:!0});o.setSelectedTab(e||"psdInspectTab")},enableExtraTabs:function(){this.$el.find("#psdLayersTab").removeClass("disabled");this.$el.find("#psdAssetsTab").removeClass("disabled")},handleAssetExtracted:function(e){var t=this.$el.find("#psdAssetsTab").hasClass("active");if(e)if(e.numExtractedAssets>0){this.$el.find("#assetCounter").show();this.$el.find("#assetCounter").text(e.numExtractedAssets);if(e.flash){var i=this;this.$el.find("#assetCounter").addClass("new_asset");t&&setTimeout(function(){i.$el.find("#assetCounter").removeClass("new_asset")},s.flashTimeout)}}else this.$el.find("#assetCounter").hide()},removeEventListeners:function(){o.off(null,null,this);graphite.events.off(null,null,this);this.model.off(null,null,this)},destroyViews:function(e){var i=this;t.each(e,function(e){if(i.hasOwnProperty(e)){i[e].remove();delete i[e]}})},remove:function(){this.removeEventListeners();this.destroyViews(["psdInspectView","layersListView","assetsListView"]);return i.View.prototype.remove.call(this)}});return h});define("ccweb.files.extract/views/modal/BaseModalView",["jquery","underscore","backbone"],function(e,t,i){"use strict";var s=i.View.extend({visible:!1,blurTargets:".psd-preview-view, #detail-panel, .selection-controlbar, .psd-header",removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)},handleHide:function(){e(this.blurTargets).removeClass("blur-background");e("div.modal-window-overlay").hide()},handleShow:function(){e(this.blurTargets).addClass("blur-background");e("div.modal-window-overlay").show()}});return s});define("ccweb.files.extract/views/templates/helpDialogTemplate.html",[],function(){return'<!-- Help panel keystroke-window-wrapper -->\n    <div class="modal-wrapper" style="display:none;">\n        <div class="keystroke-header">\n            <a class="keystroke-info-icon"></a> <span class="keystroke-header-title"><%-translate("Shortcuts")%></span>\n        </div>\n\n        <div class="keystroke-main-col">\n            <div class="keystroke-item keystroke-separator">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key"><%-ctrl%></a> / <a class="keystroke-item-key"><%-shift%></a> + <a class="keystroke-item-key">Click</a>\n                </div><span class="keystroke-item-title"><%-translate("Multi-Select")%></span>\n\n                <p class="keystroke-item-text"><%-translate("Selects or deselects a layer to add it to or remove it from a group of selected layers.")%></p>\n            </div>\n\n            <div class="keystroke-item keystroke-separator">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key">X</a>\n                </div><span class="keystroke-item-title"><%-translate("Toggle Measurement Tooltip")%></span>\n\n                <p class="keystroke-item-text"><%-translate("Toggles measurement tooltip on hover.")%></p>\n            </div>\n\n            <div class="keystroke-item keystroke-separator">\n                <div class="keystroke-item-keys"><a class="keystroke-item-key"><%-alt%></a> + <a class="keystroke-item-key">&minus;</a>/<a class="keystroke-item-key">+</a></div><span class="keystroke-item-title"><%-translate("Zoom")%></span>\n\n                <p class="keystroke-item-text"><%-translate("Zoom preview canvas in and out.")%></p>\n            </div>\n\n            <div class="keystroke-item keystroke-separator">\n                <div class="keystroke-item-keys"><a class="keystroke-item-key"><%-alt%></a> + <a class="keystroke-item-key">Click</a></div><span class="keystroke-item-title"><%-translate("Zoom to Fit Artboard")%></span>\n\n                <p class="keystroke-item-text"><%-translate("Alt + Click on an Artboard label zooms to fit that Artboard.")%></p>\n            </div>\n\n            <div class="keystroke-item keystroke-separator">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key">E</a>\n                </div><span class="keystroke-item-title"><%-translate("Eyedropper Tool")%></span>\n\n                <p class="keystroke-item-text"><%-translate("Allows extraction of pixel-level color values.")%></p>\n            </div>\n\n\n            <div class="keystroke-item">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key">&larr;</a>\n                </div><span class="keystroke-item-title"><%-translate("Select Parent Layer")%></span>\n\n                <p class="keystroke-item-text"><%=translate("Pressing &larr; will select the layer that is parent to the current layer.")%></p>\n            </div>\n\n            <div class="keystroke-item">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key">&rarr;</a>\n                </div><span class="keystroke-item-title"><%-translate("Select First Child")%></span>\n\n                <p class="keystroke-item-text"><%=translate("Pressing &rarr; will select the first child layer of the current layer. If the currently selected layer has no children, this key does nothing.")%></p>\n            </div>\n\n            <div class="keystroke-item keystroke-separator">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key">&darr;</a><a class=\n                                                                       "keystroke-item-key">&uarr;</a>\n                </div><span class="keystroke-item-title"><%-translate("Next/Previous Sibling Layer")%></span>\n\n                <p class="keystroke-item-text"><%=translate("Selects the next or previous sibling layer. Pressing &uarr; will select the previous sibling and pressing &darr; will select the next sibling layer.")%></p>\n            </div>\n\n            <div class="keystroke-item">\n                <div class="keystroke-item-keys">\n                    <a class="keystroke-item-key">Esc</a>\n                </div><span class="keystroke-item-title"><%-translate("Clear/Exit")%></span>\n\n                <p class="keystroke-item-text"><%=translate("Pressing &ldquo;Esc&rdquo; clears the current selection, exits the current mode, or dismisses a dialog.")%></p>\n            </div>\n        </div>\n    </div>\n'});define("ccweb.files.extract/views/detail/HelpView",["underscore","backbone","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/modal/BaseModalView","ccweb.files.extract/views/templates/helpDialogTemplate.html","ccweb.files.extract/utils/KeyboardUtils"],function(e,t,i,s,n,r){"use strict";var a=s.extend({visible:!1,events:{click:"handleHide"},blurTargets:".psd-preview-view, #detail-panel, .selection-controlbar, .psd-header",initialize:function(){e.bindAll(this,"handleToggle","handleHide");this.render();graphite.events.on("toggle-help-dialog",this.handleToggle,this);graphite.events.on("hide-help-dialog",this.handleHide,this)},render:function(){this.setElement(i.createTemplate(n,{ctrl:r.getMetaKeyName("ctrl"),alt:r.getMetaKeyName("alt"),shift:r.getMetaKeyName("shift")}));return this},handleToggle:function(e){if(this.visible)this.handleHide();else{this.handleShow();e&&"keyboard"===e.from&&graphite.events.trigger("help-dialog-shortcut")}},handleHide:function(){s.prototype.handleHide.apply(this,arguments);this.$el.hide();this.visible=!1},handleShow:function(){s.prototype.handleShow.apply(this,arguments);this.$el.show();this.visible=!0;graphite.events.trigger("help-dialog")}});return a});define("ccweb.files.extract/views/templates/toolbarTemplate.html",[],function(){return'<div>\n    <div class="rendering-controlbar">\n        <div class="spinner"></div>\n        <span class="message"><%-translate("Rendering...")%></span>\n    </div>\n    <div class="selection-controlbar">\n        <button class="firstuser-shortcut-guide" title=\'<%-translate("First User Experience Guide (i)")%>\'><i class="icon-btn"></i></button>\n        <button class="keyboard-shortcut-guide" title=\'<%-translate("Keyboard Shortcuts Guide (?)")%>\'><i class="icon-btn"></i></button>\n    </div>\n</div>'});define("ccweb.files.extract/collections/LayerCollection",["backbone","ccweb.files.extract/models/LayerModel"],function(e,t){"use strict";var i=e.Collection.extend({model:t,assetID:null,version:null});return i});define("ccweb.files.extract/models/LayerCompModel",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({initialize:function(){}});return i});define("ccweb.files.extract/models/PSDModel",["underscore","backbone","ccweb.files.extract/Constants","ccweb.files.extract/collections/LayerCollection","./LayerCompModel","./LayerModelMap","ccweb.files.extract/utils/MeasurementUtil","ccweb.files.extract/utils/UTF8","ccweb.files.extract/controllers/DetailsController"],function(e,t,i,s,n,r,a,o,l){"use strict";function c(t,i){var s=[],n=function(t){e.each(t,function(e){var t=s[e.layerId];if(t){e.spriteSheet=t.spriteSheet;t.flattenedSprite&&(e.flattenedSprite=t.flattenedSprite)}e.children&&n(e.children)})};e.each(i.layers,function(e){s[e.layerId]=e});n(t.children);t.dataType="complete";return t}var d=t.Model.extend({defaults:{id:"",info:"",imgdata:null,isArtboardPSD:!1,artboardsBounds:null,artboards:null,layerCollection:null,layerComps:null,layerCompId:null,extractedStyles:null,localContent:!1,status:0},toString:function(){return"[object PSDModel id: "+this.get("id")+", info: "+this.get("info")+"]"},initialize:function(e){this.id=e.id;this.set("imgdata",{originalFile:"",bounds:{bottom:0,left:0,right:0,top:0}})},decodeChildNames:function(e){var t=this;e&&e.forEach(function(e){e.layerName=o.decodeCharacters(e.layerName);t.decodeChildNames(e.children)})},parse:function(e){e.dataType=e.dataType||"complete";if("spriteSheetOnly"===e.dataType){if(!this.jsonData){this.spriteSheetData=e;var t,n=function(e){};if(e.info&&e.info.totalSheets)for(t=1;t<=e.info.totalSheets;t++)l.drawSpriteSheet(t,n);return}e=c(this.jsonData,e);delete this.jsonData}else if("JSONOnly"===e.dataType){this.decodeChildNames(e.children);if(this.spriteSheetData){e=c(e,this.spriteSheetData);delete this.spriteSheetData}else this.jsonData=e}else this.decodeChildNames(e.children);e.imgdata&&e.imgdata.originalFile&&(e.imgdata.originalFile=decodeURIComponent(e.imgdata.originalFile));this.set("imgdata",e.imgdata);this.set("info",e.info);this.set("width",e.imgdata.bounds.right);this.set("height",e.imgdata.bounds.bottom);this.set("dataType",e.dataType);r.reset();var o=new s;o.add(o.parse(e.children),{parse:!0});this.set("layerCollection",o);var d,h=null;d=o.reduce(function(e,t){t.get("type")===i.Type.LAYER_ARTBOARD&&e.push(t);return e},[]);d.length>0&&(h=a.calcLayerGroupBounds(d,this));this.set("isArtboardPSD",d.length>0);this.set("artboardsBounds",h);this.set("artboards",e.imgdata.artboards);graphite.events.trigger("num-layers",e.imgdata);this.extractStyles();var p=this.extractLayerComps(e.layerComps);this.set("layerComps",p);graphite.events.trigger("layerCompsLoaded");var u=this.get("layerCompId");p&&p.length&&!u&&graphite.events.trigger("layerCompShown");this.set("status",200);this.unset("errorInfo")},extractStyles:function(){var t,i,s,n=this.get("layerCollection"),r={colors:[],textStyles:[],gradients:[],dataType:this.get("dataType")};for(i=0;i<n.length;i++){t=n.at(i);s=t.getUsageModels();t.combineUsageModels(r,s)}this.set("extractedStyles",e.clone(r))},extractLayerComps:function(e){var t,i,s,r=[];for(s=0;s<e.length;s++){t=e[s];i=new n({id:t.id,name:o.decodeCharacters(t.name),capturedInfo:t.capturedInfo});r.push(i)}return r},_resetLayerSelection:function(e){var t=this;e&&e.each(function(i){i.set("selected",!1);e=i.get("layerCollection");t._resetLayerSelection(e)})},reset:function(){this._resetLayerSelection(this.get("layerCollection"))}});return d});define("ccweb.files.extract/controllers/AssetController",["underscore","backbone","plugin-dependencies","ccweb.files.extract/models/PSDModel","ccweb.files.extract/Constants"],function(e,t,i,s,n){"use strict";var r=t.Model.extend({getAsset:function(e,t,r,a,o){var l=o?o.localContent:!1,c=new s({id:e,assetId:e,layerCompId:t,localContent:l}),d=function(e,t,s){if("JSON"===s){var r=e.status;if(t){t.errorCode===n.WorkerErrorCodes.GRAPHITE_REJECTED&&(r=422);t.errorCode===n.WorkerErrorCodes.GRAPHITE_PROCESSING&&(r=500)}if(r>=300){c.set("errorInfo",t);c.set("status",r)}}else{i.notifyUser(i.translate("Uh oh, The rendering step failed.  Some functionality may be disabled."));graphite.events.trigger("errorNotificationShown")}a.apply(o,[e,t,s])};l?graphite.serverAPI.loadPsdModelFromUrl(c,o.localContent.directory+"/graphite.json",r,d,o):graphite.serverAPI.loadPsdModel2(c,r,d,o);return c}});return new r});define("ccweb.files.extract/views/templates/designedAtTemplate.html",[],function(){return'<span class="designed-at-label"><%-translate("Designed at")%></span>\n<div id="designedAtDropdown" class="designed-at-select">\n    <div class="label" title="1x">1x</div>\n    <ul class="designedAtDropdownItem">\n        <li title="1x"><a id="1" href="#">1x</a></li>\n    </ul>\n    <ul class="designedAtDropdownItem">\n        <li title="2x"><a id="2" href="#">2x</a></li>\n    </ul>\n    <ul class="designedAtDropdownItem">\n        <li title="3x"><a id="3" href="#">3x</a></li>\n    </ul>\n    <ul class="designedAtDropdownItem">\n        <li title="4x"><a id="4" href="#">4x</a></li>\n    </ul>\n</div>\n'});define("ccweb.files.extract/views/detail/DesignedAtView",["jquery","underscore","backbone","ccweb.files.extract/models/PSDSettingsModel","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/AssetController","ccweb.files.extract/views/templates/designedAtTemplate.html"],function(e,t,i,s,n,r,a,o){"use strict";var l=i.View.extend({className:"designed-at-controls",events:{"click #designedAtDropdown":"handleActivate","click a":"handleSelectOption"},initialize:function(){t.bindAll(this,"handleMouseDown");this.render();this.updateDropdownValue();graphite.events.on("psdSettingsChanged",this.updateDropdownValue,this)},render:function(){this.$el.html(n.createTemplate(o));return this},remove:function(){if(this.$el){graphite.events.off(null,null,this);this.$el.empty();return i.View.prototype.remove.call(this)}},handleActivate:function(t){this.$el.find("#designedAtDropdown").toggleClass("active");e(document).on("mousedown.designedAt",this.handleMouseDown);return!1},handleMouseDown:function(t){var i=e(t.target);if(!i.is(this.$el)&&0===this.$el.find(i).length){this.$el.find("#designedAtDropdown").removeClass("active");e(document).off("mousedown.designedAt")}},handleSelectOption:function(t){var i=s.get("designedAtMultiplier"),n=e(t.target),r=parseInt(n.attr("id"),10);if(i!==r){s.set("designedAtMultiplier",r);this.$el.find("#designedAtDropdown .label").text(n.text());graphite.events.trigger("designedAtMultiplierChanged",r)}this.$el.find("#designedAtDropdown").removeClass("active");e(document).off("mousedown.designedAt");t.stopPropagation();t.preventDefault()},updateDropdownValue:function(){this.$el.find("#designedAtDropdown .label").text(s.get("designedAtMultiplier")+"x")}});return l});define("ccweb.files.extract/views/templates/layerCompsTemplate.html",[],function(){return'<div id="layerCompDropdown" class="layer-comp-select">\n    <div class="label" title="<%-layerComps[currentIndex].get(\'name\')%>"><%-layerComps[currentIndex].get(\'name\')%></div>\n    <span class="layerCompIndexLabel"><%-currentIndex + 1%> <%-translate("of")%> <%-layerComps.length%></span>\n    <% _.each(layerComps, function(layerComp) { %>\n    <ul class="layerCompDropdownItem">\n        <li title="<%-layerComp.get(\'name\')%>"><a id="<%-layerComp.get(\'id\')%>" href="#"><%-layerComp.get(\'name\')%></a></li>\n    </ul>\n    <% }); %>\n</div>\n<div class="header-separator"></div>'});define("ccweb.files.extract/views/detail/LayerCompView",["jquery","underscore","backbone","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/AssetController","ccweb.files.extract/views/templates/layerCompsTemplate.html","plugin-dependencies"],function(e,t,i,s,n,r,a,o,l){"use strict";var c=i.View.extend({className:"layer-comp-controls",previouslySelectedTab:"",events:{"click #layerCompDropdown":"handleActivate","click a":"handleSelectOption"},initialize:function(){t.bindAll(this,"handleMouseDown","requestLayerComp");graphite.events.on("layerCompsLoaded",this.handleLayerCompsLoaded,this);graphite.events.on("drawPreviewFinish",this.handleDrawPreviewFinish(),this);e(document).off("mousedown.layerComps");this.render()},render:function(){this.handleLayerCompsLoaded();return this},remove:function(){if(this.$el){graphite.events.off(null,null,this);this.$el.empty();return i.View.prototype.remove.call(this)}},handleDrawPreviewFinish:function(){var e=r.getPSDModel().get("imgdata").layerCompSelectedTab;e&&n.setSelectedTab(e)},handleLayerCompsLoaded:function(){var e,n,a=r.getPSDModel(),c=r.getPSDModel().get("layerComps"),d=a.get("imgdata").appliedLayerCompId||0,h=l.translate("Last Document State");this.$el.empty();if(c&&c.length>0){c[0].get("name")!==h&&c.unshift(new i.Model({name:h,id:0}));e=t.find(c,function(e){return e.id===d});e=e||c[0];n=c.indexOf(e);this.$el.html(s.createTemplate(o,{layerComps:c,currentIndex:n}));graphite.events.trigger("layerCompChangeComplete")}},handleActivate:function(t){this.$el.find("#layerCompDropdown").addClass("active");e(document).on("mousedown.layerComps",this.handleMouseDown);return!1},handleMouseDown:function(t){var i=e(t.target);if(!i.is(this.$el)&&0===this.$el.find(i).length){this.$el.find("#layerCompDropdown").removeClass("active");e(document).off("mousedown.layerComps")}},handleSelectOption:function(i){var s=r.getPSDModel(),a=s.get("imgdata").appliedLayerCompId,o=e(i.target),l=parseInt(o.attr("id"),10);if(l!==a){s.get("imgdata").layerCompSelectedTab=n.get("selectedTab");this.handleLayerCompsLoaded();t.defer(this.requestLayerComp,l)}this.$el.find("#layerCompDropdown").removeClass("active");e(document).off("mousedown.layerComps");i.stopPropagation();i.preventDefault()},requestLayerComp:function(e){var i,s=r.getPSDModel();graphite.events.trigger("layerCompChanging");this.$el.find("#layerCompDropdown").addClass("disabled");i=a.getAsset(s.id,e,function(){t.delay(function(){graphite.events.trigger("layerCompChanged",i)},500)},function(){},this,s.get("path"))}});return c});define("ccweb.files.extract/views/templates/zoomControlsTemplate.html",[],function(){return'<!-- Zoom Controls -->\n<span class="file-dim"><%- imgdata.bounds.right %> &times; <%- imgdata.bounds.bottom %></span>\n<div class="header-separator"></div>\n<input type="text" class="zoom-input topcoat-text-input" title=\'<%-translate("ALT +/- to zoom in and out")%>\'>100%</input>\n<div class="zoom-fit-button" title=\'<%-translate("Zoom to fit width in view")%>\'><%-translate("FIT")%></div>\n<div class="zoom-100-button" title=\'<%-translate("Zoom to 100%")%>\'>1:1</div>\n<div class="header-separator"></div>\n'});define("ccweb.files.extract/views/detail/ZoomView",["jquery","underscore","backbone","plugin-dependencies","ccweb.files.extract/Constants","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/controllers/ZoomController","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/views/templates/zoomControlsTemplate.html"],function(e,t,i,s,n,r,a,o,l){"use strict";var c=i.View.extend({className:"zoom-controls",events:{"click .zoom-100-button":"handleOneToOne","click .zoom-fit-button":"handleZoomToFitClick","mouseover .zoom-fit-button":"handleZoomToFitMouseOver","focus .zoom-input":"handleFocus","keydown .zoom-input":"handleInputKey","blur .zoom-input":"handleBlur"},defaults:{previewView:null},initialize:function(e){this.previewView=e.previewView;this.render();this.addListeners()},render:function(){this.$el.html(r.createTemplate(l,o.getPSDModel().toJSON()));this.$zoomInput=this.$el.find(".zoom-input");this.setInputLabel();return this},addListeners:function(){t.bindAll(this,"handleDocumentKey","toggleZoomButtonStates","handleZoomToFitClick");graphite.events.on("zoomChanged",this.handleZoomChange,this);graphite.events.on("zoomToFit",this.handleZoomToFitRect,this);graphite.events.on("drawPreviewFinish",this.toggleZoomButtonStates,this);graphite.events.on("psdModelInfoChanged",this.render,this);graphite.events.on("dropperStart",this.handleDropperStart,this);graphite.events.on("dropperStop",this.handleDropperStop,this);e(document).on("keydown.zoomview",this.handleDocumentKey);e(window).on("resize.zoomView",t.debounce(this.toggleZoomButtonStates,300))},remove:function(){this.removeListeners();this.$zoomInput=null;this.$el.empty();this.previewView=null;return i.View.prototype.remove.call(this)},removeListeners:function(){e(document).off("keydown.zoomview",this.handleDocumentKey);e(window).off(".zoomView");graphite.events.off(null,null,this)},setInputLabel:function(){this.$zoomInput.val(a.getZoomPercent())},getCommonArtboardParent:function(e){for(var t=null,i=null,s=0;s<e.length;s++){t=e[s].getArtboardParent();if(null!==t)if(null===i)i=t;else if(i!==t){i=null;break}}return i},handleZoomToFitClick:function(){var e,t=o.getPSDModel(),i=o.getSelectedLayers(),s=null,n=t.get("isArtboardPSD");if(n){s=this.getCommonArtboardParent(i);e=s?s.get("bounds"):t.get("artboardsBounds")}else e=t.get("imgdata").bounds;this.handleZoomToFitRect(e)},handleZoomToFitMouseOver:function(){var e=o.getPSDModel(),t=o.getSelectedLayers(),i=null;if(e.get("isArtboardPSD")){i=this.getCommonArtboardParent(t);i?this.$el.find(".zoom-fit-button").attr("title",s.translate("Zoom to fit ")+i.get("layerName")):this.$el.find(".zoom-fit-button").attr("title",s.translate("Zoom to fit all artboards"))}else this.$el.find(".zoom-fit-button").attr("title",s.translate("Zoom to fit width in view"))},handleZoomToFitRect:function(e){var t=this.getPsdVisibleRect();a.zoomToFitRect(e,t,o.getPSDModel().get("isArtboardPSD"))},handleOneToOne:function(){var e=this.getCenterZoomRect(1);a.setZoomLevel(1,e)},handleZoomChange:function(){this.setInputLabel();this.toggleZoomButtonStates();this._isDropperActive&&a.getZoomLevel()<1?graphite.events.trigger("show-zoom-in-hint-popup",{sourceElement:this.$zoomInput}):graphite.events.trigger("hide-zoom-in-hint-popup")},toggleZoomButtonStates:function(){var e=this.$el.find(".zoom-fit-button"),t=this.$el.find(".zoom-100-button"),i=a.getZoomLevel(),s=o.getPSDModel(),n=this.previewView.$el.outerWidth()-50,r=s.get("imgdata").bounds,l=r.right-r.left,c=n/l;if(n){s.get("isArtboardPSD")?e.removeClass("disabled"):e.toggleClass("disabled",c===i||n>l*i&&i>=1);t.toggleClass("disabled",1===i)}},handleDropperStart:function(){a.getZoomLevel()<1&&graphite.events.trigger("show-zoom-in-hint-popup",{sourceElement:this.$zoomInput});this._isDropperActive=!0},handleDropperStop:function(){graphite.events.trigger("hide-zoom-in-hint-popup");this._isDropperActive=!1},handleInputKey:function(e){var t=e.keyCode;if(9===t||13===t||14===t){if(9!==t){e.preventDefault();e.stopPropagation()}this.commitEdit()}else if(27===t){e.preventDefault();e.stopPropagation();this.$zoomInput.val(this.revertVal)}},handleDocumentKey:function(e){var t=e.keyCode,i=1,s=null;if(e.altKey)if(189===t||109===t||173===t){e.stopPropagation();e.preventDefault();if(!a.isZooming()){i=this.getPrevZoomStep();s=this.getCenterZoomRect(i);a.setZoomLevel(i,s)}}else if(187===t||107===t||61===t){e.stopPropagation();e.preventDefault();if(!a.isZooming()){i=this.getNextZoomStep();s=this.getCenterZoomRect(i);a.setZoomLevel(i,s)}}},handleBlur:function(){this.setInputLabel()},handleFocus:function(){this.revertVal=this.$zoomInput.val()},commitEdit:function(){var e,t,i=parseFloat(this.$zoomInput.val())/100;if(!isNaN(i)&&i>0){e=i;t=this.getCenterZoomRect(e);a.setZoomLevel(e,t)}},getCenterZoomRect:function(e){var t,i=this.previewView.$el,s={width:i.outerWidth()-n.PREVIEW_SCROLLBAR_SPACING,height:i.outerHeight()-n.PREVIEW_SCROLLBAR_SPACING},r=i.find("div.preview-container"),o=0!==i.scrollLeft()?i.scrollLeft():-r.position().left,l=0!==i.scrollTop()?i.scrollTop():-r.position().top,c=Math.min(s.width,r.outerWidth()),d=Math.min(s.height,r.outerHeight()-2*n.PREVIEW_SPACING),h={left:o,top:l,right:o+c,bottom:l+d};t=a.getCenterZoomRect(h,s,e,a.getZoomLevel());return t},getNextZoomStep:function(){var e,t=a.getZoomLevel();e=.25>t?.25:.33>t?.33:.5>t?.5:.66>t?.66:1>t?1:parseInt(t+1,10);return e},getPrevZoomStep:function(){var e,t=a.getZoomLevel();e=.25>=t?.1:.33>=t?.25:.5>=t?.33:.66>=t?.5:1>=t?.66:2>=t?1:parseInt(t-1,10);return e},getPsdVisibleRect:function(){var e,t=this.previewView.$el,i=t.outerWidth(),s=t.outerHeight(),n=a.getZoomLevel();e={top:t.scrollTop()/n,left:t.scrollLeft()/n,bottom:t.scrollTop()+s,right:t.scrollLeft()+i,width:i,height:s};return e}});return c});define("ccweb.files.extract/views/detail/SelectionBarView",["underscore","backbone","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/Constants","plugin-dependencies","ccweb.files.extract/views/templates/toolbarTemplate.html","ccweb.files.extract/views/inspect/ContextMenuView","ccweb.files.extract/utils/TemplateUtil","./DesignedAtView","./LayerCompView","./ZoomView"],function(e,t,i,s,n,r,a,o,l,c,d){"use strict";var h=t.View.extend({events:{"click .direct-select":"handleDirectSelectToolChange","click .firstuser-shortcut-guide":"handleFirstUserExperienceShortcutGuideClick","click .show-measurements-on-hover":"handleMeasurementToggleClick"},defaults:{previewView:null},initialize:function(e){this.bToggleMeasurementKeyDown=!1;this.previewView=e.previewView;this.render();i.on("change:toggleMeasurementOnHover",this.handleMeasurementToggleChange,this);graphite.events.on("drawPreviewFinish",this.hideRenderingBar,this);graphite.events.on("errorNotificationShown",this.hideRenderingBar,this)},render:function(){var e={regularSelect:n.translate("Regular Select"),directSelect:n.translate("Direct Select"),showMeasurementsOnHover:n.translate("Toggle Show Info on hover")};this.setElement(o.createTemplate(r,e));this.zoomControlsView=new d({previewView:this.previewView});this.$el.find(".selection-controlbar").append(this.zoomControlsView.$el);this.layerCompControlsView=new c;this.$el.find(".selection-controlbar").append(this.layerCompControlsView.$el);if(!n.parfait&&n.utils.hasFeature("extract_batch")){this.designedAtView=new l;this.$el.find(".selection-controlbar").append(this.designedAtView.$el)}this.createHelpMenu();return this},removeEventListeners:function(){i.off(null,null,this)},handleFirstUserExperienceShortcutGuideClick:function(){graphite.events.trigger("toggle-first-user-overlay")},handleDirectSelectToolChange:function(){i.changeActiveTool(s.Tool.SELECT_DIRECT)},handleMeasurementToggleClick:function(){if(this.bToggleMeasurementKeyDown){this.bToggleMeasurementKeyDown=!1;this.$el.find(".show-measurements-on-hover").removeClass("active")}else{this.bToggleMeasurementKeyDown=!0;this.$el.find(".show-measurements-on-hover").addClass("active")}graphite.events.trigger("toggle-hover-measurement")},handleMeasurementToggleChange:function(){if(this.bToggleMeasurementKeyDown){this.bToggleMeasurementKeyDown=!1;this.$el.find(".show-measurements-on-hover").removeClass("active")}else{this.bToggleMeasurementKeyDown=!0;this.$el.find(".show-measurements-on-hover").addClass("active")}},handleActiveToolChange:function(){var e=i.get("activeTool");this.$el.find("button").removeClass("active");switch(e){case s.Tool.SELECT_DIRECT:this.$el.find(".direct-select ").addClass("active");graphite.events.trigger("activeTool",{activeTool:n.translate("Direct Select")})}},hideRenderingBar:function(){this.$el.find(".rendering-controlbar").hide()},remove:function(){this.zoomControlsView.remove();this.zoomControlsView=null;this.layerCompControlsView.remove();this.layerCompControlsView=null;this.removeEventListeners();this.previewView=null;t.View.prototype.remove.call(this);graphite.events.off(null,null,this)},createHelpMenu:function(){var e=["Extract Help","Extract FAQ","Extract Forums","Keyboard Shortcuts"].reverse(),t={"Extract Help":n.translate("Extract Help"),"Extract FAQ":n.translate("Extract FAQ"),"Extract Forums":n.translate("Extract Forums"),"Keyboard Shortcuts":n.translate("Keyboard Shortcuts")},i=this.$(".keyboard-shortcut-guide");this.preprocessorMenu=new a({name:"help-selector",$toggle:i,$after:i,items:e,position:s.MenuPosition.BELOW});this.preprocessorMenu.labels=t;i.addClass("menu-active");this.preprocessorMenu.on("selection",function(e){"Keyboard Shortcuts"===e?graphite.events.trigger("toggle-help-dialog"):"Extract Help"===e?window.open(n.translate("http://adobe.com/go/extract_help"),"_blank"):"Extract FAQ"===e?window.open(n.translate("http://adobe.com/go/extract_faq"),"_blank"):"Extract Forums"===e&&window.open(n.translate("http://www.adobe.com/go/extract_forums"),"_blank")},this)}});return h});define("ccweb.files.extract/views/templates/extractForDeviceDlgTemplate.html",[],function(){return'<!-- Extract for Device Dialog -->\n    <div class="extract-for-device-dialog modal-wrapper" style="display:none;">\n        <div class="linked-smart-object-warning">\n            <span id="lsoWarningMessage"></span>\n        </div>\n        <div class="extract-for-device-header">\n            <h1><%-translate("Extract for Devices")%><span class="preview-badge" title="<%-translate(\'Extract for devices is an experimental feature. During peak periods, there might be delays while waiting for your assets.\')%>"><%-translate("Preview")%></span></h1>\n\n            <div class="description"><%-translate("Folders of resolution-specific assets will be created in the assets folder based on the assets you\'ve saved. The folders will also be updated automatically if new assets are saved to the asset list later.")%></div>\n\n            <div class="info"></div>\n        </div>\n\n        <ul class="device-list clearfix">\n            <li class="device-list-header">\n                <div class="col1"><%-translate("Extract as")%></div>\n                <div class="col2"><%-translate("Suffix")%></div>\n                <div class="col3"><%-translate("Folder")%></div>\n            </li>\n        </ul>\n        <div class="dialog-footer">\n            <button class="topcoat-button" id="cancel_dialog"><%-translate(\'Cancel\')%></button>\n            <button class="btn btn-submit btn-primary" id="apply_settings"><%-translate(\'Apply\')%></button>\n        </div>\n        <div id="olarkFooter" class="olark-footer">\n            <button class="topcoat-button" id="olark_button"><%-translate(\'Chat with the team\')%></button>\n            <span><%-translate(\'Our engineers are online to answer your questions!\')%></span>\n        </div>\n\n    </div>\n';
});define("ccweb.files.extract/views/templates/extractSettingsItemTemplate.html",[],function(){return'<li class="extract-settings-item" id="extract-setting-<%- attributes.type %>">\n    <div class="col1">\n        <input type="checkbox" class="extract-setting-type" value="checkbox" <%- attributes.checked ? \'checked\' : \'\'%> />\n        <div class="setting-type-checkbox topcoat-checkbox__checkmark"></div>\n        <label><%- attributes.label %></label>\n    </div>\n    <div class="col2"><input type="text" class="topcoat-text-input extract-suffix" value="<%- attributes.suffix ? attributes.suffix : \'none\'%>"></div>\n    <div class="col3"><input type="text" class="topcoat-text-input extract-folder"  value="<%- attributes.folder + \'/\' %>"></div>\n</li>'});define("ccweb.files.extract/controllers/OlarkController",["underscore","backbone"],function(e,t){"use strict";var i=t.Model.extend({defaults:{olarkOperatorsAvailable:!1},initialize:function(){e.bindAll(this,"onCommandFromOperator","onMessageToVisitor","onOlarkOperatorsAvailable","onOlarkOperatorsAway");window.olark||function(e){var t=window,i=document,s="https:"==t.location.protocol?"https:":"http:",n=e.name,r="load",a=function(){function o(){l.P(r);t[n](r)}t[n]=function(){(l.s=l.s||[]).push(arguments)};for(var l=t[n]._={},c=e.methods.length;c--;)!function(e){t[n][e]=function(){t[n]("call",e,arguments)}}(e.methods[c]);l.l=e.loader;l.i=a;l.p={0:+new Date};l.P=function(e){l.p[e]=new Date-l.p[0]};t.addEventListener?t.addEventListener(r,o,!1):t.attachEvent("on"+r,o);var d=function(){function t(e){e="head";return["<",e,"></",e,"><",r,' onload="var d=',m,";d.getElementsByTagName('head')[0].",c,"(d.",h,"('script')).",p,"='",s,"//",l.l,"'",'"',"></",r,">"].join("")}var r="body",a=i[r];if(!a)return setTimeout(d,100);l.P(1);var o,c="appendChild",h="createElement",p="src",u=i[h]("div"),f=u[c](i[h](n)),g=i[h]("iframe"),m="document",v="domain";u.style.display="none";a.insertBefore(u,a.firstChild).id=n;g.frameBorder="0";g.id=n+"-loader";/MSIE[ ]+6/.test(navigator.userAgent)&&(g.src="javascript:false");g.allowTransparency="true";f[c](g);try{g.contentWindow[m].open()}catch(y){e[v]=i[v];o="javascript:var d="+m+".open();d.domain='"+i.domain+"';";g[p]=o+"void(0);"}try{var b=g.contentWindow[m];b.write(t());b.close()}catch(w){g[p]=o+'d.write("'+t().replace(/"/g,String.fromCharCode(92)+'"')+'");d.close();'}l.P(2)};d()};a()}({loader:"static.olark.com/jsclient/loader0.js",name:"olark",methods:["configure","extend","declare","identify"]});olark("api.box.shrink");olark("api.box.hide");olark("api.chat.onCommandFromOperator",this.onCommandFromOperator);olark("api.chat.onMessageToVisitor",this.onMessageToVisitor);olark("api.chat.onOperatorsAvailable",this.onOlarkOperatorsAvailable);olark("api.chat.onOperatorsAway",this.onOlarkOperatorsAway);olark.identify("6928-961-10-9900")},expandChatBox:function(){window.olark("api.box.expand")},hide:function(){olark("api.box.hide")},isOlarkOperatorAvailable:function(){return this.get("olarkOperatorsAvailable")},show:function(){olark("api.box.show")},sendMessageToVisitor:function(e){olark("api.chat.sendNotificationToVisitor",{body:e})},sendNotificationToOperator:function(e){olark("api.chat.sendNotificationToOperator",{body:e})},sendNotificationToVisitor:function(e){olark("api.chat.sendNotificationToVisitor",{body:e})},shrinkChatBox:function(){olark("api.box.shrink")},onCommandFromOperator:function(e){"closechat"==e.command.name.toLowerCase()&&this.hide();graphite.events.trigger("olark-command-from-operator",e.command.name,e.command.body)},onMessageToVisitor:function(e){graphite.events.trigger("olark-message-to-visitor",e.message.body)},onOlarkOperatorsAvailable:function(){this.set("olarkOperatorsAvailable",!0)},onOlarkOperatorsAway:function(){this.set("olarkOperatorsAvailable",!1)},removeOlark:function(){this.hide();$("#habla_beta_container_do_not_rely_on_div_classes_or_names").remove();window.olark=null}});return new i});define("ccweb.files.extract/views/assets/ExtractForDeviceDlg",["jquery","underscore","backbone","plugin-dependencies","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/modal/BaseModalView","ccweb.files.extract/views/templates/extractForDeviceDlgTemplate.html","ccweb.files.extract/views/templates/extractSettingsItemTemplate.html","ccweb.files.extract/controllers/DerivedAssetController","ccweb.files.extract/controllers/OlarkController","ccweb.files.extract/models/PSDSettingsModel"],function(e,t,i,s,n,r,a,o,l,c,d){"use strict";var h=r.extend({visible:!1,events:{"click #olark_button":"handleChatButtonClick","click #cancel_dialog":"handleHide","click #apply_settings":"handleApply","blur .extract-folder":"handleFolderChange","blur .extract-suffix":"handleSuffixChange"},initialize:function(){this.settings=l.loadDeviceExtractionSettings(this.model);this.settings.on("reset",this.handleExtractionSettingsReset,this);this.render();graphite.events.on("show-extractForDevice-dialog",this.handleShow,this);graphite.events.on("hide-extractForDevice-dialog",this.handleHide,this);this.lastAppliedDesignedAt=d.get("designedAtMultiplier")},render:function(){this.setElement(n.createTemplate(a));this.addSettingsListItems();var e=this.$el.find("#lsoWarningMessage");e.html(s.translate("Your assets contain a {0}http://www.adobe.com/go/smart_objects{1}Linked Smart Object{2} that will render poorly when scaled. {3}http://www.adobe.com/go/extract_help#linked_smart_objects{4}Help{5}",'<a id="smart_obj_link" href="','" target="_blank">',"</a>",'<a id="help_link" href="','" target="_blank">',"</a>"));return this},addSettingsListItems:function(){var e,t=this.$el.find(".device-list");for(e=0;e<this.settings.length;e++)t.append(n.createTemplate(o,this.settings.at(e)))},handleChatButtonClick:function(){c.show();c.expandChatBox()},handleHide:function(){r.prototype.handleHide.apply(this,arguments);this.$el.hide();this.visible=!1},handleShow:function(){l.containsALinkedSmartObjectAsset()?this.$el.find("div.linked-smart-object-warning").show():this.$el.find("div.linked-smart-object-warning").hide();r.prototype.handleShow.apply(this,arguments);c.isOlarkOperatorAvailable()?this.$el.find("#olarkFooter").removeClass("hidden"):this.$el.find("#olarkFooter").addClass("hidden");this.updateUI();this.$el.show();this.visible=!0},handleApply:function(){var e,t,i,n,r=this.$el.find(".extract-settings-item");for(n=0;n<r.length;n++){t=r.eq(n);e=this.findModel(t);i=t.find(".extract-suffix")[0].value;e.set("checked",t.find(".extract-setting-type")[0].checked);e.set("suffix",i!==s.translate("none")?i:"");e.set("folder",t.find(".extract-folder")[0].value)}l.saveDeviceExtractionSettings();this.lastAppliedDesignedAt=d.get("designedAtMultiplier");this.handleHide()},updateUI:function(){var e,t,i,n,r,a=this.$el.find(".extract-settings-item");for(r=0;r<a.length;r++){t=a.eq(r);e=this.findModel(t);i=e.get("suffix");n=e.get("folder");t.find(".extract-setting-type")[0].checked=e.get("checked");t.find(".extract-suffix")[0].value=""===i?s.translate("none"):i;t.find(".extract-folder")[0].value=this.normalizeFolderString(n);t.find(".extract-folder").removeClass("validation-error");t.find(".extract-suffix").removeClass("validation-error")}this.updateApplyButton();var o=s.translate("This PSD was designed at "),l=o+d.get("designedAtMultiplier")+"x",c=s.translate("what's this?");this.$el.find(".info").html(l+' (<a href="http://www.adobe.com/go/extract_faq_assets" target="_blank">'+c+"</a>)")},findModel:function(e){var t,i=e.closest(".extract-settings-item")[0].id,s=i.lastIndexOf("-");i=i.substring(s+1);t=this.settings.get(i);return t},updateApplyButton:function(){var e=this.$el.find(".validation-error");this.$el.find("#apply_settings").prop("disabled",0!==e.length)},handleFolderChange:function(t){var i=!0,n=t.target,r=e.trim(n.value);if(0===r.length){i=!1;n.title=s.translate("The destination folder cannot be empty.")}if(r.match(/(\|\\|:|\*|\?|"|<|>|\||\,|^\.\.\.)/g)){i=!1;n.title=s.translate("The folder name contains invalid characters.")}if(r.match(/.\/./)){i=!1;n.title=s.translate("The destination folder cannot be a nested subfolder.")}if(0===r.length){i=!1;n.title=s.translate("The destination folder must not be empty.")}i&&(n.value=this.normalizeFolderString(r));e(n).toggleClass("validation-error",!i);i&&(n.title="");this.updateApplyButton()},handleSuffixChange:function(t){var i=!0,n=t.target,r=e.trim(n.value);if(0===r.length){i=!1;n.title=s.translate("The suffix cannot be empty.")}if(r.match(/(\|\\|\/|:|\*|\?|"|<|>|\||\,|^\.\.\.)/g)){i=!1;n.title=s.translate("The suffix contains invalid characters.")}e(n).toggleClass("validation-error",!i);i&&(n.title="");i&&0===r.length&&(n.value=s.translate("none"));this.updateApplyButton()},normalizeFolderString:function(e){"/"!==e.charAt(e.length-1)&&(e+="/");return e},remove:function(){this.settings.off(null,null,this);graphite.events.off(null,null,this);return i.View.prototype.remove.call(this)},handleExtractionSettingsReset:function(){this.updateUI()}});return h});define("ccweb.files.extract/views/templates/popupTemplate.html",[],function(){return'<div class="popup-contents"></div>\n<div class="notch"></div>'});define("ccweb.files.extract/views/popup/BasePopupView",["jquery","underscore","backbone","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/popupTemplate.html"],function(e,t,i,s,n){"use strict";var r=i.View.extend({source:null,events:{"click .close-button":"handleCloseClick"},initialize:function(){t.bindAll(this,"handleShow","closePopup");this.source=null;this.render();this.$el.hide();this.addHandlers()},render:function(){this.$el.html(s.createTemplate(n));return this},addHandlers:function(){},handleShow:function(t){if(void 0!==this.$el.parent().offset()&&void 0!==t.sourceElement.offset()){this.source=t.sourceElement;this.$el.show();this.positionPopup();this.isMouseOver=!1;var i=this,s=this.handleMouseDown.bind(this),n=this.handleMouseEnter.bind(this),r=this.handleMouseLeave.bind(this),a=this.handleKeyUp.bind(this);i.dontListen&&i.dontListen();e(window).on("mousedown",s);i.$el.on("mouseenter",n);i.$el.on("mouseleave",r);e(document).on("keyup",a);this.dontListen=function(){e(window).off("mousedown",s);i.$el.off("mouseenter",n);i.$el.off("mouseleave",r);e(document).off("keyup",a)}}},positionPopup:function(){var t=e(".extract-plugin");0===t.length&&(t=e("#main"));var i=t.offset().top+t.outerHeight(!0),s=this.source,n=this.$el.parent().offset().top,r=s.height()+parseInt(s.css("padding-top"),10)+parseInt(s.css("padding-bottom"),10),a=parseInt(this.$el.height(),10)+parseInt(this.$el.css("padding-top"),10)+parseInt(this.$el.css("padding-bottom"),10),o=this.$el.find(".notch"),l=e(".psd-header");o.show();var c=this.getSourceYOffset()-n+r;if(c+a+o.height()>i-n){c=s.offset().top-n-this.$el.height()-2*parseInt(this.$el.css("padding-top"),10);this.$el.addClass("top");this.$el.removeClass("bottom")}else{c+=o.height();this.$el.addClass("bottom");this.$el.removeClass("top")}if(l.length&&l.offset()){var d=l.position().top+l.outerHeight()+13;if(d>c){c=d;o.hide()}}this.$el.css("top",c);var h=s.width()+parseInt(s.css("padding-left"),10)+parseInt(s.css("padding-right"),10),p=parseInt(this.$el.width(),10)+parseInt(this.$el.css("padding-left"),10)+parseInt(this.$el.css("padding-right"),10),u=this.getSourceXOffset()+(h-p)/2;u+p>e(window).width()-5&&(u=e(window).width()-p-5);this.$el.css("left",u);var f=Math.round(this.getSourceXOffset()-(u+parseInt(this.$el.css("border-left-width"),10))+parseInt(s.css("margin-left"),10)+(h-o.width())/2);o.css("left",f)},handleCloseClick:function(){this.closePopup()},handleMouseEnter:function(){this.isMouseOver=!0},handleMouseLeave:function(){this.isMouseOver=!1},handleMouseDown:function(){this.isMouseOver||this.closePopup()},handleKeyUp:function(e){27===e.keyCode&&this.closePopup()},getSourceXOffset:function(){return this.source.offset()?this.source.offset().left:0},getSourceYOffset:function(){return this.source.offset()?this.source.offset().top:0},closePopup:function(){if("none"!==this.$el.css("display")){this.$el.hide();this.dontListen&&this.dontListen()}}});return r});define("ccweb.files.extract/utils/LayerNameParser",[],function(){function e(e){var t=s(e);t&&t.length&&t.forEach(function(e){if("jpeg"===e.extension){e.extension="jpg";e.name&&(e.name=e.name.replace(/\.jpeg$/,".jpg"));e.file&&(e.file=e.file.replace(/\.jpeg$/,".jpg"))}});return t}function t(e,t){function i(){this.constructor=e}i.prototype=t.prototype;e.prototype=new i}function i(e,t,i,s,n,r){this.message=e;this.expected=t;this.found=i;this.offset=s;this.line=n;this.column=r;this.name="SyntaxError"}function s(e){function t(){return e.substring(wt,bt)}function s(e){throw a(e,null,wt)}function n(t){function i(t,i,s){var n,r;for(n=i;s>n;n++){r=e.charAt(n);if("\n"===r){t.seenCR||t.line++;t.column=1;t.seenCR=!1}else if("\r"===r||"\u2028"===r||"\u2029"===r){t.line++;t.column=1;t.seenCR=!0}else{t.column++;t.seenCR=!1}}}if(xt!==t){if(xt>t){xt=0;St={line:1,column:1,seenCR:!1}}i(St,xt,t);xt=t}return St}function r(e){if(!(Ct>bt)){if(bt>Ct){Ct=bt;Tt=[]}Tt.push(e)}}function a(t,s,r){function a(e){var t=1;e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});for(;t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function o(e,t){function i(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var s,n,r,a=new Array(e.length);for(r=0;r<e.length;r++)a[r]=e[r].description;s=e.length>1?a.slice(0,-1).join(", ")+" or "+a[e.length-1]:a[0];n=t?'"'+i(t)+'"':"end of input";return"Expected "+s+" but "+n+" found."}var l=n(r),c=r<e.length?e.charAt(r):null;null!==s&&a(s);return new i(null!==t?t:o(s,c),s,c,r,l.line,l.column)}function o(){var e,t,i=29*bt+0,s=Et[i];if(s){bt=s.nextPos;return s.result}It++;e=l();e===V&&(e=h());It--;if(e===V){t=V;0===It&&r(B)}Et[i]={nextPos:bt,result:e};return e}function l(){var t,i,s,n=29*bt+1,a=Et[n];if(a){bt=a.nextPos;return a.result}It++;t=bt;if(e.substr(bt,7)===G){i=G;bt+=7}else{i=V;0===It&&r(W)}if(i!==V){s=c();if(s!==V){wt=t;i=q(s);t=i}else{bt=t;t=z}}else{bt=t;t=z}It--;if(t===V){i=V;0===It&&r(j)}Et[n]={nextPos:bt,result:t};return t}function c(){var t,i,s,n,a=29*bt+2,o=Et[a];if(o){bt=o.nextPos;return o.result}It++;t=bt;i=d();if(i!==V){if(Y.test(e.charAt(bt))){s=e.charAt(bt);bt++}else{s=V;0===It&&r(Z)}if(s!==V){n=c();if(n!==V){wt=t;i=K(i,n);t=i}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}if(t===V){t=bt;i=d();if(i!==V){wt=t;i=J(i)}t=i}It--;if(t===V){i=V;0===It&&r(X)}Et[a]={nextPos:bt,result:t};return t}function d(){var e,t,i,s,n,a,o,l,c=29*bt+3,d=Et[c];if(d){bt=d.nextPos;return d.result}It++;e=bt;t=[];i=R();if(i!==V)for(;i!==V;){t.push(i);i=R()}else t=z;if(t!==V){i=y();i===V&&(i=ee);if(i!==V){s=F();if(s!==V){n=[];a=u();for(;a!==V;){n.push(a);a=u()}if(n!==V){a=T();a===V&&(a=ee);if(a!==V){o=F();if(o!==V){wt=bt;l=te(i,n,a);l=l?ie:z;if(l!==V){wt=e;t=se(i,n,a);e=t}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}It--;if(e===V){t=V;0===It&&r(Q)}Et[c]={nextPos:bt,result:e};return e}function h(){var t,i,s,n,a=29*bt+4,o=Et[a];if(o){bt=o.nextPos;return o.result}It++;t=bt;i=p();if(i!==V){if(Y.test(e.charAt(bt))){s=e.charAt(bt);bt++}else{s=V;0===It&&r(Z)}if(s!==V){n=h();if(n!==V){wt=t;i=re(i,n);t=i}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}if(t===V){t=bt;i=p();if(i!==V){wt=t;i=J(i)}t=i}It--;if(t===V){i=V;0===It&&r(ne)}Et[a]={nextPos:bt,result:t};return t}function p(){var e,t,i,s,n=29*bt+5,a=Et[n];if(a){bt=a.nextPos;return a.result}It++;e=f();if(e===V){e=bt;t=F();if(t!==V){i=P();if(i!==V){s=F();if(s!==V){wt=e;t=oe(i);e=t}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}It--;if(e===V){t=V;0===It&&r(ae)}Et[n]={nextPos:bt,result:e};return e}function u(){var t,i,s,n,a=29*bt+6,o=Et[a];if(o){bt=o.nextPos;return o.result}It++;t=bt;i=T();if(i!==V){if(47===e.charCodeAt(bt)){s=ce;bt++}else{s=V;0===It&&r(de)}if(s!==V){wt=bt;n=he(i);n=n?z:ie;if(n!==V){wt=t;i=pe(i);t=i}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}It--;if(t===V){i=V;0===It&&r(le)}Et[a]={nextPos:bt,result:t};return t}function f(){var e,t,i,s,n,a,o,l=29*bt+7,c=Et[l];if(c){bt=c.nextPos;return c.result}It++;e=bt;t=F();if(t!==V){i=y();i===V&&(i=ee);if(i!==V){s=F();if(s!==V){n=[];a=u();for(;a!==V;){n.push(a);a=u()}if(n!==V){a=g();if(a!==V){o=F();if(o!==V){wt=e;t=fe(i,n,a);e=t}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}}else{bt=e;e=z}It--;if(e===V){t=V;0===It&&r(ue)}Et[l]={nextPos:bt,result:e};return e}function g(){var e,t,i,s=29*bt+8,n=Et[s];if(n){bt=n.nextPos;return n.result}It++;e=bt;t=[];i=E();if(i!==V)for(;i!==V;){t.push(i);i=E()}else t=z;if(t!==V){i=m();if(i!==V){wt=e;t=me(t,i);e=t}else{bt=e;e=z}}else{bt=e;e=z}It--;if(e===V){t=V;0===It&&r(ge)}Et[s]={nextPos:bt,result:e};return e}function m(){var t,i,s,n=29*bt+9,a=Et[n];if(a){bt=a.nextPos;return a.result}It++;t=bt;i=[];if(ye.test(e.charAt(bt))){s=e.charAt(bt);bt++}else{s=V;0===It&&r(be)}if(s!==V)for(;s!==V;){i.push(s);if(ye.test(e.charAt(bt))){s=e.charAt(bt);bt++}else{s=V;0===It&&r(be)}}else i=z;if(i!==V){s=v();s===V&&(s=ee);if(s!==V){wt=t;i=we(i,s);t=i}else{bt=t;t=z}}else{bt=t;t=z}It--;if(t===V){i=V;0===It&&r(ve)}Et[n]={nextPos:bt,result:t};return t}function v(){var t,i,s,n,a=29*bt+10,o=Et[a];if(o){bt=o.nextPos;return o.result}It++;t=bt;if(45===e.charCodeAt(bt)){i=Se;bt++}else{i=V;0===It&&r(Ce)}i===V&&(i=ee);if(i!==V){s=D();if(s!==V){if(Te.test(e.charAt(bt))){n=e.charAt(bt);bt++}else{n=V;0===It&&r(Ie)}if(n===V)if(37===e.charCodeAt(bt)){n=Ee;bt++}else{n=V;0===It&&r(Pe)}n===V&&(n=ee);if(n!==V){wt=t;i=Me(s,n);t=i}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}It--;if(t===V){i=V;0===It&&r(xe)}Et[a]={nextPos:bt,result:t};return t}function y(){var t,i,s,n=29*bt+11,a=Et[n];if(a){bt=a.nextPos;return a.result}It++;t=b();if(t===V){t=bt;i=w();if(i!==V){if(32===e.charCodeAt(bt)){s=Ae;bt++}else{s=V;0===It&&r(ke)}if(s!==V){wt=t;i=De(i);t=i}else{bt=t;t=z}}else{bt=t;t=z}}It--;if(t===V){i=V;0===It&&r(Le)}Et[n]={nextPos:bt,result:t};return t}function b(){var e,t,i=29*bt+12,s=Et[i];if(s){bt=s.nextPos;return s.result}It++;e=bt;t=C();if(t!==V){wt=e;t=Fe(t)}e=t;It--;if(e===V){t=V;0===It&&r(Oe)}Et[i]={nextPos:bt,result:e};return e}function w(){var t,i,s,n,a,o,l=29*bt+13,c=Et[l];if(c){bt=c.nextPos;return c.result}It++;t=bt;i=x();if(i!==V){s=F();if(s!==V){if(e.substr(bt,1).toLowerCase()===$e){n=e.charAt(bt);bt++}else{n=V;0===It&&r(_e)}if(n!==V){a=F();if(a!==V){o=x();if(o!==V){wt=t;i=Ue(i,o);t=i}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}}else{bt=t;t=z}It--;if(t===V){i=V;0===It&&r(Re)}Et[l]={nextPos:bt,result:t};return t}function x(){var t,i,s,n=29*bt+14,a=Et[n];if(a){bt=a.nextPos;return a.result}It++;t=bt;i=k();if(i!==V){s=S();s===V&&(s=ee);if(s!==V){wt=t;i=Ne(i,s);t=i}else{bt=t;t=z}}else{bt=t;t=z}if(t===V){t=bt;if(63===e.charCodeAt(bt)){i=He;bt++}else{i=V;0===It&&r(Be)}if(i!==V){wt=t;i=je()}t=i}It--;if(t===V){i=V;0===It&&r(Ve)}Et[n]={nextPos:bt,result:t};return t}function S(){var t,i,s,n=29*bt+15,a=Et[n];if(a){bt=a.nextPos;return a.result}It++;t=bt;if(Ge.test(e.charAt(bt))){i=e.charAt(bt);bt++}else{i=V;0===It&&r(We)}if(i!==V){if(Ge.test(e.charAt(bt))){s=e.charAt(bt);bt++}else{s=V;0===It&&r(We)}if(s!==V){wt=t;i=qe(i,s);t=i}else{bt=t;t=z}}else{bt=t;t=z}It--;if(t===V){i=V;0===It&&r(ze)}Et[n]={nextPos:bt,result:t};return t}function C(){var t,i,s,n=29*bt+16,a=Et[n];if(a){bt=a.nextPos;return a.result}It++;t=bt;i=k();if(i!==V){if(37===e.charCodeAt(bt)){s=Ee;bt++}else{s=V;0===It&&r(Pe)}if(s!==V){wt=t;i=Ye(i);t=i}else{bt=t;t=z}}else{bt=t;t=z}It--;if(t===V){i=V;0===It&&r(Xe)}Et[n]={nextPos:bt,result:t};return t}function T(){var e,t,i,s=29*bt+17,n=Et[s];if(n){bt=n.nextPos;return n.result}e=bt;t=[];i=I();if(i!==V)for(;i!==V;){t.push(i);i=I()}else t=z;if(t!==V){wt=e;t=Ze(t)}e=t;Et[s]={nextPos:bt,result:e};return e}function I(){var t,i,s=29*bt+18,n=Et[s];if(n){bt=n.nextPos;return n.result}It++;t=A();if(t===V)if(46===e.charCodeAt(bt)){t=Je;bt++}else{t=V;0===It&&r(Qe)}It--;if(t===V){i=V;0===It&&r(Ke)}Et[s]={nextPos:bt,result:t};return t}function E(){var t,i,s,n=29*bt+19,a=Et[n];if(a){bt=a.nextPos;return a.result}It++;t=bt;i=M();if(i!==V){if(46===e.charCodeAt(bt)){s=Je;bt++}else{s=V;0===It&&r(Qe)}if(s!==V){wt=t;i=tt(i);t=i}else{bt=t;t=z}}else{bt=t;t=z}It--;if(t===V){i=V;0===It&&r(et)}Et[n]={nextPos:bt,result:t};return t}function P(){var e,t,i,s=29*bt+20,n=Et[s];if(n){bt=n.nextPos;return n.result}It++;e=bt;t=[];i=L();if(i!==V)for(;i!==V;){t.push(i);i=L()}else t=z;if(t!==V){wt=e;t=st(t)}e=t;It--;if(e===V){t=V;0===It&&r(it)}Et[s]={nextPos:bt,result:e};return e}function M(){var e,t,i,s=29*bt+21,n=Et[s];if(n){bt=n.nextPos;return n.result}It++;e=bt;t=[];i=A();if(i!==V)for(;i!==V;){t.push(i);i=A()}else t=z;if(t!==V){wt=e;t=st(t)}e=t;It--;if(e===V){t=V;0===It&&r(nt)}Et[s]={nextPos:bt,result:e};return e}function L(){var t,i,s=29*bt+22,n=Et[s];if(n){bt=n.nextPos;return n.result}It++;if(at.test(e.charAt(bt))){t=e.charAt(bt);bt++}else{t=V;0===It&&r(ot)}It--;if(t===V){i=V;0===It&&r(rt)}Et[s]={nextPos:bt,result:t};return t}function A(){var t,i,s=29*bt+23,n=Et[s];if(n){bt=n.nextPos;return n.result}It++;if(ct.test(e.charAt(bt))){t=e.charAt(bt);bt++}else{t=V;0===It&&r(dt)}It--;if(t===V){i=V;0===It&&r(lt)}Et[s]={nextPos:bt,result:t};return t}function k(){var t,i,s,n,a,o,l,c=29*bt+24,d=Et[c];if(d){bt=d.nextPos;return d.result}It++;t=bt;i=bt;s=bt;n=D();if(n!==V){a=bt;if(46===e.charCodeAt(bt)){o=Je;bt++}else{o=V;0===It&&r(Qe)}if(o!==V){l=D();if(l!==V){o=[o,l];a=o}else{bt=a;a=z}}else{bt=a;a=z}a===V&&(a=ee);if(a!==V){n=[n,a];s=n}else{bt=s;s=z}}else{bt=s;s=z}s!==V&&(s=e.substring(i,bt));i=s;if(i!==V){wt=t;i=pt(i)}t=i;if(t===V){t=bt;i=bt;s=bt;if(46===e.charCodeAt(bt)){n=Je;bt++}else{n=V;0===It&&r(Qe)}if(n!==V){a=D();if(a!==V){n=[n,a];s=n}else{bt=s;s=z}}else{bt=s;s=z}s!==V&&(s=e.substring(i,bt));i=s;if(i!==V){wt=t;i=ut(i)}t=i}It--;if(t===V){i=V;0===It&&r(ht)}Et[c]={nextPos:bt,result:t};return t}function D(){var e,t,i=29*bt+25,s=Et[i];if(s){bt=s.nextPos;return s.result}e=[];t=O();if(t!==V)for(;t!==V;){e.push(t);t=O()}else e=z;Et[i]={nextPos:bt,result:e};return e}function O(){var t,i=29*bt+26,s=Et[i];if(s){bt=s.nextPos;return s.result}if(ft.test(e.charAt(bt))){t=e.charAt(bt);bt++}else{t=V;0===It&&r(gt)}Et[i]={nextPos:bt,result:t};return t}function F(){var e,t,i=29*bt+27,s=Et[i];if(s){bt=s.nextPos;return s.result}It++;e=[];t=R();for(;t!==V;){e.push(t);t=R()}It--;if(e===V){t=V;0===It&&r(mt)}Et[i]={nextPos:bt,result:e};return e}function R(){var t,i=29*bt+28,s=Et[i];if(s){bt=s.nextPos;return s.result}if(vt.test(e.charAt(bt))){t=e.charAt(bt);bt++}else{t=V;0===It&&r(yt)}Et[i]={nextPos:bt,result:t};return t}function $(e,t){if(e){e.hasOwnProperty("scale")&&(t.scale=e.scale);e.hasOwnProperty("width")&&(t.width=e.width);e.hasOwnProperty("widthUnit")&&(t.widthUnit=e.widthUnit);e.hasOwnProperty("height")&&(t.height=e.height);e.hasOwnProperty("heightUnit")&&(t.heightUnit=e.heightUnit)}}var _,U=arguments.length>1?arguments[1]:{},V={},N={start:o},H=o,B={type:"other",description:"Either a default asset specification or a layer asset specification"},j={type:"other",description:"A document defaults specification"},z=V,G="default",W={type:"literal",value:"default",description:'"default"'},q=function(e){return e},X={type:"other",description:"List of default specification components"},Y=/^[+,]/,Z={type:"class",value:"[+,]",description:"[+,]"},K=function(e,t){t.unshift(e);return t},J=function(e){return[e]},Q={type:"other",description:"A single default specification component"},ee=null,te=function(e,t,i){return e||t.length>0||i&&i.trim().length>0},ie=void 0,se=function(e,i,s){var n={"default":!0,name:t().trim()};i.length>0&&(n.folder=i);if(s){s=s.trim();s.length>0&&(n.suffix=s)}$(e,n);return n},ne={type:"other",description:"List of layer specifications"},re=function(e,t){t.unshift(e);return t},ae={type:"other",description:"Layer specification"},oe=function(e){return{name:e.trim()}},le={type:"other",description:"A single folder name that ends with a slash and does not begin with a dot"},ce="/",de={type:"literal",value:"/",description:'"/"'},he=function(e){return"."==e[0]},pe=function(e){return e},ue={type:"other",description:"A size-and-file specification"},fe=function(e,i,s){var n={name:t().trim(),file:s.filename.replace(/[\\":*?<>!|]/g,"_"),extension:s.extension};i.length>0&&(n.folder=i);s.hasOwnProperty("quality")&&(n.quality=s.quality);$(e,n);return n},ge={type:"other",description:"Filename and quality suffix"},me=function(e,t){var i=String.prototype.concat.apply("",e)+t.extension;i.match(/^\s/)&&s("Filename begins with whitespace");var n={filename:i.trim(),extension:t.extension.toLowerCase()};t.hasOwnProperty("quality")&&(n.quality=t.quality);return n},ve={type:"other",description:"File extension and quality suffix"},ye=/^[a-zA-Z]/,be={type:"class",value:"[a-zA-Z]",description:"[a-zA-Z]"},we=function(e,t){var i={extension:e.join("")};t&&(i.quality=t);return i},xe={type:"other",description:"Quality parameter that follows a file extension"},Se="-",Ce={type:"literal",value:"-",description:'"-"'},Te=/^[a-z]/,Ie={type:"class",value:"[a-z]",description:"[a-z]"},Ee="%",Pe={type:"literal",value:"%",description:'"%"'},Me=function(e,t){return e.join("")+(t||"")},Le={type:"other",description:"Relative or absolute scale"},Ae=" ",ke={type:"literal",value:" ",description:'" "'},De=function(e){return e},Oe={type:"other",description:"Relative scale, like 0.3"},Fe=function(e){return{scale:e}},Re={type:"other",description:"Absolute scale, like 50x100cm"},$e="x",_e={type:"literal",value:"x",description:'"x"'},Ue=function(e,t){var i={};e.hasOwnProperty("value")&&(i.width=e.value);e.hasOwnProperty("unit")&&(i.widthUnit=e.unit);t.hasOwnProperty("value")&&(i.height=t.value);t.hasOwnProperty("unit")&&(i.heightUnit=t.unit);return i},Ve={type:"other",description:"Absolute scale component, like 100cm"},Ne=function(e,t){var i={value:e};t&&(i.unit=t);return i},He="?",Be={type:"literal",value:"?",description:'"?"'},je=function(){return{}},ze={type:"other",description:"Unit abbreviation"},Ge=/^[a-z]/i,We={type:"class",value:"[a-z]i",description:"[a-z]i"},qe=function(e,t){return e+t},Xe={type:"other",description:"A percentage, like 30%"},Ye=function(e){return e/100},Ze=function(e){return e.join("")},Ke={type:"other",description:"A good character or a dot"},Je=".",Qe={type:"literal",value:".",description:'"."'},et={type:"other",description:"A sequence of characters that ends with a dot"},tt=function(e){return e.concat(".")},it={type:"other",description:"A sequence of characters, including dots"},st=function(e){return e.join("")},nt={type:"other",description:"A sequence of characters, excluding dots"},rt={type:"other",description:"A character, including dots"},at=/^[^,+]/,ot={type:"class",value:"[^,+]",description:"[^,+]"},lt={type:"other",description:"A character, excluding dots and other weird things"},ct=/^[^+,.\/\0-\x1F]/,dt={type:"class",value:"[^+,.\\/\\0-\\x1F]",description:"[^+,.\\/\\0-\\x1F]"},ht={type:"other",description:"A nonnegative number, which may or may not have leading zeros"},pt=function(e){return parseFloat(e)},ut=function(e){return parseFloat("0"+e)},ft=/^[0-9]/,gt={type:"class",value:"[0-9]",description:"[0-9]"},mt={type:"other",description:"whitespace"},vt=/^[ \t\n\r]/,yt={type:"class",value:"[ \\t\\n\\r]",description:"[ \\t\\n\\r]"},bt=0,wt=0,xt=0,St={line:1,column:1,seenCR:!1},Ct=0,Tt=[],It=0,Et={};if("startRule"in U){if(!(U.startRule in N))throw new Error("Can't start parsing from rule \""+U.startRule+'".');H=N[U.startRule]}_=H();if(_!==V&&bt===e.length)return _;_!==V&&bt<e.length&&r({type:"end",description:"end of input"});throw a(null,Tt,Ct)}t(i,Error);return{SyntaxError:i,parse:e}});define("ccweb.files.extract/views/templates/extractAssetTemplate.html",[],function(){return'<h3 class="title"><%-translate("Save as Image...")%></h3>\n<span class="close-button"></span>\n<input type="text" class="topcoat-text-input file-name" required>\n<div class="options">\n    <div>\n        <input type="radio" name="imagetype" value="png8"/>\n        <p><%-translate("PNG 8 Alpha")%></p>\n    </div>\n    <div>\n        <input type="radio" name="imagetype" value="png32"/>\n        <p><%-translate("PNG 32")%></p>\n    </div>\n    <div>\n        <input type="radio" name="imagetype" value="jpeg" checked/>\n        <p><%-translate("JPG")%></p>\n    </div>\n    <div>\n        <input type="radio" name="imagetype" value="svg"/>\n        <p><%-translate("SVG")%></p>\n    </div>\n</div>\n<div class="svg-warning extract-asset-warning"><%-translate("Bitmap layer(s) will be saved as bitmap in SVG.")%></div>\n<div class="not-warning">\n    <div class="subtitle"><%-translate("Quality")%></div>\n    <div class="quality clearfix">\n        <input type="text" class="topcoat-text-input quality-percentage" value="80"/>\n        <input type="range" class="topcoat-range quality-range" value="80"/>\n        <div class="format-description"><%-translate("test")%></div>\n    </div>\n</div>\n<div class="lso-warning extract-asset-warning"></div>\n<div class="scale clearfix <%- settings.get(\'scaleExtractedAssets\') ? \'\' : \'disabled\'%>" title=\'<%-translate("Enter a value from 0.1x to 5x to extract an asset at a specific scale factor")%>\'>\n    <input type="checkbox" class="scale-enable" value="checkbox" <%- settings.get(\'scaleExtractedAssets\') ? \'checked\' : \'\'%> />\n    <div class="scale-enable-checkbox topcoat-checkbox__checkmark"></div>\n    <label><%-translate("Scale at")%></label>\n    <input type="text" class="topcoat-text-input scale-factor" value="<%- parseFloat(settings.get(\'assetScaleFactor\').toFixed()) %>x" />\n</div>\n<div class="popup-footer clearfix">\n    <button id="saveBtn" class="topcoat-button--cta btn btn-primary"><%-translate("Save")%></button>\n    <button id="downloadBtn" class="topcoat-button"><%-translate("Download Directly")%></button>\n</div>\n<div class="notch"></div>\n'});define("ccweb.files.extract/views/popup/ExtractAssetView",["jquery","underscore","backbone","plugin-dependencies","ccweb.files.extract/controllers/DerivedAssetController","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/views/popup/BasePopupView","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/utils/LayerNameParser","ccweb.files.extract/models/UserSettingsModel","ccweb.files.extract/views/templates/extractAssetTemplate.html","ccweb.files.extract/Constants"],function(e,t,i,s,n,r,a,o,l,c,d,h){"use strict";var p=80,u='/\\\\:*?"<>|,',f=u+"\\s",g="^[^"+u+"]*[^"+f+"][^"+u+"]*$",m=/(\/|\\|:|\*|\?|"|<|>|\||\,|^\.\.\.)/g,v=a.extend({className:"extract-asset-popup popup",selectedLayers:null,qualityRange:null,qualityPercent:null,fileFormat:null,sizeSpan:null,extractSize:null,qualityLabel:null,qualityBox:null,formatDescription:null,description:{png8:s.translate("256 colors. Lowest file size. Alpha transparency to be retained if present in element."),png32:s.translate("Lossless format so better quality."),svg:s.translate("We use the standard W3C SVG format which is supported by all viewers.")},baseName:null,events:{"click #downloadBtn":"handleExportAsset","click #saveBtn":"handleExportAsset","change .scale-enable":"scaleEnabledChanged","change .scale-factor":"scaleFactorChanged"},selectedLayersContainLinkSmartObject:function(){var e,t,i=r.getSelectedLayers();e=i.some(function(e,i){t=e.get("smartObjectInfo");return t?t.linked:!1});return s.utils.hasFeature("extract_batch")&&e},initialize:function(){a.prototype.initialize.apply(this,arguments);this.onbeforeunload=this.handleClose},updateQuality:function(e){e=Math.min(100,e);e=Math.max(0,e);this.$qualityPercent.val(e);this.$qualityRange.val(e);
this.updateSizeAndDescription();this.existingAsset||c.set("assetQuality",e)},updateSizeAndDescription:function(){var e=this.getFileFormat();if("jpeg"===e){this.$qualityLabel.html(s.translate("Quality"));this.$qualityBox.removeClass("quality-description");this.$qualityRange.css("display","block");this.$qualityPercent.css("display","block");this.$formatDescription.css("display","none")}else{this.$qualityLabel.html(s.translate("Description"));this.$qualityBox.addClass("quality-description");this.$qualityRange.css("display","none");this.$qualityPercent.css("display","none");this.$formatDescription.css("display","block");this.$formatDescription.html(this.description[e])}if("svg"===e&&this.bitmap){this.$svgWarning.show();this.$notWarning.hide()}else{this.$svgWarning.hide();this.$notWarning.show()}if(this.baseName){var t=n.generateUniqueAssetName(this.baseName,e);this.$fileName.val(t)}},updateFileNameValidity:function(){if(this.$fileName[0].validity.valid){this.$saveButton.prop("disabled",!1);this.$downloadButton.prop("disabled",!1)}else{this.$saveButton.prop("disabled",!0);this.$downloadButton.prop("disabled",!0)}},render:function(){a.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(o.createTemplate(d,{settings:c}));this.$fileName=this.$el.find(".file-name");this.$qualityRange=this.$el.find(".quality-range");this.$qualityPercent=this.$el.find(".quality-percentage");this.$fileFormat=this.$el.find(".options");this.$qualityLabel=this.$el.find(".subtitle");this.$qualityBox=this.$el.find(".quality");this.$formatDescription=this.$el.find(".format-description");this.$scale=this.$el.find(".scale");this.$scaleEnabled=this.$el.find(".scale-enable");this.$scaleFactor=this.$el.find(".scale-factor");this.$svgWarning=this.$el.find(".svg-warning");this.$lsoWarning=this.$el.find(".lso-warning");this.$notWarning=this.$el.find(".not-warning");this.$downloadButton=this.$el.find("#downloadBtn");this.$saveButton=this.$el.find("#saveBtn");this.$lsoWarning.html(s.translate("{0}http://www.adobe.com/go/smart_objects{1}Linked Smart Objects{2} will render poorly when scaled. {3}http://www.adobe.com/go/extract_help#linked_smart_objects{4}Help{5}",'<a id="smart_obj_link" href="','" target="_blank">',"</a>",'<a id="help_link" href="','" target="_blank">',"</a>"));this.$fileName.attr("title",s.translate("Cannot include any of the characters {0}",u.replace("\\\\","\\")));this.$fileName.attr("pattern",g);this.$downloadButton.toggle(s.utils.hasFeature("extract_batch")===!0&&!graphite.inPublicOneUp());this.$scale.toggle(!0);return this},addHandlers:function(){var e=this;a.prototype.addHandlers.apply(this,arguments);graphite.events.on("show-extract-asset-popup",this.handleShow,this);graphite.events.on("hide-extract-asset-popup",this.handleHide,this);this.$el.mousedown(function(e){e.stopPropagation()});this.$fileFormat.change(function(){e.updateSizeAndDescription()});this.$qualityRange.change(function(){e.updateQuality(this.value)});this.$qualityPercent.change(function(){e.updateQuality(this.value)});var t=this.$fileName;t.keyup(function(t){e.handleKeyUp(t);t.stopImmediatePropagation()});t.keypress(function(t){13===t.which&&e.handleExportAsset(t)});t.change(function(){e.baseName=null})},removeEventListeners:function(){graphite.events.off(null,null,this)},handleShow:function(e){var t=this.$el.find(".title");this.existingAsset=null;if("new"===e.type){var i=s.utils.getCurrentPage()?r.getSelectedLayers():r.getSelectedLayers().slice(0,1);this.bitmap=!1;for(var o=0,l=i.length;l>o;o++){var c=i[o],d=c.get("type")===h.Type.LAYER_TEXT||c.get("properties").get("shape");this.bitmap=this.bitmap||!d}var p=i[0];this.selectedVisibleLayerIds=r.expandSelection(i).map(function(e){return e.get("layerId")});if(p&&this.selectedVisibleLayerIds.length){this.deriveAssetDetailsFromLayer(p);1===this.selectedVisibleLayerIds.length?t.html(s.translate("Save as Image...")):t.html(s.translate("Save {0} Layers as Image...",this.selectedVisibleLayerIds.length));this.updateSizeAndDescription();this.updateFileNameValidity()}}else if("edit"===e.type){t.html(s.translate("Edit Image Properties"));this.existingAsset=e.model;var u=n.getMetadataForAsset(this.existingAsset);this.selectedVisibleLayerIds=u.get("originatingLayers");this.deriveAssetDetailsFromAsset(u);this.updateSizeAndDescription();this.updateFileNameValidity();a.prototype.handleShow.apply(this,arguments)}this.showHideLSOWarning();a.prototype.handleShow.apply(this,arguments)},handleHide:function(){var e=c.get("scaleExtractedAssets");this.$scaleEnabled.prop("checked",e);this.$scaleFactor.val(c.get("assetScaleFactor")+"x");this.$scale.toggleClass("disabled",!e);a.prototype.closePopup.call(this)},closePopup:function(){graphite.events.trigger("hide-extract-asset-popup")},handleKeyUp:function(e){a.prototype.handleKeyUp.apply(this,arguments);this.updateFileNameValidity()},handleExportAsset:function(t){if(this.$fileName[0].validity.valid){var i,r=graphite.inPublicOneUp()||e(t.target).is(this.$downloadButton),a=-1,o=this.$scaleEnabled.prop("checked")&&!this.$scale.hasClass("incompatible")?parseFloat(this.$scaleFactor.val()):null,l=this.getFileFormat();"jpeg"===l&&(a=this.$qualityPercent.val());i=this.normalizeFileName(this.$fileName.val());if(this.existingAsset)n.updateAsset(this.existingAsset,this.selectedVisibleLayerIds,r,i,this.getFileFormat(),a,o,this.model,this.handleExportAssetComplete,this.handleExportAssetError,this);else{n.exportAsset(this.selectedVisibleLayerIds,r,i,this.getFileFormat(),a,o,this.model,!1,this.handleExportAssetComplete,this.handleExportAssetError,this);if(s.utils.hasFeature("extract_batch"))if(r)graphite.events.trigger("extract-asset-direct-download",{fileFormatSelected:l});else{graphite.events.trigger("extract-asset-download-init",{fileFormatSelected:l});graphite.events.trigger("add-asset-to-catalog",{fileFormatSelected:l})}else graphite.events.trigger("extract-asset-download-init",{fileFormatSelected:l});o&&1!==o&&graphite.events.trigger("asset-extracted-scaled",{scaleFactor:o})}this.closePopup()}},handleExportAssetComplete:function(){},handleExportAssetError:function(e){401===e.status?graphite.events.trigger("reauthenticate"):507===e.status?s.notifyUser(s.translate("Error extracting asset. You've possibly exceeded your storage limit.")):s.notifyUser(s.translate("Error extracting asset."))},scaleEnabledChanged:function(){var e=this.$scaleEnabled.prop("checked");this.$scale.toggleClass("disabled",!e);c.set("scaleExtractedAssets",e);this.showHideLSOWarning()},scaleFactorChanged:function(){var e=parseFloat(this.$scaleFactor.val()),t=c.get("assetScaleFactor");!isNaN(e)&&e>=.1&&5>=e?t=parseFloat(e.toFixed(1)):!isNaN(e)&&e>5?t=5:!isNaN(e)&&.1>e&&(t=.1);c.set("assetScaleFactor",t);this.$scaleFactor.val(t+"x")},showHideLSOWarning:function(){var e=this.$scaleEnabled.prop("checked");this.$lsoWarning.hide();e&&s.utils.hasFeature("extract_batch")&&(this.existingAsset&&this.existingAsset.hasLinkedSmartObject()?this.$lsoWarning.show():this.selectedLayersContainLinkSmartObject()&&this.$lsoWarning.show())},getFileFormat:function(){return this.$fileFormat.find("input[name=imagetype]:checked").val()},setFileFormat:function(e){this.$fileFormat.find("input[value="+e+"]").prop("checked",!0)},remove:function(){this.removeEventListeners();a.prototype.remove.call(this)},normalizeFileName:function(t){t=e.trim(t);t=t.substr(0,t.lastIndexOf("."))||t;t=t.replace(m,"_");return t},deriveAssetDetailsFromLayer:function(e){var t,i,n,r,a,o,d=e.get("layerName"),h="png32";d=d.replace(/^(\/|\\|\.)+/,"");var u=c.get("assetQuality");"undefined"==typeof u&&(u=p);try{t=l.parse(d);if(t&&t.length>0){i=t[0];d=i.file||d;n=i.quality;a=i.scale;o=i.extension||"png";switch(o.toLowerCase()){case"jpg":case"jpeg":case"gif":h="jpeg";if(n){r=-1!==n.indexOf("%")?1:10;u=parseInt(n,10)*r}break;case"png":h="8"===n?"png8":"png32";break;case"svg":h="svg"}}}catch(f){}this.updateQuality(u);if(a&&1!==a&&a>=.1&&5>=a){this.$scaleEnabled.prop("checked",!0);this.$scale.toggleClass("disabled",!1);this.$scaleFactor.val(parseFloat(a.toFixed(1))+"x")}this.setFileFormat(h);d=this.normalizeFileName(d);s.utils.hasFeature("extract_batch")?this.baseName=d:this.$fileName.val(d)},deriveAssetDetailsFromAsset:function(e){var t=this.normalizeFileName(e.get("name")),i=e.get("encodingQualityFactor")||p,s=e.get("scale")||1,n=e.get("encodingType")||"png32";("jpg"===n||"jpeg"===n)&&this.updateQuality(i);if(s&&1!==s&&s>=.1&&5>=s){this.$scaleEnabled.prop("checked",!0);this.$scale.toggleClass("disabled",!1);this.$scaleFactor.val(parseFloat(s.toFixed(1))+"x")}this.setFileFormat(n);this.baseName=null;this.$el.find(".file-name").val(t)}});return v});define("ccweb.files.extract/views/templates/extractCodeTemplate.html",[],function(){return'<h3 class="title"><%-translate("Styles")%></h3>\n<span class="close-button"></span>\n<div class="textarea-holder">\n    <textarea class="topcoat-textarea" readonly><%-translate("Useful CSS here")%></textarea>\n</div>\n<p class="all-code"></p>\n<button class="topcoat-button action-button"></button>\n'});define("ccweb.files.extract/views/popup/ExtractCodeView",["underscore","backbone","ccweb.files.extract/controllers/ClipboardController","ccweb.files.extract/models/TextStyleUsageModel","ccweb.files.extract/models/UserSettingsModel","ccweb.files.extract/models/GradientUsageModel","ccweb.files.extract/views/popup/BasePopupView","ccweb.files.extract/utils/CSSUtil","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/extractCodeTemplate.html","plugin-dependencies"],function(e,t,i,s,n,r,a,o,l,c,d){"use strict";var h=a.extend({className:"extract-code-popup popup",copyString:d.translate("Copy"),copiedString:d.translate("Copied"),viewMoreString:d.translate("View more"),viewLessString:d.translate("View less"),events:{"click .all-code":"handleViewMoreClick","click .action-button":"handleSelectClick","dblclick .topcoat-textarea":"handleDoubleClickEvent"},initialize:function(){a.prototype.initialize.apply(this,arguments);this.initCopyToClipboard();graphite.events.on("show-extract-code-popup",this.handleShow,this);graphite.events.on("hide-extract-code-popup",this.closePopup,this)},render:function(){a.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(l.createTemplate(c));this.$actionButton=this.$el.find(".action-button");this.$actionButton.html(this.copyString);return this},initCopyToClipboard:function(){i.getClipboard().clip(this.$actionButton);graphite.events.on("clipboard-loaded",this.handleClipboardLoaded,this);graphite.events.on("clipboard-data-requested",this.handleClipboardDataRequest,this);graphite.events.on("clipboard-complete",this.handleClipboardComplete,this);graphite.events.on("clipboard-mouseover",this.handleClipboardMouseOver,this)},handleClipboardLoaded:function(){this.$actionButton.addClass("clipboard-enabled")},handleClipboardDataRequest:function(e){var t=i.getClipboard();if(e===this.$actionButton[0]){t.setText(this.$el.find("textarea").text());graphite.events.trigger("copy-css",{origin:"StylesPopup"})}},handleClipboardComplete:function(){var e=this;e.$actionButton.html(e.copiedString);e.timeout&&clearTimeout(e.timeout);e.timeout=setTimeout(function(){e.$actionButton.html(e.copyString)},1500)},handleClipboardMouseOver:function(){this.isMouseOver=!0},handleShow:function(e){this.reset();a.prototype.handleShow.apply(this,arguments);this.setCSS(e.model,e.ppi)},handleSelectClick:function(){this.$el.find("textarea").select()},handleDoubleClickEvent:function(){graphite.events.trigger("cssDoublClick")},handleViewMoreClick:function(){var e=this.$el.find("textarea"),t=this.$el.find(".all-code");if(this.$el.hasClass("expanded"))this.reset(!0);else{this.$el.addClass("expanded");t.html(this.viewLessString);e.height(e[0].scrollHeight-parseInt(e.css("padding-top"),10)-parseInt(e.css("padding-bottom"),10))}this.positionPopup()},setCSS:function(t,i){var a,l=this.$el.find("textarea"),c=n.get("preprocessor"),d=t.get("style").getCSS("css"===c,i),h=[];if(t instanceof s||t instanceof r){e.each(d,function(e){a=o.formatCSSString(e,c);a&&h.push(a)});l.text(h.join("\n"))}else l.text("Useful CSS here");this.updateViewMoreButton()},updateViewMoreButton:function(){var e,t;e=this.$el.find(".all-code");t=this.$el.find("textarea");if(t[0].scrollHeight-parseInt(t.css("padding-top"),10)-parseInt(t.css("padding-bottom"),10)>parseInt(t.height(),10)){e.html(this.viewMoreString);e.show()}else e.hide()},reset:function(e){this.$el.removeClass("expanded");this.$el.find(".all-code").html(this.viewMoreString);e||this.$el.find(".action-button").html(this.copyString);this.$el.find("textarea").height("60px")},removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();return t.View.prototype.remove.call(this)}});return h});define("ccweb.files.extract/views/templates/colorChipPopupTemplate.html",[],function(){return'<div class="dropdown">\n    <div class="dropdown-btn color-format">\n        <%-colorFormat%>\n    </div>\n</div>\n<textarea class="topcoat-textarea" readonly>rgba(100,100,100)</textarea>'});define("ccweb.files.extract/views/templates/alphaListPopupTemplate.html",[],function(){return'<div class="alpha-list">\n    <p class="opacities-label">Opacity:</p>\n    <ul>\n        <% _.each(alphas, function(alpha){ %>\n        <li class="color-alpha"><p><%-alpha%></p></li>\n        <% }); %>\n    </ul>\n</div>\n'});define("ccweb.files.extract/views/popup/ColorChipPopupView",["jquery","underscore","backbone","./BasePopupView","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/models/ColorUsageModel","ccweb.files.extract/utils/StyleUtil","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/inspect/ContextMenuView","ccweb.files.extract/views/templates/colorChipPopupTemplate.html","ccweb.files.extract/views/templates/alphaListPopupTemplate.html","ccweb.files.extract/Constants"],function(e,t,i,s,n,r,a,o,l,c,d,h){"use strict";var p=s.extend({className:"color-chip-popup popup",colorUsage:null,currentAlpha:1,handleShowColorProxied:null,handleHideColorProxied:null,colorFormat:"RGB",initialize:function(){s.prototype.initialize.apply(this,arguments);this.addHandlers()},addHandlers:function(){graphite.events.on("show-color-popup",this.handleShowColor,this);graphite.events.on("hide-color-popup",this.handleHideColor,this)},removeEventListeners:function(){graphite.events.off(null,null,this)},render:function(){s.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(o.createTemplate(c,{colorFormat:h.ColorFormat[this.colorFormat]}));this.createColorFormatMenu();return this},createColorFormatMenu:function(){var e=[],i={};t.each(h.ColorFormat,function(t,s){i[s]=t;e.unshift(s)});this.colorFormatMenu=new l({name:"colorFormat-selector",$toggle:this.$("div.color-format"),$after:this.$("div.color-format"),items:e,position:h.MenuPosition.TOP});this.colorFormatMenu.labels=i;this.$(".color-format").addClass("menu-active");this.colorFormatMenu.on("show",this.handleColorFormatMenuShow,this);this.colorFormatMenu.on("selection",this.handleColorFormatSelectionChange,this)},handleColorFormatMenuShow:function(e){this.colorFormatMenu.checkItem(this.colorFormat)},handleColorFormatSelectionChange:function(e){if(e!==this.colorFormat){var t=h.ColorFormat[e];this.handleColorFormatChange(t);this.$(".color-format").text(t);this.colorFormat=e}},handleShowColor:function(e){if(!this.colorUsage||!this.$el.is(":visible")||!a.areUsageStylesEqual(e.style,this.colorUsage)){this.colorUsage=e.style;this.currentAlpha=null;this.handleShow({sourceElement:e.sourceElement});this.updateColorString(h.ColorFormat[this.colorFormat]);this.initAlphaList()}},handleHideColor:function(e){!this.colorUsage||e&&!a.areUsageStylesEqual(e,this.colorUsage)||this.closePopup()},handleColorFormatChange:function(e){this.updateColorString(e);graphite.events.trigger("color-format",{format:e})},initAlphaList:function(){var t=this;this.$el.find(".alpha-list").remove();var i,s=!1,n=this.colorUsage.get("alphas");e.each(n,function(e,t){1!==t&&(s=!0)});if(s){this.$el.append(o.createTemplate(d,{alphas:n}));i=this.$el.find(".color-alpha");i.each(function(i){e(this).data("alpha",n[i]);n[i]===t.currentAlpha&&e(this).addClass("selected")});i.mouseenter(function(){graphite.events.trigger("show-alpha-usage",{alpha:e(this).data("alpha")})});this.$el.find(".alpha-list ul").mouseleave(function(){graphite.events.trigger("hide-alpha-usage")});i.click(function(){e.each(i,function(){e(this).removeClass("selected")});t.currentAlpha=e(this).data("alpha");t.updateColorString(h.ColorFormat[t.colorFormat]);e(this).addClass("selected")})}},updateColorString:function(e){var t,i=this.$el.find("textarea");if(this.colorUsage instanceof r){t=this.colorUsage.get("style");e===h.ColorFormat.RGB?i.val(t.toRGBString(this.currentAlpha)):e===h.ColorFormat.HEX?i.val(t.toHEXString(this.currentAlpha)):i.val(t.toHSLString(this.currentAlpha))}i.select()},remove:function(){this.removeEventListeners();s.prototype.remove.call(this)}});return p});define("ccweb.files.extract/views/templates/layerThumbPopupTemplate.html",[],function(){return'<div class="layer-thumb">\n    <canvas class="sprite_preview preview" ></canvas>\n    <span id="layerWarningMessage" style="display: none"><%-translate("Warning: This layer contains an incompatible graphic option: blend mode")%></span>\n</div>'});define("ccweb.files.extract/views/popup/LayerThumbPopupView",["underscore","backbone","ccweb.files.extract/views/popup/BasePopupView","plugin-dependencies","ccweb.files.extract/Constants","ccweb.files.extract/utils/ImageUtil","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/utils/SpriteSheetUtils","ccweb.files.extract/views/templates/layerThumbPopupTemplate.html"],function(e,t,i,s,n,r,a,o,l){"use strict";var c=i.extend({className:"layer-thumb-popup popup",initialize:function(){i.prototype.initialize.apply(this,arguments);graphite.events.on("load-layer-thumb-popup",this.handleLoadThumb,this);graphite.events.on("show-layer-thumb-popup",this.handleShow,this);graphite.events.on("hide-layer-thumb-popup",this.closePopup,this)},render:function(){i.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(a.createTemplate(l));return this},removeEventListeners:function(){graphite.events.off(null,null,this)},handleLoadThumb:function(e){var t=e.get("properties"),i=t?t.get("blendOptions"):null;o.renderSpriteModel(this,e,".layer-thumb",".sprite_preview",!0);var r=this.$el.find("#layerWarningMessage"),a=[];i&&i.mode&&"passThrough"!==i.mode&&!e.get("isFlattened")&&e.get("visible")&&a.push(s.translate("This layer contains blend modes that may not be rendered correctly with the current combination of visible layers."));e.isFontSubstitution()&&a.push(s.translate("This layer contains font substitutions so the font-size CSS reported is approximate."));e.isMultipleLayerStylesCSSWarning()&&a.push(s.translate(n.LayerWarnings.MULTI_LAYER_STYLES_WARNING));if(a.length>0){r.show();r.html(a.join("<br><br>"))}else r.hide()},closePopup:function(){i.prototype.closePopup.apply(this,arguments);this.$el.find(".preview").attr("src","")},remove:function(){this.removeEventListeners();i.prototype.remove.call(this)}});return c});define("ccweb.files.extract/views/templates/assetThumbPopupTemplate.html",[],function(){return'<div class="layer-thumb">\n    <canvas class="sprite_preview preview" ></canvas>\n    <span id="lsoWarningMessage" style="display: none"><%-translate(\'Linked Smart Objects will render poorly when scaled.\')%></span>\n</div>'});define("ccweb.files.extract/views/popup/AssetThumbPopupView",["underscore","backbone","ccweb.files.extract/views/popup/BasePopupView","plugin-dependencies","ccweb.files.extract/utils/ImageUtil","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/utils/SpriteSheetUtils","ccweb.files.extract/views/templates/assetThumbPopupTemplate.html"],function(e,t,i,s,n,r,a,o){"use strict";var l=i.extend({className:"asset-thumb-popup popup",initialize:function(){i.prototype.initialize.apply(this,arguments);graphite.events.on("load-asset-thumb-popup",this.handleLoadAssetThumb,this);graphite.events.on("show-asset-thumb-popup",this.handleShow,this);graphite.events.on("hide-asset-thumb-popup",this.closePopup,this)},render:function(){i.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(r.createTemplate(o));return this},removeEventListeners:function(){graphite.events.off(null,null,this)},handleLoadAssetThumb:function(e){var t="image/svg+xml"===e.get("mimeType")?graphite.serverAPI.getDerivedDownloadURL(e.get("guid"),e.get("name")):graphite.serverAPI.getDerivedRenditionURL(e.get("guid")),i=new Image,n=this.$el.find(".sprite_preview"),r=this.$el.find("#lsoWarningMessage");s.utils.hasFeature("extract_batch")&&e.hasLinkedSmartObject()?r.show():r.hide();i.addEventListener("load",function(){if("image/svg+xml"===e.get("mimeType")){var t=i.width,s=i.height;if(t>s){if(t>240){s=240*s/t;t=240}}else if(s>240){t=240*t/s;s=240}n[0].width=t;n[0].height=s}else{n[0].width=i.width;n[0].height=i.height}r.width(n[0].width+2);var a=n[0].getContext("2d");a.drawImage(i,0,0,n[0].width,n[0].height);i.removeEventListener("load")});graphite.serverAPI.loadCrossDomainImage(i,t)},handleShow:function(){i.prototype.handleShow.apply(this,arguments)},closePopup:function(){i.prototype.closePopup.apply(this,arguments);this.$el.find(".preview").attr("src","")},remove:function(){this.removeEventListeners();i.prototype.remove.call(this)}});return l});define("ccweb.files.extract/views/popup/ZoomInHintPopupView",["underscore","backbone","ccweb.files.extract/views/popup/BasePopupView","plugin-dependencies","ccweb.files.extract/utils/ImageUtil","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/utils/SpriteSheetUtils","ccweb.files.extract/views/templates/layerThumbPopupTemplate.html"],function(e,t,i,s,n,r,a,o){"use strict";var l=i.extend({className:"zoom-in-hint-popup popup",initialize:function(){i.prototype.initialize.apply(this,arguments);graphite.events.on("show-zoom-in-hint-popup",this.handleShow,this);graphite.events.on("hide-zoom-in-hint-popup",this.closePopup,this)},render:function(){i.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").text(s.translate("Zoom to 100% for greater color picker accuracy."));this.$el.on("mouseover",this.closePopup);return this},positionPopup:function(){i.prototype.positionPopup.apply(this,arguments);this.$el.find(".notch").show()},removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();i.prototype.remove.call(this)}});return l});define("ccweb.files.extract/controllers/FlattenedAssetController",["jquery","underscore","ccweb.files.extract/Constants","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/models/LayerModelMap","ccweb.files.extract/models/LayerModel","ccweb.files.extract/utils/MeasurementUtil"],function(e,t,i,s,n,r,a,o){"use strict";var l={activeRequests:{},requestDelay:1e3,cachedImages:{},invalidateSprite:function(e){var t,i=s.getPSDModel().id,r=s.getPSDModel().get("layerCompId"),a=this.deriveSpriteInfo(e,i),o=this.cachedImages[a.key()],l=this;if(!o&&this.isOriginalPSDVisibility(e)){o={image:n.spriteSheets[e.get("flattenedSprite").sheetID],bounds:e.get("flattenedSprite").bounds};this.cachedImages[a.key()]=o}if(a.visibleLayers&&0===a.visibleLayers.length)this.replaceFlattenedSprite(e,null);else if(o&&o.image.complete)this.replaceFlattenedSprite(e,o.image,o.bounds);else{t={};t.model=e;t.psdModelID=i;t.layerCompId=r;t.info=a;t.delayTimer=setTimeout(function(){l.activateRequest(t)},this.requestDelay);this.queueRequest(t)}},validateSprite:function(e){this.cancelRequest(e)},activateRequest:function(e){var t=this,i=function(){t.imageLoaded(e)},n=function(i){t.imageError(e)};e.image=graphite.serverAPI.getDerivedSpriteImage(s.getPSDModel(),e.info.visibleLayers,i,n);e.delayTimer=null},imageLoaded:function(e){var t=this.activeRequests[e.model.get("layerId")],i={top:0,left:0,right:e.image.width,bottom:e.image.height};this.cachedImages[e.info.key()]={image:e.image,bounds:i};if(t&&t.info.key()===e.info.key()&&e.psdModelID===s.getPSDModel().id){this.replaceFlattenedSprite(e.model,e.image,i);this.cancelRequest(e.model)}},imageError:function(e){this.activeRequests[e.model.get("layerId")]&&e.psdModelID===s.getPSDModel().id&&this.replaceFlattenedSprite(e.model,null);this.cancelRequest(e.model)},replaceFlattenedSprite:function(n,a,l){var c,d,h,p,u,f,g="flattenedLayer"+n.get("layerId"),m=e("#"+g),v=n.get("flattenedSprite"),y=s.getPSDModel(),b=y.get("imgdata").bounds;if(m.length){f=m[0].getContext("2d");f.clearRect(0,0,m.width(),m.height());if(a){m[0].width=l.right-l.left;m[0].height=l.bottom-l.top;f.drawImage(a,l.left,l.top,m[0].width,m[0].height,0,0,m[0].width,m[0].height)}p=n.getEffectiveVisibility();u=n.get("type")===i.Type.LAYER_ADJUSTMENT;n.set("renderedVisible",p);h=o.getVisibleBounds(n,y);d={top:p&&!u?h.top:b.bottom,left:p&&!u?h.left:b.right};t.each(v.includedLayers,function(e){c=r.getLayerModelFromId(e);p=c.getEffectiveVisibility();u=c.get("type")===i.Type.LAYER_ADJUSTMENT;h=o.getVisibleBounds(c,y);c.set("renderedVisible",p);if(p&&!u){d.left=Math.min(d.left,h.left);d.top=Math.min(d.top,h.top)}});if(s.clipLayersToImage){d.top=Math.max(0,d.top);d.left=Math.max(0,d.left)}this.applyParentAndPosition(n,d,m,v);graphite.events.trigger("flattenedSpriteUpdated",n)}},placeSprite:function(t,i){for(var s,n,r,o,l,c,d,h=t.get("parentModel");h&&h instanceof a&&1!=h.getEffectiveOpacity();)h=h.get("parentModel");if(h){s=h.get("layerCollection");for(d=0;d<s.length;d++){c=s.at(d);c.get("flattenedParent")===t.get("layerId")&&(r=c)}r&&(o=e("#layer"+r.get("layerId")));if(h instanceof a){l=e("#layer"+h.get("layerId"));n=h}else l=e("#psdpreview_root");l&&(o?o.before(i):l.prepend(i))}return n},applyParentAndPosition:function(e,i,n,r){var a=this.placeSprite(e,n),o=a?a.get("bounds"):null;o||(o={top:0,left:0});r&&(r.altPsdOrigin=t.clone(i));var l=i.top,c=i.left,d=o.left,h=o.top;if(s.clipLayersToImage){l=Math.max(0,l);c=Math.max(0,c);d=Math.max(0,d);h=Math.max(0,h)}n.css({left:i.left-d+"px",top:i.top-h+"px"})},queueRequest:function(t){var i=t.model,s=t.model.get("layerId");this.cancelRequest(i);this.activeRequests[s]=t;e(".spinner").show()},cancelRequest:function(t){var i=t.get("layerId"),s=this.activeRequests[i];if(s){clearTimeout(s.delayTimer);delete this.activeRequests[i]}0===Object.keys(this.activeRequests).length&&e(".spinner").hide()},isOriginalPSDVisibility:function(e){var i,s=e.getEffectiveVisibility(),n=s===e.get("psdVisible"),a=e.get("flattenedSprite");n&&t.each(a.includedLayers,function(e){i=r.getLayerModelFromId(e);s=i.getEffectiveVisibility();s!==i.get("psdVisible")&&(n=!1)});return n},deriveSpriteInfo:function(e,i){var n,a=e.get("flattenedSprite"),o=[],l={psdId:i,visibleLayers:[],key:function(){return i+","+this.visibleLayers.join(",")}};e.getEffectiveVisibility()&&o.push(e);t.each(a.includedLayers,function(e){n=r.getLayerModelFromId(e);n.getEffectiveVisibility()&&o.push(n)});o=s.expandSelection(o);l.visibleLayers=t.unique(t.map(o,function(e){return e.get("layerId")}));return l},reset:function(){this.activeRequests={};this.cachedImages={}}};return l});define("ccweb.files.extract/views/templates/inspectFontCalloutTemplate.html",[],function(){return'<div class="font-callout">\n    <p>T</p>\n    <div class="callout-notch"></div>\n</div>'});define("ccweb.files.extract/views/templates/inspectColorCalloutTemplate.html",[],function(){return'<div class="color-callout">\n    <p class="alpha-value">1.0</p>\n    <div class="callout-notch"></div>\n</div>'});define("ccweb.files.extract/views/preview/InspectStyleOverlayView",["jquery","underscore","backbone","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/controllers/ZoomController","ccweb.files.extract/models/ColorUsageModel","ccweb.files.extract/models/TextStyleUsageModel","ccweb.files.extract/models/GradientUsageModel","ccweb.files.extract/models/LayerModelMap","ccweb.files.extract/utils/CSSUtil","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/inspectFontCalloutTemplate.html","ccweb.files.extract/views/templates/inspectColorCalloutTemplate.html"],function(e,t,i,s,n,r,a,o,l,c,d,h,p,u){"use strict";var f=i.View.extend({colorCalloutDict:{},inspectableLayers:{},initialize:function(){this.render();this.model.on("change:extractedStyles",this.handleExtractedStylesChanged,this);this.addHandlers();this.model.get("extractedStyles")&&this.handleExtractedStylesChanged()},render:function(){var t=e('<div id="inspectStyleOverlay">');this.setElement(t)},handleExtractedStylesChanged:function(){this.loadInspectableLayers()},addHandlers:function(){graphite.events.on("show-style-usage",this.handleShowStyleUsage,this);graphite.events.on("hide-style-usage",this.handleHideStyleUsage,this);graphite.events.on("show-originating-layers",this.handleShowOriginatingLayers,this);graphite.events.on("hide-originating-layers",this.handleHideOriginatingLayers,this);graphite.events.on("show-alpha-usage",this.handleShowAlphaUsage,this);graphite.events.on("hide-alpha-usage",this.handleHideAlphaUsage,this);graphite.events.on("zoomChanged",this.handleSelectedInspectItemChange,this);graphite.events.on("layerVisiblityChanged",this.handleSelectedInspectItemChange,this);n.on("change:selectedInspectItem",this.handleSelectedInspectItemChange,this);s.on("change:extractedStylesInSelection",t.bind(this.updateCallouts,this,o,null))},removeEventListeners:function(){this.model.off(null,null,this);graphite.events.off(null,null,this);n.off(null,null,this);s.off(null,null,this);s.unbind("change:extractedStylesInSelection")},attachCalloutClickHandler:function(e,t){var i=this;e.unbind("click");e.click(function(e){s.changeSelection([t],!1,!0);if(!s.isLayerVisible(t,!0))if(void 0!==t.get("spriteSheet")){var n=i.inspectableLayers.spriteSheetLayers,r=t.get("bounds");n[0].width=r.right-r.left;n[0].height=r.bottom-r.top;n.css("top",r.top+"px");n.css("left",r.left+"px");var a=n[0].getContext("2d"),o=t.get("spriteSheet").bounds,l=s.spriteSheets[t.get("spriteSheet").sheetID];a.drawImage(l,o.left,o.top,o.right-o.left,o.bottom-o.top,0,0,o.right-o.left,o.bottom-o.top);n.show()}else i.inspectableLayers[t.get("layerId")].show();e.stopPropagation()})},loadInspectableLayers:function(){var t,i,s,n;this.inspectableLayers={};t=[];i=this.model.get("extractedStyles");n=this;t=t.concat(i.colors,i.textStyles,i.gradients);e.each(t,function(t,i){s=i.get("layers");e.each(s,function(e,t){n.loadInspectableLayer(t)})})},loadInspectableLayer:function(t){var i;if(void 0!==t.get("spriteSheet")&&!this.inspectableLayers.spriteSheetLayers){i=e('<canvas class="inspectable-layer">');this.inspectableLayers.spriteSheetLayers=i;this.$el.append(i)}},handleShowStyleUsage:function(e){this.updateHoverRects(e.styles);this.updateCallouts(e.styles[0].constructor,e.styles)},handleHideStyleUsage:function(e){this.updateCallouts(e[0].constructor,null);graphite.events.trigger("item-hovered-over",[],!1)},updateHoverRects:function(t){var i=[];e.each(t,function(e,t){i=i.concat(t.get("layers"))});graphite.events.trigger("item-hovered-over",i,!1)},handleSelectedInspectItemChange:function(){this.updateCallouts(o,null);this.updateCallouts(a,null);this.updateCallouts(l,null)},handleShowAlphaUsage:function(t){this.getCalloutsForStyleType(a).each(function(){if(e(this).is(":visible")){e(this).removeClass("defocused");t.alpha!==e(this).data("alpha")&&e(this).addClass("defocused")}})},handleHideAlphaUsage:function(){this.getCalloutsForStyleType(a).each(function(){e(this).is(":visible")&&e(this).removeClass("defocused")})},updateCallouts:function(t,i){this.getCalloutsForStyleType(t).each(function(){e(this).hide();e(this).removeClass("defocused")});var s=[],r=n.get("selectedInspectItem");i&&(s=s.concat(i));r&&r.constructor===t&&r!==i&&s.push(r);
s.length?this.showCalloutsForStyles(t,s):this.$el.find("canvas.inspectable-layer").hide()},showCalloutsForStyles:function(t,i){var s,n=this,r=this.getCalloutsForStyleType(t),a=0;e.each(i,function(i,o){e.each(o.get("layers"),function(i,l){if(l.isLayerShown()){if(r[a]){s=e(r[a]);a++}else{s=n.createCalloutForStyleType(t);n.$el.append(s)}n.initCallout(s,o,l)}})})},getCalloutsForStyleType:function(e){var t="";switch(e){case o:t=".font-callout";break;case a:t=".solid-color-callout";break;case l:t=".gradient-callout";break;default:console.warn("Unknown callout for model")}return this.$el.find(t)},createCalloutForStyleType:function(e,t){var i;switch(e){case o:i=h.createTemplate(p);break;case a:i=h.createTemplate(u);i.addClass("solid-color-callout");break;case l:i=h.createTemplate(u);i.addClass("gradient-callout");break;default:console.warn("Unknown callout for model")}return i},initCallout:function(t,i,n){if(i instanceof a){t.css("background","none");t.css("background-color",i.get("style").toRGBString());e.each(n.get("colors"),function(e,s){var n,r;if(s.isEqual(i.get("style"))){n=t.find(".alpha-value");r=s.get("alpha");if(1===r)n.hide();else{n.show();n.text(r)}t.data("alpha",r)}})}else if(i instanceof l){t.css("background","none");t.find(".alpha-value").hide();d.applyCSS(t,i.get("style"),!0)}t.removeClass("invisible");s.isLayerVisible(n,!0)||t.addClass("invisible");this.attachCalloutClickHandler(t,n);this.positionCallout(t,n);t.show()},handleShowOriginatingLayers:function(e){var t=e.assetModel.get("originatingLayers");this.hideShowOriginatingLayers(t,!0)},handleHideOriginatingLayers:function(e){var t=e.get("originatingLayers");this.hideShowOriginatingLayers(t,!1)},hideShowOriginatingLayers:function(t,i){var s,n;for(n=0;n<t.length;n++){s=c.getLayerInfoForId(t[n]).item;i?e(s).addClass("originating-layer"):e(s).removeClass("originating-layer")}},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)},positionCallout:function(e,t){var i,s,n=r.zoomRect(t.get("bounds")),a=n.bottom-n.top,o=parseInt(e.css("width"),10),l=parseInt(e.css("height"),10),c=parseInt(e.find(".callout-notch").width(),10);i=n.top+(a-l)/2-4;0>i&&(i=0);s=n.left-o-c-7;0>s&&(s=0);e.css({top:i+"px",left:s+"px"})}});return f});define("ccweb.files.extract/views/preview/SelectionOverlayView",["jquery","underscore","backbone","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/ZoomController","ccweb.files.extract/utils/MeasurementUtil"],function(e,t,i,s,n,r){"use strict";var a=i.View.extend({selectionButtonBars:[],parentView:null,initialize:function(e){t.bindAll(this,"handleSelectionChange","handleHoverOver");this.parentView=e.parentView;this.render();graphite.events.on("selection-changed",this.handleSelectionChange,this);graphite.events.on("item-hovered-over",this.handleHoverOver,this);graphite.events.on("zoomChanged",this.handleZoomChanged,this)},render:function(){var e=this.parentView.$el.find("#selection-overlay")[0];this.setElement(e)},drawOutline:function(t,i){var a,o,l,c,d=this.$el.width(),h=this.$el.height();c=r.getVisibleBounds(t,s.getPSDModel());c=n.zoomRect(c);l=c.top<=0||c.left<=0||c.right>=d||c.bottom>=h;o=l?-1:0;a=e('<div class="'+i+'"></div>');a.css({top:c.top+"px",left:c.left+"px",height:c.bottom-c.top,width:c.right-c.left,"outline-offset":o+"px"});this.$el.append(a)},handleSelectionChange:function(){var e,t,i=s.getSelectedLayers();for(e=0;e<this.selectionButtonBars.length;e++)this.selectionButtonBars[e].remove();this.selectionButtonBars=[];this.$el.find(".selection").remove();this.$el.find(".hover").remove();for(t=0;t<i.length;t++)this.drawOutline(i[t],"selection")},handleZoomChanged:function(){this.$el.find(".hover").remove();var e=s.getSelectedLayers();s.changeSelection([],!1,!0);graphite.events.once("zoomCompleted",function(){s.changeSelection(e,!1,!0)})},handleHoverOver:function(e){var t;this.$el.find(".hover").remove();for(t=0;t<e.length;t++)this.isItemSelected(e[t])||this.drawOutline(e[t],"hover")},isItemSelected:function(e){var t,i;for(t in s.selectionMap)if(s.selectionMap.hasOwnProperty(t)){i=s.selectionMap[t];if(e===i)return!0}return!1},removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)}});return a});define("ccweb.files.extract/views/templates/mouseListenerOverlayTemplate.html",[],function(){return'<div id="mouseListenerOverlay"></div>'});define("ccweb.files.extract/views/preview/MouseListenerOverlayView",["jquery","underscore","backbone","plugin-dependencies","ccweb.files.extract/Constants","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/models/UserSettingsModel","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/mouseListenerOverlayTemplate.html"],function(e,t,i,s,n,r,a,o,l,c){"use strict";var d=i.View.extend({initialize:function(){t.bindAll(this,"handleMouseMove","handleMouseLeave");this.render()},render:function(){this.setElement(l.createTemplate(c))},addHandlers:function(){this.$el.on("mousemove",this.handleMouseMove);this.$el.on("mouseleave",this.handleMouseLeave)},handleMouseMove:function(t){var i,s,o=t.clientX+e(document).scrollLeft(),l=t.clientY+e(document).scrollTop();if(r.get("activeTool")===n.Tool.SELECT_DIRECT){var c=this.previewView.convertClientPtToPSDPt(o,l);i=a.itemAtPoint(c.x,c.y);s=i&&!this.isItemSelected(i)?[i]:[];graphite.events.trigger("item-hovered-over",s,!0);graphite.events.trigger("mouseMoved",{x:o,y:l,itemMousedOver:i},!0)}},handleMouseLeave:function(e){graphite.events.trigger("item-hovered-over",[],!0);graphite.events.trigger("mouseMoved",null,!0)},removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)},isItemSelected:function(e){return e?e.get("selected"):!1}});return d});define("ccweb.files.extract/views/templates/artboardOverlayTemplate.html",[],function(){return'<div id="artboardOverlay"></div>'});define("ccweb.files.extract/views/preview/ArtboardOverlayView",["jquery","underscore","backbone","ccweb.files.extract/Constants","ccweb.files.extract/utils/KeyboardUtils","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/ZoomController","ccweb.files.extract/views/templates/artboardOverlayTemplate.html"],function(e,t,i,s,n,r,a,o,l){"use strict";var c=i.View.extend({psdModel:null,initialize:function(e){this.psdModel=e.model;this.render();graphite.events.on("drawPreviewFinish",this.handleDrawPreviewFinish,this);graphite.events.on("selection-changed",this.handleSelectionChange,this);graphite.events.on("zoomChanged",this.removeLabels,this);graphite.events.on("zoomCompleted",this.placeLabels,this)},render:function(){this.setElement(r.createTemplate(l))},handleDrawPreviewFinish:function(){this.placeLabels()},handleSelectionChange:function(){var t=a.getSelectedLayers(),i=this;this.$el.find(".artboardLabel").removeClass("selected");e.each(t,function(e,t){t.get("type")===s.Type.LAYER_ARTBOARD&&i.$el.find("#ArtboardLabel"+t.get("layerId")).addClass("selected")})},onLabelClick:function(t){var i=e(t.target).data("layerModel");a.changeSelection([i],n.isMultiSelectKey(t),!0);if(t.altKey){graphite.events.trigger("zoomToFit",i.get("bounds"));graphite.events.trigger("artboard-zoomToFit")}t.stopPropagation()},onLabelHoverIn:function(t){var i=e(t.target).data("layerModel");i&&!i.get("selected")&&graphite.events.trigger("item-hovered-over",[i],!0)},onLabelHoverOut:function(e){graphite.events.trigger("item-hovered-over",[],!0)},placeLabels:function(){var t=this,i=null;this.psdModel&&this.psdModel.get("layerCollection")&&!o.isZooming()&&this.psdModel.get("layerCollection").each(function(n){var r=null;if(n.get("type")===s.Type.LAYER_ARTBOARD){r=e("<div/>");r.attr("id","ArtboardLabel"+n.get("layerId"));r.text(n.get("layerName"));r.attr("title",n.get("layerName"));r.addClass("artboardLabel");r.data("layerModel",n);t.$el.append(r);i=o.zoomRect(n.get("bounds"));r.css({top:i.top-16,left:i.left+1,maxwidth:i.right-i.left-2});r.hover(t.onLabelHoverIn,t.onLabelHoverOut);r.bind("click",t.onLabelClick)}})},removeLabels:function(){this.$el.find(".artboardLabel").remove()},removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)}});return c});define("ccweb.files.extract/views/popup/BasePreviewPopupView",["jquery","underscore","backbone","./BasePopupView"],function(e,t,i,s){"use strict";var n=s.extend({events:{mouseenter:"handleMouseEnter",mouseleave:"handleMouseLeave"},handleMouseDown:function(e){e.stopPropagation()},handleShow:function(t){if(void 0!==this.$el.parent().offset()){this.source=t.sourceElement;this.source||(this.source=null);this.$el.show();this.positionPopup();this.isMouseOver=!1;e(window).on("mousedown",e.proxy(this.handleMouseDown,this))}},positionPopup:function(){var t=e("div.psd-preview-view"),i=e("div.preview-container"),s=this.$el.find(".notch"),n=this.$el.parent().width(),r=this.getSourceOuterHeight(),a=this.getSourceOuterWidth()||n,o=this.$el.outerHeight(),l=this.$el.outerWidth(),c=t.width()-10,d=t.height(),h=parseFloat(i.css("margin-left")),p=t.scrollLeft(),u=t.scrollTop(),f=s.height(),g=s.width(),m=0,v=this.getSourceYOffset()+r+f-4,y=this.getSourceXOffset()+(a-l)/2,b=!1,w=e("div.center-helper"),x=w.outerHeight(!0);Math.abs(parseInt(w.css("margin-bottom"),10))>x&&(x=0);this.$el.removeClass("top bottom");if(v+o+f>d+u-x){b=!0;v=this.getSourceYOffset()-o+4}if(u-x>v){b=!0;v=this.getSourceYOffset()+r-o+3;if(v+o+f>d+u-x){b=!1;v=this.getSourceYOffset()+f-4}}this.$el.addClass(b?"top":"bottom");s.css("left",Math.round((l-g)/2));if(p>y){m=Math.min(p-y,(l-g)/2);s.css("left",(l-g)/2-m);y=p}if(y+l>c+p-h){m=Math.min(y-(c+p-h-l),(l-g)/2);s.css("left",(l-g)/2+m);y=c+p-h-l}this.$el.css({top:v,left:Math.round(y)})},getSourceXOffset:function(){return Math.max(0,this.source.offset().left-this.$el.parent().offset().left)},getSourceYOffset:function(){return Math.max(0,this.source.offset().top-this.$el.parent().offset().top)},getSourceOuterWidth:function(){return this.source.outerWidth()},getSourceOuterHeight:function(){return this.source.outerHeight()}});return n});define("ccweb.files.extract/views/templates/shiftClickMeasurementNotificationTemplate.html",[],function(){return'<div id="shiftClickMeasurementNotification" class="shiftClickMeasurementNotification">\n    <button class="closeButton">×</button>\n    <span class="notificationText"><%-translate("You can Shift-Click to measure, or select multiple layers and save them as one image.")%></span>\n</div>\n'});define("ccweb.files.extract/views/popup/ShiftClickNotificationView",["underscore","backbone","ccweb.files.extract/Constants","ccweb.files.extract/models/UserSettingsModel","ccweb.files.extract/views/popup/BasePreviewPopupView","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/shiftClickMeasurementNotificationTemplate.html"],function(e,t,i,s,n,r,a){"use strict";var o=t.View.extend({events:{"click .closeButton":"handleCloseClick"},initialize:function(){this.render();window.graphite.events.trigger("measurement-notification-shown")},render:function(){this.$el.html(r.createTemplate(a));return this},handleCloseClick:function(e){e.stopPropagation();var t=this.$el.parent(),n=this.$el.outerHeight(),r=t.position().top;this.$el.remove();t.hasClass("top")&&t.css({top:r+n});s.setInterceptShown(i.InterceptNames.SHIFT_CLICK_MEASUREMENT,!1);window.graphite.events.trigger("measurement-notification-closed")}});return o});define("ccweb.files.extract/views/templates/measurementPopupTemplate.html",[],function(){return'<div id="measurementPopupInfo">\n    <div id="measurementPreferredUnits" class="measurementPreferredUnits"><span id="preferredUnitPx" class="selectedUnit">PX</span><br/><span id="preferredUnitPct">%</span></div>\n    <div class="measurementElementInfoDim">W: <span class="copyable width">0</span> <br/>H: <span class="copyable height">0</span></div>\n    <div class="measurementElementInfoPos">X: <span class="copyable x">0</span> <br/>Y: <span class="copyable y">0</span></div>\n    <div class="measurementElementCopyControls"><span id="copyCSSLink" class="copyable"><%-translate("Copy CSS")%></span><br/><span id="copyTextLink" class="copyable"><%-translate("Copy Text")%></span></div>\n    <div class="measurementElementAssetExtract" title=\'<%-translate("Extract asset")%>\'></div>\n    <div class="extractAssetPopupContainer"></div>\n</div>\n'});define("ccweb.files.extract/views/popup/MeasurementPopupView",["jquery","underscore","backbone","ccweb.files.extract/Constants","ccweb.files.extract/views/popup/BasePreviewPopupView","plugin-dependencies","ccweb.files.extract/controllers/ClipboardController","ccweb.files.extract/controllers/ZoomController","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/models/LayerModelMap","ccweb.files.extract/models/PSDSettingsModel","ccweb.files.extract/models/UserSettingsModel","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/utils/MeasurementUtil","ccweb.files.extract/utils/UTF8","ccweb.files.extract/views/popup/ShiftClickNotificationView","ccweb.files.extract/views/templates/measurementPopupTemplate.html"],function(e,t,i,s,n,r,a,o,l,c,d,h,p,u,f,g,m){"use strict";var v=n.extend({className:"measurementPopup popup blueHUD",sourceElement:null,layerModel:null,layerList:null,displayWidth:null,displayHeight:null,displayX:null,displayY:null,extractAssetPopup:null,events:{"click #preferredUnitPx":"handlePreferredMeasurementUnitChange","mousedown #preferredUnitPx":"handleMouseDown","click #preferredUnitPct":"handlePreferredMeasurementUnitChange","mousedown #preferredUnitPct":"handleMouseDown","click #copyCSSLink":"handleCopyableClick","mousedown #copyCSSLink":"handleMouseDown","click #copyTextLink":"handleCopyableClick","click .copyable":"handleCopyableClick","mousedown #copyTextLink":"handleMouseDown"},initialize:function(){n.prototype.initialize.apply(this,arguments);this.initCopyToClipboard();graphite.events.on("layerVisiblityChanged",this.layerVisiblityChanged,this);graphite.events.on("designedAtMultiplierChanged",this.designedAtMultiplierChanged,this)},show:function(){this.$el.show()},hide:function(){this.$el.hide()},render:function(){n.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(p.createTemplate(m));var t=this.$el.find("#copyCSSLink"),i=this.$el.find("#copyTextLink"),a=this.$el.find(".measurementElementAssetExtract"),o=this.$el.find(".copyable");h.get("preferredMeasurementUnits")!==s.MeasurementUnitType.PX&&this.$el.find("#measurementPreferredUnits span").toggleClass("selectedUnit");t.html(r.translate("Copy CSS"));i.html(r.translate("Copy Text"));o.attr("title",r.translate("Click to copy"));o.hover(this.highlightLabel,this.unhighlightLabel);var l=this;a.click(function(t){graphite.events.trigger("show-extract-asset-popup",{type:"new",sourceElement:a,origin:"measurementPopup"});l.extractAssetPopup=e(".extract-asset-popup");l.$el.parent().append(l.extractAssetPopup);graphite.events.once("hide-extract-asset-popup",function(){if(l.extractAssetPopup){e("div.extract-plugin").append(l.extractAssetPopup);delete l.extractAssetPopup}});var i=new n;i.$el=l.extractAssetPopup;i.source=a;i.positionPopup();t.stopPropagation()});this.layerVisiblityChanged();return this},layerVisiblityChanged:function(e){l.canExtractAsset()?this.$el.find(".measurementElementAssetExtract").css("display","inline-block"):this.$el.find(".measurementElementAssetExtract").css("display","none")},initCopyToClipboard:function(){var i=this,n=a.getClipboard(),o=this.$el.find(".copyable"),l=this.$el.find("#copyTextLink"),c=this.$el.find("#copyCSSLink");t.each(o,function(e){n.clip(e)});graphite.events.on("clipboard-data-requested",function(t){if(t===l[0]){if(i.layerModel&&i.layerModel.get("type")===s.Type.LAYER_TEXT){var a=e.trim(i.layerModel.get("properties").get("rawText"));a.indexOf("￿ff")>=0&&(a=f.decodeCharacters(a));n.setText(a);graphite.events.trigger("copy-text");i.showSuccessTooltip(r.translate("Text copied to clipboard"))}}else if(t===c[0]){if(i.layerModel){var o=i.layerModel.getCSSAsString(!0,h.get("preprocessor"));n.setText(o);graphite.events.trigger("copy-css",{origin:"HUD"});i.showSuccessTooltip(r.translate("CSS copied to clipboard"))}}else e(t).hasClass("copyable")&&this.handleCopyableElement(e(t))},this)},handleCopyableElement:function(e){var t,i=a.getClipboard(),s=r.translate("Value copied to clipboard");if(e.hasClass("width")||e.hasClass("height")){t="width: "+this.displayWidth+";\nheight: "+this.displayHeight+";";s=r.translate("Size copied to clipboard")}else if(e.hasClass("x")||e.hasClass("y")){t="top: "+this.displayY+"px;\nleft: "+this.displayX+"px;";s=r.translate("Position copied to clipboard")}else t=e.text();i.setText(t);graphite.events.trigger("copy-value",{origin:"HUD"});this.showSuccessTooltip(s)},showSuccessTooltip:function(t){var i=this.$el.parent().get(0);e(i).append('<div id="notificationTooltip" style="display:none"><span>'+t+"</span></div>");var n=e("#notificationTooltip"),r=n.width(),a=n.height(),l=this.layerModel?this.layerModel.attributes.bounds:this.layerGroupBounds,c=(l.left+(l.right-l.left)/2)*o.getZoomLevel()-r/2,d=(l.top+(l.bottom-l.top)/2)*o.getZoomLevel()-a/2;n.css({top:d,left:c});n.fadeIn(250);setTimeout(function(){n.remove()},s.toolTipTimeout)},designedAtMultiplierChanged:function(){this.handleShowMeasurementInfo(this.layerList?{layerList:this.layerList}:{layerModel:this.layerModel})},handleCopyableClick:function(e){e.stopPropagation()},highlightLabel:function(){e(this).addClass("zeroclipboard-is-hover")},unhighlightLabel:function(){e(this).removeClass("zeroclipboard-is-hover")},handlePreferredMeasurementUnitChange:function(e){var t="preferredUnitPx"===e.target.id?s.MeasurementUnitType.PX:s.MeasurementUnitType.PCT;if(t!==h.get("preferredMeasurementUnits")){h.set("preferredMeasurementUnits",t);this.$el.find("#measurementPreferredUnits span").toggleClass("selectedUnit");this.sourceElement=null;this.handleShowMeasurementInfo(this.layerList?{layerList:this.layerList}:{layerModel:this.layerModel});graphite.events.trigger("preferredMeasurementUnitsChanged",{preferredMeasurementUnits:t})}e.stopPropagation()},handleShowMeasurementInfo:function(e){var i,n,r,a,o,c,p=this.$el.find(".measurementElementInfoDim"),f=this.$el.find(".measurementElementInfoPos"),g=l.getPSDModel(),m=d.get("designedAtMultiplier"),v=!1;this.layerModel=null;this.layerList=null;this.layerGroupBounds=null;i=g.get("imgdata").bounds;if(e.layerList instanceof Array){n=u.calcLayerGroupBounds(e.layerList,g);if(2===e.layerList.length&&h.get("preferredMeasurementUnits")===s.MeasurementUnitType.PCT){o=u.getVisibleBounds(e.layerList[0],g);c=u.getVisibleBounds(e.layerList[1],g);r=e.layerList[0].getArtboardParent();a=e.layerList[1].getArtboardParent();if(g.get("isArtboardPSD")&&r&&r===a)i=r.get("bounds");else if(u.rect1ContainsRect2(o,c)){n=c;i=o}else if(u.rect1ContainsRect2(c,o)){n=o;i=c}}}else{r=e.layerModel.getArtboardParent();if(g.get("isArtboardPSD")&&r&&r!==e.layerModel){i=r.get("bounds");v=!0}n=u.getVisibleBounds(e.layerModel,g)}var y=u.getMeasurementsOfRectInsideRect(n,i,v);if(g.get("isArtboardPSD")&&r&&r!==e.layerModel){this.displayX=Math.round(y.displayLeft/m);this.displayY=Math.round(y.displayTop/m)}else{this.displayX=y.displayLeft;this.displayY=y.displayTop}this.displayWidth=y.displayWidth;this.displayHeight=y.displayHeight;f.find(".x").text(this.displayX+"px");f.find(".y").text(this.displayY+"px");p.find(".width").text(y.displayWidth);p.find(".height").text(y.displayHeight);if(e.layerList instanceof Array){this.layerList=e.layerList;this.lastMeasuredBounds=t.clone(n);this.layerGroupBounds=e.layerList[0].attributes.bounds;this.placePopupOutOfTheWay(e.layerList)}else{this.layerModel=e.layerModel;this.placePopupRelativeToLayerElement(e.layerModel)}},placePopupRelativeToLayerElement:function(i){var n,r=this.$el.find(".notch"),a=this.$el.find("#copyTextLink"),d=this.$el.find(".measurementElementInfoPos"),p=l.getPSDModel();r.show();d.show();i&&i.get("type")===s.Type.LAYER_TEXT?a.removeClass("disabled"):a.addClass("disabled");if(i){var f=c.getLayerInfoForId(i.attributes.layerId).item;if(this.sourceElement!==f){this.sourceElement=f;n=u.getVisibleBounds(i,p);this.lastMeasuredBounds=t.clone(n);this.layerBounds=o.zoomRect(n);var m=null,v=this.$el.find("#shiftClickMeasurementNotification");if(0===v.length&&h.shouldInterceptBeShown(s.InterceptNames.SHIFT_CLICK_MEASUREMENT)){m=new g;this.$el.append(m.$el);this.$el.find("#shiftClickMeasurementNotification").css({width:Math.floor(this.$el.width()-9)})}this.handleShow({sourceElement:e(this.sourceElement)});m&&this.$el.hasClass("top")&&this.$el.prepend(m.$el)}}else{this.closePopup();this.sourceElement=null}},placePopupOutOfTheWay:function(t){var i,s,n,r=this.$el.find(".notch"),a=this.$el.find(".measurementElementInfoPos"),o=this.$el.find("#copyCSSLink"),l=this.$el.find("#copyTextLink"),c=e("#popupOverlay"),d=e("div.psd-preview-view"),h=d.scrollLeft(),p=d.scrollTop(),f=d.height(),g=d.width()-10,m=Math.min(g,this.$el.parent().width()),v=Math.min(f,this.$el.parent().height()),y=Math.min(Math.floor(v/10),90);r.hide();a.hide();o.addClass("disabled");l.addClass("disabled");var b={left:(m-this.$el.outerWidth())/2+h,top:(v-this.$el.outerHeight())/2+p,right:(m+this.$el.outerWidth())/2+h,bottom:(v+this.$el.outerHeight())/2+p};if(2===t.length){i=c.find("div.measurementOffsetsBanner");s=i.first();n=i.slice(1).first();var w=parseInt(s.css("left"),10),x=parseInt(s.parent().css("left"),10),S=s.parent().parent().offset().left,C=parseInt(s.css("top"),10),T=parseInt(s.parent().css("top"),10),I=s.parent().parent().offset().top,E=w+x+S-c.offset().left,P=C+T+I-c.offset().top,M={left:E,top:P,right:E+s.outerWidth(),bottom:P+s.outerHeight()},L={left:0,top:0,right:0,bottom:0};if(1===n.length){w=parseInt(n.css("left"),10);x=parseInt(n.parent().css("left"),10);S=n.parent().parent().offset().left;C=parseInt(n.css("top"),10);T=parseInt(n.parent().css("top"),10);I=n.parent().parent().offset().top;E=w+x+S-c.offset().left;P=C+T+I-c.offset().top;L={left:E,top:P,right:E+n.outerWidth(),bottom:P+n.outerHeight()}}if(u.boundsIntersect(M,b)||u.boundsIntersect(L,b)){b.top=y+d.scrollTop();b.bottom=b.top+this.$el.outerHeight();if(u.boundsIntersect(M,b)||u.boundsIntersect(L,b)){b.top=v-this.$el.outerHeight()-y+e("div.psd-preview-view").scrollTop();b.bottom=b.top+this.$el.outerHeight()}}}this.$el.show();this.$el.css({left:b.left,top:b.top})},getSourceXOffset:function(){return this.layerBounds.left},getSourceYOffset:function(){return this.layerBounds.top},getSourceOuterWidth:function(){return this.layerBounds.right-this.layerBounds.left},getSourceOuterHeight:function(){return this.layerBounds.bottom-this.layerBounds.top},destroy:function(){this.extractAssetPopup&&graphite.events.trigger("hide-extract-asset-popup");graphite.events.off(null,null,this)}});return v});define("ccweb.files.extract/views/templates/measurementOffsetsBoxTemplate.html",[],function(){return'<div id="measurementOffsetsBox" class="measurementOffsetsBox">\n    <canvas id="measurementOffsetsCanvas" class="measurementOffsetsCanvas">\n    </canvas>\n</div>'});define("ccweb.files.extract/views/templates/measurementOffsetsBannerTemplate.html",[],function(){return'<div id="measurementOffsetsBanner" class="measurementOffsetsBanner measurementPopup popup measurementTooltip">\n    <span id="measurementOffsetX" class="noWrap copyable"><i class="xOffsetIcon"></i>20</span><br/>\n    <span id="measurementOffsetY" class="noWrap copyable"><i class="yOffsetIcon"></i>200</span>\n    <div class="notch"></div>\n</div>'});define("ccweb.files.extract/views/popup/MeasurementOffsetPopupView",["jquery","underscore","backbone","ccweb.files.extract/Constants","ccweb.files.extract/views/popup/BasePreviewPopupView","ccweb.files.extract/controllers/ZoomController","ccweb.files.extract/controllers/ClipboardController","ccweb.files.extract/models/PSDSettingsModel","ccweb.files.extract/models/UserSettingsModel","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/measurementOffsetsBoxTemplate.html","ccweb.files.extract/views/templates/measurementOffsetsBannerTemplate.html"],function(e,t,i,s,n,r,a,o,l,c,d,h){"use strict";var p=n.extend({showParams:null,initialize:function(){n.prototype.initialize.apply(this,arguments);graphite.events.on("preferredMeasurementUnitsChanged",this.handlePreferredMeasurementUnitsChanged,this);graphite.events.on("designedAtMultiplierChanged",this.designedAtMultiplierChanged,this)},render:function(){n.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(c.createTemplate(d));return this},designedAtMultiplierChanged:function(){this.updateMeasurementDisplay()},handlePreferredMeasurementUnitsChanged:function(){this.updateMeasurementDisplay()},handleShowMeasurementInfo:function(i){this.showParams=e.extend(!0,{},i);if(i.bounds){graphite.events.trigger("show-measurement-offsets");var s=this.$el.find("#measurementOffsetsBox"),n=r.zoomRect(i.bounds),o=n.width-2,l=n.height-2;s.css({top:n.top+"px",left:n.left+"px",height:Math.max(1,l),width:Math.max(1,o)});var d=this.$el.find("#measurementOffsetsCanvas");d[0].width=Math.max(1,n.width);d[0].height=Math.max(1,n.height);var p=d[0].getContext("2d");this.$el.show();p.lineWidth=1;p.strokeStyle="#000";var u=3,f=Math.floor(o/2)+.5,g=Math.floor(l/2)+.5;p.moveTo(0,g);if(l>=5){if(o>2*(u+3)){p.lineTo(u,g-u);p.stroke();p.moveTo(0,g);p.lineTo(u,g+u);p.stroke();p.moveTo(0,g)}p.lineTo(o,g);p.stroke();if(o>2*(u+3)){p.lineTo(o-u,g-u);p.stroke();p.moveTo(o,g);p.lineTo(o-u,g+u);p.stroke()}}if(o>=5){if(l>2*(u+3)){p.moveTo(f,0);p.lineTo(f-u,u);p.stroke();p.moveTo(f,0);p.lineTo(f+u,u);p.stroke()}p.moveTo(f,0);p.lineTo(f,l);p.stroke();if(l>2*(u+3)){p.lineTo(f-u,l-u);p.stroke();p.moveTo(f,l);p.lineTo(f+u,l-u);p.stroke()}}s.append(c.createTemplate(h));var m=this.$el.find(".copyable"),v=a.getClipboard();t.each(m,function(e){v.clip(e)});this.updateMeasurementDisplay();var y=this.$el.find("#measurementOffsetsBanner");y.click(function(e){e.stopPropagation()});var b=this.$el.find(".notch");b.show();var w=(o-y.outerWidth())/2,x=0;if(o>=y.outerWidth()+2*(u+3)&&l>=y.outerHeight()+2*(u+3)){x=(l-y.outerHeight())/2;b.hide()}else{x=l+6;x+y.outerHeight()>e("#selection-overlay").height()&&(x=-y.outerHeight()-6)}y.css({top:x+"px",left:w+"px"});var S=20,C=Math.round((y.outerWidth()-S)/2);b.css({left:C,top:"-6px"})}else this.closePopup()},updateMeasurementDisplay:function(){var t=e.extend(!0,{},this.showParams),i=l.get("preferredMeasurementUnits"),n=o.get("designedAtMultiplier");if(i===s.MeasurementUnitType.PCT){t.containerBounds.width=t.containerBounds.right-t.containerBounds.left;t.containerBounds.height=t.containerBounds.bottom-t.containerBounds.top;t.bounds.width=+(t.bounds.width/t.containerBounds.width*100).toFixed(1);t.bounds.height=+(t.bounds.height/t.containerBounds.height*100).toFixed(1)}else{t.bounds.width=Math.round(t.bounds.width/n);t.bounds.height=Math.round(t.bounds.height/n)}this.$el.find("#measurementOffsetX").html('<i class="xOffsetIcon"></i>'+t.bounds.width+i);this.$el.find("#measurementOffsetY").html('<i class="yOffsetIcon"></i>'+t.bounds.height+i)}});return p});define("ccweb.files.extract/views/templates/measurementTooltipTemplate.html",[],function(){return'<div id="measurementTooltipInfo" class="measurementTooltip">\n    <div class="measurementElementInfoDim">W: 0 <br/>H: 0</div>\n    <div class="measurementElementInfoPos">X: 0 <br/>Y: 0</div>\n</div>'});define("ccweb.files.extract/views/templates/popupOverlayTemplate.html",[],function(){return'<div id="popupOverlay"></div>'});define("ccweb.files.extract/views/preview/PopupOverlayView",["jquery","underscore","backbone","ccweb.files.extract/Constants","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/ZoomController","ccweb.files.extract/models/UserSettingsModel","ccweb.files.extract/utils/MeasurementUtil","ccweb.files.extract/utils/ScrollUtils","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/popup/MeasurementPopupView","ccweb.files.extract/views/popup/MeasurementOffsetPopupView","ccweb.files.extract/views/templates/measurementTooltipTemplate.html","ccweb.files.extract/views/templates/popupOverlayTemplate.html"],function(e,t,i,s,n,r,a,o,l,c,d,h,p,u){"use strict";var f=i.View.extend({bShowMeasurementOnHover:!1,measurementPopupView:null,measurementTooltip:null,mouseOverElement:null,lastMouseX:0,lastMouseY:0,lastItemMousedOver:null,initialize:function(){this.bShowMeasurementOnHover=!1;this.measurementTooltip=null;this.mouseOverElement=null;this.render()},render:function(){this.setElement(c.createTemplate(u));var e=c.createTemplate(p);this.$el.append(e);this.measurementTooltip=this.$el.find("#measurementTooltipInfo");this.measurementTooltip.hide();this.addHandlers()},addHandlers:function(){graphite.events.on("selection-changed",this.refreshSelection,this);graphite.events.on("preview-scroll-end",this.showMeasurementPopups,this);graphite.events.on("zoomChanged",this.handleZoomChanged,this);graphite.events.on("toggle-hover-measurement",this.toggleHoverMeasurement,this);graphite.events.on("multiSelectPending",this.handleMultiSelectPending,this);graphite.events.on("mouseMoved",this.handleMouseMoved,this)},handleMouseMoved:function(e){if(e){this.bShowMeasurementOnHover&&e.itemMousedOver?this.syncMeasurementTooltip(e.x,e.y,e.itemMousedOver):this.measurementTooltip.hide();this.lastMouseX=e.x;this.lastMouseY=e.y;this.lastItemMousedOver=e.itemMousedOver}else{this.lastItemMousedOver=null;this.measurementTooltip.hide()}},handleMultiSelectPending:function(e){this.isMultiSelectPending=e;this.measurementPopupView&&(e?this.measurementPopupView.hide():this.measurementPopupView.show())},handleZoomChanged:function(){this.refreshSelection()},refreshSelection:function(){var e=this;this.$el.children().remove();t.delay(function(){l.isScrollNeeded||e.showMeasurementPopups()},50)},showMeasurementPopups:function(){var e,t,i,r,l=n.getSelectedLayers(),c=n.getPSDModel();if(this.measurementPopupView){this.measurementPopupView.destroy();this.measurementPopupView=null}this.measurementTooltip.hide();this.$el.append(this.measurementTooltip);this.bShowMeasurementOnHover&&this.lastItemMousedOver&&this.syncMeasurementTooltip(this.lastMouseX,this.lastMouseY,this.lastItemMousedOver);if(1===l.length){i=l[0];e=new d;this.measurementPopupView=e;this.$el.append(e.el);e.handleShowMeasurementInfo({layerModel:i})}else if(2===l.length){var p,u=o.getVisibleBounds(l[0],c),f=o.getVisibleBounds(l[1],c);if(o.rect1ContainsRect2(u,f))p=u;else if(o.rect1ContainsRect2(f,u))p=f;else{var g=l[0],m=l[1],v=g.getArtboardParent(),y=m.getArtboardParent();p=c.get("isArtboardPSD")&&v&&v===y?v.get("bounds"):c.get("imgdata").bounds}r={top:0,left:0,right:0,bottom:0,height:100,width:100};if(u.top>=f.bottom){r.top=f.bottom;r.height=u.top-f.bottom}else if(f.top>=u.bottom){r.top=u.bottom;r.height=f.top-u.bottom}else{r.top=Math.min(u.top,f.top);r.height=Math.abs(u.top-f.top)}if(u.left>f.right){r.left=f.right;r.width=u.left-f.right}else if(f.left>u.right){r.left=u.right;r.width=f.left-u.right}else{r.left=Math.min(u.left,f.left);r.width=Math.abs(u.left-f.left)}r.right=r.left+r.width;r.bottom=r.top+r.height;t=new h;this.$el.append(t.el);t.handleShowMeasurementInfo({bounds:r,containerBounds:p});if(o.rect1ContainsRect2(u,f)||o.rect1ContainsRect2(f,u)){r.left=Math.min(u.right,f.right);r.width=Math.abs(u.right-f.right);r.top=Math.min(u.bottom,f.bottom);r.height=Math.abs(u.bottom-f.bottom);r.right=r.left+r.width;r.bottom=r.top+r.height;t=new h;this.$el.append(t.el);t.handleShowMeasurementInfo({bounds:r,containerBounds:p})}}if(l.length>=2){a.setInterceptShown(s.InterceptNames.SHIFT_CLICK_MEASUREMENT,!1);
e=new d;this.measurementPopupView=e;this.$el.append(e.el);e.handleShowMeasurementInfo({layerList:l})}this.isMultiSelectPending&&e&&e.hide()},positionMeasurementTooltip:function(t,i){this.measurementTooltip.css({left:0,top:0,width:"auto"});var s=this.$el.offset(),n=this.measurementTooltip.width(),r=Math.min(t-s.left+3,this.$el.width()-n,e("#detail-panel").offset().left-n-s.left),a=Math.max(i-s.top-58,0);this.measurementTooltip.css({left:r,top:a,width:n+1+"px"})},syncMeasurementTooltip:function(e,t,i){if(i){if(i!==this.mouseOverElement){this.mouseOverElement=i;var s=o.getMeasurementsOfLayerAgainstPSDBounds(i);this.measurementTooltip.find(".measurementElementInfoDim").html("W: "+s.displayWidth+"<br/> H: "+s.displayHeight);this.measurementTooltip.find(".measurementElementInfoPos").html("X: "+s.left+"px<br/> Y: "+s.top+"px")}this.positionMeasurementTooltip(e,t);this.measurementTooltip.show()}else this.measurementTooltip.hide()},toggleHoverMeasurement:function(){this.bShowMeasurementOnHover=!this.bShowMeasurementOnHover;this.bShowMeasurementOnHover?this.syncMeasurementTooltip(this.lastMouseX,this.lastMouseY,this.lastItemMousedOver):this.measurementTooltip.hide()},removeEventListeners:function(){graphite.events.off(null,null,this)},remove:function(){this.removeEventListeners();return i.View.prototype.remove.call(this)}});return f});define("ccweb.files.extract/views/templates/lensTemplate.html",[],function(){return'<div class="lens" style="display: none;">\n    <div class="inner">\n        <canvas class="lens-grid" width="70" height="70"></canvas>\n        <div class="center"></div>\n    </div>\n</div>'});define("ccweb.files.extract/views/templates/workerProgressTemplate.html",[],function(){return'<div id="workerProgress">\n    <div class="worker-status">Processing...</div>\n    <div class="worker-progress-base"><div class="worker-progress-bar"></div></div>\n    <div class="worker-status-tip"><%- tip %></div>\n</div>'});define("ccweb.files.extract/views/templates/psdPreviewTemplate.html",[],function(){return'<% var w = width || imgdata.bounds.right; %>\n<% var h = height || imgdata.bounds.bottom; %>\n<div class="preview-container" style="width: <%- w %>px; height: <%- h %>px;">\n    <div style="width: <%- w %>px; height: <%- h %>px;" id="psdpreview_bg"></div>\n    <div style="width: <%- w %>px; height: <%- h %>px;" id="psdpreview_root"></div>\n    <img style="width: <%- w %>px; height: <%- h %>px;" id="tempPreview" class="tempPreview">\n    <div id="selection-overlay" style=" width: <%- w %>px; height: <%- h %>px;"></div>\n</div>\n<div class="spinner"></div>'});define("ccweb.files.extract/views/templates/psdPreviewDivSpriteSheetTemplate.html",[],function(){return'<div class="psd-layer-group" style="top: <%- bounds.top %>px; left: <%- bounds.left %>px; bottom: <%- bounds.bottom %>px; right: <%- bounds.right %>px;" ></div>\n'});define("ccweb.files.extract/views/templates/psdPreviewLayerTemplate.html",[],function(){return'<canvas class="psd-layer" style="top: <%- bounds.top %>px; left: <%- bounds.left %>px;" ></canvas>\n'});define("ccweb.files.extract/views/templates/errorNotificationTemplate.html",[],function(){return'<div class="error-notification">\n    <div class="centered-wrapper">\n        <div class="error-icon"></div>\n        <div class="error-msg"><%- messageText %><%= anchor %></div>\n    </div>\n</div>\n'});define("ccweb.files.extract/cceco/StorageServiceAPI",["jquery","plugin-dependencies"],function(e,t){"use strict";var i={storagePath:function(i){var s=e.Deferred(),n={type:"HEAD",url:"https://cc-api-storage-stage.adobe.io/resolve?id="+i,headers:{authorization:t.auth.token,"x-api-key":"webpagraphics"}};e.ajax(n).fail(function(e,t,i){s.reject(e)}).done(function(e,t,i){s.resolve(i.getResponseHeader("Content-Location"))});return s.promise()},storageId:function(t){var i=e.Deferred(),s=this.metadataOptions(t);e.ajax(s).fail(function(e,t,s){i.resolve(["",""])}).done(function(e,t,s){i.resolve(e.id.split("/"))});return i.promise()},assetDirectory:function(t){var i=e.Deferred(),s=this;this.storagePath(t).then(function(e){i.resolve(s.assetDirectoryPath(e))},function(e){i.reject(e)});return i.promise()},assetDirectoryPath:function(e){var t=e.lastIndexOf(".");-1!==t&&(e=e.substr(0,t));return e+"-assets"},fetchContents:function(i){var s=e.Deferred(),n={type:"GET",url:"https://cc-api-storage-stage.adobe.io"+i,headers:{authorization:t.auth.token,"x-api-key":"webpagraphics"}};e.ajax(n).fail(function(e,t,i){s.reject(e)}).done(function(e,t,i){s.resolve(e,i.getResponseHeader("etag"))});return s.promise()},storeContents:function(i,s,n){var r=e.Deferred(),a={type:"PUT",url:"https://cc-api-storage-stage.adobe.io"+i,headers:{authorization:t.auth.token,"x-api-key":"webpagraphics","content-type":"*/*"},dataType:"text",data:n};s&&(a.headers["if-match"]=s);e.ajax(a).fail(function(e,t,i){r.reject(e)}).done(function(e,t,i){r.resolve(i.getResponseHeader("etag"))});return r.promise()},renditionURL:function(e,i,s){return"https://cc-api-storage-stage.adobe.io"+e+"/:rendition;size="+s+"?accept="+i+"&api_key=webpagraphics&user_token="+t.auth.token.substring(7)},downloadURL:function(e,i){return"https://cc-api-storage-stage.adobe.io"+e+"?content_disposition=attachment;filename="+encodeURIComponent(i)+"&api_key=webpagraphics&user_token="+t.auth.token.substring(7)},metadataOptions:function(e){return{type:"GET",url:"https://cc-api-storage-stage.adobe.io"+e+"/:metadata",headers:{authorization:t.auth.token,"x-api-key":"webpagraphics"}}},archive:function(i){var s=e.Deferred();e.ajax(this.metadataOptions(i)).fail(function(e,t,i){s.reject(e)}).done(function(n,r,a){var o={type:"PUT",url:"https://cc-api-storage-stage.adobe.io/archive/"+encodeURI(i.substring(i.lastIndexOf("/")+1))+"?invocation_mode=async",headers:{authorization:t.auth.token,"x-api-key":"webpagraphics",link:"<"+i.substring(1)+">;rel=self",accept:"application/vnd.adobe.file+json, application/vnd.adobe.directory+json","if-match":n.etag}};e.ajax(o).fail(function(e,t,i){s.reject(e)}).done(function(e,t,i){s.resolve(i)})});return s.promise()}};return i});define("ccweb.files.extract/views/preview/PSDPreviewView",["jquery","underscore","backbone","ccweb.files.extract/Constants","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/controllers/ZoomController","ccweb.files.extract/controllers/FlattenedAssetController","ccweb.files.extract/models/LayerModelMap","ccweb.files.extract/utils/KeyboardUtils","ccweb.files.extract/utils/ScrollUtils","ccweb.files.extract/views/preview/InspectStyleOverlayView","ccweb.files.extract/views/preview/SelectionOverlayView","ccweb.files.extract/views/preview/MouseListenerOverlayView","ccweb.files.extract/views/preview/ArtboardOverlayView","ccweb.files.extract/views/preview/PopupOverlayView","ccweb.files.extract/utils/MeasurementUtil","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/lensTemplate.html","ccweb.files.extract/views/templates/workerProgressTemplate.html","ccweb.files.extract/views/templates/psdPreviewTemplate.html","ccweb.files.extract/views/templates/psdPreviewDivSpriteSheetTemplate.html","ccweb.files.extract/views/templates/psdPreviewLayerTemplate.html","ccweb.files.extract/views/templates/errorNotificationTemplate.html","plugin-dependencies","plugin-components/image-loader","ccweb.files.extract/cceco/StorageServiceAPI"],function(e,t,i,s,n,r,a,o,l,c,d,h,p,u,f,g,m,v,y,b,w,x,S,C,T,I,E){"use strict";var P=i.View.extend({className:"psd-preview-view",events:{click:"handleClickEvent",mousedown:"handleMouseDownEvent",mouseup:"handleMouseUpEvent",dblclick:"handleDoubleClickEvent"},isClickDrag:!1,extractionStartTime:null,selectionOverlay:null,inspectStyleOverlay:null,mouseListenerOverlay:null,artboardOverlay:null,popupOverlay:null,extractTooltip:null,tempPreviewHidden:!1,initialize:function(){t.bindAll(this,"hideTempPreview","attached","_previewImageDataReceived");this.addHandlers();this.renderProgressPane();this.$defocused=e('<div class="defocused"></div>');this.model.on("change:info",this.handleModelInfoChanged,this);this.model.on("change:extractedStyles",this.handleExtractedStylesChanged,this);this.model.on("change:status",this.handleStatusChanged,this);this.handleStatusChanged()},render:function(){this.renderContainer();this.inspectStyleOverlay=new h({model:this.model});this.selectionOverlay=new p({parentView:this});this.mouseListenerOverlay=new u({model:this.model});this.mouseListenerOverlay.previewView=this;this.artboardOverlay=new f({model:this.model});this.popupOverlay=new g({model:this.model});this.$psdLens=v.createTemplate(y);this.$el.find(".preview-container").append(this.mouseListenerOverlay.el);this.$el.find(".preview-container").append(this.artboardOverlay.el);this.$el.find(".preview-container").append(this.inspectStyleOverlay.el);this.$el.find(".preview-container").append(this.popupOverlay.el);this.mouseListenerOverlay.addHandlers();return this},attached:function(){if(!this.mouseListenerOverlay){if(this.model.get("info"))this.handleModelInfoChanged();else if(this.model.get("width")&&this.model.get("height")){var e=this.model.get("imgdata").bounds;this.renderContainer();e.bottom=this.model.get("height");e.right=this.model.get("width");graphite.events.trigger("zoomToFit",e);this.applyCurrentZoomLevel(!0)}this.model.get("extractedStyles")&&this.handleExtractedStylesChanged()}},handleStatusChanged:function(){var e=this.model.get("status");200>e?this.renderSpinner():e>=400&&this.$el.find(".preview-loading-spinner").remove()},handleModelInfoChanged:function(){graphite.events.trigger("psdModelInfoChanged");this.render()},handleExtractedStylesChanged:function(){e(".preview-loading-spinner").remove();if("complete"===this.model.get("dataType")){this.addLayerSpritesBackToFront(this.model);this.model.set("renderedSprites",!0);r.triggerWhenSpriteSheetsLoaded("drawPreviewFinish")}else{this.populateLayerModelMap(this.model);r.triggerSpriteSheetLoadedEvent("JSONPreviewReady")}},renderSpinner:function(){this.$el.append('<div class="spinner preview-loading-spinner" style="display:block;"></div>')},renderProgressPane:function(){var e=[T.translate("Use shift-click to measure the distance between elements in the PSD view."),T.translate("After extracting assets, find them in the Assets tab where they can be downloaded locally."),T.translate("Select a color swatch in the Styles tab to see where the color is used in your design."),T.translate("You can select multiple layers in the Layers tab and export them as a single image."),T.translate("Select layer comps with the drop down above the PSD view."),T.translate("Zoom in and out on your PSD view using ALT +/-."),T.translate("Use the arrow keys to traverse the layers in your design."),T.translate("Hover over thumbnails in the Layers tab to see a preview for a layer or layer group.")];this.$progressPane=v.createTemplate(b,{tip:T.translate("Tip: ")+e[Math.round(Math.random()*(e.length-1))]});this.$progressPane.hide();this.$el.append(this.$progressPane)},renderContainer:function(){if(0===this.$el.find(".preview-container").length){this.$el.append(v.createTemplate(w,t.defaults(this.model.toJSON(),{width:0,height:0})));this.$tempPreview=this.$el.find("#tempPreview");this._loadPreviewImage()}else{var e=this.$el.find("#psdpreview_root"),i=this.$el.find("#tempPreview"),s=this.$el.find(".center-helper"),n=this.model.get("imgdata").bounds,r={width:n.right,height:n.bottom};e.css(r);i.css(r);s.css("margin-bottom",-(n.bottom/2+50)+"px");a.zoomElementScale(e);a.zoomElementScale(i)}this.$el.removeClass("preview-rendered")},showProgressPane:function(t){if(!this.workerProgressShown){this.$el.addClass("worker-progress-shown");e(".worker-status").text(T.translate("Processing")+" 0%...");e(".worker-progress-bar").css("width",0);this.$progressPane.show();this.workerProgressShown=!0}this.workerGuid=t},hideProgressPane:function(t){if(-1===t||this.workerGuid===t){this.$el.find(".preview-loading-spinner").remove();this.$el.removeClass("worker-progress-shown");e(".worker-status").text(T.translate("Processing")+" 100%");e(".worker-progress-bar").width("100%");this.$progressPane.fadeOut(300);this.workerProgressShown=!1;this.workerGuid=null}},updateProgressPane:function(t,i,s){var n,r;this.workerProgressShown||t!==this.model.get("id")||this.showProgressPane(t);if(this.workerGuid===t){if("queued"===i){n=T.translate("Job queued...");e(".worker-progress-bar").width(0)}else{r=(isNaN(s)?0:Math.round(s))+"%";n=T.translate("Processing")+" "+r+"...";e(".worker-progress-bar").width(r)}e(".worker-status").text(n)}},addHandlers:function(){graphite.events.on("drawPreviewFinish",this.hideTempPreview,this);graphite.events.on("zoomChanged",this.handleZoomChanged,this);graphite.events.on("flattenedSpriteUpdated",this.updateFlattenedLayers,this);graphite.events.on("layerCompChanging",this.layerCompChanging,this);graphite.events.on("showWorkerProgress",this.showProgressPane,this);graphite.events.on("hideWorkerProgress",this.hideProgressPane,this);graphite.events.on("updateWorkerProgress",this.updateProgressPane,this);graphite.events.on("jsonExtractionFailure",this.handleJSONExtractionFailure,this);graphite.events.on("dropperStart",this.handleDropperStart,this);graphite.events.on("dropperStop",this.handleDropperStop,this);graphite.events.on("extract-asset-download-init",this.handleAssetExtractInit,this);graphite.events.on("assetExtracted",this.handleAssetExtracted,this);graphite.events.on("assetExtractionFailure",this.handleAssetExtracted,this);graphite.events.on("multiSelectPending",this.handleMultiSelectPending,this);graphite.events.on("selection-changed",this.handleSelectionChanged,this)},convertClientPtToPSDPt:function(e,t){var i=this.$el.find(".preview-container"),s=i.offset(),n=i.css("padding-top"),r=i.css("padding-left"),o={x:e-s.left-parseInt(r,10),y:t-s.top-parseInt(n,10)};o=a.zoomPoint(o,!0);return o},isItemSelected:function(e){var t,i;for(t in n.selectionMap)if(n.selectionMap.hasOwnProperty(t)){i=n.selectionMap[t];if(e===i)return!0}return!1},getPriorityLayers:function(){var e,t,i,s,n,r,a=[],o={};a.push(this.model.get("extractedStyles").colors);a.push(this.model.get("extractedStyles").textStyles);a.push(this.model.get("extractedStyles").gradients);for(s=0;s<a.length;s++){e=a[s];for(r=0;r<e.length;r++){t=e[r];i=t.get("layers");for(n=0;n<i.length;n++)o[i[n].get("layerId")]=!0}}return o},shouldFlattenedParentObscure:function(e,t){var i=e.getArtboardParent(),s=t.getArtboardParent();return!s||i&&i.isEqual(s)},addLayerSpritesBackToFront:function(e){for(var i,r,a,c,d,h,p,u,f=[],g=e,y=[],b=this.$el.find("#psdpreview_root"),w=0,C=[];g;){p=g.get("type")===s.Type.LAYER_GROUP||g.get("type")===s.Type.LAYER_ARTBOARD;i=g.get("parentModel");if(i){r=p?x:S;a=v.createTemplate(r,g.toJSON());g.get("type")===s.Type.LAYER_ARTBOARD&&a.addClass("artboard");c=null;d=g.get("bounds");m.setLayerBounds(a,!1,g,i,n);a.attr("id","layer"+g.get("layerId"));g.isVisibleOnStage()?a.show():a.hide();h=l.getLayerInfoForId(i.get("layerId"))?l.getLayerInfoForId(i.get("layerId")).item:null;h||(h=b);if(g.get("flattenedSprite")){c=v.createTemplate(S,g.toJSON());c.attr("id","flattenedLayer"+g.get("layerId"));var T=m.setLayerBounds(c,!0,g,i,n);h.append(c);o.applyParentAndPosition(g,T,c,g.get("flattenedSprite"));y.push(g);p||a.css("visibility","hidden");for(var I=C.length-1;I>=0;--I)if(this.shouldFlattenedParentObscure(C[I].model,g)){C[I].item.css("visibility","hidden");C.splice(I,1)}}else if(g.get("flattenedParent")){var E=l.getLayerModelFromId(g.get("flattenedParent"));E?this.shouldFlattenedParentObscure(g,E)&&a.css("visibility","hidden"):C.push({item:a,model:g})}l.addLayerToMap(g.get("layerId"),a,c,g);c&&this.loadSpriteSheet(c,g,g.get("flattenedSprite"),!0);if(p){if(g.get("properties")&&g.get("properties").get("blendOptions")){var P=g.get("properties").get("blendOptions"),M=P.opacity>=0?P.opacity/100:1,L=P.fillOpacity>=0?P.fillOpacity/100:1;a.css("opacity",M*L)}}else this.loadSpriteSheet(a,g,g.get("spriteSheet"));h.append(a);this.addEventHandlers(g,h,b)}u=g.get("layerCollection");u&&u.each(function(e){e.set("parentModel",g);e.set("zIndex",w);w++;f.push(e)});g=f.shift()}t.each(y,function(e){var i,s,n=e.get("flattenedSprite"),r=!0;t.each(n.includedLayers,function(e){i=l.getLayerModelFromId(e);i.getEffectiveVisibility()&&(r=!1)});if(r){s=l.getLayerInfoForId(e.get("layerId")).flattenedItem;s&&s.css("visibility","hidden")}})},loadImage:function(e,t,i){if(t.right!==t.left&&t.top!==t.bottom){var n=new Image,r=graphite.serverAPI.getLayerURL(this.model.id,e.get("layerId"));n.title=e.get("layerId");n.addEventListener("load",function(){var t=l.getLayerInfoForId(this.title).item;(e.get("type")===s.Type.LAYER_GROUP||e.get("type")===s.Type.LAYER_ARTBOARD)&&(t=t.children().first());var n=t[0].getContext("2d");n.drawImage(this,0,0);i||t.css("display","none");e.set("rendered",!0)},!1);graphite.serverAPI.loadCrossDomainImage(n,r)}},populateLayerModelMap:function(e){var t,i=[],s=e,n=this.$el.find("#psdpreview_root"),r=function(e){e.set("parentModel",s);i.push(e)};l.reset();for(;s;){s.get("parentModel")&&l.addLayerToMap(s.get("layerId"),n,null,s);t=s.get("layerCollection");t&&t.each(r);s=i.shift()}},loadSpriteSheet:function(e,t,i,n){var a=t.get("type")===s.Type.LAYER_GROUP||t.get("type")===s.Type.LAYER_ARTBOARD,o=t.get("flattenedSprite");void 0===i||a&&!o||(i.sheetID?r.drawSpriteSheet(i.sheetID,this.drawSprite(e,t,n)):i.color&&this.drawRectangle(t,i.color,i.opacity))},drawSprite:function(e,t,i){return function(s){var n=e[0].getContext("2d"),r=t.get("flattenedSprite"),a=i&&r?r.bounds:t.get("spriteSheet").bounds,o=a.right-a.left,l=a.bottom-a.top;n.drawImage(s,a.left,a.top,o,l,0,0,o,l)}},drawRectangle:function(e,t,i){var s=l.getLayerInfoForId(e.get("layerId")).item,n=e.get("bounds"),r=s[0].getContext("2d");r.globalAlpha=i/255;r.beginPath();r.rect(0,0,n.right-n.left,n.bottom-n.top);r.fillStyle="rgb("+t.red+","+t.green+","+t.blue+")";r.fill()},addEventHandlers:function(e,t,i){var s=this;e.on("change:visible",function(){s.layerVisibilityChanged(this)});e.on("focus",function(){0===i.find(s.$defocused).length&&i.append(s.$defocused);var e="#layer"+this.get("layerId");t.find(e).addClass("focused");s.groupExpanded(this)})},groupExpanded:function(e){this.refreshVisibilityForFocus(e);var t=e.get("parentModel");t.get("info")||this.groupExpanded(t)},refreshVisibilityForFocus:function(e){if(e.get("type")!==s.Type.LAYER_GROUP&&e.get("type")!==s.Type.LAYER_ARTBOARD)this.refreshVisibilityForItem(e);else{var t=e.get("layerCollection"),i=this;t&&t.each(function(e){i.refreshVisibilityForItem(e)})}},refreshVisibilityForItem:function(e){var t=l.getLayerInfoForId(e.get("layerId")).item,i=e.get("clippedLayers"),s=this;e.isVisibleOnStage()?t.show():t.hide();i&&i.forEach(function(e){s.refreshVisibilityForItem(e)})},layerVisibilityChanged:function(e){this.updateFlattenedLayers(e);this.refreshVisibilityForItem(e)},updateFlattenedLayers:function(e){var i,n,r,a=e.get("flattenedParent"),c=l.getLayerModelFromId(a),d=e.get("flattenedSprite"),h=!0,p=[],u=[],f=[],g=this;if(c||d){c=c||e;f.push(c)}else(e.get("type")===s.Type.LAYER_GROUP||e.get("type")===s.Type.LAYER_ARTBOARD)&&(f=e.findDescendantFlattenedSprites());t.each(f,function(e){d=e.get("flattenedSprite");if(d){i=l.getLayerInfoForId(e.get("layerId")).flattenedItem;u.push({layer:e,flattenedSprite:d,$flattenedSpriteElem:i})}});t.each(u,function(e){h=!0;d=e.flattenedSprite;i=e.$flattenedSpriteElem;t.each(d.includedLayers,function(e){n=l.getLayerModelFromId(e);r=l.getLayerInfoForId(n.get("layerId")).item;p.push({model:n,$elem:r,elemVisibility:r.css("visibility")});h&&!n.isEffectiveRenderedVisibility()&&(h=!1)});if(h){i.css("visibility","visible");g._flattenLayerElems(!0,p);o.validateSprite(e.layer)}else{i.css("visibility","hidden");g._flattenLayerElems(!1,p);o.invalidateSprite(e.layer)}})},handleClickEvent:function(t){if(!e(t.target).parents(".popup").length&&!e(t.target).hasClass("popup")){var i=r.get("activeTool");if(i===s.Tool.SELECT_DIRECT){n.set("shouldScrollLayers",!0);var a=this.convertClientPtToPSDPt(t.clientX+e(document).scrollLeft(),t.clientY+e(document).scrollTop());n.selectItemAtPoint(a.x,a.y,c.isMultiSelectKey(t));t.stopPropagation()}}},logCanvasClick:function(e,t,i){var s=this.convertClientPtToPSDPt(t,i),r=n.itemAtPoint(s.x,s.y),a=r?r.get("type"):"nothingUnderCursor";graphite.events.trigger("canvasClick",{type:e,layerType:a})},handleDoubleClickEvent:function(e){this.logCanvasClick("doubleClick",e.clientX,e.clientY)},handleMouseDownEvent:function(t){if(2===t.button)this.logCanvasClick("rightClick",t.clientX,t.clientY);else if(0===t.button){var i={x:t.pageX,y:t.pageY};e(window).on("mousemove.dragDetect",function(t){this.isClickDrag=!0;if(Math.abs(t.pageX-i.x)>20||Math.abs(t.pageY-i.y)>20){graphite.events.trigger("canvasClickDrag");e(window).off(".dragDetect")}})}},handleMouseUpEvent:function(){e(window).off(".dragDetect");this.isClickDrag=!1},layerCompChanging:function(){this.$el.find(".preview-loading-spinner").remove();this.renderSpinner()},handleAssetExtractInit:function(e){this.extractionStartTime=(new Date).getTime();graphite.inPublicOneUp()||this.showSuccessTooltip(T.translate("Extracting asset. Look for it in the Assets tab."))},handleAssetExtracted:function(e){if(this.extractTooltip){var t=s.NotificationTooltip.MIN_DURATION-((new Date).getTime()-this.extractionStartTime);if(0>=t){this.extractTooltip.remove();this.extractTooltip=null}else setTimeout(this.handleAssetExtracted.bind(this),t)}},handleMultiSelectPending:function(e){var t=n.getSelectedLayers();this.$el.toggleClass("measure-pending",e&&1===t.length)},handleSelectionChanged:function(e){var t,i,s=n.getSelectedLayers();1!==s.length&&this.$el.removeClass("measure-pending");if(s.length>=1){t=m.calcLayerGroupBounds(s,n.getPSDModel());t=a.zoomRect(t);i=this.$el[0].getBoundingClientRect();t.top+=i.top-this.$el.scrollTop();t.bottom+=i.top-this.$el.scrollTop();t.left+=i.left-this.$el.scrollLeft();t.right+=i.left-this.$el.scrollLeft();e||d.scrollRectIntoView(this.$el,t)}},showSuccessTooltip:function(t){if(!this.extractTooltip){var i=this.$el.find("div.blueHUD"),s=i.parent();s.append('<div id="notificationTooltip"><span>'+t+"</span></div>");this.extractTooltip=e("#notificationTooltip");this.extractTooltip.width(i.outerWidth()-(this.extractTooltip.outerWidth()-this.extractTooltip.width()));var n,r=Math.round(i.position().left)+13+s.scrollLeft(),a=this.extractTooltip.outerHeight();n=i.hasClass("bottom")?i.position().top+i.outerHeight():i.position().top-a-15;this.extractTooltip.css({top:n,left:r});this.extractTooltip.fadeIn(250)}},setBackgroundWhite:function(){var e=this.$el.find("#psdpreview_root");e.css("background","white")},showErrorNotification:function(e){var t=T.utils.getCurrentBasePath(),i=graphite.inPublicOneUp();e.anchor="";if("file"===t||"link"===t){var s=i?T.translate("Go to Comments to preview the PSD."):T.translate("Go to Details to preview the PSD.");e.anchor=' <a class="details-anchor">'+s+"</a>"}if(this.$notification){this.$notification.find(".details-anchor").off(".details");this.$notification.remove();this.$notification=null}this.$el.append(v.createTemplate(C,e));this.$notification=this.$el.find(".error-notification");var n=this.$el.find(".details-anchor");n.length&&n.on("click.details",function(e){e.preventDefault();T.events.trigger("plugin.show",i?"ccweb.files.activity_public":"ccweb.files.details")});this.$el.addClass("has-error");graphite.events.trigger("errorNotificationShown")},removeEventListeners:function(){this.model.off(null,null,this);graphite.events.off(null,null,this)},remove:function(){o.reset();this.inspectStyleOverlay&&this.inspectStyleOverlay.remove();this.selectionOverlay&&this.selectionOverlay.remove();this.mouseListenerOverlay&&this.mouseListenerOverlay.remove();this.artboardOverlay&&this.artboardOverlay.remove();this.popupOverlay&&this.popupOverlay.remove();if(this.$progressPane){this.$progressPane.remove();this.$progressPane=null}if(this.$psdLens){this.$psdLens.remove();this.$psdLens=null}if(this.$notification){this.$notification.find(".details-anchor").off(".details");this.$notification.remove();this.$notification=null}this.inspectStyleOverlay=null;this.selectionOverlay=null;this.mouseListenerOverlay=null;this.artboardOverlay=null;this.popupOverlay=null;this.removeEventListeners();return i.View.prototype.remove.call(this)},_loadPreviewImage:function(){if(I){var e={id:this.model.get("assetId"),modified:this.model.get("modified"),height:this.model.get("width"),width:this.model.get("height"),type:this.model.get("type"),name:this.model.get("fileName"),link:graphite.linkId};I(e,this._previewImageDataReceived)}else if(!this.model.get("localContent")&&!this.model.get("layerCompId"))if(T.utils.hasFeature("temp_extract_use_webtier")){var t=this;E.storagePath(this.model.get("id")).then(function(e){t.$tempPreview.attr("src",graphite.serverAPI.getDefaultRenditionURL(e))})}else this.$tempPreview.attr("src",graphite.serverAPI.getDefaultRenditionURL(this.model.get("id")))},_previewImageDataReceived:function(t){if(t&&t.length&&-1===t.attr("src").indexOf(T.utils.getFileIconPath())){var i=this.model.get("width"),s=this.model.get("height"),n=e('<canvas id="tempPreview" class="tempPreview"></canvas>'),r=n[0].getContext("2d");n.css({width:i+"px",height:s+"px"});n[0].width=i;n[0].height=s;t[0].width&&t[0].height&&r.drawImage(t[0],0,0,t[0].width,t[0].height,0,0,i,s);this.$tempPreview.replaceWith(n);this.$tempPreview=n;a.zoomElementScale(this.$tempPreview);this.tempPreviewHidden&&this.hideTempPreview()}},_flattenLayerElems:function(e,i){var s=e?"hidden":"visible";t.each(i,function(t){t.model.set("isFlattened",e);t.elemVisibility!==s&&t.$elem&&t.$elem.css("visibility",s)})},handleZoomChanged:function(e){this.applyCurrentZoomLevel(!1,e)},hideTempPreview:function(){var e;this.$el.addClass("preview-rendered");this.tempPreviewHidden=!0;var t=n.getPSDModel();if(t.get("isArtboardPSD")){this.$el.find("div.preview-container").addClass("artboard");this.$el.find("#psdpreview_root").addClass("artboard");e=t.get("artboards");e&&this.$el.find("#psdpreview_root").css("background-color","rgb("+parseInt(e.canvasColor.red,10)+", "+parseInt(e.canvasColor.green,10)+", "+parseInt(e.canvasColor.blue,10)+")");graphite.events.trigger("zoomToFit",t.get("artboardsBounds"));graphite.events.trigger("artboardpsd-shown")}else{graphite.events.trigger("zoomToFit",t.get("imgdata").bounds);graphite.events.trigger("nonartboardpsd-shown")}},applyCurrentZoomLevel:function(e,t){var i=this.$el.find("div.preview-container"),r=this.$el.find("#psdpreview_bg"),o=this.$el.find("#psdpreview_root"),l=this.$el.find("#tempPreview"),c=this.$el.find("#selection-overlay"),d=this.model.get("imgdata").bounds,h={width:d.right,height:d.bottom};a.zoomElementSize(c,h);if(!this.tempPreviewHidden||e){var p=this.$el.outerWidth()-s.PREVIEW_SCROLLBAR_SPACING,u=this.$el.outerHeight()-s.PREVIEW_SCROLLBAR_SPACING,f=a.zoomSize(h),g=Math.max(0,Math.round((p-f.width)/2)),m=Math.max(0,Math.round((u-f.height)/2));(g>0||m>0)&&i.css({top:m,left:g});a.zoomElementScale(l);a.zoomElementSize(i,h);a.zoomElementSize(r,h);a.zoomElementScale(o)}else a.zoomAndScrollElements(o,this.$el,t,i,r,h,n.getPSDModel().get("isArtboardPSD"));o.css("overflow",a.getZoomLevel()>1?"visible":"hidden")},handleDropperStart:function(){var t,i=this.$psdLens.find(".lens-grid"),s=e("<canvas/>")[0],r=s.getContext("2d"),a=7,o=3,c=this;e(".extract-plugin").addClass("dropper-tool");e(".extract-plugin").append(this.$psdLens);this.$psdLens.hide();s.width=a;s.height=a;this.$el.on("mousedown.dropper",function(e){t&&graphite.events.trigger("commitDropperColor",t)});e(window).on("click.dropper",function(e){n.disableDropperTool();c.$psdLens.css("border-color","");e.preventDefault();e.stopPropagation()});this.$el.on("mouseleave.dropper",function(e){c.$psdLens.hide()});this.$el.on("mouseenter.dropper",function(e){c.$psdLens.show()});this.$el.on("mousemove.dropper",function(d){var h,p=c.convertClientPtToPSDPt(d.clientX-o,d.clientY-o),u={top:Math.round(p.y),left:Math.round(p.x),bottom:Math.round(p.y)+a,right:Math.round(p.x)+a},f=n.findIntersectsBackToFront(u);c.$psdLens.show();r.clearRect(0,0,a,a);for(h=f.length-1;h>=0;h--){var g,m,v=f[h].intersect,y=f[h].item;g=y.get("flattenedSprite")?l.getLayerInfoForId(y.get("layerId")).flattenedItem:l.getLayerInfoForId(y.get("layerId")).item;m=g[0];r.drawImage(m,v.left,v.top,v.width,v.height,v.destLeft,v.destTop,v.width,v.height)}var b=r.getImageData(o,o,1,1);t=null;if(b.data&&b.data.length>=4&&b.data[3]>0){t={};t.red=b.data[0];t.green=b.data[1];t.blue=b.data[2];t.alpha=b.data[3]/255;var w="rgb("+t.red+","+t.green+","+t.blue+")";e(".dropper-item .color-chip").css("background-color",w);c.$psdLens.css("border-color",w)}else{e(".dropper-item .color-chip").css("background-color","");c.$psdLens.css("border-color","")}var x=i[0].getContext("2d");x.webkitImageSmoothingEnabled=!1;x.mozImageSmoothingEnabled=!1;x.msImageSmoothingEnabled=!1;x.clearRect(0,0,10*a,10*a);x.drawImage(s,0,0,a,a,0,0,10*a,10*a);c.$psdLens.css({left:d.clientX+"px",top:d.clientY-e(".extract-plugin").offset().top+"px"})})},handleDropperStop:function(){e(".extract-plugin").removeClass("dropper-tool");e(window).off(".dropper");this.$el.off(".dropper");e(".dropper-item .color-chip").css("background-color","");this.$psdLens.hide()}});return P});define("ccweb.files.extract/views/templates/mobileWarningTemplate.html",[],function(){return'<div class="mobile-styles-toggle"></div>\n<div class="mobile-centered-container">\n    <div class="width-warning"><div class="extract-icon"></div><%-translate("Extract requires a minimum width of 800 pixels")%></div>\n    <div class="mobile-info"><%-translate("View this page on the desktop to get more out of the PSD extraction features.")%></div>\n</div>\n'});define("ccweb.files.extract/views/templates/psdHeaderTemplate.html",[],function(){return'<div class="psd-header">\n    <div class="psd-header-nowrap">\n        <a class="back-to-files" href="/#"></a>\n        <div class="header-separator"></div>\n        <span class="file-name"><%- imgdata.originalFile %></span>\n    </div>\n</div>\n'});define("ccweb.files.extract/views/detail/PSDDetailsView",["underscore","backbone","ccweb.files.extract/controllers/DetailsController","ccweb.files.extract/controllers/KeyboardController","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/controllers/ZoomController","./DetailPanelView","./HelpView","./SelectionBarView","ccweb.files.extract/views/assets/ExtractForDeviceDlg","ccweb.files.extract/views/popup/ExtractAssetView","ccweb.files.extract/views/popup/ExtractCodeView","ccweb.files.extract/views/popup/ColorChipPopupView","ccweb.files.extract/views/popup/LayerThumbPopupView","ccweb.files.extract/views/popup/AssetThumbPopupView","ccweb.files.extract/views/popup/ZoomInHintPopupView","ccweb.files.extract/views/preview/PSDPreviewView","ccweb.files.extract/Constants","plugin-dependencies","ccweb.files.extract/views/templates/mobileWarningTemplate.html","ccweb.files.extract/views/templates/psdHeaderTemplate.html","ccweb.files.extract/views/templates/errorNotificationTemplate.html","ccweb.files.extract/utils/TemplateUtil"],function(e,t,i,s,n,r,a,o,l,c,d,h,p,u,f,g,m,v,y,b,w,x,S){"use strict";var C=t.View.extend({assetId:null,tagName:"section",detailPanelView:null,previewView:null,extractAssetPopup:null,extractCodePopup:null,colorChipPopup:null,layerThumbPopup:null,assetThumbPopup:null,helpView:null,selectionBar:null,events:{"click .mobile-styles-toggle":"handleMobileStylesToggle","click .modal-window-overlay":"handleClickInModalOverlay"},initialize:function(){this.model.set("previewStarted",Date.now());this.model.on("change:imgdata",this.handleModelImgdataChanged,this);this.model.on("change:renderedSprites",this.handleRenderedSpritesChanged,this);this.model.on("change:status",this.handleStatusChanged,this);this.addHandlers();this.render();this.handleModelImgdataChanged();this.handleStatusChanged();
},render:function(){r.reset();n.setPSDModel(this.model);i.setPSDModel(this.model);this.detailPanelView=new a({model:this.model});this.previewView=new m({model:this.model});this.selectionBar=new l({previewView:this.previewView});this.extractAssetPopup=new d({model:this.model});this.extractCodePopup=new h({model:this.model});this.colorChipPopup=new p;this.layerThumbPopup=new u;this.assetThumbPopup=new f;this.zoomInHintPopup=new g;this.helpView=new o;this.extractForDeviceDlg=new c({model:this.model});n.psdView=this.previewView;this.$el.append(S.createTemplate(b));this.$el.append(this.previewView.el);this.$el.append(this.selectionBar.el);this.$el.append(this.detailPanelView.el);this.$el.append(this.extractAssetPopup.el);this.$el.append(this.extractCodePopup.el);this.$el.append(this.colorChipPopup.el);this.$el.append(this.layerThumbPopup.el);this.$el.append(this.assetThumbPopup.el);this.$el.append(this.zoomInHintPopup.el);var e=this.$el.find(".modal-window-overlay");if(0===e.length){this.$el.append('<div class="modal-window-overlay" style="display:none;">');e=this.$el.find(".modal-window-overlay");e.append(this.helpView.el);e.append(this.extractForDeviceDlg.el)}graphite.events.trigger("do-first-use-overlay-check");return this},handleClickInModalOverlay:function(e){"modal-window-overlay"===e.target.className&&graphite.events.trigger("dismiss-modal-views")},handleModelImgdataChanged:function(){this.$el.find(".psd-header").remove();this.$el.append(S.createTemplate(w,this.model.toJSON()));this.$el.find(".psd-header .back-to-files").text(y.translate("Files"));if(void 0!==y.utils.getCurrentPage()){this.$el.find(".psd-header .back-to-files").css("visibility","visible");this.$el.find(".psd-header .header-separator").css("visibility","visible")}else{this.$el.find(".psd-header .back-to-files").css("visibility","hidden");this.$el.find(".psd-header .header-separator").css("visibility","hidden")}},handleMobileStylesToggle:function(){this.$el.toggleClass("mobile-styles-visible")},handleRenderedSpritesChanged:function(){},handleStatusChanged:function(){var e,t=this.model.get("status");if(t>=300){var i=this.model.get("errorInfo");if(i&&i.errorCode===v.WorkerErrorCodes.GRAPHITE_REJECTED){var s=i.errorMessage.match(/File rejected - too many layers \((\d+)\/(\d+)\)/);s||(s=i.errorMessage.match(/File rejected - limits exceeded: {"limitName":"maxLayers","value":(\d+),"limit":(\d+)/));if(s){var n=s[1],r=s[2];e=y.translate("Uh oh, this PSD has an exceptional number of layers and has failed to process. Please keep the number of layers below {0}. This PSD has {1}.",r,n)}else e=y.translate("Uh oh, this PSD has an exceptional number of layers and has failed to process.")}e=e||y.translate("Uh oh, this PSD was not successfully processed because it's not currently compatible with Extract.")}e&&this.showErrorNotification({messageText:e})},addHandlers:function(){s.attachKeyHandlers();graphite.events.on("dismiss-modal-views",this.handleHideModals,this)},handleHideModals:function(){graphite.events.trigger("hide-help-dialog");graphite.events.trigger("hide-extractForDevice-dialog")},removeEventListeners:function(){this.model.off(null,null,this);graphite.events.off(null,null,this);s.removeKeyHandlers()},showErrorNotification:function(e){this.previewView&&this.previewView.showErrorNotification(e)},destroyViews:function(t){var i=this;e.each(t,function(e){if(i.hasOwnProperty(e)){i[e].remove();delete i[e]}})},remove:function(){this.removeEventListeners();var e=["detailPanelView","previewView","extractAssetPopup","extractCodePopup","colorChipPopup","layerThumbPopup","assetThumbPopup","helpView","extractForDeviceDlg","selectionBar"];i.setSelectedTab("psdInspectTab");i.setSelectedInspectItem(null);this.destroyViews(e);n.psdView=null;this.$el.empty();this.stopListening();return this}});return C});define("ccweb.files.extract/views/templates/interceptBinaryTemplate.html",[],function(){return'<div id="interceptPopupBinary">\n    <%-translate("Did this work as expected?")%>\n    <div class="popup-footer"><span id="interceptYesLink" class="popup-button"><%-translate("Yes")%></span> <span id="interceptNoLink" class="popup-button"><%-translate("No")%></span>\n    </div>\n    <i id="interceptCloseLink" class="popup-close">&times;</i>\n</div>'});define("ccweb.files.extract/views/popup/InterceptPopupView",["underscore","backbone","ccweb.files.extract/Constants","ccweb.files.extract/views/popup/BasePreviewPopupView","plugin-dependencies","ccweb.files.extract/utils/TemplateUtil","ccweb.files.extract/views/templates/interceptBinaryTemplate.html"],function(e,t,i,s,n,r,a){"use strict";var o=s.extend({className:"interceptBinary measurementTooltip popup",events:{"click #interceptYesLink":"handleYesClick","click #interceptNoLink":"handleNoClick","click #interceptCloseLink":"handleCloseClick"},initialize:function(){s.prototype.initialize.apply(this,arguments)},render:function(){s.prototype.render.apply(this,arguments);this.$el.find(".popup-contents").html(r.createTemplate(a));var e=this.$el.find("#interceptYesLink"),t=this.$el.find("#interceptNoLink");e.html(n.translate("Yes"));e.hover(this.highlightLabel,this.unhighlightLabel);t.html(n.translate("No"));t.hover(this.highlightLabel,this.unhighlightLabel);return this},handleYesClick:function(e){this.tryHandler(e,"yes")},handleNoClick:function(e){this.tryHandler(e,"no")},handleCloseClick:function(e){this.tryHandler(e,"close")},tryHandler:function(e,t){e.stopPropagation();this.handlers&&this.handlers[t]&&this.handlers[t]();this.closePopup();this.remove()},setHandlers:function(e){this.handlers=e}});return o});define("ccweb.files.extract/models/InterceptModel",["jquery","underscore","backbone","ccweb.files.extract/views/popup/InterceptPopupView","ccweb.files.extract/models/UserSettingsModel"],function(e,t,i,s,n){"use strict";var r=i.Model.extend({defaults:{},configurations:[{segment:"layer-comp-binary",behavior:function(){function e(){window.graphite.events.trigger("catchIntercept",{segment:r.segment,result:"yes"})}function i(){window.graphite.events.trigger("catchIntercept",{segment:r.segment,result:"no"});window.olark("api.box.expand")}function s(){window.graphite.events.trigger("catchIntercept",{segment:r.segment,result:"close"})}var r=this,a=n.get("shownIntercepts");a[r.segment]||window.graphite.events.on("layerCompChanged",function(){var a=t.clone(n.get("shownIntercepts"));if(!a[r.segment]){window.graphite.events.trigger("load-intercept-binary",{style:"top: 33px",handlers:{yes:e,no:i,close:s}});a[r.segment]=!0;n.set("shownIntercepts",a)}})}}],attachListeners:function(){window.graphite.events.on("load-intercept-binary",function(i){t.delay(function(){var t=new s;t.setHandlers(i.handlers);e(t.el).addClass("bottom");i.style&&e(t.el).attr("style",i.style);e("#results").find(".layer-comp-controls").append(t.el);e(t.el).show()},500)},this)},applyBehaviors:function(){this.attachListeners();var e,t=n.get("shownIntercepts");for(e in this.configurations)this.configurations.hasOwnProperty(e)&&!t[this.configurations[e].segment]&&this.configurations[e].behavior()}});return new r});define("ccweb.files.extract/controllers/InterceptController",["underscore","backbone","ccweb.files.extract/models/InterceptModel"],function(e,t,i){"use strict";var s=t.Model.extend({defaults:{applied:!1},initialize:function(){},applyBehaviors:function(){if(!this.applied){i.applyBehaviors();this.applied=!0}}});return new s});define("ccweb.files.extract/serverAPI",["jquery","underscore","plugin-dependencies","ccweb.files.extract/Constants","ccweb.files.extract/models/DerivedAssetModel","ccweb.files.extract/collections/DerivedAssetCollection"],function(e,t,i,s,n,r){"use strict";function a(e,t,i,s){t&&(e.success=function(e,i,n){t.apply(s,[n])});i&&(e.error=function(e){i.apply(s,[e])})}function o(e,t){var s=i.config.sharedcloud_proxy_url,n=i.auth.token,r=n?"&Authorization="+encodeURIComponent(n):"",a=t?"":graphite.urlBase;return s+"/api?X-Location="+a+e+r}function l(e,t){var s=i.config.sharedcloud_proxy_url,n=i.auth.token,r=n?"&Authorization="+encodeURIComponent(n):"",a=t?"":graphite.urlBase;return graphite.inPublicOneUp()&&graphite.linkId?s+"/api?link="+graphite.linkId+"&X-Location="+a+e:s+"/api?X-Location="+a+e+r}function c(e,t,s){s=s||!1;var n={type:e,url:i.config.sharedcloud_proxy_url+"/api",headers:{"x-location":s?t:graphite.urlBase+t,authorization:i.auth.token}};return n}function d(e,t,s,n){s=s||!1;n=n||!1;var r={type:e,url:i.config.sharedcloud_proxy_url+"/api",headers:{"x-location":s?t:graphite.urlBase+t}};!n&&graphite.inPublicOneUp()&&graphite.linkId?r.data={link:graphite.linkId}:r.headers.authorization=i.auth.token;return r}function h(e){return graphite.inPublicOneUp()&&graphite.linkId?i.config.sharedcloud_proxy_url+"/download?link="+graphite.linkId+"&resource="+encodeURIComponent(graphite.urlBase)+"%2Fapi%2Fv1%2Fassets%2F"+e+"&format=psd":"vnd-adobe-sharedcloud.asset:"+e}function p(t,i,s){e.ajax(c("GET",t,!0)).done(function(e,n,r){if(200===r.status)if("failed"===e.status){s&&graphite.events.trigger("hideWorkerProgress",s);i(e,e,r)}else if("done"===e.status){s&&graphite.events.trigger("updateWorkerProgress",s,"done",100);i(null,e,r)}else{s&&graphite.events.trigger("updateWorkerProgress",s,e.status,e.progress);setTimeout(function(){p(t,i,s)},500)}})}function u(e){return e.split("/").pop().split(":").pop()}function f(i,s,n){var r=e.Deferred(),a=c("GET","/api/v1/collections/"+i);e.ajax(a).done(function(a,o,l){if(a.hasOwnProperty("sub_collections")){var d=t.find(a.sub_collections,function(e){return e.name===s});if(d)r.resolve(d.id);else if(n){var h=c("POST","/api/v1/collections"),p={parent_collection:i,collection_name:s};h.data=JSON.stringify(p);e.ajax(h).fail(function(e,t,n){409===e.status?f(i,s,!1).then(function(e){r.resolve(e)},function(e,t){r.reject(e,t)}):r.reject(t,e)}).done(function(e,t,i){r.resolve(u(i.getResponseHeader("location")))})}else r.resolve(null)}else r.reject(o,l)});return r.promise()}function g(t,i){var s=e.Deferred(),n={collection_name:t._links.self.name||t.asset.fileName,parent_collection:t._links.parent.href},r=n.collection_name.lastIndexOf(".");-1!==r&&(n.collection_name=n.collection_name.substr(0,r));n.collection_name+="-assets";f(u(n.parent_collection),n.collection_name,i).then(function(e){n.collectionId=e;e?s.resolve(n):s.resolve(null)},function(e,t){s.resolve(e,t)});return s.promise()}function m(t,i){var s=e.Deferred(),n=c("GET","/api/v1/assets/"+t+"/metadata");n.headers.accept="application/hal+json";e.ajax(n).fail(function(e,t,i){s.reject(t,e)}).done(function(e,t,n){200===n.status?g(e,i).then(function(e){s.resolve(e)},function(e){s.reject(e)}):s.reject(t,n)});return s.promise()}function v(t,i){var s=e.Deferred(),n=i.shift();0===n.length?s.resolve(t):f(t,n,!0).then(function(e){i.length>0?v(e,i).then(function(e){s.resolve(e)},function(e,t){s.reject(e,t)}):s.resolve(e)},function(e,t){s.reject(e,t)});return s.promise()}function y(i,s){return t.map(s,function(t){var s=e.Deferred();v(i,t.outputTarget.split("/")).then(function(e){s.resolve({name:t.outputTarget,id:e})},function(e,t){s.reject(e,t)});return s.promise()})}function b(t,s){var n=e.Deferred(),r=c("POST","/api/v1/jobs/"+V),a={parameters:{cmd:"createAsset",layerIds:t.layerIds,assetId:t.psdGuid,encodingType:O[t.encodingType].encodingType,encodingQualityFactor:t.encodingQualityFactor,scale:t.scale,assetName:t.assetName+O[t.encodingType].fileExtension,encoder:"magick"},outputMode:s,inputs:[h(t.psdGuid)]};i.utils.hasFeature("temp_extract_use_layerrange")&&(a.parameters.encoderHints=["layerRangeComposite:on"]);t.layerCompId&&(a.parameters.layerCompId=t.layerCompId);"asset"===s&&t.hasOwnProperty("outputTarget")&&(a.outputTarget="vnd-adobe-sharedcloud.collection:"+t.outputTarget);var o=function(e,t,i){e?n.reject(e):n.resolve(t)};r.data=JSON.stringify(a);e.ajax(r).fail(function(e,t,i){n.reject(t,e)}).done(function(e,t,i){201===i.status&&p(i.getResponseHeader("location"),o)});return n.promise()}function w(e,i){var s={},n={parameters:{cmd:"createAsset",encoder:"magick",assetId:e.psdGuid},inputs:[h(e.psdGuid)],outputMode:"asset"},r=[];t.each(i,function(e){s[e.name]=e.id});t.each(e.jobs,function(e){t.each(e.assets,function(t){var i={worker_id:V,parameters:{layerIds:t.layerIds,encodingType:O[t.encodingType].encodingType,encodingQualityFactor:t.encodingQualityFactor,scale:e.scale,assetName:t.assetName+O[t.encodingType].fileExtension,outputTarget:s[e.outputTarget]}};e.layerCompId&&(i.parameters.layerCompId=e.layerCompId);r.push(i)})});n.seq=r;return JSON.stringify(n)}function x(){if(D)return D;var t=e.Deferred(),i=c("POST","/api/v1/jobs/"+V),s={parameters:{cmd:"workerInfo"},inputs:[]},n=function(e,i,s){if(e){t.reject(e,s);D=null}else if(i.results&&i.results.graphite_workerInfo)t.resolve(JSON.parse(i.results.graphite_workerInfo));else{t.reject(i);D=null}};i.data=JSON.stringify(s);e.ajax(i).fail(function(e,i,s){t.reject(i);D=null}).done(function(e,t,i){201===i.status&&p(i.getResponseHeader("location"),n)});D=t.promise();return D}function S(e,t){var i=e.split("."),s=t.split(".");i[0]=parseInt(i[0],10);i[1]=parseInt(i[1],10);i[2]=parseInt(i[2],10);s[0]=parseInt(s[0],10);s[1]=parseInt(s[1],10);s[2]=parseInt(s[2],10);return i[0]>s[0]||i[0]===s[0]&&i[1]>s[1]||i[0]===s[0]&&i[1]===s[1]&&i[2]>s[2]?!0:!1}function C(t){var i=e.Deferred(),s=function(s,n,r){if(s)i.reject(s,r);else if(n.results)if(n.results.hasOwnProperty(t.resultProp)){var a=n.results[t.resultProp];"string"==typeof a&&(a=JSON.parse(a));i.resolve(a,r)}else e.ajax(t.getOptions).done(function(e,t,s){if(200===s.status){"string"==typeof e&&(e=JSON.parse(e));i.resolve(e,s)}else i.reject(e,s)});else i.reject(n,r)},n=function(){e.ajax(t.workerOptions).fail(function(e,t,s){i.reject(s,e)}).done(function(e,n,r){if(201===r.status){t.workerID&&graphite.events.trigger("showWorkerProgress",t.workerID);p(r.getResponseHeader("location"),s,t.workerID)}else i.reject(e,r)})};e.ajax(t.getOptions).fail(function(e,t,s){404===e.status?n():i.reject(s,e)}).done(function(e,s,r){var a=JSON.parse(e);x().then(function(e){!e[t.versionProp]||a.info&&!S(e[t.versionProp],a.info.version)?i.resolve(a,r):n()},function(e){i.resolve(a,r)})});return i.promise()}function T(e){var s=e.get("layerCompId"),n=s?"-lcid"+s:"",r={},a={parameters:{cmd:"default",jsonVersion:N+".x",assetId:e.id,limits:{maxLayers:U}}};a.outputMode="rendition";a.inputs=["vnd-adobe-sharedcloud.asset:"+e.id];r.getOptions=d("GET","/api/v1/assets/"+e.id+"/renditions/graphite/default_json_data_v"+N+n);r.workerOptions=d("POST","/api/v1/jobs/"+V,!1,graphite.inPublicOneUp()&&graphite.ownerId===i.user.get("userId"));s&&(a.parameters.layerCompId=s);r.workerOptions.data=JSON.stringify(t.extend({},r.workerOptions.data,a));r.workerID=e.id;r.versionProp="json_version";r.resultProp="graphite_json";return C(r)}function I(s,n,r){var a,o=e.Deferred(),l=2|Math.floor(n/500),h=0!==Math.floor(6/l)?Math.floor(6/l):1,u=d("POST","/api/v1/jobs/workflow",!1,graphite.inPublicOneUp()&&graphite.ownerId===i.user.get("userId")),f={seq:[{parameters:{cmd:"spritesheet",assetId:s.id,spriteSheet:{minSheets:h,flattenLayers:!0,includeDrawable:!1}},par:[],child_id:"spritesheetSubJobs",outputMode:"transient"},{worker_id:V,parameters:{cmd:"mergeSpriteSheets",mergeOutputsOf:"spritesheetSubJobs"},outputMode:"rendition"}],inputs:["vnd-adobe-sharedcloud.asset:"+s.id],outputMode:"rendition"};if(s.get("layerCompId")){f.seq[0].parameters.layerCompId=s.get("layerCompId");f.seq[1].parameters.layerCompId=s.get("layerCompId")}for(a=1;l>=a;a++){var g={worker_id:V,parameters:{workflowParms:{currentJobNumber:a,totalJobNumber:l}}};f.seq[0].par.push(g)}u.data=JSON.stringify(t.extend({},u.data,f));var m=function(t,i,s){t?o.reject(t,s):i.results.graphite_spritesheet_json?o.resolve(i.results.graphite_spritesheet_json,s):e.ajax(r).done(function(e,t,i){if(200===i.status){"string"==typeof e&&(e=JSON.parse(e));o.resolve(e,i)}else o.reject(e,i)})},v=function(t){e.ajax(c("GET",t,!0)).done(function(e,i,s){200===s.status&&e.children&&e.children.childJobs&&e.children.childJobs[1]&&e.children.childJobs[1].job?p(e.children.childJobs[1].job,m):setTimeout(function(){v(t)},500)})};e.ajax(u).fail(function(e,t,i){o.reject(i,e)}).done(function(e,t,i){201===i.status?v(i.getResponseHeader("location")):o.reject(e,i)});return o.promise()}function E(s){var n=e.Deferred(),r=s.get("layerCompId"),a=r?"-lcid"+r:"",o={},l={parameters:{cmd:"spritesheet",assetId:s.id,spriteSheet:{minSheets:6,flattenLayers:!0,includeDrawable:!1},limits:{maxLayers:U}}};l.outputMode="rendition";l.inputs=["vnd-adobe-sharedcloud.asset:"+s.id];o.getOptions=d("GET","/api/v1/assets/"+s.id+"/renditions/graphite/spritesheet_json_data"+a);o.workerOptions=d("POST","/api/v1/jobs/"+V,!1,graphite.inPublicOneUp()&&graphite.ownerId===i.user.get("userId"));r&&(l.parameters.layerCompId=r);o.versionProp="spritesheet_version";o.resultProp="graphite_json";var c=function(){o.workerOptions.data=JSON.stringify(t.extend({},o.workerOptions.data,l));C(o).then(function(e,t){n.resolve(e,t)},function(e,t){if("use_workflow_job"===e.errorCode){var i=e.errorMessage.split(":")[1];I(s,i,o.getOptions).then(function(e,t){n.resolve(e,t)},function(e,t){n.reject(e,t)})}else n.reject(e,t)})};x().then(function(e){e.version&&S(e.version,"1.0.78")?l.parameters.workflowLayerLimit=750:l.parameters.undoc=["refreshVisibility"];c()},function(e){l.parameters.undoc=["refreshVisibility"];c()});return n.promise()}function P(t,i,s,a){var o=e.Deferred(),l=c("GET","/api/v1/collections/"+t),d=function(e,t){var i=new n;i.set(i.parse(e));t.push(i);return i};e.ajax(l).fail(function(e,t,n){s?o.resolve(i):o.reject(t)}).done(function(t){var s,n,l,c=[],h=[];for(s in t.assets)t.assets.hasOwnProperty(s)&&d(t.assets[s],c);if(a)for(s in t.sub_collections)if(t.sub_collections.hasOwnProperty(s)){n=d(t.sub_collections[s],c);l=new r;n.set("childAssets",l);h.push(P(n.get("id"),l,!0,a))}i.reset(c);0===h.length?o.resolve(i):e.when.apply(e,h).then(function(e){o.resolve(i)})});return o.promise()}function M(t){var i=e.Deferred();$.hasOwnProperty(t)?i.resolve($[t]):H.loadAssetData(t,"dummyKey",function(e){i.resolve($[t])},function(e){i.reject(e)});return i.promise()}function L(t){var i=e.Deferred();R.hasOwnProperty(t)?i.resolve(R[t]):H.loadGenericData(t,"dummyKey",function(e){i.resolve(R[t])},function(e){i.reject(e)});return i.promise()}function A(t){e.ajax(d("GET","/api/v1/assets/"+t+"/metadata")).done(function(e,i,s){200===s.status&&(F[t]=e.asset.updated)})}function k(t,i){var s=e.Deferred();m(t,i).then(function(t){if(t){var i=c("GET","/api/v1/collections/"+t.collectionId);e.ajax(i).then(function(e,i,n){var r,a={collectionID:t.collectionId,filename:"_extract.manifest"};for(r=0;r<e.assets.length;r++)if(e.assets[r].name===a.filename){a.manifestID=e.assets[r].id;break}s.resolve(a)},function(e,t){s.reject(t,e)})}else s.resolve({})},function(e,t){s.reject(e,t)});return s.promise()}var D,O={png8:{fileExtension:".png",encodingType:"png8"},png32:{fileExtension:".png",encodingType:"png"},svg:{fileExtension:".svg",encodingType:"svg"},jpeg:{fileExtension:".jpg",encodingType:"jpeg"}},F={},R={},$={},_=1,U=1500,V="GraphiteJSONExtractionWorker",N="2",H={loadPsdModel:function(e,s,n,r){var a=e.get("layerCompId"),o=a?"-lcid"+a:"",l={},c={parameters:{cmd:"graphiteRenditions",assetId:e.id,maxLayers:1500,spriteSheet:{minSheets:6,includeDrawable:!1,flattenLayers:!0}}},h=function(t,i){t.dataType="complete";e.parse(t);s.apply(r,[i])},p=function(e,t){n.apply(r,[t,e])};c.outputMode="rendition";c.inputs=["vnd-adobe-sharedcloud.asset:"+e.id];l.getOptions=d("GET","/api/v1/assets/"+e.id+"/renditions/graphite/json_data_v"+N+o);l.workerOptions=d("POST","/api/v1/jobs/"+V,!1,graphite.inPublicOneUp()&&graphite.ownerId===i.user.get("userId"));a&&(c.parameters.layerCompId=a);l.workerOptions.data=JSON.stringify(t.extend({},l.workerOptions.data,c));l.workerID=e.id;l.versionProp="json_version";l.resultProp="graphite_json";A(e.id);C(l).then(h,p)},loadPsdModel2:function(e,t,i,s){A(e.id);T(e).then(function(i,n){i.dataType="JSONOnly";e.parse(i);t.apply(s,[n])},function(e,t){var n=t.responseText;try{n=JSON.parse(t.responseText)}catch(r){}i.apply(s,[t,n,"JSON"])});E(e).then(function(t,i){t.dataType="spriteSheetOnly";e.parse(t)},function(e,t){i.apply(s,[t,e,"spriteSheet"])})},loadAssetData:function(t,i,s,n,r){k(t,!1).then(function(a){if(a.manifestID){var o=c("GET","/api/v1/assets/"+a.manifestID);e.ajax(o).fail(function(e,t,i){n.apply(r,[e])}).done(function(e,n,a){"string"==typeof e&&(e=JSON.parse(e));var o={etag:a.getResponseHeader("etag"),data:e};$[t]=o;var l={etag:a.getResponseHeader("etag")};e&&(l.data=e[i]);s.apply(r,[l])})}else{$[t]={};s.apply(r,[{}])}},function(e){n.apply(r,[e])})},updateAssetData:function(t,i,s,n,r,a,o){var l=this;o=void 0===o?1:o;e.when(k(t,!0),M(t)).fail(function(e,t){r.apply(a,[e||t])}).done(function(d,h){h.data||(h.data={});h.data[i]=s.apply(a,[h.data[i]]);var p;if(d.manifestID){p=c("PUT","/api/v1/assets/"+d.manifestID);p.headers["If-Match"]=h.etag}else p=c("POST","/api/v1/collections/"+d.collectionID);p.headers["Content-Type"]="application/json";p.headers["Content-Disposition"]="inline; filename="+encodeURIComponent(d.filename);p.data=JSON.stringify(h.data);p.dataType="text";e.ajax(p).fail(function(e,c,d){if(o){delete $[t];l.updateAssetData(t,i,s,n,r,a,o-1)}else r.apply(a,[e])}).done(function(e,t,s){var r={data:h.data[i],etag:s.getResponseHeader("etag"),needRefresh:o!==_};h.etag=r.etag;n.apply(a,[r])})})},loadGenericData:function(t,i,s,n,r){var a=d("GET","/api/v1/assets/"+t+"/metadata/asset_custom_metadata");e.ajax(a).error(function(e,t,i){n.apply(r,[e])}).done(function(e,n,a){var o={etag:a.getResponseHeader("etag"),data:e};R[t]=o;var l={etag:a.getResponseHeader("etag")};e&&e.custom&&e.custom[i]&&(l.data=e.custom[i]);s.apply(r,[l])})},updateGenericData:function(t,i,s,n,r,a,o){var l=this;o=void 0===o?_:o;L(t).then(function(d){d.data||(d.data={});d.data.custom||(d.data.custom={});d.data.custom[i]=s.apply(a,[d.data.custom[i]]);var h=c("PUT","/api/v1/assets/"+t+"/metadata/asset_custom_metadata");h.headers["If-Match"]=d.etag;h.headers["Content-Type"]="application/json";h.data=JSON.stringify(d.data);h.dataType="text";e.ajax(h).error(function(e,c,d){if(o&&412===e.status){delete R[t];l.updateGenericData(t,i,s,n,r,a,o-1)}else r.apply(a,[e])}).done(function(e,t,s){var r={data:d.data.custom[i],etag:s.getResponseHeader("etag"),needRefresh:o!==_};d.etag=r.etag;n.apply(a,[r])})},function(e){r.apply(a,[e])})},loadDerivedAssetCollection:function(e,t,i,s,n){m(t.get("id"),!1).then(function(t){if(t)P(t.collectionId,e,!1,!1).then(function(e){i.apply(n,[{status:e,collectionId:t.collectionId}])},function(e){s.apply(n,[e])});else{e.reset();i.apply(n,[{responseText:"",collectionId:""}])}},function(e){s.apply(n,[e])})},getAssetCollectionID:function(e,t,i,s,n){m(e,t).then(function(e){i.apply(n,[e.collectionId])},function(e){s.apply(n,[e])})},createDerivedAsset:function(e,t,i,s,n){t?b(e,"transient").then(function(e){var t={id:u(e.outputs[0]),url:e.outputs[0],name:e.results.graphite_asset.name};i.apply(n,[{responseText:JSON.stringify(t)}])},function(e){s.apply(n,[e])}):m(e.psdGuid,!0).then(function(t){e.outputTarget=t.collectionId;b(e,"asset").then(function(e){e.outputs&&e.outputs.length>0?i.apply(n,[{responseText:JSON.stringify({id:u(e.outputs[0]),url:e.outputs[0],name:e.results.graphite_asset.name})}]):s.apply(n,[{status:507}])},function(e){s.apply(n,[e])})},function(e){s.apply(n,[e])})},_batchCreateDerivedAssets:function(t,i,s,n){var r=t.jobs.length,a=function(t){var i=c("POST","/api/v1/collections/"+t.parameters.outputTarget+"?op=move"),s={resources:[{href:t.outputs[0],name:t.parameters.assetName,"if-match":'"*"'}]};i.data=JSON.stringify(s);i.headers["If-Match"]="*";i.headers["Content-Type"]="application/x-sharedcloud-resources+json";e.ajax(i).complete(function(e,t){r--})},o=function(t,i,s){if(!t){var n=c("GET","/api/v1/collections/"+i.parameters.outputTarget);e.ajax(n).fail(function(e,t,s){a(i)}).done(function(t,s,n){if(t.assets){var r,o=!0;for(r=0;r<t.assets.length;r++)if(t.assets[r].name===i.parameters.assetName){o=!1;break}if(o)a(i);else{var l=c("HEAD","/api/v1/assets/"+t.assets[r].id);e.ajax(l).done(function(t,s,n){l.headers["If-Match"]=n.getResponseHeader("etag");l.type="DELETE";e.ajax(l).done(function(e,t,s){a(i)})})}}else a(i)})}},l=function(e,t,r){if(e)s.apply(n,[e]);else{var a,c=l;"seq"===t.children.mode&&(c=o);for(a=0;a<t.children.childJobs.length;a++)p(t.children.childJobs[a].job,c);i.apply(n,[t])}};m(t.psdGuid,!0).then(function(i){e.when.apply(e,y(i.collectionId,t.jobs)).then(function(){var i=c("POST","/api/v1/jobs/workflow");i.data=w(t,arguments);e.ajax(i).fail(function(e,t,i){s.apply(n,[t])}).done(function(e,t,i){201===i.status&&p(i.getResponseHeader("location"),l)})},function(e){s.apply(n,[e])})},function(e){s.apply(n,[e])})},_batchCreateDerivedAssets2:function(i,s,n,r){var a=0,o=0,l=function(e,t,l){a++;e&&o++;a===i.jobs.length&&(o===a?n.apply(r,[a]):s.apply(r,[a,o]))};m(i.psdGuid,!0).then(function(s){t.each(i.jobs,function(n){v(s.collectionId,n.outputTarget.split("/")).then(function(s){var r=c("POST","/api/v1/jobs/"+V),a={parameters:{cmd:"batchCreateAssets",assetId:i.psdGuid,scale:n.scale,assets:[]},outputMode:"asset",inputs:[h(i.psdGuid)],outputTarget:"vnd-adobe-sharedcloud.collection:"+s};t.each(n.assets,function(e){var t={layerIds:e.layerIds,encodingType:O[e.encodingType].encodingType,encodingQualityFactor:e.encodingQualityFactor,assetName:e.assetName+O[e.encodingType].fileExtension};a.parameters.assets.push(t)});n.layerCompId&&(a.parameters.layerCompId=n.layerCompId);r.data=JSON.stringify(a);e.ajax(r).fail(function(e,t,i){l(i,t,e)}).done(function(e,t,i){201===i.status&&p(i.getResponseHeader("location"),l)})},function(e){l(e)})})},function(e){n.apply(r,[e])})},batchCreateDerivedAssets:function(e,t,i,s){var n=this;graphite.inPublicOneUp()||x().then(function(r){r.version&&S(r.version,"1.0.73")?n._batchCreateDerivedAssets2(e,t,i,s):n._batchCreateDerivedAssets(e,t,i,s)},function(r){n._batchCreateDerivedAssets(e,t,i,s)})},getWorkerStatus:function(t,i,s,n){var r=c("GET","/api/v1/jobs/"+t);a(r,i,s,n);e.ajax(r)},getSpriteSheetURL:function(e,t,i){var s=t?"-lcid"+t:"";return l("/api/v1/assets/"+e+"/renditions/graphite/SpriteSheet-"+i+s)+(F.hasOwnProperty(e)?"&time="+F[e]:"")},getSharedUserID:function(){var e=null;if(i.utils.hasCookiesEnabled()){e=i.utils.getCookie("fid");if(!e){var t=i.utils.getCookie("s_pers");t&&(e=this.extractfid(t))}e||(e=i.utils.getCookie("s_fid"))}e||(e=this.createfid());return e},extractfid:function(e){var t=decodeURIComponent(e);if(t){var i=t.split("s_fid=");if(i.length>1){var s=i[1].split("|");if(s.length>0)return s[0]}}return null},createfid:function(){return"xxxxxxxxxxxxxxxx-xxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16).toUpperCase()})},registerPersistentParameters:function(e){},trackEvent:function(e,t,s,n){var r=this.getSharedUserID();r&&i.utils.hasCookiesEnabled()&&i.utils.setCookie("fid",r);e.fid=r;var a=i.log("ccweb.files.extract");a("metrics:",e);var o={code:"EDGE_EXTRACT",sub_code:"INTERACTION",ets:e.timestamp,epd:e},l=i.utils.etsSendEvent(o);l.then(t,s)},getDerivedRenditionURL:function(e){return o("/api/v1/assets/"+e+"/renditions/png/240")},getDerivedDownloadURL:function(e,t){return o("/api/v1/assets/"+e)+"&download=true&filename="+encodeURIComponent(t).replace(/'/g,"%27")},deleteDerivedAsset:function(t,i,s,n){var r=c("HEAD","/api/v1/assets/"+t);e.ajax(r).done(function(r,o,l){var d=c("DELETE","/api/v1/assets/"+t);d.headers["If-Match"]=l.getResponseHeader("etag");a(d,i,s,n);e.ajax(d)}).fail(function(e,t,i){s.apply(n,[e])})},getDefaultRenditionURL:function(e){return o("/api/v1/assets/"+e+"/renditions/jpeg/1200")},getDerivedSpriteImage:function(e,t,i,s,n){var r=new Image,a=this,l={layerIds:t,psdGuid:e.id,encodingType:"png32",encodingQualityFactor:100};e.get("layerCompId")&&(l.layerCompId=e.get("layerCompId"));if(n){r.addEventListener("load",function(){i.apply(n)});r.addEventListener("error",function(){s.apply(n)})}else{r.addEventListener("load",i);r.addEventListener("error",s)}b(l,"transient").then(function(e){a.loadCrossDomainImage(r,o(e.outputs[0],!0))},function(e){s.apply(n)});return r},getAssetETag:function(t,i,s,n){var r=c("HEAD","/api/v1/assets/"+t);a(r,i,s,n);e.ajax(r)},loadCrossDomainImage:function(e,t){try{e&&(e.crossOrigin="Anonymous")}catch(i){}if(-1!==navigator.appVersion.indexOf("MSIE 10.")&&window.URL&&window.URL.createObjectURL){e.crossOrigin="anonymous";var s=new XMLHttpRequest;s.onreadystatechange=function(){4===s.readyState&&200===s.status&&(e.src=window.URL.createObjectURL(s.response))};s.open("GET",t,!0);s.responseType="blob";s.send()}else e.src=t}};return H});define("ccweb.files.extract/external/jquery.mxhr",["jquery"],function(e){"use strict";e.multipart=function(t){function i(){this.headers={};this.header="";this.body=null}function s(){this.boundary=null;this.boundaryChars=null;this.lookbehind=null;this.state=r.PARSER_UNINITIALIZED;this.index=null;this.flags=0;this._part=new i}var n=0,r={PARSER_UNINITIALIZED:n++,START:n++,START_BOUNDARY:n++,HEADER_FIELD_START:n++,HEADER_FIELD:n++,HEADER_VALUE_START:n++,HEADER_VALUE:n++,HEADER_VALUE_ALMOST_DONE:n++,HEADERS_ALMOST_DONE:n++,PART_DATA_START:n++,PART_DATA:n++,PART_END:n++,END:n++},a=1,o={PART_BOUNDARY:a,LAST_BOUNDARY:a*=2},l=10,c=13,d=32,h=45,p=58,u=97,f=122,g=function(e){return 32|e};s.prototype.Uint8Concat=function(e,t){var i=e.length,s=new Uint8Array(i+t.length);s.set(e);s.set(t,i);return s};s.prototype.unpackString=function(e){var t=new Uint8Array(e.length),i=e.length,s=0;for(s=0;i>s;s++)e.charCodeAt(s)&&(t[s]=e.charCodeAt(s));return t};s.prototype.initWithBoundary=function(e){var t=0;this.boundary=new Uint8Array(e.length+4);this.boundary=this.unpackString("\r\n"+e);this.lookbehind=new Uint8Array(this.boundary.length+8);this.state=r.START;this.boundaryChars={};for(t=0;t<this.boundary.length;t++)this.boundaryChars[this.boundary[t]]=!0};s.prototype.write=function(e){var t,i,s=this,n=new Uint8Array(e),a=0,m=n.length,v=this.index,y=this.index,b=this.state,w=this.flags,x=this.lookbehind,S=this.boundary,C=this.boundaryChars,T=this.boundary.length,I=T-1,E=n.length,P=function(e){s[e+"Mark"]=a},M=function(e){delete s[e+"Mark"]},L=function(e,t,i,n){if(void 0===i||i!==n){var r="on"+e.substr(0,1).toUpperCase()+e.substr(1);r in s&&s[r](t,i,n)}},A=function(e,t){var i=e+"Mark";if(i in s)if(t){L(e,n,s[i],a);delete s[i]}else{L(e,n,s[i],n.length);s[i]=0}};for(a=0;m>a;a++){t=n[a];switch(b){case r.PARSER_UNINITIALIZED:return a;case r.START:y=0;b=r.START_BOUNDARY;case r.START_BOUNDARY:if(y===S.length-2){if(t===h)w|=o.LAST_BOUNDARY;else if(t!==c)return a;y++;break}if(y-1===S.length-2){if(w&o.LAST_BOUNDARY&&t===h){L("end");b=r.END;w=0}else{if(w&o.LAST_BOUNDARY||t!==l)return a;y=0;L("partBegin");b=r.HEADER_FIELD_START}break}t!==S[y+2]&&(y=-2);t===S[y+2]&&y++;break;case r.HEADER_FIELD_START:b=r.HEADER_FIELD;P("headerField");y=0;case r.HEADER_FIELD:if(t===c){M("headerField");b=r.HEADERS_ALMOST_DONE;break}y++;if(t===h)break;if(t===p){if(1===y)return a;A("headerField",!0);b=r.HEADER_VALUE_START;break}i=g(t);if(u>i||i>f)return a;break;case r.HEADER_VALUE_START:if(t===d)break;P("headerValue");b=r.HEADER_VALUE;case r.HEADER_VALUE:if(t===c){A("headerValue",!0);L("headerEnd");b=r.HEADER_VALUE_ALMOST_DONE}break;case r.HEADER_VALUE_ALMOST_DONE:if(t!==l)return a;b=r.HEADER_FIELD_START;break;case r.HEADERS_ALMOST_DONE:if(t!==l)return a;L("headersEnd");b=r.PART_DATA_START;break;case r.PART_DATA_START:b=r.PART_DATA;P("partData");case r.PART_DATA:v=y;if(0===y){a+=I;for(;E>a&&!(n[a]in C);)a+=T;a-=I;t=n[a]}if(y<S.length)if(S[y]===t){0===y&&A("partData",!0);y++}else y=0;else if(y===S.length){y++;t===c?w|=o.PART_BOUNDARY:t===h?w|=o.LAST_BOUNDARY:y=0}else if(y-1===S.length)if(w&o.PART_BOUNDARY){y=0;if(t===l){w&=~o.PART_BOUNDARY;L("partEnd");L("partBegin");b=r.HEADER_FIELD_START;break}}else if(w&o.LAST_BOUNDARY)if(t===h){L("partEnd");L("end");b=r.END;w=0}else y=0;else y=0;if(y>0)x[y-1]=t;else if(v>0){
L("partData",x,0,v);v=0;P("partData");a--}break;case r.END:break;default:return a}}A("headerField");A("headerValue");A("partData");this.index=y;this.state=b;this.flags=w;return m};s.prototype.onHeaderField=function(e,t,i){var s=String.fromCharCode.apply(null,e.subarray(t,i));this._part.header=s};s.prototype.onHeaderValue=function(e,t,i){this._part.headers[this._part.header]=String.fromCharCode.apply(null,e.subarray(t,i))};s.prototype.onPartData=function(e,t,i){e.subarray(t,i),this._part.headers["Content-Type"];this._part.body?this._part.body=this.Uint8Concat(this._part.body,e.subarray(t,i)):this._part.body=e.subarray(t,i)};s.prototype.onPartEnd=function(){var e=this._part.headers["Content-Type"];if(t[e]&&this._part.body){t[e].call(this._part.body,this._part.headers["Content-Id"]);this._part.body=null;this._part.headers={};this._part.header=""}};s.prototype.onEnd=function(){t.hasOwnProperty("onSuccess")&&t.onSuccess.call(this)};s.prototype.end=function(){var e=function(e,t){var i="on"+t.substr(0,1).toUpperCase()+t.substr(1);i in e&&e[i]()};if(this.state===r.HEADER_FIELD_START&&0===this.index||this.state===r.PART_DATA&&this.index===this.boundary.length){e(this,"partEnd");e(this,"end")}else if(this.state!==r.END)return new Error("MultipartParser.end(): stream ended unexpectedly: "+this.state)};var m,v,y=t.url,b=t.type||"GET",w=t.data||!1,x=e("meta[name='csrf-token']").attr("content"),S=t.headers,C=function(){if(3===m.readyState){var e=m.getResponseHeader("Content-Type");-1===e.indexOf("multipart")?m.onreadystatechange=function(){m.onreadystatechange=function(){};t.hasOwnProperty("onError")&&t.onError.call(m.status)}:v="--"+/boundary=([^\x3B]+)/.exec(e)[1]}if(4===m.readyState&&200===m.status){var i=m.response,n=new s;n.initWithBoundary(v);n.write(i)}else 4===m.readyState&&200!==m.status&&t.hasOwnProperty("onError")&&t.onError.call(m.status)};try{m=new ActiveXObject("MSXML2.XMLHTTP.6.0")}catch(T){try{m=new ActiveXObject("MSXML3.XMLHTTP")}catch(I){try{m=new XMLHttpRequest}catch(E){throw new Error("Could not find supported version of XMLHttpRequest.")}}}m.responseType="arraybuffer";m.open(b,y,!0);m.onreadystatechange=C;x&&m.setRequestHeader("X-CSRF-Token",x);S&&e.each(S,function(e,t){m.setRequestHeader(e,t)});m.send(w?w:null)}});define("ccweb.files.extract/serverExtractAPI",["jquery","underscore","plugin-dependencies","ccweb.files.extract/models/DerivedAssetModel","ccweb.files.extract/collections/DerivedAssetCollection","ccweb.files.extract/external/jquery.mxhr","ccweb.files.extract/cceco/StorageServiceAPI"],function(e,t,i,s,n,r,a){"use strict";function o(e,t,i,s){t&&(e.success=function(e,i,n){t.apply(s,[n])});i&&(e.error=function(e){i.apply(s,[e])})}function l(e,t){var i={svg:"image/svg+xml",png8:"image/png; x-format=png-8",png32:"image/png",jpeg:"image/jpeg"},s=i[e];"jpeg"===e&&void 0!==t&&(s=s+"; q="+t/100);return s}function c(e,t,s){var n={type:e,url:E+(s?"/public":"")+t+"?api_key=webpagraphics&debug=true",headers:{"Content-type":"application/vnd.adobe.image-operation+json"}};i.auth.token&&(n.headers.authorization=i.auth.token);return n}function d(e,t){return t?E+"/public"+e+"?api_key=webpagraphics":E+e+"?api_key=webpagraphics&user_token="+i.auth.token.substring(7)}function h(e,t,s){s=s||!1;var n={type:e,url:i.config.sharedcloud_proxy_url+"/api",headers:{"x-location":s?t:graphite.urlBase+t,authorization:i.auth.token}};return n}function p(e){return"image/png"===e||"image/svg+xml"===e||"image/jpg"===e}function u(e){var t,i,s,n,r="";for(t=0;t<e.length;t++){i=e[t];switch(i>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(i);break;case 12:case 13:s=e[++t];r+=String.fromCharCode((31&i)<<6|63&s);break;case 14:s=e[++t];n=e[++t];r+=String.fromCharCode((15&i)<<12|(63&s)<<6|(63&n)<<0)}}return r}function f(e){var t,i=32768,s="";for(t=0;t<e.length;t+=i)s+=String.fromCharCode.apply(null,e.subarray(t,t+i));return window.btoa(s)}function g(e){return graphite.inPublicOneUp()?{cclink:graphite.linkId}:{sharedcloud:e.id}}function m(t){var i=e.Deferred(),s=c("POST","/introspect",graphite.inPublicOneUp()),n={inputs:{image:g(t)},options:{rendition:!0}};t.get("layerCompId")&&(n.options.layerCompId=t.get("layerCompId"));s.data=JSON.stringify(n);s["application/vnd.adobe.image-operation+json"]=function(e){};s["application/json"]=function(e){i.resolve(JSON.parse(u(this)))};s.onError=function(){i.reject(this)};e.multipart(s);return i.promise()}function v(t){var i,s=e.Deferred(),n=c("POST","/spritesheet",graphite.inPublicOneUp()),r={inputs:{image:{sharedcloud:t.id}},options:{flattenLayers:!0,rendition:!0},outputs:{sheets:{disposition:"location"}}};t.get("layerCompId")&&(r.options.layerCompId=t.get("layerCompId"));w=[];n.data=JSON.stringify(r);n["application/vnd.adobe.image-operation+json"]=function(e){};n["application/json"]=function(e){i=JSON.parse(u(this))};n.onError=function(){s.reject()};n.onSuccess=function(){s.resolve(i)};e.multipart(n);return s.promise()}function y(t){var i=e.Deferred();C.hasOwnProperty(t)?i.resolve(C[t]):P.loadGenericData(t,"dummyKey",function(e){i.resolve(C[t])},function(e){i.reject(e)});return i.promise()}function b(t){var i=e.Deferred();if(T.hasOwnProperty(t)){var s=T[t];if(s.promise)return s.promise;i.resolve(s)}else{var n={promise:i.promise()};T[t]=n;a.assetDirectory(t).then(function(e){e+="/_extract.manifest";a.fetchContents(e).then(function(s,n){var r={etag:n,data:"string"==typeof s?JSON.parse(s):s,path:e};T[t]=r;i.resolve(r)},function(s){var n={data:{},path:e};T[t]=n;i.resolve(n)})},function(e){i.reject(e)})}return i.promise()}var w,x={svg:".svg",png8:".png",png32:".png",jpeg:".jpg"},S={},C={},T={},I=1,E="https://cc-api-extract.adobe.io";"https://stage.adobecc.com"===i.stellarConfig.get("it_base_url")&&(E="https://cc-api-extract-stage.adobe.io");var P={loadPsdModel:function(e,t,i,s){S[e.id]=e.get("modified");m(e).then(function(i,n){i.dataType="JSONOnly";e.parse(i);t.apply(s,[n])},function(e){i.apply(s,[{status:e}])});v(e).then(function(t,i){t.dataType="spriteSheetOnly";e.parse(t)})},loadPsdModel2:function(e,t,i,s){return this.loadPsdModel(e,t,i,s)},loadAssetData:function(e,t,i,s,n){b(e).then(function(e){var s={etag:e.etag};e.data&&(s.data=e.data[t]);i.apply(n,[s])},function(e){s.apply(n,[e])})},updateAssetData:function(e,t,i,s,n,r,o){var l=this;o=void 0===o?1:o;b(e).then(function(c){c.data[t]=i.apply(r,[c.data[t]]);a.storeContents(c.path,c.etag,JSON.stringify(c.data)).then(function(e){var i={data:c.data[t],etag:e,needRefresh:o!==I};c.etag=e;s.apply(r,[i])},function(a){if(o){delete T[e];l.updateAssetData(e,t,i,s,n,r,o-1)}else n.apply(r,[a])})},function(e){n.apply(r,[e])})},loadGenericData:function(t,i,s,n,r){var a=c("GET","/metadata/sharedcloud/"+t);e.ajax(a).error(function(e,t,i){n.apply(r,[e])}).done(function(e,n,a){var o={etag:a.getResponseHeader("etag"),data:e};C[t]=o;var l={etag:a.getResponseHeader("etag")};e&&e.custom&&e.custom[i]&&(l.data=e.custom[i]);s.apply(r,[l])})},updateGenericData:function(t,i,s,n,r,a,o){var l=this;o=void 0===o?I:o;y(t).then(function(d){d.data||(d.data={});d.data.custom||(d.data.custom={});d.data.custom[i]=s.apply(a,[d.data.custom[i]]);var h=c("PUT","/metadata/sharedcloud/"+t);h.headers["If-Match"]=d.etag;h.headers["Content-Type"]="application/json";h.data=JSON.stringify(d.data);h.dataType="text";e.ajax(h).error(function(e,c,d){if(o&&412===e.status){delete C[t];l.updateGenericData(t,i,s,n,r,a,o-1)}else r.apply(a,[e])}).done(function(e,t,s){var r={data:d.data.custom[i],etag:s.getResponseHeader("etag"),needRefresh:o!==I};d.etag=r.etag;n.apply(a,[r])})},function(e){r.apply(a,[e])})},loadDerivedAssetCollection:function(e,t,i,n,r){a.assetDirectory(t.get("id")).then(function(t){a.fetchContents(t).then(function(n){var o,l,c=[];for(o in n.children)if(n.children.hasOwnProperty(o)&&p(n.children[o].type)){l=new s;l.set(n.children[o]);l.set("guid",t+"/"+l.get("name"));l.set("mimeType",l.get("type"));c.push(l)}e.reset(c);a.storageId(t).then(function(t){i.apply(r,[{status:e,collectionId:t[1]}])})},function(e){n.apply(r,[e])})},function(e){n.apply(r,[e])})},getAssetCollectionID:function(e,t,i,s,n){a.assetDirectory(e).then(function(e){a.storageId(e).then(function(e){i.apply(n,[e[1]])})},function(e){s.apply(n,[e])})},createDerivedAsset:function(t,i,s,n,r){var o=c("POST","/createwebasset",graphite.inPublicOneUp()),d={inputs:{image:{sharedcloud:t.psdGuid}},options:{layerIds:t.layerIds},outputs:{output:{accept:l(t.encodingType,t.encodingQualityFactor),disposition:"location"}}},h=function(){o.data=JSON.stringify(d);e.ajax(o).fail(function(e,t,i){n.apply(r,[e])}).done(function(e,i,n){var a={id:e.outputs.output.location,url:e.outputs.output.location,name:t.assetName+x[t.encodingType]};s.apply(r,[{responseText:JSON.stringify(a)}])})};t.layerCompId&&(d.options.layerCompId=t.layerCompId);t.scale&&(d.options.scale=t.scale);i?h():a.assetDirectory(t.psdGuid).then(function(i){d.outputs.output.location=i+"/"+t.assetName+x[t.encodingType];t.update?e.ajax(a.metadataOptions(d.outputs.output.location)).fail(function(e){n.apply(r,[e])}).done(function(e,t,i){d.outputs.output["If-Match"]=i.getResponseHeader("etag");h()}):h()},function(e){n.apply(r,[e])})},batchCreateDerivedAssets:function(i,s,n,r){graphite.inPublicOneUp()||a.assetDirectory(i.psdGuid).then(function(a){var o=c("POST","/batchcreatewebasset"),d={};t.each(i.jobs,function(e){var s=d[e.layerCompId||"default"];if(!s){s={index:1,postData:{inputs:{image:{sharedcloud:i.psdGuid}},options:{},outputs:{}}};e.layerCompId&&(s.postData.options.layerCompId=e.layerCompId);d[e.layerCompId||"default"]=s}t.each(e.assets,function(t){s.postData.outputs["asset"+s.index++]={accept:l(t.encodingType,t.encodingQuality),location:a+"/"+e.outputTarget+t.assetName+x[t.encodingType],options:{layerIds:t.layerIds,scale:e.scale,svgEncodingType:t.svgEncodingType,svgEncodingQuality:t.svgEncodingQuality}}})});var h,p=[];for(h in d)if(d.hasOwnProperty(h)){o.data=JSON.stringify(d[h].postData);p.push(e.ajax(o))}e.when.apply(e,p).fail(function(e){n.apply(r,[e])}).done(function(e){s.apply(r,[e])})},function(e){n.apply(r,[e])})},getWorkerStatus:function(t,i,s,n){var r=h("GET","/api/v1/jobs/"+t);o(r,i,s,n);e.ajax(r)},getSpriteSheetURL:function(e,t,i){var s=t?"/layerComp/"+t:"";return graphite.inPublicOneUp()?d("/spritesheet/cclink/"+graphite.linkId+"/"+i+s,!0):d("/spritesheet/sharedcloud/"+e+"/"+i+s,!1)},getSharedUserID:function(){var e=null;if(i.utils.hasCookiesEnabled()){e=i.utils.getCookie("fid");if(!e){var t=i.utils.getCookie("s_pers");t&&(e=this.extractfid(t))}e||(e=i.utils.getCookie("s_fid"))}e||(e=this.createfid());return e},extractfid:function(e){var t=decodeURIComponent(e);if(t){var i=t.split("s_fid=");if(i.length>1){var s=i[1].split("|");if(s.length>0)return s[0]}}return null},createfid:function(){return"xxxxxxxxxxxxxxxx-xxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"===e?t:3&t|8;return i.toString(16).toUpperCase()})},registerPersistentParameters:function(e){},trackEvent:function(e,t,s,n){var r=this.getSharedUserID();r&&i.utils.hasCookiesEnabled()&&i.utils.setCookie("fid",r);e.fid=r;var a=i.log("ccweb.files.extract");a("metrics:",e);var o={code:"EDGE_EXTRACT",sub_code:"INTERACTION",ets:e.timestamp,epd:e},l=i.utils.etsSendEvent(o);l.then(t,s)},getDerivedRenditionURL:function(e){return a.renditionURL(e,"image/png",240)},getDerivedDownloadURL:function(e,t){return a.downloadURL(e,t)},deleteDerivedAsset:function(e,t,i,s){a.archive(e).then(function(e){t.apply(s,[e])},function(e){i.apply(s,[e])})},getDefaultRenditionURL:function(e){return a.renditionURL(e,"image/jpeg",1200)},getDerivedSpriteImage:function(t,i,s,n,r){var a=new Image,o=this;if(r){a.addEventListener("load",function(){s.apply(r)});a.addEventListener("error",function(){n.apply(r)})}else{a.addEventListener("load",s);a.addEventListener("error",n)}var l=c("POST","/createwebasset"),d={inputs:{image:{sharedcloud:t.id}},options:{layerIds:i,layerCompId:t.get("layerCompId")},outputs:{output:{accept:"image/png"}}};l.data=JSON.stringify(d);l["application/vnd.adobe.image-operation+json"]=function(e){};l["image/png"]=function(e){o.loadCrossDomainImage(a,"data:image/png;base64,"+f(this))};l.onError=function(){n.apply(r)};e.multipart(l);return a},getAssetETag:function(t,i,s,n){var r=a.metadataOptions(t);o(r,i,s,n);e.ajax(r)},loadCrossDomainImage:function(e,t){try{e&&(e.crossOrigin="Anonymous")}catch(i){}if(-1!==navigator.appVersion.indexOf("MSIE 10.")&&window.URL&&window.URL.createObjectURL){e.crossOrigin="anonymous";var s=new XMLHttpRequest;s.onreadystatechange=function(){4===s.readyState&&200===s.status&&(e.src=window.URL.createObjectURL(s.response))};s.open("GET",t,!0);s.responseType="blob";s.send()}else e.src=t}};return P});define("ccweb.files.extract/utils/AutomationTestUtils",["underscore","ccweb.files.extract/controllers/SelectionController","ccweb.files.extract/models/LayerModelMap"],function(e,t,i){"use strict";var s={selectLayers:function(e){if(!Array.isArray(e)){if("string"!=typeof e)return!1;e=[e]}for(var s,n=[],r=0;r<e.length;r++){s=i.getLayerModelFromName(e[r]);s&&n.push(s)}t.changeSelection(n,!1,!1);return!0}};return s});define("libs/require/css/css",["./normalize"],function(e){function t(e,t){for(var i=0,s=e.length;s>i;i++)if(e[i]===t)return i;return-1}if("undefined"==typeof window)return{load:function(e,t,i){i()}};var i=!1,s=document.getElementsByTagName("head")[0],n=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)/),r=!1;if(n)if(n[1]||n[7]){r=parseInt(n[1])<6||parseInt(n[7])<=9;n="trident"}else if(n[2]){r=!0;n="webkit"}else if(n[3]);else if(n[4]){r=parseInt(n[4])<18;n="gecko"}else i&&alert("Engine detection failed");else;var a={},o=/^\/|([^\:\/]*:)/;a.pluginBuilder="./css-builder";var l=[],c={},d=[];a.addBuffer=function(e){if(-1==t(l,e)&&-1==t(d,e)){l.push(e);d.push(e)}};a.setBuffer=function(t,i){var s=window.location.pathname.split("/");s.pop();s=s.join("/")+"/";var n=require.toUrl("base_url").split("/");n.pop();var r=n.join("/")+"/";r=e.convertURIBase(r,s,"/");r.match(o)||(r="/"+r);"/"!=r.substr(r.length-1,1)&&(r+="/");a.inject(e(t,r,s));for(var d=0;d<l.length;d++)if(i&&".less"==l[d].substr(l[d].length-5,5)||!i&&".css"==l[d].substr(l[d].length-4,4)){!function(e){c[e]=c[e]||!0;setTimeout(function(){"function"==typeof c[e]&&c[e]();delete c[e]},7)}(l[d]);l.splice(d--,1)}};a.attachBuffer=function(e,i){for(var s=0;s<l.length;s++)if(l[s]==e){c[e]=i;return!0}if(c[e]===!0){c[e]=i;return!0}if(-1!=t(d,e)){i();return!0}};var h=function(e,t){setTimeout(function(){for(var i=0;i<document.styleSheets.length;i++){var s=document.styleSheets[i];if(s.href==e.href)return t()}h(e,t)},10)},p=function(e,t){setTimeout(function(){try{e.sheet.cssRules;return t()}catch(i){}p(e,t)},10)};if("trident"==n&&r)var u=[],f=[],g=0,m=function(e,t){var i;f.push({url:e,cb:t});i=u.shift();if(!i&&g++<12){i=document.createElement("style");s.appendChild(i)}i&&v(i)},v=function(e){var t=f.shift();if(t){e.onload=function(){t.cb(t.ss);v(e)};var i=e.styleSheet;t.ss=i.imports[i.addImport(t.url)]}else{e.onload=b;u.push(e)}};var y=function(e){var t=document.createElement("link");t.type="text/css";t.rel="stylesheet";t.href=e;return t},b=function(){};a.linkLoad=function(e,t){var a=setTimeout(function(){i&&alert("timeout");t()},1e3*M-100),o=function(){clearTimeout(a);l&&(l.onload=b);setTimeout(t,7)};if(r)if("webkit"==n){var l=y(e);h(l,o);s.appendChild(l)}else if("gecko"==n){var c=document.createElement("style");c.textContent='@import "'+e+'"';p(c,o);s.appendChild(c)}else"trident"==n&&m(e,o);else{var l=y(e);l.onload=o;s.appendChild(l)}};var w,x=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],S={},C=function(e,t,i){if(S[e])t(S[e]);else{var s,n,r;if("undefined"!=typeof XMLHttpRequest)s=new XMLHttpRequest;else if("undefined"!=typeof ActiveXObject)for(n=0;3>n;n+=1){r=x[n];try{s=new ActiveXObject(r)}catch(a){}if(s){x=[r];break}}s.open("GET",e,requirejs.inlineRequire?!1:!0);s.onreadystatechange=function(n){var r,a;if(4===s.readyState){r=s.status;if(r>399&&600>r){a=new Error(e+" HTTP status: "+r);a.xhr=s;i(a)}else{S[e]=s.responseText;t(s.responseText)}}};s.send(null)}},T=0;a.inject=function(e){if(31>T){w=document.createElement("style");w.type="text/css";s.appendChild(w);T++}w.styleSheet?w.styleSheet.cssText+=e:w.appendChild(document.createTextNode(e))};var I=/@import\s*(url)?\s*(('([^']*)'|"([^"]*)")|\(('([^']*)'|"([^"]*)"|([^\)]*))\))\s*;?/g,E=window.location.pathname.split("/");E.pop();E=E.join("/")+"/";var P=function(t,i,s){t.match(o)||(t="/"+e.convertURIBase(t,E,"/"));C(t,function(n){n=e(n,t,E);for(var r,a=[],o=[],l=[];r=I.exec(n);){var c=r[4]||r[5]||r[7]||r[8]||r[9];a.push(c);o.push(I.lastIndex-r[0].length);l.push(r[0].length)}for(var d=0,h=0;h<a.length;h++)(function(e){P(a[e],function(t){n=n.substr(0,o[e])+t+n.substr(o[e]+l[e]);for(var s=t.length-l[e],r=e+1;r<a.length;r++)o[r]+=s;d++;d==a.length&&i(n)},s)})(h);0==a.length&&i(n)},s)};a.normalize=function(e,t){".css"==e.substr(e.length-4,4)&&(e=e.substr(0,e.length-4));return t(e)};var M,L=!1;a.load=function(e,t,s,n,o){M=M||n.waitSeconds||7;var l=e+(o?".less":".css");if(!a.attachBuffer(l,s)){fileUrl=t.toUrl(l);if(!L&&i){alert(r?"hacking links":"not hacking");L=!0}o?P(fileUrl,function(e){o&&(e=o(e,function(e){a.inject(e);setTimeout(s,7)}))}):a.linkLoad(fileUrl,s)}};i&&(a.inspect=function(){return stylesheet.styleSheet?stylesheet.styleSheet.cssText:stylesheet.innerHTML?stylesheet.innerHTML:void 0});return a});define(["jquery","underscore","backbone","plugin-dependencies","ccweb.files.extract/models/PluginConfigModel","ccweb.files.extract/models/PluginAuthModel","ccweb.files.extract/models/MetricsProxyModel","ccweb.files.extract/models/UserSettingsModel","ccweb.files.extract/models/PSDSettingsModel","ccweb.files.extract/views/detail/PSDDetailsView","ccweb.files.extract/controllers/InterceptController","ccweb.files.extract/controllers/AssetController","ccweb.files.extract/controllers/OlarkController","ccweb.files.extract/serverAPI","ccweb.files.extract/serverExtractAPI","ccweb.files.extract/utils/AutomationTestUtils","css!./css/topcoat.css","css!./css/firstUserExp.css","css!./css/jobListing.css","css!./css/inspect.css","css!./css/layers.css","css!./css/main.css","css!./css/popup.css","css!./css/preview.css","css!./css/zIndex.css","css!./css/mobile.css"],function(e,t,i,s,n,r,a,o,l,c,d,h,p,u,f,g){"use strict";window.graphite=window.graphite||{};window.graphite.events=window.graphite.events||t.extend({},i.Events);s.utils.hasFeature("temp_extract_use_webtier")?window.graphite.serverAPI=f:window.graphite.serverAPI=u;window.graphite.fflags=window.graphite.fflags||{};window.graphite.setFeatureEnabled=function(e,t){null!==e&&(window.graphite.fflags[e]=t)};window.graphite.configModel=new n;window.graphite.authModel=new r;window.graphite.metricsProxyModel=new a;if(window.graphite.metricsProxyModel){window.graphite.metricsProxyModel.setAuthModel(window.graphite.authModel);window.graphite.metricsProxyModel.setConfigModel(window.graphite.configModel)}window.__extractAutomation||(window.__extractAutomation=g);graphite.events.trigger("register-defaults");window.graphite.isFeatureEnabled=function(e){var t=!1;null!==e&&window.graphite.fflags[e]&&(t=!0);return t};window.graphite.inPublicOneUp=function(){return"link"===s.utils.getCurrentBasePath()};var m,v,y;return function(t){var i=t.get("id"),n=i.substr(i.lastIndexOf("/")+1),r=t.get("layerCompId"),a=t.get("path");if(s.utils.hasFeature("temp_extract_use_webtier")){var o=i.match(/https:\/\/cc-(us|eu|ap)1/i);n=o[1].toUpperCase()+"/"+i.substr(i.lastIndexOf("/")+1)}window.graphite.urlBase=i.substr(0,i.indexOf("/api/"));window.graphite.ownerId=t.get("owner");window.graphite.linkId=t.get("linkId");this&&(this.localContent=t.get("localContent")||!1);if(m!==n||t.get("etag")!==v){y=h.getAsset(n,r,function(){window.graphite.metricsProxyModel.authModel.isAnalyticsOptIn()&&d.applyBehaviors();var e=y.get("info"),t=e.version||"";!y.get("localContent")&&y.get("path")&&graphite.events.trigger("asset-data-loaded",{path:y.get("path"),graphiteVersion:t})},function(e){401===e.status&&graphite.events.trigger("reauthenticate")},this,a);l.setup(n);m=n;v=t.get("etag")}y.set("modified",t.get("modified"));y.set("assetId",t.get("id"));y.set("fileName",t.get("name"));y.set("type",t.get("type"));var u=y.get("imgdata");if(!u||0===u.bounds.right&&0===u.bounds.bottom){y.set("height",t.get("height"));y.set("width",t.get("width"))}y.set("size",t.get("size"));var f={$el:e("<div>").addClass("extract-plugin"),show:function(){window.graphite.inPublicOneUp()&&this.$el.addClass("public");this.psdDetailsView=new c({model:y});this.$el.html(this.psdDetailsView.$el);this.addHandlers()},hide:function(){graphite.events.trigger("reset-layers-visibility");if(this.psdDetailsView){this.psdDetailsView.remove();this.psdDetailsView=null}this.removeHandlers();y.reset();p.hide()},addHandlers:function(){graphite.events.on("layerCompChanged",this.layerCompChanged,this)},removeHandlers:function(){graphite.events.off("layerCompChanged",this.layerCompChanged,this)},layerCompChanged:function(e){this.hide();y&&(e.get("imgdata").layerCompSelectedTab=y.get("imgdata").layerCompSelectedTab);y=e;this.show();this.trigger("added-to-dom")},trigger:function(e){"added-to-dom"===e&&this.psdDetailsView.previewView&&this.psdDetailsView.previewView.attached()},sizeChange:function(){}};return f}});
//# sourceMappingURL=main.js.map